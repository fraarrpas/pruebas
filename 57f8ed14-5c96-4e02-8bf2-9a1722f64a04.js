!function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=16)}([function(t,e){t.exports='<div id="m-setstyle-dialog" class="m-setstyle-dialog">\r\n    <div id="m-setstyle-modal" class="m-setstyle-modal">\r\n        <div id="m-setstyle-content" class="m-setstyle-content">\r\n            <div id="m-setstyle-title" class="m-setstyle-title">\r\n                <span>{{message}}</span>\r\n            </div>\r\n            <div id="m-setstyle-message" class="m-setstyle-message">\r\n                <input type="file" id="m-setstyle-file" style="display: none"/>\r\n                <input type="text" placeholder="URL o fichero local" style="width: 50%"/>\r\n                <label for="file" id="m-setstyle-filebutton">Elige un fichero</label>\r\n            </div>\r\n            <div id="m-setstyle-button" class="m-setstyle-button">\r\n                <button id="remove-button" style="margin-right: 1%">Quitar fichero</button>\r\n                <button id="ok-button" style="margin-right: 1%">Cargar fichero</button>\r\n                <button id="cancel-button">Cancelar</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},function(t,e,o){var i,n;function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*! Sortable 1.7.0 - MIT | git://github.com/rubaxa/Sortable.git */!function(a){"use strict";void 0===(n="function"==typeof(i=function(){function t(e,o){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=o=v({},o),e[U]=this;var i={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==t.supportPointer};for(var r in i)!(r in o)&&(o[r]=i[r]);for(var a in st(o),this)"_"===a.charAt(0)&&"function"==typeof this[a]&&(this[a]=this[a].bind(this));this.nativeDraggable=!o.forceFallback&&$,n(e,"mousedown",this._onTapStart),n(e,"touchstart",this._onTapStart),o.supportPointer&&n(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(n(e,"dragover",this),n(e,"dragenter",this)),rt.push(this._onDragOver),o.store&&this.sort(o.store.get(this))}function e(t,e){"clone"!==t.lastPullMode&&(e=!0),M&&M.state!==e&&(l(M,"display",e?"none":""),e||M.state&&(t.options.group.revertClone?(k.insertBefore(M,C),t._animate(w,M)):k.insertBefore(M,w)),M.state=e)}function o(t,e,o){if(t){o=o||W;do{if(">*"===e&&t.parentNode===o||m(t,e))return t}while(t=i(t))}return null}function i(t){var e=t.host;return e&&e.nodeType?e:t.parentNode}function n(t,e,o){t.addEventListener(e,o,Q)}function a(t,e,o){t.removeEventListener(e,o,Q)}function s(t,e,o){if(t)if(t.classList)t.classList[o?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(z," ").replace(" "+e+" "," ");t.className=(i+(o?" "+e:"")).replace(z," ")}}function l(t,e,o){var i=t&&t.style;if(i){if(void 0===o)return W.defaultView&&W.defaultView.getComputedStyle?o=W.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),void 0===e?o:o[e];e in i||(e="-webkit-"+e),i[e]=o+("string"==typeof o?"":"px")}}function c(t,e,o){if(t){var i=t.getElementsByTagName(e),n=0,r=i.length;if(o)for(;n<r;n++)o(i[n],n);return i}return[]}function h(t,e,o,i,n,r,a,s){t=t||e[U];var l=W.createEvent("Event"),c=t.options,h="on"+o.charAt(0).toUpperCase()+o.substr(1);l.initEvent(o,!0,!0),l.to=n||e,l.from=r||e,l.item=i||e,l.clone=M,l.oldIndex=a,l.newIndex=s,e.dispatchEvent(l),c[h]&&c[h].call(t,l)}function u(t,e,o,i,n,r,a,s){var l,c,h=t[U],u=h.options.onMove;return(l=W.createEvent("Event")).initEvent("move",!0,!0),l.to=e,l.from=t,l.dragged=o,l.draggedRect=i,l.related=n||e,l.relatedRect=r||e.getBoundingClientRect(),l.willInsertAfter=s,t.dispatchEvent(l),u&&(c=u.call(h,l,a)),c}function p(t){t.draggable=!1}function d(){et=!1}function f(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,o=e.length,i=0;o--;)i+=e.charCodeAt(o);return i.toString(36)}function g(t,e){var o=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)"TEMPLATE"===t.nodeName.toUpperCase()||">*"!==e&&!m(t,e)||o++;return o}function m(t,e){if(t){var o=(e=e.split(".")).shift().toUpperCase(),i=new RegExp("\\s("+e.join("|")+")(?=\\s)","g");return!(""!==o&&t.nodeName.toUpperCase()!=o||e.length&&((" "+t.className+" ").match(i)||[]).length!=e.length)}return!1}function y(t,e){var o,i;return function(){void 0===o&&(o=arguments,i=this,X((function(){1===o.length?t.call(i,o[0]):t.apply(i,o),o=void 0}),e))}}function v(t,e){if(t&&e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function b(t){return K&&K.dom?K.dom(t).cloneNode(!0):J?J(t).clone(!0)[0]:t.cloneNode(!0)}function _(t){return X(t,0)}function S(t){return clearTimeout(t)}if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var w,x,L,M,k,C,E,T,P,O,A,I,N,F,D,R,G,B,j,q,V={},z=/\s+/g,Z=/left|right|inline/,U="Sortable"+(new Date).getTime(),H=window,W=H.document,Y=H.parseInt,X=H.setTimeout,J=H.jQuery||H.Zepto,K=H.Polymer,Q=!1,$="draggable"in W.createElement("div"),tt=function(t){return!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&((t=W.createElement("x")).style.cssText="pointer-events:auto","auto"===t.style.pointerEvents)}(),et=!1,ot=Math.abs,it=Math.min,nt=[],rt=[],at=y((function(t,e,o){if(o&&e.scroll){var i,n,r,a,s,l,c=o[U],h=e.scrollSensitivity,u=e.scrollSpeed,p=t.clientX,d=t.clientY,f=window.innerWidth,g=window.innerHeight;if(P!==o&&(T=e.scroll,P=o,O=e.scrollFn,!0===T)){T=o;do{if(T.offsetWidth<T.scrollWidth||T.offsetHeight<T.scrollHeight)break}while(T=T.parentNode)}T&&(i=T,n=T.getBoundingClientRect(),r=(ot(n.right-p)<=h)-(ot(n.left-p)<=h),a=(ot(n.bottom-d)<=h)-(ot(n.top-d)<=h)),r||a||(a=(g-d<=h)-(d<=h),((r=(f-p<=h)-(p<=h))||a)&&(i=H)),V.vx===r&&V.vy===a&&V.el===i||(V.el=i,V.vx=r,V.vy=a,clearInterval(V.pid),i&&(V.pid=setInterval((function(){if(l=a?a*u:0,s=r?r*u:0,"function"==typeof O)return O.call(c,s,l,t);i===H?H.scrollTo(H.pageXOffset+s,H.pageYOffset+l):(i.scrollTop+=l,i.scrollLeft+=s)}),24)))}}),30),st=function(t){function e(t,e){return void 0!==t&&!0!==t||(t=o.name),"function"==typeof t?t:function(o,i){var n=i.options.group.name;return e?t:t&&(t.join?t.indexOf(n)>-1:n==t)}}var o={},i=t.group;i&&"object"==r(i)||(i={name:i}),o.name=i.name,o.checkPull=e(i.pull,!0),o.checkPut=e(i.put),o.revertClone=i.revertClone,t.group=o};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){Q={capture:!1,passive:!1}}}))}catch(t){}return t.prototype={constructor:t,_onTapStart:function(t){var e,i=this,n=this.el,r=this.options,a=r.preventOnFilter,s=t.type,l=t.touches&&t.touches[0],c=(l||t).target,u=t.target.shadowRoot&&t.path&&t.path[0]||c,p=r.filter;if(function(t){nt.length=0;for(var e=t.getElementsByTagName("input"),o=e.length;o--;){var i=e[o];i.checked&&nt.push(i)}}(n),!w&&!(/mousedown|pointerdown/.test(s)&&0!==t.button||r.disabled)&&!u.isContentEditable&&(c=o(c,r.draggable,n))&&E!==c){if(e=g(c,r.draggable),"function"==typeof p){if(p.call(this,t,c,this))return h(i,u,"filter",c,n,n,e),void(a&&t.preventDefault())}else if(p&&(p=p.split(",").some((function(t){if(t=o(u,t.trim(),n))return h(i,t,"filter",c,n,n,e),!0}))))return void(a&&t.preventDefault());r.handle&&!o(u,r.handle,n)||this._prepareDragStart(t,l,c,e)}},_prepareDragStart:function(t,e,o,i){var r,a=this,l=a.el,u=a.options,d=l.ownerDocument;o&&!w&&o.parentNode===l&&(B=t,k=l,x=(w=o).parentNode,C=w.nextSibling,E=o,R=u.group,F=i,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,w.style["will-change"]="all",r=function(){a._disableDelayedDrag(),w.draggable=a.nativeDraggable,s(w,u.chosenClass,!0),a._triggerDragStart(t,e),h(a,k,"choose",w,k,k,F)},u.ignore.split(",").forEach((function(t){c(w,t.trim(),p)})),n(d,"mouseup",a._onDrop),n(d,"touchend",a._onDrop),n(d,"touchcancel",a._onDrop),n(d,"selectstart",a),u.supportPointer&&n(d,"pointercancel",a._onDrop),u.delay?(n(d,"mouseup",a._disableDelayedDrag),n(d,"touchend",a._disableDelayedDrag),n(d,"touchcancel",a._disableDelayedDrag),n(d,"mousemove",a._disableDelayedDrag),n(d,"touchmove",a._disableDelayedDrag),u.supportPointer&&n(d,"pointermove",a._disableDelayedDrag),a._dragStartTimer=X(r,u.delay)):r())},_disableDelayedDrag:function(){var t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),a(t,"mouseup",this._disableDelayedDrag),a(t,"touchend",this._disableDelayedDrag),a(t,"touchcancel",this._disableDelayedDrag),a(t,"mousemove",this._disableDelayedDrag),a(t,"touchmove",this._disableDelayedDrag),a(t,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(t,e){(e=e||("touch"==t.pointerType?t:null))?(B={target:w,clientX:e.clientX,clientY:e.clientY},this._onDragStart(B,"touch")):this.nativeDraggable?(n(w,"dragend",this),n(k,"dragstart",this._onDragStart)):this._onDragStart(B,!0);try{W.selection?_((function(){W.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(){if(k&&w){var e=this.options;s(w,e.ghostClass,!0),s(w,e.dragClass,!1),t.active=this,h(this,k,"start",w,k,k,F)}else this._nulling()},_emulateDragOver:function(){if(j){if(this._lastX===j.clientX&&this._lastY===j.clientY)return;this._lastX=j.clientX,this._lastY=j.clientY,tt||l(L,"display","none");var t=W.elementFromPoint(j.clientX,j.clientY),e=t,o=rt.length;if(t&&t.shadowRoot&&(e=t=t.shadowRoot.elementFromPoint(j.clientX,j.clientY)),e)do{if(e[U]){for(;o--;)rt[o]({clientX:j.clientX,clientY:j.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);tt||l(L,"display","")}},_onTouchMove:function(e){if(B){var o=this.options,i=o.fallbackTolerance,n=o.fallbackOffset,r=e.touches?e.touches[0]:e,a=r.clientX-B.clientX+n.x,s=r.clientY-B.clientY+n.y,c=e.touches?"translate3d("+a+"px,"+s+"px,0)":"translate("+a+"px,"+s+"px)";if(!t.active){if(i&&it(ot(r.clientX-this._lastX),ot(r.clientY-this._lastY))<i)return;this._dragStarted()}this._appendGhost(),q=!0,j=r,l(L,"webkitTransform",c),l(L,"mozTransform",c),l(L,"msTransform",c),l(L,"transform",c),e.preventDefault()}},_appendGhost:function(){if(!L){var t,e=w.getBoundingClientRect(),o=l(w),i=this.options;s(L=w.cloneNode(!0),i.ghostClass,!1),s(L,i.fallbackClass,!0),s(L,i.dragClass,!0),l(L,"top",e.top-Y(o.marginTop,10)),l(L,"left",e.left-Y(o.marginLeft,10)),l(L,"width",e.width),l(L,"height",e.height),l(L,"opacity","0.8"),l(L,"position","fixed"),l(L,"zIndex","100000"),l(L,"pointerEvents","none"),i.fallbackOnBody&&W.body.appendChild(L)||k.appendChild(L),t=L.getBoundingClientRect(),l(L,"width",2*e.width-t.width),l(L,"height",2*e.height-t.height)}},_onDragStart:function(t,e){var o=this,i=t.dataTransfer,r=o.options;o._offUpEvents(),R.checkPull(o,o,w,t)&&((M=b(w)).draggable=!1,M.style["will-change"]="",l(M,"display","none"),s(M,o.options.chosenClass,!1),o._cloneId=_((function(){k.insertBefore(M,w),h(o,k,"clone",w)}))),s(w,r.dragClass,!0),e?("touch"===e?(n(W,"touchmove",o._onTouchMove),n(W,"touchend",o._onDrop),n(W,"touchcancel",o._onDrop),r.supportPointer&&(n(W,"pointermove",o._onTouchMove),n(W,"pointerup",o._onDrop))):(n(W,"mousemove",o._onTouchMove),n(W,"mouseup",o._onDrop)),o._loopId=setInterval(o._emulateDragOver,50)):(i&&(i.effectAllowed="move",r.setData&&r.setData.call(o,i,w)),n(W,"drop",o),o._dragStartId=_(o._dragStarted))},_onDragOver:function(i){var n,r,a,s,c=this.el,h=this.options,p=h.group,f=t.active,g=R===p,m=!1,y=h.sort;if(void 0!==i.preventDefault&&(i.preventDefault(),!h.dragoverBubble&&i.stopPropagation()),!w.animated&&(q=!0,f&&!h.disabled&&(g?y||(s=!k.contains(w)):G===this||(f.lastPullMode=R.checkPull(this,f,w,i))&&p.checkPut(this,f,w,i))&&(void 0===i.rootEl||i.rootEl===this.el))){if(at(i,h,this.el),et)return;if(n=o(i.target,h.draggable,c),r=w.getBoundingClientRect(),G!==this&&(G=this,m=!0),s)return e(f,!0),x=k,void(M||C?k.insertBefore(w,M||C):y||k.appendChild(w));if(0===c.children.length||c.children[0]===L||c===i.target&&function(t,e){var o=t.lastElementChild.getBoundingClientRect();return e.clientY-(o.top+o.height)>5||e.clientX-(o.left+o.width)>5}(c,i)){if(0!==c.children.length&&c.children[0]!==L&&c===i.target&&(n=c.lastElementChild),n){if(n.animated)return;a=n.getBoundingClientRect()}e(f,g),!1!==u(k,c,w,r,n,a,i)&&(w.contains(c)||(c.appendChild(w),x=c),this._animate(r,w),n&&this._animate(a,n))}else if(n&&!n.animated&&n!==w&&void 0!==n.parentNode[U]){A!==n&&(A=n,I=l(n),N=l(n.parentNode));var v=(a=n.getBoundingClientRect()).right-a.left,b=a.bottom-a.top,_=Z.test(I.cssFloat+I.display)||"flex"==N.display&&0===N["flex-direction"].indexOf("row"),S=n.offsetWidth>w.offsetWidth,E=n.offsetHeight>w.offsetHeight,T=(_?(i.clientX-a.left)/v:(i.clientY-a.top)/b)>.5,P=n.nextElementSibling,O=!1;if(_){var F=w.offsetTop,D=n.offsetTop;O=F===D?n.previousElementSibling===w&&!S||T&&S:n.previousElementSibling===w||w.previousElementSibling===n?(i.clientY-a.top)/b>.5:D>F}else m||(O=P!==w&&!E||T&&E);var B=u(k,c,w,r,n,a,i,O);!1!==B&&(1!==B&&-1!==B||(O=1===B),et=!0,X(d,30),e(f,g),w.contains(c)||(O&&!P?c.appendChild(w):n.parentNode.insertBefore(w,O?P:n)),x=w.parentNode,this._animate(r,w),this._animate(a,n))}}},_animate:function(t,e){var o=this.options.animation;if(o){var i=e.getBoundingClientRect();1===t.nodeType&&(t=t.getBoundingClientRect()),l(e,"transition","none"),l(e,"transform","translate3d("+(t.left-i.left)+"px,"+(t.top-i.top)+"px,0)"),e.offsetWidth,l(e,"transition","all "+o+"ms"),l(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=X((function(){l(e,"transition",""),l(e,"transform",""),e.animated=!1}),o)}},_offUpEvents:function(){var t=this.el.ownerDocument;a(W,"touchmove",this._onTouchMove),a(W,"pointermove",this._onTouchMove),a(t,"mouseup",this._onDrop),a(t,"touchend",this._onDrop),a(t,"pointerup",this._onDrop),a(t,"touchcancel",this._onDrop),a(t,"pointercancel",this._onDrop),a(t,"selectstart",this)},_onDrop:function(e){var o=this.el,i=this.options;clearInterval(this._loopId),clearInterval(V.pid),clearTimeout(this._dragStartTimer),S(this._cloneId),S(this._dragStartId),a(W,"mouseover",this),a(W,"mousemove",this._onTouchMove),this.nativeDraggable&&(a(W,"drop",this),a(o,"dragstart",this._onDragStart)),this._offUpEvents(),e&&(q&&(e.preventDefault(),!i.dropBubble&&e.stopPropagation()),L&&L.parentNode&&L.parentNode.removeChild(L),k!==x&&"clone"===t.active.lastPullMode||M&&M.parentNode&&M.parentNode.removeChild(M),w&&(this.nativeDraggable&&a(w,"dragend",this),p(w),w.style["will-change"]="",s(w,this.options.ghostClass,!1),s(w,this.options.chosenClass,!1),h(this,k,"unchoose",w,x,k,F),k!==x?(D=g(w,i.draggable))>=0&&(h(null,x,"add",w,x,k,F,D),h(this,k,"remove",w,x,k,F,D),h(null,x,"sort",w,x,k,F,D),h(this,k,"sort",w,x,k,F,D)):w.nextSibling!==C&&(D=g(w,i.draggable))>=0&&(h(this,k,"update",w,x,k,F,D),h(this,k,"sort",w,x,k,F,D)),t.active&&(null!=D&&-1!==D||(D=F),h(this,k,"end",w,x,k,F,D),this.save()))),this._nulling()},_nulling:function(){k=w=x=L=C=M=E=T=P=B=j=q=D=A=I=G=R=t.active=null,nt.forEach((function(t){t.checked=!0})),nt.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragover":case"dragenter":w&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.preventDefault()}(t));break;case"mouseover":this._onDrop(t);break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],i=this.el.children,n=0,r=i.length,a=this.options;n<r;n++)o(t=i[n],a.draggable,this.el)&&e.push(t.getAttribute(a.dataIdAttr)||f(t));return e},sort:function(t){var e={},i=this.el;this.toArray().forEach((function(t,n){var r=i.children[n];o(r,this.options.draggable,i)&&(e[t]=r)}),this),t.forEach((function(t){e[t]&&(i.removeChild(e[t]),i.appendChild(e[t]))}))},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return o(t,e||this.options.draggable,this.el)},option:function(t,e){var o=this.options;if(void 0===e)return o[t];o[t]=e,"group"===t&&st(o)},destroy:function(){var t=this.el;t[U]=null,a(t,"mousedown",this._onTapStart),a(t,"touchstart",this._onTapStart),a(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(a(t,"dragover",this),a(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),rt.splice(rt.indexOf(this._onDragOver),1),this._onDrop(),this.el=t=null}},n(W,"touchmove",(function(e){t.active&&e.preventDefault()})),t.utils={on:n,off:a,css:l,find:c,is:function(t,e){return!!o(t,e,t)},extend:v,throttle:y,closest:o,toggleClass:s,clone:b,index:g,nextTick:_,cancelNextTick:S},t.create=function(e,o){return new t(e,o)},t.version="1.7.0",t})?i.call(e,o,e,t):i)||(t.exports=n)}()},function(t,e){t.exports='<div class="m-control m-managelayers-{{baseName}}">\r\n\t<div id="toolbar-button-{{baseName}}" class="m-toolbar-button m-toolbar-button-{{baseName}}">\r\n\t\t<button id="tool-btn-{{baseName}}" class="m-tool-button {{iconClass}}" title="{{tooltip}}"></button>\r\n\t</div>\r\n\t<div id="toolbar-container-{{baseName}}" class="m-toolbar-container m-toolbar-container-{{baseName}} dNone" title="">\r\n\t\t<div id="tool-{{baseName}}" class="m-tool-container m-tool-container-{{baseName}}">\r\n\t\t</div>\r\n\t</div>\r\n</div>'},function(t,e){t.exports='<div id="m-setstyle-dialog" class="m-setstyle-dialog" style="overflow: auto;">\r\n    <div id="m-setstyle-modal" class="m-setstyle-modal">\r\n        <div id="m-setstyle-content" class="m-setstyle-content" style="max-height: fit-content;">\r\n            <div id="m-setstyle-title" class="m-setstyle-title">\r\n                <span style="font-size: x-large">Ayuda</span>\r\n            </div>\r\n            <div id="m-setstyle-message" class="m-setstyle-message">\r\n                <span class="m-help-margin-width-100">\r\n                    Para poder cambiar el estilo hay que seleccionar un fichero JSON (si se quiere cambiar el estilo de una capa WFS o GeoJSON) o un fichero SLD (si se quiere cambiar el estilo de una capa WMS), también se puede cambiar el estilo con un fichero Javascript por URL.\r\n                    <br/>\r\n                    <br/>\r\n                    <div class="m-help-overflow">\r\n                        <div class="m-help-title">Formato del fichero JSON:</div>\r\n                        <div class="m-help-subtitle">Estilo simple:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "&lt;puede_ser_\'Polygon\',_\'Line\'_o_\'Point\'&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"options": {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;opciones_de_estilo&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo coropletas:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "choropleth",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"valueField": "&lt;nombre_del_parámetro&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"colors": &lt;(opcional)_array_de_colores&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"quantification": &lt;(opcional)_2_opciones:\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_función,número",_"nombre_función"_sería_"quantile"_o_"jenks"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_función_personalizada",_tiene_que_estar_cargada_en_el_TOC&gt;\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo proporcional:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "proportional",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"valueField": "&lt;nombre_del_parámetro&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"sizeMin": &lt;tamaño_mínimo&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"sizeMax": &lt;tamaño_máximo&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"pointStyle": &lt;(opcional)_estilo_de_punto&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"proportionalFunction": "&lt;(opcional)_nombre_función_personalizada,_la_función_personalizada_tiene_que_estar_cargada_en_el_TOC&gt;"\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo categoría:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "category",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"attributeName": "&lt;nombre_del_parámetro&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"categoryStyles": (opcional)_[\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "&lt;nombre_de_la_categoría&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"style": &lt;estilo_simple&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;]\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo estadístico:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "chart",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"chartStyle": {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type": "&lt;puede_ser_\'pie\',_\'pie3D\',_\'donut\'_o_\'bar\'&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"radius": "&lt;(opcional)_radio_de_la_tarta,_o_altura_máxima_de_las_barras&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"donutRatio": "&lt;(opcional)_radio_del_interior_del_donut&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"offsetX": "&lt;(opcional)_desplazamiento_en_el_eje_X&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"offsetY": "&lt;(opcional)_desplazamiento_en_el_eje_Y&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"stroke": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"color": &lt;color_del_borde&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"width": &lt;ancho_del_borde&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"fill3DColor": &lt;(opcional)_color_del_relleno&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"scheme": &lt;(opcional)_2_opciones:\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_del_tipo,_puede_ser_\'Classic\',_\'Dark\',_\'Pale\',_\'Pastel\',_\'Neon\'_o_\'Custom\'"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array_de_colores&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"label": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"text": "&lt;nombre_de_la_etiqueta&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"color": "&lt;color_del_relleno&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"stroke": &lt;borde_de_la_etiqueta,_la_estructura_de_este_objeto_se_definió_anteriormente&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"font": "&lt;nombre_de_la_fuente&gt;",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"scale": &lt;tamaño_de_la_escala&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"offset": &lt;array_de_números_de_desplazamiento_respecto_a_la_gráfica&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"rotateWithview": &lt;(opcional)_lógico_que_determina_si_el_gráfico_rota_con_el_mapa&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"variables": &lt;array,_cada_elemento_puede_ser:\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_de_la_variable"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objeto_personalizado: {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"attribute": "nombre_de_la_variable",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"legend": "(opcional)_descripción_de_la_variable_en_la_leyenda",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"fill": "(opcional)_color_de_la_variable",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"label": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"text": 3_opciones:\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"texto"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_de_la_variable_con_dobles_llaves"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nombre_función_personalizada,_la_función_personalizada_tiene_que_estar_cargada_en_el_TOC_y_parte_de_su_nombre_tiene_que_tener_la_palabra_\'funcion\'_o_\'function\'"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"radiusIncrement": (opcional)_separación_del_texto_respecto_al_borde\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"stroke": borde_de_la_etiqueta,_la_estructura_de_este_objeto_se_definió_anteriormente\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"fill": (opcional)_color_del_relleno\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"font": (opcional)_nombre_de_la_fuente\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"scale": (opcional)_escala\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo mapa de calor:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "heatmap",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"attribute": "&lt;nombre_del_atributo&gt;"\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"options": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"blur": &lt;(opcional)_tamaño_de_la_borrosidad_en_pixeles&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"radius": &lt;(opcional)_radio_de_influencia_del_punto_en_pixeles&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"gradient": &lt;(opcional)_array_de_colores&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Estilo clúster:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        {\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"geometry": "cluster",\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"clusterOptions": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ranges": [\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"min": &lt;(opcional)_valor_mínimo&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"max": &lt;(opcional)_valor_máximo&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"style": &lt;(opcional)_estilo_de_punto&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"animated": &lt;(opcional)_lógico_que_indica_si_se_quiere_animación_o_no_al_desplegar_el_cluster&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"hoverInteraction": &lt;(opcional)_lógico_que_indica_si_se_quiere_mostrar_el_polígono_que_engloba_los_elementos_al_situarse_sobre_el_cluster&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"selectInteraction": &lt;(opcional)_lógico_que_indica_si_se_quiere_que_al_pinchar_en_un_cluster_se_abra_el_abanico_de_puntos_o_no&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"displayAmount": &lt;(opcional)_lógico_que_indica_si_se_muestra_el_número_de_elementos_que_componen_el_cluster&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"maxFeaturesToSelect": &lt;(opcional)_número_máximo_de_elementos_agrupados_a_partir_de_los_cuales,_al_hacer_click,_se_hará_zoom_en_lugar_de_desplegar_el_cluster&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"distance": &lt;(opcional)_distancia_(en_píxeles)_de_agrupación_de_elementos&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;},\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;"vendorOptions": (opcional)_{\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"distanceSelectFeatures": &lt;(opcional)_distancia_(en_píxeles)_entre_los_elementos_desplegados_de_un_cluster&gt;,\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"convexHullStyle": &lt;(opcional)_estilo_del_polígono_que_engloba_los_elementos_(si_\'hoverInteraction\'_es_true)&gt;\r\n                                        <br/>\r\n                                        &nbsp;&nbsp;&nbsp;&nbsp;}\r\n                                        <br/>\r\n                                        }\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-title">Formato del fichero SLD:</div>\r\n                        <div class="m-help-subtitle">El formato del fichero SLD tiene que ser conforme a lo que se indica en el fichero "StyledLayerDescriptor.xsd" de la URL http://schemas.opengis.net/sld/ según la versión que se utilice</div>\r\n                        <br/>\r\n                        <div class="m-help-title">Uso de Javascript por URL:</div>\r\n                        <div class="m-help-subtitle">Para utilizar ficheros JSON o SLD por URL hay que utilizarlos como ficheros Javascript, a continuación se explica como hay que hacerlo</div>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Capa WFS o GeoJSON:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        var jsonViaUrlContent = `&lt;contenido_del_JSON&gt;`;\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <br/>\r\n                        <div class="m-help-subtitle">Capa WMS:</div>\r\n                        <table class="m-help-table">\r\n                            <tr>\r\n                                <td>\r\n                                    <span class="m-help-table-content">\r\n                                        var sldViaUrlContent = `&lt;contenido_del_SLD&gt;`;\r\n                                    </span>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                    </div>\r\n                </span>\r\n            </div>\r\n            <div id="m-setstyle-button" class="m-setstyle-button">\r\n                <button id="close-button">Cerrar</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},function(t,e){t.exports='<div id="tool-activelayers">\r\n\t<div id="toc-activelayers" class="m-toc-activelayers sortable-activelayers">\r\n\t\t{{#if groups}}\r\n\t\t\t{{#each groups}}\r\n\t\t\t\t{{#if groupsSL}}\r\n\t\t\t\t\t{{#gt groupsSL.length 0}}\r\n\t\t\t\t\t\t<div id="{{id}}" class="toc-item-group toc-item-group-capas-activas n1">\r\n\t\t\t\t\t\t\t<div class="toc-item-group-header gris-n1">\r\n\t\t\t\t\t\t\t\t<div class="layer-group-name">\r\n\t\t\t\t\t\t\t\t\t<button id="button-{{id}}" class="boton-toc-grupo m-accion-thematiclayers-collapse g-cartografia-flecha-abajo2"></button>\r\n\t\t\t\t\t\t\t\t\t<span class="letra-negrita-20">{{name}}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="m-area-order-hook" title="Orden de capas">\r\n\t\t\t\t\t\t\t\t\t<div class="m-accion-activelayers-order">\r\n\t\t\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">\r\n\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\td="M25 0c-.254 0-.523.086-.719.281l-7 7a1.005 1.005 0 0 0-.218 1.094c.156.371.535.625.937.625h14.031c.551 0 1-.45 1-1a1.01 1.01 0 0 0-.437-.813L25.719.282A1.015 1.015 0 0 0 25 0zM2 13v4h46v-4zm0 10v4h46v-4zm0 10v4h46v-4zm16 8c-.402 0-.781.25-.938.625-.156.375-.066.809.22 1.094l7 7c.195.195.46.281.718.281.258 0 .523-.086.719-.281l7-7c.285-.285.375-.719.218-1.094A1.023 1.023 0 0 0 32 41z">\r\n\t\t\t\t\t\t\t\t\t\t\t</path>\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div id="id-contenido-{{id}}" class="toc-activelayers toc-item-group-options">\r\n\t\t\t\t\t\t\t\t{{#each groupsSL}}\r\n\t\t\t\t\t\t\t\t\t{{> groupInside}}\r\n\t\t\t\t\t\t\t\t{{/each}}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/gt}}\r\n\t\t\t\t{{else}}\r\n\t\t\t\t\t{{#if ids}}\r\n\t\t\t\t\t\t{{> group}}\r\n\t\t\t\t\t{{else}}\r\n\t\t\t\t\t\t{{> layer}}\r\n\t\t\t\t\t{{/if}}\r\n\t\t\t\t{{/if}}\r\n\t\t\t{{/each}}\r\n\t\t{{/if}}\r\n\t\t{{#if overlayLayers}}\r\n\t\t\t{{#each overlayLayers}}\r\n\t\t\t\t{{> layer}}\r\n\t\t\t{{else}}\r\n\t\t\t<div class="info">\r\n\t\t\t\t<span>No existe ninguna capa activa</span>\r\n\t\t\t</div>\r\n\t\t\t{{/each}}\r\n\t\t{{/if}}\r\n\t</div>\r\n</div>'},function(t,e){t.exports='<div id="tool-baselayers">\r\n\t<div id="toc-baselayers" class="m-toc-baselayers">\r\n\t\t{{#if baseMapBlanco}}\r\n\t\t<div id="{{baseMapBlanco.id}}" data-id="{{baseMapBlanco.id}}" class="box m-accion-baselayers-load {{#if activo}} baseActivo{{/if}}">\r\n\t\t\t<img data-id="{{baseMapBlanco.id}}" class="m-accion-baselayers-load">\r\n\t\t\t<div class="caption simple-caption">\r\n\t\t\t\t<h5 data-id="{{baseMapBlanco.id}}" class="m-accion-baselayers-load">Fondo Blanco</h5>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{{/if}} {{#gt baseLayers.length 0}} {{#each baseLayers}}\r\n\t\t<div id="{{id}}" class="box{{#if activo}} baseActivo{{/if}}">\r\n\t\t\t<img data-id="{{id}}" class="m-accion-baselayers-load" src="{{img}}" alt="{{descripcion}}">\r\n\t\t\t<div class="caption simple-caption">\r\n\t\t\t\t<h5 data-id="{{id}}" class="m-accion-baselayers-load">{{title}}</h5>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{{/each}} {{/gt}}\r\n\t</div>\r\n</div>'},function(t){t.exports=JSON.parse('{"url":{"name":"managelayers","separator":"*"},"constructor":"M.plugin.ManageLayers","parameters":[{"type":"object","properties":[{"type":"simple","name":"paramsPlugin","position":0}]}],"files":{"ol":{"scripts":["managelayers.ol.min.js"],"styles":["managelayers.ol.min.css"]}},"metadata":{"name":"TOC","description":"Ofrece una lista con las capas que se pueden mostrar en el mapa","text":"Ofrece una lista con las capas que se pueden mostrar en el mapa","version":"2.1.0","date":"Agosto, 2021","tags":"mapea,plugin","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mSkUqFuwg4pChOlkQFXGUViyChdJWaNXB5NI/aNKQpLg4Cq4FB38Wqw4uzro6uAqC4A+Ik6OToouU+F1SaBHjHcc9vPe9H3fvAUKzylSzZxJQNctIJ2JiLr8qBl7hpxmCiJDETD2ZWczCc3zdw8f3uyjv5V335xhQCiYDfCLxPNMNi3iDeHbT0jnvE4dZWVKIz4knDLog8SPXZZffOJccFnjPsJFNx4nDxGKpi+UuZmVDJZ4hjiiqRv2FnMsK5y3OarXO2vfkLwwWtJUM12mNIoElJJGijGTUUUEVFqK0a6SYSNN5zMM/4vhT5JLJVQEjxwJqUCE5fvA/+J2tWZyecjsFY0Dvi21/jAGBXaDVsO3vY9tunQD+Z+BK6/hrTWDuk/RGR4scAYPbwMV1R5P3gMsdYPhJlwzJkfy0hGIReD+jb8oDQ7dA/5qbW/scpw9AlrJavgEODoHxEvVe93h3X3du/9a08/sBOQhykL1IYaYAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAHdElNRQfkAwMQJw41TxoYAAADlUlEQVRYw+2YT0jbcBTHXxNmsWALlVk2hjBBD2I9KPWih7JdCjK7i4joRfAmHjx56CWxSPEPExUL6gKCDoduMmSTYnXgRWQlg6q1bNUtjrZ2LULWWbGuy2+HH4RQh6sx3RzkkUuTR/Lh933v+3u/ahBCcPOCgBsZKpaKpWKpWCqWivX/Yr3++PpmYQ1vDhcPFj+af1Q8WDy8OawIluY6g83c9pzjrePLty9aUlt5u3IvsZf+mS41lPY/6G+vbr8WF5IVnn1PxXgFUEDSZOuLVo7nEEIcz7W+aCVpEiioGK/w7HuQ3LgyFhtlayZrMJB93h46DmUlhI5D9nk7hquZrGGjbH6xduO7tjkbQRMETdjmbLvxXaWSZWLFTmJtL9tImiRowjpj9cf8Ob7dH/NbZ6wETZA02fayLXYSUxJr9WBV69QCBeVj5WyUFZCQ49sFJLBRtnysHCjQOrWrB6sKi8jxHK4YgiYsU5Y/wmEgy5QFL5V93o7bIi8l74/58ZcugZMC4bTcRZffiQih5Q/LZrcZKMiCkwIBBWa3eSm49JcMAihoX2rPCJmFwELZaBmGs85YFwOLuLqBgrLRsoXAQkbItCy2yFuwnLAiyUjjs0ZRlEA8gO+nM2nmPWMcMAIF+DIOGJn3TDqTxgmBeEBUs/FZYyQZURLLe+DV9euAAoPLMPFuInWekj5NnaecG857T+45N5wXH028mzC4DECBrl/nPfAqLGI4Ge541YG92zRkcvvcWQRZkTpPuX1u05AJ7wcdrzrCyXC+ait0HMJqYr1+C4eBsLJYu4sbVF460Rfxie0mhcsCskxZtsJbR9+P8tuJ4tTQ6+0VkLD2aQ3bBIZ7/PyxWPtmt3nt05qAhK43XfKmiZywDvnDuuk6URTRr6U2gS/RGsS9QRS9brrukD/MESun6TRxmuB4DgCKCooaShuMhUZ8n9SQzZXNwa4g08RUlVQxTUywK9hc2UxqSJxgLDQ2lDYUFRQBAMdzidOE8mNg90o3tgm9S9+30ZdMJy9JTqaTfRt9epceW0P3SnceS15qE3qX3rHu4M/4rBz+jHesOzCQDGuQ34lSm5DCSYFkWwMO+UeM7a/bncud7BErIEF3S2e5a/FFfac/TgkNUXun9mnT02pT9b85+QDA+uf1Hk/PTnwH/zSXmEdsIw/vP7zuiQwpEbP+2XqmftY/ixSK666W+h+EiqViqVgqlop15fgFYx9SkSi/NVEAAAAASUVORK5CYII=","centralized":true,"buttons":[{"title":"Abre el TOC","description":"Abre la lista de capas","click":true,"querySelectorOpen":".m-managelayers.collapsed > button","querySelectorClose":".m-managelayers.opened > button","buttons":[{"title":"Capas activas","description":"Permite ver las capas activas del mapa","click":true,"querySelector":"#toolbar-button-activelayers","buttons":[{"title":"Opciones de capa","description":"Botón para ver las opciones de la capa","querySelector":".m-area-accion-activelayers-collapse > button"},{"title":"Nombre de la capa","description":"Nombre de la capa","querySelector":".m-area-title > .m-title"},{"title":"Resaltar la capa","description":"Botón para resaltar la capa","querySelector":".toc-item-layer-header.visible > .g-cartografia-tamano"},{"title":"Editar estilo de la capa","description":"Botón para editar estilo de la capa","querySelector":".toc-item-layer-header.visible > .g-cartografia-herramienta"},{"title":"Activar/desactivar capa","description":"Botón para activar/desactivar la capa","querySelector":".m-area-activate > .m-accion-activelayers-activate"},{"title":"Mover capa","description":"Botón para mover la capa, tiene que dejarse presionado y moverlo al sitio deseado para moverla","querySelector":".m-accion-activelayers-order.movible"},{"title":"Ver subgrupos de segundo nivel","description":"Botón para ver los subgrupos que hay en el grupo de primer nivel","querySelector":".toc-item-group-header.gris-n1 > .layer-group-name > .boton-toc-grupo.m-accion-thematiclayers-collapse.g-cartografia-flecha-abajo2"},{"title":"Ver capas dentro del grupo","description":"Botón para ver las capas dentro del grupo","querySelector":".toc-item-group-header.gris-negrita-n2 > .layer-group-name > .boton-toc-grupo.m-accion-thematiclayers-collapse.g-cartografia-flecha-abajo2"}]},{"title":"Capas de fondo","description":"Permite ver las capas de fondo que se pueden utilizar","click":true,"querySelector":"#toolbar-button-baselayers","buttons":[{"title":"Seleccionar base","description":"Botón para seleccionar capa base","querySelector":".m-toc-baselayers > .box.baseActivo"}]},{"title":"Capas favoritas","description":"Permite ver las capas favoritas que se pueden utilizar","click":true,"querySelector":"#toolbar-button-thematiclayers","buttons":[{"title":"Grupo de capas","description":"Botón para desplegar el grupo de capas favoritas o temáticas","querySelector":"#toc-thematiclayers > .toc-item-group > .toc-item-group-header > .layer-group-name > .m-accion-thematiclayers-collapse.g-cartografia-flecha-abajo2"},{"title":"Añadir capa","description":"Botón para añadir capa","querySelector":".toc-item-group-options > .toc-item-group-overlay"}]},{"title":"Style manager","description":"Permite utilizar el editor de estilos para las capas WFS, GeoJSON y KML","click":true,"querySelector":"#toolbar-button-stylemanager","buttons":[{"title":"Selector de capa","description":"Para editar el estilo se debe seleccionar una capa","querySelector":"#m-stylemanager-select"},{"title":"Aplicar estilo","description":"Botón para aplicar el nuevo estilo","querySelector":".m-button-styles:nth-of-type(1)"},{"title":"Limpiar estilo","description":"Botón para borrar el estilo actual","querySelector":".m-button-styles:nth-of-type(2)"}]}]}],"uuid_plugin":"746aaa94-73f3-47ad-aa71-b57a53876de4","uuid_version_plugin":"a0be4757-e4dc-4787-ba8e-b6392de51458"}}')},function(t,e){t.exports='<div id="tool-thematiclayers">\r\n\t<div id="toc-thematiclayers" class="m-toc-thematiclayers">\r\n\t\t{{#gt groups.length 0}} {{#each groups}}\r\n\t\t<div id="tocGroup_{{id}}" data-id="{{id}}" class="toc-item-group">\r\n\t\t\t<div class="toc-item-group-header">\r\n\t\t\t\t<div class="layer-group-name">\r\n\t\t\t\t\t<button data-id="{{id}}" class="m-accion-thematiclayers-collapse {{#if collapsed}}g-cartografia-flecha-abajo2{{else}}g-cartografia-flecha-arriba2{{/if}}"\r\n\t\t\t\t\t title="Lista de capas"></button>\r\n\t\t\t\t\t<span>{{title}}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t\x3c!-- <div class="layer-group-button">\r\n\t\t\t\t\t<button data-id="{{id}}" class="m-accion-thematiclayers-load-group {{#if activated}}g-cartografia-cancelar2{{else}}g-cartografia-mas2{{/if}}"\r\n\t\t\t\t\t title="{{#if activated}}Eliminar todas las capas del grupo{{else}}Añadir todas las capas del grupo{{/if}}"></button>\r\n\t\t\t\t</div> --\x3e\r\n\t\t\t</div>\r\n\t\t\t<div id="optionsTocGroup_{{id}}" class="toc-item-group-options{{#if collapsed}} dNone{{/if}}">\r\n\t\t\t\t{{#gt overlays.length 0}} {{#each overlays}}\r\n\t\t\t\t<div class="toc-item-group-overlay">\r\n\t\t\t\t\t<input id="{{@index}}-{{id}}" class="m-accion-thematiclayers-load" type="checkbox" data-id="{{id}}" value="{{id}}" title="Añadir/Eliminar capa"\r\n\t\t\t\t\t {{#if load}}checked{{/if}}>\r\n\t\t\t\t\t<label for="{{@index}}-{{id}}">{{title}}</label>\r\n\t\t\t\t</div>\r\n\t\t\t\t{{/each}} {{/gt}}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{{/each}} {{/gt}}\r\n\t</div>\r\n</div>'},function(t,e){t.exports='<div id="toolbar-managelayers" class="m-control m-toolbar m-control-toolbar-managelayers">\r\n\t\x3c!-- TOOLBARS BUTTONS --\x3e\r\n\t<div id="toolbar-buttons-managelayers" class="m-toolbar-buttons m-toolbar-buttons-managelayers"></div>\r\n\t\x3c!-- TITLE --\x3e\r\n\t<div id="toolbar-title-managelayers" class="title">Gestión de capas</div>\r\n\r\n\t<div id="toolbar-containers-managelayers" class="m-toolbar-containers m-toolbar-containers-managelayers">\r\n\t\t<div id="m-waiting-result" class="dNone m-waiting-result g-cartografia-spinner"></div>\r\n\t</div>\r\n</div>'},function(t,e){t.exports='<div id="tool-stylemanager">\r\n\t<div id="toc-stylemanager" class="m-toc-stylemanager"></div>\r\n</div>'},function(t,e){t.exports='<div id="tool-wmclayers">\r\n\t<div id="toc-wmclayers" class="m-toc-wmclayers">\r\n\t\t{{#gt wmcLayers.length 0}}\r\n\t\t<div class="toc-item-group-header">\r\n\t\t\t<div class="layer-group-name">\r\n\t\t\t\t<span>Capas WMC: {{name}}</span>\r\n\t\t\t</div>\r\n\t\t\t<div class="layer-group-button">\r\n\t\t\t\t\x3c!-- <button data-id="{{id}}" class="m-accion-thematiclayers-load-group {{#if activated}}g-cartografia-cancelar2{{else}}g-cartografia-mas2{{/if}}"\r\n\t\t\t\t title="{{#if activated}}Eliminar todas las capas del grupo{{else}}Añadir todas las capas del grupo{{/if}}"></button> --\x3e\r\n\t\t\t\t<button class="m-accion-wmclayers-load-group g-cartografia-mas2" title="Añadir todas las capas"></button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\x3c!-- <div class="title">\r\n\t\t\t<span>Capas WMC: {{name}}</span>\r\n\t\t\t<button class="m-accion-wmclayers-load-group g-cartografia-mas2" title="Añadir todas las capas"></button>\r\n\t\t</div> --\x3e\r\n\t\t{{#each wmcLayers}}\r\n\t\t<div id="wmclayer_{{id}}" class="toc-item-layer">\r\n\t\t\t<input id="{{@index}}-{{id}}" class="m-accion-wmclayers-load" type="checkbox" data-id="{{id}}" value="{{id}}" {{#if load}}checked{{/if}}\r\n\t\t\t title="Añadir/Eliminar capa">\r\n\t\t\t<label for="{{@index}}-{{id}}">{{title}}</label>\r\n\t\t</div>\r\n\t\t{{/each}} {{else}}\r\n\t\t<div class="info">\r\n\t\t\t<span>No se ha añadido ninguna capa WMC</span>\r\n\t\t</div>\r\n\t\t{{/gt}}\r\n\t</div>\r\n</div>'},function(t,e){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/**
 * ol-ext - A set of cool extensions for OpenLayers (ol) in node modules structure
 * @description ol3,openlayers,popup,menu,symbol,renderer,filter,canvas,interaction,split,statistic,charts,pie,LayerSwitcher,toolbar,animation
 * @version v3.2.1
 * @author Jean-Marc Viglino
 * @see https://github.com/Viglino/ol-ext#,
 * @license BSD-3-Clause
 */var i,n,r,a,s,l;window.ol&&!ol.ext&&(ol.ext={}),ol.ext.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},window.ol&&(ol.inherits||(ol.inherits=ol.ext.inherits)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.Element&&!Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),ol.ext.Ajax=function(t){t=t||{},ol.Object.call(this),this._auth=t.auth,this.set("dataType",t.dataType||"JSON")},ol.ext.inherits(ol.ext.Ajax,ol.Object),ol.ext.Ajax.get=function(t){var e=new ol.ext.Ajax(t);t.success&&e.on("success",(function(e){t.success(e.response,e)})),t.error&&e.on("error",(function(e){t.error(e)})),e.send(t.url,t.data,t.options)},ol.ext.Ajax.getCORS=function(t,e){var o=new XMLHttpRequest;o.open("GET",t,!0),o.send(),o.onreadystatechange=function(){this.readyState==this.HEADERS_RECEIVED&&e(o.getResponseHeader("Access-Control-Allow-Origin"))}},ol.ext.Ajax.prototype.send=function(t,e,o){var i=this,n=!1!==(o=o||{}).encode;n&&(t=encodeURI(t));var r="";for(var a in e)e.hasOwnProperty(a)&&void 0!==e[a]&&(r+=(r?"&":"?")+a+"="+(n?encodeURIComponent(e[a]):e[a]));this._request&&!1!==o.abort&&this._request.abort();var s=this._request=new XMLHttpRequest;s.open("GET",t+r,!0),o.timeout&&(s.timeout=o.timeout),this._auth&&s.setRequestHeader("Authorization","Basic "+this._auth),this.dispatchEvent({type:"loadstart"}),s.onload=function(){if(i._request=null,i.dispatchEvent({type:"loadend"}),this.status>=200&&this.status<400){var t;try{switch(i.get("dataType")){case"JSON":t=JSON.parse(this.response);break;default:t=this.response}}catch(t){return void i.dispatchEvent({type:"error",status:0,statusText:"parsererror",error:t,options:o,jqXHR:this})}i.dispatchEvent({type:"success",response:t,status:this.status,statusText:this.statusText,options:o,jqXHR:this})}else i.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:o,jqXHR:this})},s.ontimeout=function(){i._request=null,i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"error",status:this.status,statusText:"Timeout",options:o,jqXHR:this})},s.onerror=function(){i._request=null,i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"error",status:this.status,statusText:this.statusText,options:o,jqXHR:this})},s.send()},ol.ext.SVGFilter=function(t){t=t||{},ol.Object.call(this),ol.ext.SVGFilter.prototype.svg||(ol.ext.SVGFilter.prototype.svg=document.createElementNS(this.NS,"svg"),ol.ext.SVGFilter.prototype.svg.setAttribute("version","1.1"),ol.ext.SVGFilter.prototype.svg.setAttribute("width",0),ol.ext.SVGFilter.prototype.svg.setAttribute("height",0),ol.ext.SVGFilter.prototype.svg.style.position="absolute",document.body.appendChild(ol.ext.SVGFilter.prototype.svg)),this.element=document.createElementNS(this.NS,"filter"),this._id=t.id||"_ol_SVGFilter_"+ol.ext.SVGFilter.prototype._id++,this.element.setAttribute("id",this._id),t.color&&this.element.setAttribute("color-interpolation-filters",t.color),t.operation&&this.addOperation(t.operation),ol.ext.SVGFilter.prototype.svg.appendChild(this.element)},ol.ext.inherits(ol.ext.SVGFilter,ol.Object),ol.ext.SVGFilter.prototype.NS="http://www.w3.org/2000/svg",ol.ext.SVGFilter.prototype.svg=null,ol.ext.SVGFilter.prototype._id=0,ol.ext.SVGFilter.prototype.getId=function(){return this._id},ol.ext.SVGFilter.prototype.remove=function(){this.element.remove()},ol.ext.SVGFilter.prototype.addOperation=function(t){t instanceof Array?t.forEach(function(t){this.addOperation(t)}.bind(this)):(t instanceof ol.ext.SVGOperation||(t=new ol.ext.SVGOperation(t)),this.element.appendChild(t.geElement()))},ol.ext.SVGFilter.prototype.grayscale=function(t){this.addOperation({feoperation:"feColorMatrix",type:"saturate",values:t||0})},ol.ext.SVGFilter.prototype.luminanceToAlpha=function(t){t=t||{},this.addOperation({feoperation:"feColorMatrix",type:"luminanceToAlpha"}),t.gamma&&this.addOperation({feoperation:"feComponentTransfer",operations:[{feoperation:"feFuncA",type:"gamma",amplitude:t.gamma,exponent:1,offset:0}]})},ol.ext.SVGFilter.prototype.applyTo=function(t){var e=document.createElement("CANVAS");return e.width=t.naturalWidth||t.width,e.height=t.naturalHeight||t.height,e.getContext("2d").filter="url(#"+this.getId()+")",e.getContext("2d").drawImage(t,0,0),e},ol.ext.SVGOperation=function(t){"string"==typeof t&&(t={feoperation:t}),t&&t.feoperation?(ol.Object.call(this),this._name=t.feoperation,this.element=document.createElementNS(this.NS,this._name),this.setProperties(t),t.operations instanceof Array&&this.appendChild(t.operations)):console.error("[SVGOperation]: no operation defined.")},ol.ext.inherits(ol.ext.SVGOperation,ol.Object),ol.ext.SVGOperation.prototype.NS="http://www.w3.org/2000/svg",ol.ext.SVGOperation.prototype.getName=function(){return this._name},ol.ext.SVGOperation.prototype.set=function(t,e){/^feoperation$|^operations$/.test(t)||(ol.Object.prototype.set.call(this,t,e),this.element.setAttribute(t,e))},ol.ext.SVGOperation.prototype.setProperties=function(t){for(var e in t=t||{})this.set(e,t[e])},ol.ext.SVGOperation.prototype.geElement=function(){return this.element},ol.ext.SVGOperation.prototype.appendChild=function(t){t instanceof Array?t.forEach(function(t){this.appendChild(t)}.bind(this)):(t instanceof ol.ext.SVGOperation||(t=new ol.ext.SVGOperation(t)),this.element.appendChild(t.geElement()))},ol.ext.element={},ol.ext.element.create=function(t,e){var o;if(e=e||{},"TEXT"===t)o=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(o);else for(var i in o=document.createElement(t),/button/i.test(t)&&o.setAttribute("type","button"),e)switch(i){case"className":e.className&&e.className.trim&&o.setAttribute("class",e.className.trim());break;case"html":e.html instanceof Element?o.appendChild(e.html):void 0!==e.html&&(o.innerHTML=e.html);break;case"parent":e.parent&&e.parent.appendChild(o);break;case"style":this.setStyle(o,e.style);break;case"change":case"click":ol.ext.element.addListener(o,i,e[i]);break;case"on":for(var n in e.on)ol.ext.element.addListener(o,n,e.on[n]);break;case"checked":o.checked=!!e.checked;break;default:o.setAttribute(i,e[i])}return o},ol.ext.element.setHTML=function(t,e){e instanceof Element?t.appendChild(e):void 0!==e&&(t.innerHTML=e)},ol.ext.element.appendText=function(t,e){t.appendChild(document.createTextNode(e||""))},ol.ext.element.addListener=function(t,e,o){"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){t.addEventListener(e,o)}))},ol.ext.element.removeListener=function(t,e,o){"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){t.removeEventListener(e,o)}))},ol.ext.element.show=function(t){t.style.display=""},ol.ext.element.hide=function(t){t.style.display="none"},ol.ext.element.hidden=function(t){return"none"===ol.ext.element.getStyle(t,"display")},ol.ext.element.toggle=function(t){t.style.display="none"===t.style.display?"":"none"},ol.ext.element.setStyle=function(t,e){for(var o in e)switch(o){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":"number"==typeof e[o]?t.style[o]=e[o]+"px":t.style[o]=e[o];break;default:t.style[o]=e[o]}},ol.ext.element.getStyle=function(t,e){var o,i=(t.ownerDocument||document).defaultView;if(i&&i.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),o=i.getComputedStyle(t,null).getPropertyValue(e);else if(t.currentStyle&&(e=e.replace(/-(\w)/g,(function(t,e){return e.toUpperCase()})),o=t.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(o)))return function(e){var o=t.style.left,i=t.runtimeStyle.left;return t.runtimeStyle.left=t.currentStyle.left,t.style.left=e||0,e=t.style.pixelLeft+"px",t.style.left=o,t.runtimeStyle.left=i,e}(o);return/px$/.test(o)?parseInt(o):o},ol.ext.element.outerHeight=function(t){return t.offsetHeight+ol.ext.element.getStyle(t,"marginBottom")},ol.ext.element.outerWidth=function(t){return t.offsetWidth+ol.ext.element.getStyle(t,"marginLeft")},ol.ext.element.offsetRect=function(t){var e=t.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.widtth||e.right-e.left}},ol.ext.element.scrollDiv=function(t,e){var o,i=!1,n=0,r=0,a="function"==typeof e.onmove?e.onmove:function(){},s=e.vertical?"pageY":"pageX",l=e.vertical?"scrollTop":"scrollLeft",c=!1;t.querySelectorAll("img").forEach((function(t){t.ondragstart=function(){return!1}})),ol.ext.element.addListener(t,["mousedown"],(function(e){c=!1,i=e[s],r=new Date,t.classList.add("ol-move")})),ol.ext.element.addListener(window,["mousemove"],(function(e){if(c=!0,!1!==i){var h=i-e[s];t[l]+=h,(o=new Date)-r&&(n=(n+h/(o-r))/2),i=e[s],r=o,h&&a(!0)}else a(!1)})),ol.ext.element.addListener(window,["mouseup"],(function(e){c?setTimeout((function(){t.classList.remove("ol-move")})):t.classList.remove("ol-move"),c=!1,(r=new Date-r)>100?n=0:r>0&&(n=((n||0)+(i-e[s])/r)/2),t[l]+=100*n,i=!1,n=0,r=0})),e.mousewheel&&!t.classList.contains("ol-touch")&&ol.ext.element.addListener(t,["mousewheel","DOMMouseScroll","onmousewheel"],(function(e){var o=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));return t.classList.add("ol-move"),t[l]-=30*o,t.classList.remove("ol-move"),!1}))},ol.ext.element.dispatchEvent=function(t,e){var o;try{o=new CustomEvent(t)}catch(e){(o=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,{})}e.dispatchEvent(o)},ol.ext.getMapCanvas=function(t){if(!t)return null;var e=t.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return e||(t.getViewport().querySelector(".ol-layers")?((e=document.createElement("canvas")).className="ol-fixedoverlay",t.getViewport().querySelector(".ol-layers").after(e),t.on("precompose",(function(o){e.width=t.getSize()[0]*o.frameState.pixelRatio,e.height=t.getSize()[1]*o.frameState.pixelRatio}))):e=t.getViewport().querySelector("canvas")),e},ol.matrix3D={},ol.matrix3D.getTransform=function(t){var e,o,i=window.getComputedStyle(t,null),n=(i.getPropertyValue("-webkit-transform")||i.getPropertyValue("-moz-transform")||i.getPropertyValue("-ms-transform")||i.getPropertyValue("-o-transform")||i.getPropertyValue("transform")).split("(")[1].split(")")[0].split(","),r=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(16===n.length)for(e=0;e<4;++e)for(o=0;o<4;++o)r[o][e]=+n[4*e+o];else for(e=0;e<3;++e)for(o=0;o<2;++o)r[o][e]=+n[2*e+o];return r},ol.matrix3D.getTransformOrigin=function(t){for(var e=window.getComputedStyle(t,null),o=(e.getPropertyValue("-webkit-transform-origin")||e.getPropertyValue("-moz-transform-origin")||e.getPropertyValue("-ms-transform-origin")||e.getPropertyValue("-o-transform-origin")||e.getPropertyValue("transform-origin")).split(" "),i=[0,0,0,1],n=0;n<o.length;++n)i[n]=parseInt(o[n]);return i},ol.matrix3D.translateMatrix=function(t,e,o){return[[1,0,0,t],[0,1,0,e],[0,0,1,o],[0,0,0,1]]},ol.matrix3D.identity=function(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]},ol.matrix3D.roundTo=function(t,e){e||(e=1e-10);for(var o=[[],[],[],[]],i=0;i<4;i++)for(var n=0;n<4;n++)o[i][n]=Math.round(t[i][n]/e)*e;return o},ol.matrix3D.multiply=function(t,e){for(var o=[[],[],[],[]],i=0;i<4;++i)for(var n=0;n<4;++n){for(var r=0,a=0;a<4;++a)r+=t[a][i]*e[n][a];o[n][i]=r}return o},ol.matrix3D.computeTransformMatrix=function(t,e){var o=ol.matrix3D.translateMatrix(-e[0],-e[1],-e[2]),i=ol.matrix3D.translateMatrix(e[0],e[1],e[2]),n=ol.matrix3D.multiply(o,t);return ol.matrix3D.multiply(n,i)},ol.matrix3D.transformVertex=function(t,e){for(var o=[e[0],e[1],0,1],i=[],n=0;n<4;++n){i[n]=0;for(var r=0;r<4;++r)i[n]+=+t[n][r]*o[r]}return i},ol.matrix3D.projectVertex=function(t){for(var e=[],o=0;o<4;++o)e[o]=t[o]/t[3];return e},ol.matrix3D.inverse=function(t){var e=t[0][0]*t[1][1]-t[1][0]*t[0][1],o=t[0][0]*t[1][2]-t[1][0]*t[0][2],i=t[0][0]*t[1][3]-t[1][0]*t[0][3],n=t[0][1]*t[1][2]-t[1][1]*t[0][2],r=t[0][1]*t[1][3]-t[1][1]*t[0][3],a=t[0][2]*t[1][3]-t[1][2]*t[0][3],s=t[2][2]*t[3][3]-t[3][2]*t[2][3],l=t[2][1]*t[3][3]-t[3][1]*t[2][3],c=t[2][1]*t[3][2]-t[3][1]*t[2][2],h=t[2][0]*t[3][3]-t[3][0]*t[2][3],u=t[2][0]*t[3][2]-t[3][0]*t[2][2],p=t[2][0]*t[3][1]-t[3][0]*t[2][1],d=1/(e*s-o*l+i*c+n*h-r*u+a*p);if(isNaN(d)||d===1/0)throw new Error("Inverse determinant attempted to divide by zero.");return[[(t[1][1]*s-t[1][2]*l+t[1][3]*c)*d,(-t[0][1]*s+t[0][2]*l-t[0][3]*c)*d,(t[3][1]*a-t[3][2]*r+t[3][3]*n)*d,(-t[2][1]*a+t[2][2]*r-t[2][3]*n)*d],[(-t[1][0]*s+t[1][2]*h-t[1][3]*u)*d,(t[0][0]*s-t[0][2]*h+t[0][3]*u)*d,(-t[3][0]*a+t[3][2]*i-t[3][3]*o)*d,(t[2][0]*a-t[2][2]*i+t[2][3]*o)*d],[(t[1][0]*l-t[1][1]*h+t[1][3]*p)*d,(-t[0][0]*l+t[0][1]*h-t[0][3]*p)*d,(t[3][0]*r-t[3][1]*i+t[3][3]*e)*d,(-t[2][0]*r+t[2][1]*i-t[2][3]*e)*d],[(-t[1][0]*c+t[1][1]*u-t[1][2]*p)*d,(t[0][0]*c-t[0][1]*u+t[0][2]*p)*d,(-t[3][0]*n+t[3][1]*o-t[3][2]*e)*d,(t[2][0]*n-t[2][1]*o+t[2][2]*e)*d]]},window.ol&&!ol.sphere&&(ol.sphere={},ol.sphere.getDistance=function(t,e,o){return new ol.Sphere(o||6371008.8).haversineDistance(t,e)},ol.sphere.getArea=ol.Sphere.getArea,ol.sphere.getLength=ol.Sphere.getLength),ol.ext.SVGFilter.Laplacian=function(t){t=t||{},ol.ext.SVGFilter.call(this,{id:t.id});var e={feoperation:"feConvolveMatrix",in:"SourceGraphic",preserveAlpha:!0,result:"C1"};4===t.neighbours?e.kernelMatrix=[0,-1,0,-1,4,-1,0,-1,0]:e.kernelMatrix=[-1,-1,-1,-1,8,-1,-1,-1,-1],this.addOperation(e),t.grayscale?this.grayscale():t.alpha&&this.luminanceToAlpha({gamma:t.gamma})},ol.ext.inherits(ol.ext.SVGFilter.Laplacian,ol.ext.SVGFilter),ol.ext.SVGFilter.Prewitt=function(t){t=t||{},ol.ext.SVGFilter.call(this,{id:t.id,color:"sRGB"});var e={feoperation:"feConvolveMatrix",in:"SourceGraphic",preserveAlpha:!0,order:3,kernelMatrix:[-1,-1,-1,0,0,0,1,1,1],result:"V1"};this.addOperation(e),e.kernelMatrix=[1,1,1,0,0,0,-1,-1,-1],e.result="V2",this.addOperation(e),e.kernelMatrix=[-1,0,1,-1,0,1,-1,0,1],e.result="H1",this.addOperation(e),e.kernelMatrix=[1,-0,-1,1,0,-1,1,0,-1],e.result="H2",this.addOperation(e),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"V1",in2:"V2",k2:1,k3:1,result:"V"}),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"H1",in2:"H2",k2:1,k3:1,result:"H"}),this.addOperation({feoperation:"feBlend",mode:"lighten",in:"H",in2:"V"}),t.grayscale?this.grayscale():t.alpha&&this.luminanceToAlpha()},ol.ext.inherits(ol.ext.SVGFilter.Prewitt,ol.ext.SVGFilter),ol.ext.SVGFilter.Roberts=function(t){t=t||{},ol.ext.SVGFilter.call(this,{id:t.id,color:"sRGB"});var e={feoperation:"feConvolveMatrix",in:"SourceGraphic",preserveAlpha:!0,order:3,kernelMatrix:[-1,0,0,0,0,0,0,0,1],result:"V1"};this.addOperation(e),e.kernelMatrix=[1,0,0,0,0,0,0,0,-1],e.result="V2",this.addOperation(e),e.kernelMatrix=[0,0,1,0,0,0,-1,0,0],e.result="H1",this.addOperation(e),e.kernelMatrix=[0,-0,-1,0,0,0,1,0,0],e.result="H2",this.addOperation(e),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"V1",in2:"V2",k2:1,k3:1,result:"V"}),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"H1",in2:"H2",k2:1,k3:1,result:"H"}),this.addOperation({feoperation:"feBlend",mode:"lighten",in:"H",in2:"V"}),t.grayscale?this.grayscale():t.alpha&&this.luminanceToAlpha()},ol.ext.inherits(ol.ext.SVGFilter.Roberts,ol.ext.SVGFilter),ol.ext.SVGFilter.Sobel=function(t){t=t||{},ol.ext.SVGFilter.call(this,{id:t.id,color:"sRGB"});var e={feoperation:"feConvolveMatrix",in:"SourceGraphic",preserveAlpha:!0,order:3,kernelMatrix:[-1,-2,-1,0,0,0,1,2,1],result:"V1"};this.addOperation(e),e.kernelMatrix=[1,2,1,0,0,0,-1,-2,-1],e.result="V2",this.addOperation(e),e.kernelMatrix=[-1,0,1,-2,0,2,-1,0,1],e.result="H1",this.addOperation(e),e.kernelMatrix=[1,-0,-1,2,0,-2,1,0,-1],e.result="H2",this.addOperation(e),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"V1",in2:"V2",k2:1,k3:1,result:"V"}),this.addOperation({feoperation:"feComposite",operator:"arithmetic",in:"H1",in2:"H2",k2:1,k3:1,result:"H"}),this.addOperation({feoperation:"feBlend",mode:"lighten",in:"H",in2:"V"}),t.grayscale?this.grayscale():t.alpha&&this.luminanceToAlpha({gamma:t.gamma})},ol.ext.inherits(ol.ext.SVGFilter.Sobel,ol.ext.SVGFilter),window.ol&&!ol.legend&&(ol.legend={}),ol.legend.Legend=function(t){t=t||{},ol.Object.call(this),this._items=new ol.Collection,this._items.on(["add","remove","change"],function(){this.refresh()}.bind(this)),this._listElement=ol.ext.element.create("UL",{className:"ol-legend"}),this._canvas=document.createElement("canvas"),this.set("size",t.size||[40,25]),this.set("margin",0===t.margin?0:t.margin||10),this._title=new ol.legend.Item({title:t.title||"",className:"ol-title"}),this.setStyle(t.style),this.refresh()},ol.ext.inherits(ol.legend.Legend,ol.Object),ol.legend.Legend.prototype.setTitle=function(t){this._title.setTitle(t)},ol.legend.Legend.prototype.getTitle=function(){return this._title.get("title")},ol.legend.Legend.prototype.getListElement=function(){return this._listElement},ol.legend.Legend.prototype.getCanvas=function(){return this._canvas},ol.legend.Legend.prototype.setStyle=function(t){this._style=t,this.refresh()},ol.legend.Legend.prototype.addItem=function(t){t instanceof ol.legend.Item?this._items.push(t):this._items.push(new ol.legend.Item(t))},ol.legend.Legend.prototype.getItems=function(){return this._items},ol.legend.Legend.prototype.refresh=function(){var t=this._listElement;t.innerHTML="";var e=this.get("size")[0]+2*this.get("margin"),o=this.get("size")[1]+2*this.get("margin");this.getTitle()&&t.appendChild(this._title.getElement([e,o]));var i=this.getCanvas();i.width=10*e*ol.has.DEVICE_PIXEL_RATIO,i.height=(this._items.getLength()+1)*o*ol.has.DEVICE_PIXEL_RATIO,this._items.forEach(function(n,r){t.appendChild(n.getElement([e,o])),(i=this.getLegendImage(n.getProperties(),i,r+(this.getTitle()?1:0))).style.height=(this._items.length+1)*o+"px"}.bind(this)),this.dispatchEvent({type:"refresh",width:e,height:(this._items.length+1)*o})},ol.legend.Legend.prototype.getLegendImage=function(t,e,o){t=t||{};var i=this.get("size"),n=i[0]+2*this.get("margin"),r=i[1]+2*this.get("margin"),a=ol.has.DEVICE_PIXEL_RATIO;e||((e=document.createElement("canvas")).width=n*a,e.height=r*a,o=0);var s=e.getContext("2d");s.save();var l,c=ol.render.toContext(s),h=t.typeGeom,u=t.feature;!u&&t.properties&&h&&(u=/Point/.test(h)?new ol.Feature(new ol.geom.Point([0,0])):/LineString/.test(h)?new ol.Feature(new ol.geom.LineString([0,0])):new ol.Feature(new ol.geom.Polygon([[0,0]]))).setProperties(t.properties),u?("function"==typeof(l=u.getStyle())&&(l=l(u)),l||(l="function"==typeof this._style?this._style(u):this._style||[]),h=u.getGeometry().getType()):l=t.style,l instanceof Array||(l=[l]);var p,d,f=n/2,g=r/2,m=i[0]/2,y=i[1]/2;if("Point"===h){var v=null;for(p=0;d=l[p];p++){var b=d.getImage();if(b&&b.getAnchor){var _=b.getAnchor(),S=b.getSize(),w=_[0]-S[0],x=_[1]-S[1];v?ol.extent.extend(v,[w,x,w+S[0],x+S[1]]):v=[w,x,w+S[0],x+S[1]]}}v&&(f+=(v[2]+v[0])/2,g+=(v[3]+v[1])/2)}for(g+=o*r||0,p=0;d=l[p];p++)switch(c.setStyle(d),h){case ol.geom.Point:case"Point":case"MultiPoint":c.drawGeometry(new ol.geom.Point([f,g]));break;case ol.geom.LineString:case"LineString":case"MultiLineString":s.save(),s.rect(this.get("margin")*a,0,i[0]*a,e.height),s.clip(),c.drawGeometry(new ol.geom.LineString([[f-m,g],[f+m,g]])),s.restore();break;case ol.geom.Polygon:case"Polygon":case"MultiPolygon":c.drawGeometry(new ol.geom.Polygon([[[f-m,g-y],[f+m,g-y],[f+m,g+y],[f-m,g+y],[f-m,g-y]]]))}return s.restore(),e},ol.legend.Item=function(t){t=t||{},ol.Object.call(this,t),t.feature&&this.set("feature",t.feature.clone()),this.element=ol.ext.element.create("LI",{className:this.get("className")}),this._box=ol.ext.element.create("DIV",{click:function(){this.dispatchEvent({type:"select",symbol:!0})}.bind(this),parent:this.element}),this._title=ol.ext.element.create("DIV",{html:this.get("title")||"",click:function(){this.dispatchEvent({type:"select",symbol:!0})}.bind(this),parent:this.element})},ol.ext.inherits(ol.legend.Item,ol.Object),ol.legend.Item.prototype.setTitle=function(t){this.set("title",t||""),this._title.innerHTML=this.get("title")||""},ol.legend.Item.prototype.getElement=function(t){return this._title.innerHTML=this.get("title")||"",this.element.style.height=t[1]+"px",this._box.style.width=t[0]+"px",this._box.style.height=t[1]+"px",this.element},ol.control.CanvasBase=function(t){t||(t={}),this.setStyle(t.style),ol.control.Control.call(this,t)},ol.ext.inherits(ol.control.CanvasBase,ol.control.Control),ol.control.CanvasBase.prototype.setMap=function(t){this.getCanvas(t);var e=this.getMap();this._listener&&(ol.Observable.unByKey(this._listener),this._listener=null),ol.control.Control.prototype.setMap.call(this,t),e&&e.renderSync(),t&&(this._listener=t.on("postcompose",this._draw.bind(this)))},ol.control.CanvasBase.prototype.getCanvas=function(t){return ol.ext.getMapCanvas(t)},ol.control.CanvasBase.prototype.getContext=function(t){var e=t.context;if(!e&&this.getMap()){var o=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];e=o?o.getContext("2d"):null}return e},ol.control.CanvasBase.prototype.setStyle=function(t){this._style=t||new ol.style.Style({})},ol.control.CanvasBase.prototype.getStyle=function(){return this._style},ol.control.CanvasBase.prototype.getStroke=function(){return this._style.getStroke()||this._style.setStroke(new ol.style.Stroke({color:"#000",width:1.25})),this._style.getStroke()},ol.control.CanvasBase.prototype.getFill=function(){return this._style.getFill()||this._style.setFill(new ol.style.Fill({color:"#fff"})),this._style.getFill()},ol.control.CanvasBase.prototype.getTextStroke=function(){var t=this._style.getText();return t||(t=new ol.style.Text({})),t.getStroke()||t.setStroke(new ol.style.Stroke({color:"#fff",width:3})),t.getStroke()},ol.control.CanvasBase.prototype.getTextFill=function(){var t=this._style.getText();return t||(t=new ol.style.Text({})),t.getFill()||t.setFill(new ol.style.Fill({color:"#fff"})),t.getFill()},ol.control.CanvasBase.prototype.getTextFont=function(){var t=this._style.getText();return t||(t=new ol.style.Text({})),t.getFont()||t.setFont("12px sans-serif"),t.getFont()},ol.control.CanvasBase.prototype._draw=function(){console.warn("[CanvasBase] draw function not implemented.")},ol.control.SelectBase=function(t){var e;t||(t={}),this._features=this.setFeatures(t.features),t.target?e=document.createElement("div"):((e=document.createElement("div")).className="ol-select ol-unselectable ol-control ol-collapsed",ol.ext.element.create("BUTTON",{type:"button",on:{"click touchstart":function(t){e.classList.toggle("ol-collapsed"),t.preventDefault()}},parent:e})),t.className&&e.classList.add(t.className),e.appendChild(t.content),ol.ext.element.create("BUTTON",{html:t.btInfo||"OK",className:"ol-ok",on:{"click touchstart":this.doSelect.bind(this)},parent:t.content}),ol.control.Control.call(this,{element:e,target:t.target}),this.setSources(t.source)},ol.ext.inherits(ol.control.SelectBase,ol.control.Control),ol.control.SelectBase.prototype.setSources=function(t){t?this.set("source",t instanceof Array?t:[t]):this.unset("source")},ol.control.SelectBase.prototype.setFeatures=function(t){t instanceof ol.Collection?this._features=t:this._features=null},ol.control.SelectBase.prototype.getFeatures=function(){return this._features},ol.control.SelectBase.prototype.operationsList={"=":"=","!=":"≠","<":"<","<=":"≤",">=":"≥",">":">",contain:"⊂","!contain":"⊄",regexp:"≃","!regexp":"≄"},ol.control.SelectBase.prototype._escape=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},ol.control.SelectBase.prototype._checkCondition=function(t,e,o){if(!e.attr)return!0;var i=t.get(e.attr);switch(e.op){case"=":return new RegExp("^"+this._escape(e.val)+"$",o?"":"i").test(i);case"!=":return!new RegExp("^"+this._escape(e.val)+"$",o?"":"i").test(i);case"<":return i<e.val;case"<=":return i<=e.val;case">":return i>e.val;case">=":return i>=e.val;case"contain":return new RegExp(this._escape(e.val),o?"":"i").test(i);case"!contain":return!new RegExp(this._escape(e.val),o?"":"i").test(i);case"regexp":return new RegExp(e.val,o?"":"i").test(i);case"!regexp":return!new RegExp(e.val,o?"":"i").test(i);default:return!1}},ol.control.SelectBase.prototype._selectFeatures=function(t,e,o,i,n){var r;o=o||[];for(var a=e.length-1;r=e[a];a--){for(var s,l=i,c=0;s=o[c];c++)s.attr&&(l=i?l&&this._checkCondition(r,s,n):l||this._checkCondition(r,s,n));l?t.push(r):this._features&&this._features.removeAt(a)}return t},ol.control.SelectBase.prototype.getSources=function(){if(this.get("source"))return this.get("source");var t=[];return this.getMap()&&function e(o){o.forEach((function(o){o.getLayers?e(o.getLayers()):o.getSource&&o.getSource()instanceof ol.source.Vector&&t.push(o.getSource())}))}(this.getMap().getLayers()),t},ol.control.SelectBase.prototype.doSelect=function(t){var e=[];if((t=t||{}).features)this._selectFeatures(e,t.features,t.conditions,t.matchAll,t.useCase);else if(this._features)this._selectFeatures(e,this._features.getArray(),t.conditions,t.matchAll,t.useCase);else{(t.sources||this.getSources()).forEach(function(o){this._selectFeatures(e,o.getFeatures(),t.conditions,t.matchAll,t.useCase)}.bind(this))}return this.dispatchEvent({type:"select",features:e}),e},ol.control.Button=function(t){t=t||{};var e=document.createElement("div");e.className=(t.className||"")+" ol-button ol-unselectable ol-control";var o=this,i=this.button_=document.createElement(/ol-text-button/.test(t.className)?"div":"button");i.type="button",t.title&&(i.title=t.title),t.html instanceof Element?i.appendChild(t.html):i.innerHTML=t.html||"";var n=function(e){e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),t.handleClick&&t.handleClick.call(o,e)};i.addEventListener("click",n),i.addEventListener("touchstart",n),e.appendChild(i),!t.title&&i.firstElementChild&&(i.title=i.firstElementChild.title),ol.control.Control.call(this,{element:e,target:t.target}),t.title&&this.set("title",t.title),t.title&&this.set("title",t.title),t.name&&this.set("name",t.name)},ol.ext.inherits(ol.control.Button,ol.control.Control),ol.control.Button.prototype.setVisible=function(t){t?ol.ext.element.show(this.element):ol.ext.element.hide(this.element)},ol.control.Button.prototype.setTitle=function(t){this.button_.setAttribute("title",t)},ol.control.Button.prototype.setHtml=function(t){ol.ext.element.setHTML(this.button_,t)},ol.control.Button.prototype.getButtonElement=function(){return this.button_},ol.control.Toggle=function(t){t=t||{};var e=this;this.interaction_=t.interaction,this.interaction_&&(this.interaction_.setActive(t.active),this.interaction_.on("change:active",(function(){e.setActive(e.interaction_.getActive())}))),t.toggleFn&&(t.onToggle=t.toggleFn),t.handleClick=function(){e.toggle(),t.onToggle&&t.onToggle.call(e,e.getActive())},t.className=(t.className||"")+" ol-toggle",ol.control.Button.call(this,t),this.set("title",t.title),this.set("autoActivate",t.autoActivate),t.bar&&(this.subbar_=t.bar,this.subbar_.setTarget(this.element),this.subbar_.element.classList.add("ol-option-bar")),this.setActive(t.active),this.setDisable(t.disable)},ol.ext.inherits(ol.control.Toggle,ol.control.Button),ol.control.Toggle.prototype.setMap=function(t){!t&&this.getMap()&&(this.interaction_&&this.getMap().removeInteraction(this.interaction_),this.subbar_&&this.getMap().removeControl(this.subbar_)),ol.control.Button.prototype.setMap.call(this,t),t&&(this.interaction_&&t.addInteraction(this.interaction_),this.subbar_&&t.addControl(this.subbar_))},ol.control.Toggle.prototype.getSubBar=function(){return this.subbar_},ol.control.Toggle.prototype.getDisable=function(){var t=this.element.querySelector("button");return t&&t.disabled},ol.control.Toggle.prototype.setDisable=function(t){this.getDisable()!=t&&(this.element.querySelector("button").disabled=t,t&&this.getActive()&&this.setActive(!1),this.dispatchEvent({type:"change:disable",key:"disable",oldValue:!t,disable:t}))},ol.control.Toggle.prototype.getActive=function(){return this.element.classList.contains("ol-active")},ol.control.Toggle.prototype.toggle=function(){this.getActive()?this.setActive(!1):this.setActive(!0)},ol.control.Toggle.prototype.setActive=function(t){this.interaction_&&this.interaction_.setActive(t),this.subbar_&&this.subbar_.setActive(t),this.getActive()!==t&&(t?this.element.classList.add("ol-active"):this.element.classList.remove("ol-active"),this.dispatchEvent({type:"change:active",key:"active",oldValue:!t,active:t}))},ol.control.Toggle.prototype.setInteraction=function(t){this.interaction_=t},ol.control.Toggle.prototype.getInteraction=function(){return this.interaction_},ol.control.Search=function(t){var e=this;t||(t={}),null==t.typing&&(t.typing=300),this._classname=t.className||"search";var o=(t.className||"")+" ol-search"+(t.target?"":" ol-unselectable ol-control"),i=ol.ext.element.create("DIV",{className:o});if(!1!==t.collapsed&&i.classList.add("ol-collapsed"),t.target||(this.button=document.createElement("BUTTON"),this.button.setAttribute("type","button"),this.button.setAttribute("title",t.title||t.label||"Search"),this.button.addEventListener("click",(function(){if(i.classList.toggle("ol-collapsed"),!i.classList.contains("ol-collapsed")){i.querySelector("input.search").focus();for(var t=i.querySelectorAll("li"),o=0;o<t.length;o++)t[o].classList.remove("select");s.value||e.drawList_()}})),i.appendChild(this.button)),t.inputLabel){var n=document.createElement("LABEL");n.innerText=t.inputLabel,i.appendChild(n)}var r,a="",s=this._input=document.createElement("INPUT");s.setAttribute("type","search"),s.setAttribute("class","search"),s.setAttribute("autocomplete","off"),s.setAttribute("placeholder",t.placeholder||"Search..."),s.addEventListener("change",(function(t){e.dispatchEvent({type:"change:input",input:t,value:s.value})}));var l=function(o){var n=i.querySelector("ul.autocomplete li.select"),l=s.value;if("ArrowDown"==o.key||"ArrowUp"==o.key||"Down"==o.key||"Up"==o.key)n?(n.classList.remove("select"),(n=/Down/.test(o.key)?n.nextElementSibling:n.previousElementSibling)&&n.classList.add("select")):i.querySelector("ul.autocomplete li").classList.add("select");else if("input"!=o.type||l)if(!n||"search"!=o.type&&"Enter"!=o.key)if("search"==o.type||"Enter"==o.key||a!=l&&t.typing>=0)if(a=l){r&&clearTimeout(r);var c=e.get("minLength");r=setTimeout((function(){if(a.length>=c){var t=e.autocomplete(a,(function(t){e.drawList_(t)}));t&&e.drawList_(t)}else e.drawList_()}),t.typing)}else e.drawList_();else(n=i.querySelector("ul.autocomplete li"))&&n.classList.remove("select");else i.classList.contains("ol-control")&&s.blur(),n.classList.remove("select"),a=l,e._handleSelect(e._list[n.getAttribute("data-search")]);else setTimeout((function(){e.drawList_()}),200)};if(s.addEventListener("keyup",l),s.addEventListener("search",l),s.addEventListener("cut",l),s.addEventListener("paste",l),s.addEventListener("input",l),t.noCollapse||(s.addEventListener("blur",function(){setTimeout(function(){s!==document.activeElement&&(i.classList.add("ol-collapsed"),this.set("reverse",!1),i.classList.remove("ol-revers"))}.bind(this),200)}.bind(this)),s.addEventListener("focus",function(){this.get("reverse")||(i.classList.remove("ol-collapsed"),i.classList.remove("ol-revers"))}.bind(this))),i.appendChild(s),t.reverse){var c=ol.ext.element.create("BUTTON",{type:"button",class:"ol-revers",title:"click on the map",click:function(){this.get("reverse")?this.set("reverse",!1):(this.set("reverse",!this.get("reverse")),s.focus(),i.classList.add("ol-revers"))}.bind(this)});i.appendChild(c)}var h=document.createElement("UL");h.classList.add("autocomplete"),i.appendChild(h),ol.control.Control.call(this,{element:i,target:t.target}),"function"==typeof t.getTitle&&(this.getTitle=t.getTitle),"function"==typeof t.autocomplete&&(this.autocomplete=t.autocomplete),this.set("copy",t.copy),this.set("minLength",t.minLength||1),this.set("maxItems",t.maxItems||10),this.set("maxHistory",t.maxHistory||t.maxItems||10),t.onselect&&this.on("select",t.onselect),t.centerOnSelect&&this.on("select",function(t){var e=this.getMap();e&&e.getView().setCenter(t.coordinate)}.bind(this)),t.zoomOnSelect&&this.on("select",function(e){var o=this.getMap();o&&(o.getView().setCenter(e.coordinate),o.getView().getZoom()<t.zoomOnSelect&&o.getView().setZoom(t.zoomOnSelect))}.bind(this)),this.restoreHistory(),this.drawList_()},ol.ext.inherits(ol.control.Search,ol.control.Control),ol.control.Search.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener=t.on("click",this._handleClick.bind(this)))},ol.control.Search.prototype.collapse=function(t){!1===t?this.element.classList.remove("ol-collapsed"):this.element.classList.add("ol-collapsed")},ol.control.Search.prototype.getInputField=function(){return this._input},ol.control.Search.prototype.getTitle=function(t){return t.name||"No title"},ol.control.Search.prototype._getTitleTxt=function(t){return ol.ext.element.create("DIV",{html:this.getTitle(t)}).innerText},ol.control.Search.prototype.search=function(){var t=this.element.querySelector("input.search");this._triggerCustomEvent("search",t)},ol.control.Search.prototype._handleClick=function(t){this.get("reverse")&&(document.activeElement.blur(),this.reverseGeocode(t.coordinate))},ol.control.Search.prototype.reverseGeocode=function(){},ol.control.Search.prototype._triggerCustomEvent=function(t,e){ol.ext.element.dispatchEvent(t,e)},ol.control.Search.prototype.setInput=function(t,e){var o=this.element.querySelector("input.search");o.value=t,e&&this._triggerCustomEvent("keyup",o)},ol.control.Search.prototype.select=function(t,e,o,i){var n={type:"select",search:t,reverse:!!e,coordinate:o};if(i)for(var r in i)n[r]=i[r];this.dispatchEvent(n)},ol.control.Search.prototype._handleSelect=function(t,e,o){if(t){var i,n=this.get("history");try{var r=JSON.stringify(t);for(i=n.length-1;i>=0;i--)n[i]&&JSON.stringify(n[i])!==r||n.splice(i,1)}catch(e){for(i=n.length-1;i>=0;i--)n[i]===t&&n.splice(i,1)}n.unshift(t);for(var a=Math.max(0,this.get("maxHistory")||10)||0;n.length>a;)n.pop();this.saveHistory(),this.select(t,e,null,o),e&&(this.setInput(this._getTitleTxt(t)),this.drawList_(),setTimeout(function(){this.collapse(!1)}.bind(this),300))}},ol.control.Search.prototype._history={},ol.control.Search.prototype.saveHistory=function(){if(this.get("maxHistory")>=0)try{localStorage["ol@search-"+this._classname]=JSON.stringify(this.get("history"))}catch(t){}else localStorage.removeItem("ol@search-"+this._classname)},ol.control.Search.prototype.restoreHistory=function(){if(this._history[this._classname])this.set("history",this._history[this._classname]);else try{this._history[this._classname]=JSON.parse(localStorage["ol@search-"+this._classname]),this.set("history",this._history[this._classname])}catch(t){this.set("history",[])}},ol.control.Search.prototype.clearHistory=function(){this.set("history",[]),this.saveHistory(),this.drawList_()},ol.control.Search.prototype.getHistory=function(){return this.get("history")},ol.control.Search.prototype.autocomplete=function(t,e){return e([]),!1},ol.control.Search.prototype.drawList_=function(t){var e=this,o=this.element.querySelector("ul.autocomplete");if(o.innerHTML="",this._list=[],t)o.setAttribute("class","autocomplete");else{if(this.element.querySelector("input.search").value)return;t=this.get("history"),o.setAttribute("class","autocomplete history")}for(var i,n=Math.min(e.get("maxItems"),t.length),r=0;r<n;r++)if(t[r]&&(!r||!e.equalFeatures(t[r],t[r-1]))){(i=document.createElement("LI")).setAttribute("data-search",this._list.length),this._list.push(t[r]),i.addEventListener("click",(function(t){e._handleSelect(e._list[t.currentTarget.getAttribute("data-search")])}));var a=e.getTitle(t[r]);a instanceof Element?i.appendChild(a):i.innerHTML=a,o.appendChild(i)}n&&this.get("copy")&&((i=document.createElement("LI")).classList.add("copy"),i.innerHTML=this.get("copy"),o.appendChild(i))},ol.control.Search.prototype.equalFeatures=function(){return!1},ol.control.SearchJSON=function(t){(t=t||{}).className=t.className||"JSON",delete t.autocomplete,t.minLength=t.minLength||3,t.typing=t.typing||800,ol.control.Search.call(this,t);var e=t.url||"";if("https:"===window.location.protocol){var o=document.createElement("a");o.href=e,o.protocol=window.location.protocol,e=o.href}this.set("url",e),this._ajax=new ol.ext.Ajax({dataType:"JSON",auth:t.authentication}),this._ajax.on("success",function(t){t.status>=200&&t.status<400?"function"==typeof this._callback&&this._callback(t.response):("function"==typeof this._callback&&this._callback(!1,"error"),console.log("AJAX ERROR",arguments))}.bind(this)),this._ajax.on("error",function(){"function"==typeof this._callback&&this._callback(!1,"error"),console.log("AJAX ERROR",arguments)}.bind(this)),this._ajax.on("loadstart",function(){this.element.classList.add("searching")}.bind(this)),this._ajax.on("loadend",function(){this.element.classList.remove("searching")}.bind(this)),"function"==typeof t.handleResponse&&(this.handleResponse=t.handleResponse)},ol.ext.inherits(ol.control.SearchJSON,ol.control.Search),ol.control.SearchJSON.prototype.ajax=function(t,e,o,i){i=i||{},this._callback=o,this._ajax.set("dataType",i.dataType||"JSON"),this._ajax.send(t,e,i)},ol.control.SearchJSON.prototype.autocomplete=function(t,e){var o=this.requestData(t),i=encodeURI(this.get("url"));this.ajax(i,o,(function(t){"function"==typeof e&&e(this.handleResponse(t))}))},ol.control.SearchJSON.prototype.requestData=function(t){return{q:t}},ol.control.SearchJSON.prototype.handleResponse=function(t){return t},ol.control.SearchPhoton=function(t){(t=t||{}).className=t.className||"photon",t.url=t.url||"https://photon.komoot.io/api/",t.copy=t.copy||'<a href="http://www.openstreetmap.org/copyright" target="new">&copy; OpenStreetMap contributors</a>',ol.control.SearchJSON.call(this,t),this.set("lang",t.lang),this.set("position",t.position)},ol.ext.inherits(ol.control.SearchPhoton,ol.control.SearchJSON),ol.control.SearchPhoton.prototype.getTitle=function(t){var e=t.properties;return(e.housenumber||"")+" "+(e.street||e.name||"")+"<i> "+(e.postcode||"")+" "+(e.city||"")+" ("+e.country+")</i>"},ol.control.SearchPhoton.prototype.requestData=function(t){var e={q:t,lang:this.get("lang"),limit:this.get("maxItems")};if(this.get("position")){var o=this.getMap().getView(),i=new ol.geom.Point(o.getCenter());i=i.transform(o.getProjection(),"EPSG:4326").getCoordinates(),e.lon=i[0],e.lat=i[1]}return e},ol.control.SearchPhoton.prototype.handleResponse=function(t){return t.features},ol.control.SearchPhoton.prototype.equalFeatures=function(t,e){return this.getTitle(t)===this.getTitle(e)&&t.geometry.coordinates[0]===e.geometry.coordinates[0]&&t.geometry.coordinates[1]===e.geometry.coordinates[1]},ol.control.SearchPhoton.prototype.select=function(t){var e=t.geometry.coordinates;try{e=ol.proj.transform(t.geometry.coordinates,"EPSG:4326",this.getMap().getView().getProjection())}catch(t){}this.dispatchEvent({type:"select",search:t,coordinate:e})},ol.control.SearchPhoton.prototype.reverseData=function(t){var e=ol.proj.transform(t,this.getMap().getView().getProjection(),"EPSG:4326");return{lon:e[0],lat:e[1]}},ol.control.SearchPhoton.prototype.reverseGeocode=function(t,e){this.ajax(this.get("url").replace("/api/","/reverse/").replace("/search/","/reverse/"),this.reverseData(t),function(t){t.features&&(t=t.features),t instanceof Array||(t=[t]),e?e.call(this,t):this._handleSelect(t[0],!0)}.bind(this))},ol.control.SearchGeoportail=function(t){(t=t||{}).className=t.className||"IGNF",t.typing=t.typing||500,t.url="https://wxs.ign.fr/"+t.apiKey+"/ols/apis/completion",t.copy='<a href="https://www.geoportail.gouv.fr/" target="new">&copy; IGN-Géoportail</a>',ol.control.SearchJSON.call(this,t),this.set("type",t.type||"StreetAddress,PositionOfInterest"),this.set("timeout",t.timeout||2e3)},ol.ext.inherits(ol.control.SearchGeoportail,ol.control.SearchJSON),ol.control.SearchGeoportail.prototype.reverseGeocode=function(t,e){var o=ol.proj.transform(t,this.getMap().getView().getProjection(),"EPSG:4326");this._handleSelect({x:o[0],y:o[1],fulltext:o[0].toFixed(6)+","+o[1].toFixed(6)},!0,e);var i="Commune"===this.get("type")?"PositionOfInterest":this.get("type")||"StreetAddress";/,/.test(i)&&(i="StreetAddress");var n='<?xml version="1.0" encoding="UTF-8"?><XLS xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml" xmlns="http://www.opengis.net/xls" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.2" xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"> <Request requestID="1" version="1.2" methodName="ReverseGeocodeRequest" maximumResponses="1" >  <ReverseGeocodeRequest>   <ReverseGeocodePreference>'+i+"</ReverseGeocodePreference>   <Position>    <gml:Point><gml:pos>"+o[1]+" "+o[0]+"</gml:pos></gml:Point>   </Position>  </ReverseGeocodeRequest> </Request></XLS>";this.ajax(this.get("url").replace("ols/apis/completion","geoportail/ols"),{xls:n},function(t){var i={};if(t){var n=(t=t.replace(/\n|\r/g,"")).replace(/.*<gml:pos>(.*)<\/gml:pos>.*/,"$1").split(" ");if(Number(n[1])||Number(n[0]))if(i.x=o[0],i.y=o[1],i.city=t.replace(/.*<Place type="Municipality">([^<]*)<\/Place>.*/,"$1"),i.insee=t.replace(/.*<Place type="INSEE">([^<]*)<\/Place>.*/,"$1"),i.zipcode=t.replace(/.*<PostalCode>([^<]*)<\/PostalCode>.*/,"$1"),/<Street>/.test(t)){i.kind="",i.country="StreetAddress",i.street=t.replace(/.*<Street>([^<]*)<\/Street>.*/,"$1");var r=t.replace(/.*<Building number="([^"]*).*/,"$1");i.fulltext=r+" "+i.street+", "+i.zipcode+" "+i.city}else i.kind=t.replace(/.*<Place type="Nature">([^<]*)<\/Place>.*/,"$1"),i.country="PositionOfInterest",i.street="",i.fulltext=i.zipcode+" "+i.city;else i={x:o[0],y:o[1],fulltext:o[0].toFixed(6)+","+o[1].toFixed(6)}}else i={x:o[0],y:o[1],fulltext:o[0].toFixed(6)+","+o[1].toFixed(6)};"function"==typeof e?e.call(this,[i]):(this.getHistory().shift(),this._handleSelect(i,!0,e))}.bind(this),{timeout:this.get("timeout"),dataType:"XML"})},ol.control.SearchGeoportail.prototype.getTitle=function(t){return t.fulltext},ol.control.SearchGeoportail.prototype.requestData=function(t){return{text:t,type:"Commune"===this.get("type")?"PositionOfInterest":this.get("type")||"StreetAddress,PositionOfInterest",maximumResponses:this.get("maxItems")}},ol.control.SearchGeoportail.prototype.handleResponse=function(t){var e=t.results;if("Commune"===this.get("type"))for(var o=e.length-1;o>=0;o--)e[o].kind&&(e[o].classification>5||"Département"==e[o].kind)&&e.splice(o,1);return e},ol.control.SearchGeoportail.prototype.select=function(t,e,o,i){if(t.x||t.y){var n=[Number(t.x),Number(t.y)];try{n=ol.proj.transform(n,"EPSG:4326",this.getMap().getView().getProjection())}catch(t){}"Commune"===this.get("type")?this.searchCommune(t,(function(){ol.control.Search.prototype.select.call(this,t,e,n,i)})):ol.control.Search.prototype.select.call(this,t,e,n,i)}else this.searchCommune(t)},ol.control.SearchGeoportail.prototype.searchCommune=function(t,e){var o='<?xml version="1.0" encoding="UTF-8"?><XLS xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml" xmlns="http://www.opengis.net/xls" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.2" xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"><RequestHeader/><Request requestID="1" version="1.2" methodName="LocationUtilityService"><GeocodeRequest returnFreeForm="false"><Address countryCode="PositionOfInterest"><freeFormAddress>'+t.zipcode+" "+t.city+"+</freeFormAddress></Address></GeocodeRequest></Request></XLS>";this.ajax(this.get("url").replace("ols/apis/completion","geoportail/ols"),{xls:o},function(o){if(o){var i=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("GeocodedAddress")[0],n=i.getElementsByTagName("gml:Point")[0].textContent.trim().split(" ");t.x=Number(n[1]),t.y=Number(n[0]);for(var r=i.getElementsByTagName("Place"),a=0;a<r.length;a++)switch(r[a].attributes.type.value){case"Nature":t.kind=r[a].textContent;break;case"INSEE":t.insee=r[a].textContent}(t.x||t.y)&&(e?e.call(this,[t]):this._handleSelect(t))}}.bind(this),{dataType:"XML"})},ol.control.LayerSwitcher=function(t){t=t||{};var e,o=this;this.dcount=0,this.show_progress=t.show_progress,this.oninfo="function"==typeof t.oninfo?t.oninfo:null,this.onextent="function"==typeof t.onextent?t.onextent:null,this.hasextent=t.extent||t.onextent,this.hastrash=t.trash,this.reordering=!1!==t.reordering,this._layers=[],this._layerGroup=t.layerGroup&&t.layerGroup.getLayers?t.layerGroup:null,"function"==typeof t.displayInLayerSwitcher&&(this.displayInLayerSwitcher=t.displayInLayerSwitcher),t.target?e=ol.ext.element.create("DIV",{className:t.switcherClass||"ol-layerswitcher"}):(e=ol.ext.element.create("DIV",{className:(t.switcherClass||"ol-layerswitcher")+" ol-unselectable ol-control"}),!1!==t.collapsed?e.classList.add("ol-collapsed"):e.classList.add("ol-forceopen"),this.button=ol.ext.element.create("BUTTON",{type:"button",parent:e}),this.button.addEventListener("touchstart",(function(t){e.classList.toggle("ol-collapsed"),o.dispatchEvent({type:"toggle",collapsed:e.classList.contains("ol-collapsed")}),t.preventDefault(),o.overflow()})),this.button.addEventListener("click",(function(){e.classList.toggle("ol-forceopen"),e.classList.add("ol-collapsed"),o.dispatchEvent({type:"toggle",collapsed:!e.classList.contains("ol-forceopen")}),o.overflow()})),t.mouseover&&(e.addEventListener("mouseleave",(function(){e.classList.add("ol-collapsed"),o.dispatchEvent({type:"toggle",collapsed:!0})})),e.addEventListener("mouseover",(function(){e.classList.remove("ol-collapsed"),o.dispatchEvent({type:"toggle",collapsed:!1})}))),this.topv=ol.ext.element.create("DIV",{className:"ol-switchertopdiv",parent:e,click:function(){o.overflow("+50%")}}),this.botv=ol.ext.element.create("DIV",{className:"ol-switcherbottomdiv",parent:e,click:function(){o.overflow("-50%")}})),this.panel_=ol.ext.element.create("UL",{className:"panel",parent:e}),ol.ext.element.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",(function(t){o.overflow(Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)))&&(t.stopPropagation(),t.preventDefault())})),this.header_=ol.ext.element.create("LI",{className:"ol-header",parent:this.panel_}),ol.control.Control.call(this,{element:e,target:t.target}),this.set("drawDelay",t.drawDelay||0)},ol.ext.inherits(ol.control.LayerSwitcher,ol.control.Control),ol.control.LayerSwitcher.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"},ol.control.LayerSwitcher.prototype.displayInLayerSwitcher=function(t){return!1!==t.get("displayInLayerSwitcher")},ol.control.LayerSwitcher.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.drawPanel(),this._listener&&(this._listener&&ol.Observable.unByKey(this._listener.change),this._listener&&ol.Observable.unByKey(this._listener.moveend),this._listener&&ol.Observable.unByKey(this._listener.size)),this._listener=null,t&&(this._listener={moveend:t.on("moveend",this.viewChange.bind(this)),size:t.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=t.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))},ol.control.LayerSwitcher.prototype.show=function(){this.element.classList.add("ol-forceopen"),this.overflow()},ol.control.LayerSwitcher.prototype.hide=function(){this.element.classList.remove("ol-forceopen"),this.overflow()},ol.control.LayerSwitcher.prototype.toggle=function(){this.element.classList.toggle("ol-forceopen"),this.overflow()},ol.control.LayerSwitcher.prototype.isOpen=function(){return this.element.classList.contains("ol-forceopen")},ol.control.LayerSwitcher.prototype.setHeader=function(t){ol.ext.element.setHTML(this.header_,t)},ol.control.LayerSwitcher.prototype.overflow=function(t){if(this.button){if(ol.ext.element.hidden(this.panel_))return void ol.ext.element.setStyle(this.element,{height:"auto"});var e=ol.ext.element.outerHeight(this.element),o=ol.ext.element.outerHeight(this.panel_),i=this.button.offsetTop+ol.ext.element.outerHeight(this.button),n=this.panel_.offsetTop-i;if(o>e-i){ol.ext.element.setStyle(this.element,{height:"100%"});var r=2*ol.ext.element.getStyle(this.panel_.querySelectorAll("li.visible .li-content")[0],"height");switch(t){case 1:n+=r;break;case-1:n-=r;break;case"+50%":n+=Math.round(e/2);break;case"-50%":n-=Math.round(e/2)}return n+o<=e-3*i/2?(n=e-3*i/2-o,ol.ext.element.hide(this.botv)):ol.ext.element.show(this.botv),n>=0?(n=0,ol.ext.element.hide(this.topv)):ol.ext.element.show(this.topv),ol.ext.element.setStyle(this.panel_,{top:n+"px"}),!0}return ol.ext.element.setStyle(this.element,{height:"auto"}),ol.ext.element.setStyle(this.panel_,{top:0}),ol.ext.element.hide(this.botv),ol.ext.element.hide(this.topv),!1}return!1},ol.control.LayerSwitcher.prototype._setLayerForLI=function(t,e){var o=[];e.getLayers&&o.push(e.getLayers().on("change:length",this.drawPanel.bind(this))),t&&(o.push(e.on("change:opacity",function(){this.setLayerOpacity(e,t)}.bind(this))),o.push(e.on("change:visible",function(){this.setLayerVisibility(e,t)}.bind(this)))),o.push(e.on("propertychange",function(t){"displayInLayerSwitcher"!==t.key&&"openInLayerSwitcher"!==t.key||this.drawPanel(t)}.bind(this))),this._layers.push({li:t,layer:e,listeners:o})},ol.control.LayerSwitcher.prototype.setLayerOpacity=function(t,e){var o=e.querySelector(".layerswitcher-opacity-cursor");o&&(o.style.left=100*t.getOpacity()+"%"),this.dispatchEvent({type:"layer:opacity",layer:t})},ol.control.LayerSwitcher.prototype.setLayerVisibility=function(t,e){var o=e.querySelector(".ol-visibility");o&&(o.checked=t.getVisible()),t.getVisible()?e.classList.add("ol-visible"):e.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:t})},ol.control.LayerSwitcher.prototype._clearLayerForLI=function(){this._layers.forEach((function(t){t.listeners.forEach((function(t){ol.Observable.unByKey(t)}))})),this._layers=[]},ol.control.LayerSwitcher.prototype._getLayerForLI=function(t){for(var e,o=0;e=this._layers[o];o++)if(e.li===t)return e.layer;return null},ol.control.LayerSwitcher.prototype.viewChange=function(){this.panel_.querySelectorAll("li").forEach(function(t){var e=this._getLayerForLI(t);e&&(this.testLayerVisibility(e)?t.classList.remove("ol-layer-hidden"):t.classList.add("ol-layer-hidden"))}.bind(this))},ol.control.LayerSwitcher.prototype.drawPanel=function(){if(this.getMap()){var t=this;this.dcount++,setTimeout((function(){t.drawPanel_()}),this.get("drawDelay")||0)}},ol.control.LayerSwitcher.prototype.drawPanel_=function(){--this.dcount||this.dragging_||(this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach(function(t){t.classList.contains("ol-header")||t.remove()}.bind(this)),this.drawList(this.panel_,this._layerGroup?this._layerGroup.getLayers():this.getMap().getLayers()))},ol.control.LayerSwitcher.prototype.switchLayerVisibility=function(t,e){t.get("baseLayer")?(t.getVisible()||t.setVisible(!0),e.forEach((function(e){t!==e&&e.get("baseLayer")&&e.getVisible()&&e.setVisible(!1)}))):t.setVisible(!t.getVisible())},ol.control.LayerSwitcher.prototype.testLayerVisibility=function(t){if(!this.getMap())return!0;var e=this.getMap().getView().getResolution();if(t.getMaxResolution()<=e||t.getMinResolution()>=e)return!1;var o=t.getExtent();if(o){var i=this.getMap().getView().calculateExtent(this.getMap().getSize());return ol.extent.intersects(i,o)}return!0},ol.control.LayerSwitcher.prototype.dragOrdering_=function(t){t.stopPropagation(),t.preventDefault();var e,o,i,n,r,a=this,s=t.currentTarget.parentNode.parentNode,l=!0,c=this.panel_,h=t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageY;function u(t){if(e=t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageY,l&&Math.abs(h-e)>2&&(l=!1,s.classList.add("drag"),n=a._getLayerForLI(s),o=!1,r=a._getLayerForLI(s.parentNode.parentNode),i=ol.ext.element.create("LI",{className:"ol-dragover",html:s.innerHTML,style:{position:"absolute","z-index":1e4,left:s.offsetLeft,opacity:.5,width:ol.ext.element.outerWidth(s),height:ol.ext.element.getStyle(s,"height")},parent:c}),a.element.classList.add("drag"),a.dispatchEvent({type:"reorder-start",layer:n,group:r})),!l){var u;for(t.preventDefault(),t.stopPropagation(),ol.ext.element.setStyle(i,{top:e-ol.ext.element.offsetRect(c).top+c.scrollTop+5}),(u=t.touches?document.elementFromPoint(t.touches[0].clientX,t.touches[0].clientY):t.target).classList.contains("ol-switcherbottomdiv")?a.overflow(-1):u.classList.contains("ol-switchertopdiv")&&a.overflow(1);u&&"LI"!==u.tagName;)u=u.parentNode;u&&u.classList.contains("dropover")||s.parentNode.querySelectorAll("li").forEach((function(t){t.classList.remove("dropover"),t.classList.remove("dropover-after"),t.classList.remove("dropover-before")})),u&&u.parentNode.classList.contains("drag")&&u!==s?((o=a._getLayerForLI(u))&&!o.get("allwaysOnTop")==!n.get("allwaysOnTop")?(u.classList.add("dropover"),u.classList.add(s.offsetTop<u.offsetTop?"dropover-after":"dropover-before")):o=!1,ol.ext.element.show(i)):(o=!1,u===s?ol.ext.element.hide(i):ol.ext.element.show(i)),o?i.classList.remove("forbidden"):i.classList.add("forbidden")}}s.parentNode.classList.add("drag"),ol.ext.element.addListener(document,"mousemove touchmove",u),ol.ext.element.addListener(document,"mouseup touchend touchcancel",(function t(){if(o){var e=n;if(e&&o){for(var l,c=(l=r?r.getLayers():a._layerGroup?a._layerGroup.getLayers():a.getMap().getLayers()).getArray(),h=0;h<c.length;h++)if(c[h]==e){l.removeAt(h);break}for(var p=0;p<c.length;p++)if(c[p]==o){h>p?l.insertAt(p,e):l.insertAt(p+1,e);break}}a.dispatchEvent({type:"reorder-end",layer:e,group:r})}s.parentNode.querySelectorAll("li").forEach((function(t){t.classList.remove("dropover"),t.classList.remove("dropover-after"),t.classList.remove("dropover-before")})),s.classList.remove("drag"),s.parentNode.classList.remove("drag"),a.element.classList.remove("drag"),i&&i.remove(),ol.ext.element.removeListener(document,"mousemove touchmove",u),ol.ext.element.removeListener(document,"mouseup touchend touchcancel",t)}))},ol.control.LayerSwitcher.prototype.dragOpacity_=function(t){t.stopPropagation(),t.preventDefault();var e=this,o=t.target,i=this._getLayerForLI(o.parentNode.parentNode.parentNode);if(i){var n=t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageX,r=ol.ext.element.getStyle(o,"left")-n;e.dragging_=!0,ol.ext.element.addListener(document,"mouseup touchend touchcancel",(function t(){ol.ext.element.removeListener(document,"mouseup touchend touchcancel",t),ol.ext.element.removeListener(document,"mousemove touchmove",a),e.dragging_=!1})),ol.ext.element.addListener(document,"mousemove touchmove",a)}function a(t){var e=t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageX,n=(r+e)/ol.ext.element.getStyle(o.parentNode,"width"),a=Math.max(0,Math.min(1,n));ol.ext.element.setStyle(o,{left:100*a+"%"}),o.parentNode.nextElementSibling.innerHTML=Math.round(100*a),i.setOpacity(a)}},ol.control.LayerSwitcher.prototype.drawList=function(t,e){var o=this,i=e.getArray(),n=function(t){t.stopPropagation(),t.preventDefault();var i=o._getLayerForLI(this.parentNode.parentNode);o.switchLayerVisibility(i,e)};function r(t){t.stopPropagation(),t.preventDefault();var e=o._getLayerForLI(this.parentNode.parentNode);o.oninfo(e),o.dispatchEvent({type:"info",layer:e})}function a(t){t.stopPropagation(),t.preventDefault();var e=o._getLayerForLI(this.parentNode.parentNode);o.onextent?o.onextent(e):o.getMap().getView().fit(e.getExtent(),o.getMap().getSize()),o.dispatchEvent({type:"extent",layer:e})}function s(t){t.stopPropagation(),t.preventDefault();var e,i=this.parentNode.parentNode.parentNode.parentNode,n=o._getLayerForLI(i);n?(e=o._getLayerForLI(this.parentNode.parentNode),n.getLayers().remove(e),0!=n.getLayers().getLength()||n.get("noSwitcherDelete")||s.call(i.querySelectorAll(".layerTrash")[0],t)):(i=this.parentNode.parentNode,o.getMap().removeLayer(o._getLayerForLI(i)))}for(var l=i.length-1;l>=0;l--){var c=i[l];if(o.displayInLayerSwitcher(c)){var h=ol.ext.element.create("LI",{className:(c.getVisible()?"visible ":" ")+(c.get("baseLayer")?"baselayer":""),parent:t});this._setLayerForLI(h,c);var u=ol.ext.element.create("DIV",{className:"ol-layerswitcher-buttons",parent:h}),p=ol.ext.element.create("DIV",{className:"li-content",parent:h});if(ol.ext.element.create("INPUT",{type:c.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:c.getVisible(),click:n,parent:p}),ol.ext.element.create("LABEL",{html:c.get("title")||c.get("name"),title:c.get("title")||c.get("name"),click:n,unselectable:"on",style:{userSelect:"none"},parent:p}).addEventListener("selectstart",(function(){return!1})),this.reordering&&(l<i.length-1&&(c.get("allwaysOnTop")||!i[l+1].get("allwaysOnTop"))||l>0&&(!c.get("allwaysOnTop")||i[l-1].get("allwaysOnTop")))&&ol.ext.element.create("DIV",{className:"layerup",title:this.tip.up,on:{"mousedown touchstart":function(t){o.dragOrdering_(t)}},parent:u}),c.getLayers){var d=0;c.getLayers().forEach((function(t){o.displayInLayerSwitcher(t)&&d++})),d&&ol.ext.element.create("DIV",{className:c.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var t=o._getLayerForLI(this.parentNode.parentNode);t.set("openInLayerSwitcher",!t.get("openInLayerSwitcher"))},parent:u})}if(this.oninfo&&ol.ext.element.create("DIV",{className:"layerInfo",title:this.tip.info,click:r,parent:u}),this.hastrash&&!c.get("noSwitcherDelete")&&ol.ext.element.create("DIV",{className:"layerTrash",title:this.tip.trash,click:s,parent:u}),this.hasextent&&i[l].getExtent()){var f=i[l].getExtent();4==f.length&&f[0]<f[2]&&f[1]<f[3]&&ol.ext.element.create("DIV",{className:"layerExtent",title:this.tip.extent,click:a,parent:u})}if(this.show_progress&&c instanceof ol.layer.Tile){var g=ol.ext.element.create("DIV",{className:"layerswitcher-progress",parent:p});this.setprogress_(c),c.layerswitcher_progress=ol.ext.element.create("DIV",{parent:g})}var m=ol.ext.element.create("DIV",{className:"layerswitcher-opacity",click:function(t){if(t.target===this){t.stopPropagation(),t.preventDefault();var e=Math.max(0,Math.min(1,t.offsetX/ol.ext.element.getStyle(this,"width")));o._getLayerForLI(this.parentNode.parentNode).setOpacity(e)}},parent:p});if(ol.ext.element.create("DIV",{className:"layerswitcher-opacity-cursor",style:{left:100*c.getOpacity()+"%"},on:{"mousedown touchstart":function(t){o.dragOpacity_(t)}},parent:m}),ol.ext.element.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(100*c.getOpacity()),parent:p}),c.getLayers){if(h.classList.add("ol-layer-group"),!0===c.get("openInLayerSwitcher")){var y=ol.ext.element.create("UL",{parent:h});this.drawList(y,c.getLayers())}}else c instanceof ol.layer.Vector||c instanceof ol.layer.VectorTile?h.classList.add("ol-layer-vector"):c instanceof ol.layer.Tile?h.classList.add("ol-layer-tile"):c instanceof ol.layer.Image?h.classList.add("ol-layer-image"):c instanceof ol.layer.Heatmap&&h.classList.add("ol-layer-heatmap");this.dispatchEvent({type:"drawlist",layer:c,li:h})}else this._setLayerForLI(null,c)}this.viewChange(),t===this.panel_&&this.overflow()},ol.control.LayerSwitcher.prototype.setprogress_=function(t){if(!t.layerswitcher_progress){var e=0,o=0,i=function(){o===e?(o=e=0,ol.ext.element.setStyle(t.layerswitcher_progress,{width:0})):ol.ext.element.setStyle(t.layerswitcher_progress,{width:(e/o*100).toFixed(1)+"%"})};t.getSource().on("tileloadstart",(function(){o++,i()})),t.getSource().on("tileloadend",(function(){e++,i()})),t.getSource().on("tileloaderror",(function(){e++,i()}))}},ol.control.Bar=function(t){t||(t={});var e=document.createElement("div");if(e.classList.add("ol-unselectable","ol-control","ol-bar"),t.className){var o=t.className.split(" ").filter((function(t){return t.length>0}));e.classList.add.apply(e.classList,o)}if(t.group&&e.classList.add("ol-group"),ol.control.Control.call(this,{element:e,target:t.target}),this.set("toggleOne",t.toggleOne),this.set("autoDeactivate",t.autoDeactivate),this.controls_=[],t.controls instanceof Array)for(var i=0;i<t.controls.length;i++)this.addControl(t.controls[i])},ol.ext.inherits(ol.control.Bar,ol.control.Control),ol.control.Bar.prototype.setVisible=function(t){this.element.style.display=t?"":"none"},ol.control.Bar.prototype.getVisible=function(){return"none"!=this.element.style.display},ol.control.Bar.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t);for(var e=0;e<this.controls_.length;e++){this.controls_[e].setMap(t)}},ol.control.Bar.prototype.getControls=function(){return this.controls_},ol.control.Bar.prototype.setPosition=function(t){this.element.classList.remove("ol-left","ol-top","ol-bottom","ol-right"),t=t.split("-");for(var e=0;e<t.length;e++)switch(t[e]){case"top":case"left":case"bottom":case"right":this.element.classList.add("ol-"+t[e])}},ol.control.Bar.prototype.addControl=function(t){this.controls_.push(t),t.setTarget(this.element),this.getMap()&&this.getMap().addControl(t),t.on("change:active",function(e){this.onActivateControl_(e,t)}.bind(this)),t.getActive&&this.onActivateControl_({target:t,active:t.getActive()},t)},ol.control.Bar.prototype.deactivateControls=function(t){for(var e=0;e<this.controls_.length;e++)this.controls_[e]!==t&&this.controls_[e].setActive&&this.controls_[e].setActive(!1)},ol.control.Bar.prototype.getActiveControls=function(){for(var t,e=[],o=0;t=this.controls_[o];o++)t.getActive&&t.getActive()&&e.push(t);return e},ol.control.Bar.prototype.setActive=function(t){if(!t&&this.get("autoDeactivate")&&this.deactivateControls(),t)for(var e,o=this.getControls(),i=0;e=o[i];i++)e.get("autoActivate")&&e.setActive(!0)},ol.control.Bar.prototype.onActivateControl_=function(t,e){if(this.get("toggleOne"))if(t.active){var o;for(o=0;o<this.controls_.length&&this.controls_[o]!==e;o++);if(o==this.controls_.length)return;this.deactivateControls(this.controls_[o])}else if(!this.getActiveControls().length)for(var i,n=0;i=this.controls_[n];n++)if(i.get("autoActivate")){i.setActive(!0);break}},ol.control.Bar.prototype.getControlsByName=function(t){return this.getControls().filter((function(e){return e.get("name")===t}))},ol.control.CanvasAttribution=function(t){t||(t={}),ol.control.Attribution.call(this,t),this.setCanvas(!!t.canvas),t||(t={}),t.style||(t.style=new ol.style.Style),this.setStyle(t.style)},ol.ext.inherits(ol.control.CanvasAttribution,ol.control.Attribution),ol.control.CanvasAttribution.prototype.setCanvas=function(t){this.isCanvas_=t,t&&this.setCollapsed(!1),this.element.style.visibility=t?"hidden":"visible",this.map_&&this.map_.renderSync()},ol.control.CanvasAttribution.prototype.getContext=ol.control.CanvasBase.prototype.getContext,ol.control.CanvasAttribution.prototype.setStyle=function(t){var e=t.getText();this.font_=e?e.getFont():"10px sans-serif";var o=e?e.getStroke():null,i=e?e.getFill():null;this.fontStrokeStyle_=o?ol.color.asString(o.getColor()):"#fff",this.fontFillStyle_=i?ol.color.asString(i.getColor()):"#000",this.fontStrokeWidth_=o?o.getWidth():3,this.getMap()&&this.getMap().render()},ol.control.CanvasAttribution.prototype.setMap=function(t){ol.control.CanvasBase.prototype.getCanvas.call(this,t);var e=this.getMap();this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.ScaleLine.prototype.setMap.call(this,t),e&&e.renderSync(),t&&(this._listener=t.on("postcompose",this.drawAttribution_.bind(this))),this.map_=t,this.setCanvas(this.isCanvas_)},ol.control.CanvasAttribution.prototype.drawAttribution_=function(t){if(this.isCanvas_){var e=this.getContext(t);if(e){var o="";Array.prototype.slice.call(this.element.querySelectorAll("li")).filter((function(t){return"none"!==t.style.display})).map((function(t){o+=(o?" - ":"")+t.textContent}));var i=t.frameState.pixelRatio;e.save(),e.scale(i,i);var n=this.element.getBoundingClientRect(),r=this.getMap().getViewport().getBoundingClientRect(),a=this.getMap().getSize()[0]/r.width;e.translate((n.left-r.left)*a,(n.top-r.top)*a);var s=this.element.clientHeight,l=this.element.clientWidth/2+this.element.querySelectorAll("button")[0].clientWidth;e.beginPath(),e.strokeStyle=this.fontStrokeStyle_,e.fillStyle=this.fontFillStyle_,e.lineWidth=this.fontStrokeWidth_,e.textAlign="center",e.textBaseline="middle",e.font=this.font_,e.strokeText(o,l,s/2),e.fillText(o,l,s/2),e.closePath(),e.restore()}}},ol.control.CanvasScaleLine=function(t){ol.control.ScaleLine.call(this,t),this.scaleHeight_=6,t||(t={}),t.style||(t.style=new ol.style.Style),this.setStyle(t.style)},ol.ext.inherits(ol.control.CanvasScaleLine,ol.control.ScaleLine),ol.control.CanvasScaleLine.prototype.getContext=ol.control.CanvasBase.prototype.getContext,ol.control.CanvasScaleLine.prototype.setMap=function(t){ol.control.CanvasBase.prototype.getCanvas.call(this,t);var e=this.getMap();this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.ScaleLine.prototype.setMap.call(this,t),e&&e.renderSync(),t&&(this._listener=t.on("postcompose",this.drawScale_.bind(this))),this.element.style.visibility="hidden",this.olscale=this.element.querySelector(".ol-scale-line-inner")},ol.control.CanvasScaleLine.prototype.setStyle=function(t){var e=t.getStroke();this.strokeStyle_=e?ol.color.asString(e.getColor()):"#000",this.strokeWidth_=e?e.getWidth():2;var o=t.getFill();this.fillStyle_=o?ol.color.asString(o.getColor()):"#fff";var i=t.getText();this.font_=i?i.getFont():"10px Arial",e=i?i.getStroke():null,o=i?i.getFill():null,this.fontStrokeStyle_=e?ol.color.asString(e.getColor()):this.fillStyle_,this.fontStrokeWidth_=e?e.getWidth():3,this.fontFillStyle_=o?ol.color.asString(o.getColor()):this.strokeStyle_,this.getMap()&&this.getMap().render()},ol.control.CanvasScaleLine.prototype.drawScale_=function(t){if("hidden"===this.element.style.visibility){var e=this.getContext(t);if(e){var o=parseInt(this.olscale.style.width);if(o){var i=this.olscale.textContent,n={left:this.element.offsetLeft,top:this.element.offsetTop},r=t.frameState.pixelRatio;e.save(),e.scale(r,r),n.top+=this.element.clientHeight-this.scaleHeight_,e.beginPath(),e.strokeStyle=this.fontStrokeStyle_,e.fillStyle=this.fontFillStyle_,e.lineWidth=this.fontStrokeWidth_,e.textAlign="center",e.textBaseline="bottom",e.font=this.font_,e.strokeText(i,n.left+o/2,n.top),e.fillText(i,n.left+o/2,n.top),e.closePath(),n.top+=2,e.lineWidth=this.strokeWidth_,e.strokeStyle=this.strokeStyle_;for(var a=4,s=parseInt(i);s%10==0;)s/=10;s%5==0&&(a=5);for(var l=0;l<a;l++)e.beginPath(),e.fillStyle=l%2?this.fillStyle_:this.strokeStyle_,e.rect(n.left+l*o/a,n.top,o/a,this.scaleHeight_),e.stroke(),e.fill(),e.closePath();e.restore()}}}},ol.control.CanvasTitle=function(t){t||(t={});var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-control-title ol-unselectable",style:{display:"block",visibility:"hidden"}});ol.control.CanvasBase.call(this,{element:e,style:t.style}),this.setTitle(t.title||"Title"),this.element.style.font=this.getTextFont()},ol.ext.inherits(ol.control.CanvasTitle,ol.control.CanvasBase),ol.control.CanvasTitle.prototype.setStyle=function(t){ol.control.CanvasBase.prototype.setStyle.call(this,t),this.element&&(this.element.style.font=this.getTextFont()),this.getMap()&&this.getMap().render()},ol.control.CanvasTitle.prototype.setTitle=function(t){this.element.textContent=t,this.set("title",t),this.getMap()&&this.getMap().renderSync()},ol.control.CanvasTitle.prototype.getTitle=function(){return this.get("title")},ol.control.CanvasTitle.prototype.setVisible=function(t){this.element.style.display=t?"block":"none",this.getMap()&&this.getMap().renderSync()},ol.control.CanvasTitle.prototype.getVisible=function(){return"none"!==this.element.style.display},ol.control.CanvasTitle.prototype._draw=function(t){if(this.getVisible()){var e=this.getContext(t);if(e){var o=t.frameState.pixelRatio;e.save(),e.scale(o,o);var i=this.element.getBoundingClientRect(),n=this.getMap().getViewport().getBoundingClientRect(),r=this.getMap().getSize()[0]/n.width;e.translate((i.left-n.left)*r,(i.top-n.top)*r);var a=this.element.clientHeight,s=this.element.clientWidth,l=s/2;e.beginPath(),e.fillStyle=ol.color.asString(this.getFill().getColor()),e.rect(0,0,s,a),e.fill(),e.closePath(),e.beginPath(),e.fillStyle=ol.color.asString(this.getTextFill().getColor()),e.strokeStyle=ol.color.asString(this.getTextStroke().getColor()),e.lineWidth=this.getTextStroke().getWidth(),e.textAlign="center",e.textBaseline="middle",e.font=this.getTextFont(),e.lineWidth&&e.strokeText(this.getTitle(),l,a/2),e.fillText(this.getTitle(),l,a/2),e.closePath(),e.restore()}}},ol.control.CenterPosition=function(t){t||(t={});var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-center-position ol-unselectable",style:{display:"block",visibility:"hidden"}});ol.control.CanvasBase.call(this,{element:e,style:t.style}),this.element.style.font=this.getTextFont(),this.set("projection",t.projection),this.setCanvas(t.canvas),this._format="function"==typeof t.coordinateFormat?t.coordinateFormat:ol.coordinate.toStringXY},ol.ext.inherits(ol.control.CenterPosition,ol.control.CanvasBase),ol.control.CenterPosition.prototype.setStyle=function(t){ol.control.CanvasBase.prototype.setStyle.call(this,t),this.element&&(this.element.style.font=this.getTextFont()),this.getMap()&&this.getMap().render()},ol.control.CenterPosition.prototype.setCanvas=function(t){this.set("canvas",t),this.element.style.visibility=t?"hidden":"visible",this.getMap()&&this.getMap().renderSync()},ol.control.CenterPosition.prototype.setVisible=function(t){this.element.style.display=t?"":"none",this.getMap()&&this.getMap().renderSync()},ol.control.CenterPosition.prototype.getVisible=function(){return"none"!==this.element.style.display},ol.control.CenterPosition.prototype._draw=function(t){if(this.getVisible()&&this.getMap()){var e=this.getMap().getView().getCenter();if(this.get("projection")&&(e=ol.proj.transform(e,this.getMap().getView().getProjection(),this.get("projection"))),e=this._format(e),this.element.textContent=e,this.get("canvas")){var o=this.getContext(t);if(o){var i=t.frameState.pixelRatio;o.save(),o.scale(i,i);var n=this.element.getBoundingClientRect(),r=this.getMap().getViewport().getBoundingClientRect(),a=this.getMap().getSize()[0]/r.width;o.translate((n.left-r.left)*a,(n.top-r.top)*a);var s=this.element.clientHeight,l=this.element.clientWidth;o.beginPath(),o.fillStyle=ol.color.asString(this.getTextFill().getColor()),o.strokeStyle=ol.color.asString(this.getTextStroke().getColor()),o.lineWidth=this.getTextStroke().getWidth(),o.textAlign="center",o.textBaseline="middle",o.font=this.getTextFont(),o.lineWidth&&o.strokeText(e,l/2,s/2),o.fillText(e,l/2,s/2),o.closePath(),o.restore()}}}},ol.control.Compass=function(t){var e=this;t||(t={});var o=document.createElement("div");o.className="ol-compassctrl ol-unselectable ol-hidden"+(t.className?" "+t.className:""),o.style.position="absolute",o.style.visibility="hidden";var i=t.style instanceof ol.style.Stroke?new ol.style.Style({stroke:t.style}):t.style;t.style||(i=new ol.style.Style({stroke:new ol.style.Stroke({width:0})})),ol.control.CanvasBase.call(this,{element:o,style:i}),this.set("rotateVithView",!1!==t.rotateWithView),t.image?this.img_=t.image:t.src?(this.img_=new Image,this.img_.onload=function(){e.getMap()&&e.getMap().renderSync()},this.img_.src=t.src):this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor()),this.da_=[];for(var n=0;n<8;n++)this.da_[n]=[Math.cos(Math.PI*n/8),Math.sin(Math.PI*n/8)]},ol.ext.inherits(ol.control.Compass,ol.control.CanvasBase),ol.control.Compass.prototype.defaultCompass_=function(t,e){var o=document.createElement("canvas"),i=o.getContext("2d"),n=(t=o.width=o.height=t||150)/2,r=.22*n;function a(t,o){i.fillStyle=e||"#963",i.beginPath(),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(o,o),i.moveTo(0,0),i.lineTo(-t,0),i.lineTo(-o,-o),i.moveTo(0,0),i.lineTo(0,t),i.lineTo(-o,o),i.moveTo(0,0),i.lineTo(0,-t),i.lineTo(o,-o),i.moveTo(0,0),i.fill(),i.stroke()}function s(t,e){i.globalCompositeOperation="destination-out",i.fillStyle="#fff",i.beginPath(),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(e,-e),i.moveTo(0,0),i.lineTo(-t,0),i.lineTo(-e,e),i.moveTo(0,0),i.lineTo(0,t),i.lineTo(e,e),i.moveTo(0,0),i.lineTo(0,-t),i.lineTo(-e,-e),i.moveTo(0,0),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(e,-e),i.moveTo(0,0),i.lineTo(-t,0),i.lineTo(-e,e),i.moveTo(0,0),i.lineTo(0,t),i.lineTo(e,e),i.moveTo(0,0),i.lineTo(0,-t),i.lineTo(-e,-e),i.moveTo(0,0),i.stroke()}return i.translate(n,n),i.strokeStyle=e||"#963",i.lineWidth=1.5,i.beginPath(),i.arc(0,0,.41*t,0,2*Math.PI),i.arc(0,0,.44*t,0,2*Math.PI),i.stroke(),i.rotate(Math.PI/4),a(.9*n,.8*r),s(.9*n,.8*r),i.rotate(-Math.PI/4),a(n,r),s(n,r),o},ol.control.Compass.prototype._draw=function(t){var e=this.getContext(t);if(e){var o=e.canvas,i=t.frameState.pixelRatio;e.save(),e.scale(i,i);var n=this.element.clientWidth,r=this.element.clientHeight,a=this.element.offsetLeft,s=this.element.offsetTop,l=this.img_,c=t.frameState.viewState.rotation;if(e.beginPath(),e.translate(a+n/2,s+r/2),this.get("rotateVithView")&&e.rotate(c),this.getStroke().getWidth()){e.beginPath(),e.strokeStyle=this.getStroke().getColor(),e.lineWidth=this.getStroke().getWidth();for(var h=Math.max(o.width,o.height),u=0;u<8;u++)e.moveTo(-this.da_[u][0]*h,-this.da_[u][1]*h),e.lineTo(this.da_[u][0]*h,this.da_[u][1]*h);e.stroke()}l.width&&e.drawImage(l,-n/2,-r/2,n,r),e.closePath(),e.restore()}},ol.control.Dialog=function(t){t=t||{};var e=ol.ext.element.create("DIV",{className:((t.className||"")+(t.zoom?" ol-zoom":"")+" ol-ext-dialog").trim(),click:function(){this.get("hideOnClick")&&this.close()}.bind(this)}),o=ol.ext.element.create("FORM",{on:{submit:this._onButton("submit")},parent:e});ol.ext.element.create("H2",{parent:o}),ol.ext.element.create("DIV",{className:"ol-closebox",click:this._onButton("cancel"),parent:o}),ol.ext.element.create("DIV",{className:"ol-content",parent:o}),this._progress=ol.ext.element.create("DIV",{className:"ol-progress-bar",style:{display:"none"},parent:o}),this._progressbar=ol.ext.element.create("DIV",{parent:this._progress}),ol.ext.element.create("DIV",{className:"ol-buttons",parent:o}),ol.control.Control.call(this,{element:e,target:t.target}),this.set("closeBox",t.closeBox),this.set("zoom",t.zoom),this.set("hideOnClick",t.hideOnClick),this.set("className",t.className),this.set("closeOnSubmit",t.closeOnSubmit),this.setContent(t)},ol.ext.inherits(ol.control.Dialog,ol.control.Control),ol.control.Dialog.prototype.show=function(t){(t instanceof Element||"string"==typeof t)&&(t={content:t}),this.setContent(t),this.element.classList.add("ol-visible");var e=this.element.querySelector('input[type="text"],input[type="search"],input[type="number"]');e&&e.focus(),this.dispatchEvent({type:"show"})},ol.control.Dialog.prototype.open=function(){this.show()},ol.control.Dialog.prototype.setContent=function(t){if(t){"string"==typeof t&&(t={content:t}),(t=t||{}).max&&this.setProgress(0,t.max),void 0!==t.progress&&this.setProgress(t.progress),this.get("zoom")?this.element.classList.add("ol-zoom"):this.element.classList.remove("ol-zoom"),t.className?this.element.classList.add(t.className):this.get("className")&&this.element.classList.add(this.get("className"));var e=this.element.querySelector("form");void 0!==t.content&&(t.content instanceof Element&&ol.ext.element.setHTML(e.querySelector(".ol-content"),""),ol.ext.element.setHTML(e.querySelector(".ol-content"),t.content||"")),void 0!==t.title&&(e.querySelector("h2").innerText=t.title||"",t.title?e.classList.add("ol-title"):e.classList.remove("ol-title")),t.closeBox||this.get("closeBox")&&!1!==t.closeBox?e.classList.add("ol-closebox"):e.classList.remove("ol-closebox");var o=this.element.querySelector(".ol-buttons");if(o.innerHTML="",t.buttons)for(var i in e.classList.add("ol-button"),t.buttons)ol.ext.element.create("INPUT",{type:"submit"===i?"submit":"button",value:t.buttons[i],click:this._onButton(i),parent:o});else e.classList.remove("ol-button")}},ol.control.Dialog.prototype.setProgress=function(t,e){if(e>0?this.set("max",Number(e)):e=this.get("max"),e){var o=Math.round(t/e*100);ol.ext.element.setStyle(this._progress,{display:""}),this._progressbar.className=o?"":"notransition",ol.ext.element.setStyle(this._progressbar,{width:o+"%"})}else ol.ext.element.setStyle(this._progress,{display:"none"})},ol.control.Dialog.prototype._onButton=function(t){return function(e){e.preventDefault(),"submit"===t&&!1===this.get("closeOnSubmit")||this.hide();var o={};this.element.querySelectorAll("form input").forEach((function(t){t.className&&(o[t.className]=t)})),this.dispatchEvent({type:"button",button:t,inputs:o})}.bind(this)},ol.control.Dialog.prototype.hide=function(){this.element.classList.remove("ol-visible"),this.dispatchEvent({type:"hide"})},ol.control.Dialog.prototype.close=ol.control.Dialog.prototype.hide,ol.control.Dialog.prototype.isOpen=function(){return this.element.classList.contains("ol-visible")},ol.control.Disable=function(t){t=t||{};var e=document.createElement("div");e.className=(t.className||" ol-disable ol-unselectable ol-control").trim();var o={top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4,background:"none",display:"none"};Object.keys(o).forEach((function(t){e.style[t]=o[t]})),ol.control.Control.call(this,{element:e})},ol.ext.inherits(ol.control.Disable,ol.control.Control),ol.control.Disable.prototype.isOn=function(){return this.element.classList.contains("ol-disable")},ol.control.Disable.prototype.disableMap=function(t){t?this.element.classList.add("ol-enable").show():this.element.classList.remove("ol-enable").hide()},ol.control.EditBar=function(t){(t=t||{}).interactions=t.interactions||{},ol.control.Bar.call(this,{className:(t.className?t.className+" ":"")+"ol-editbar",toggleOne:!0,target:t.target}),this._source=t.source,this._interactions={},this._setSelectInteraction(t),!1!==t.edition&&this._setEditInteraction(t),this._setModifyInteraction(t)},ol.ext.inherits(ol.control.EditBar,ol.control.Bar),ol.control.EditBar.prototype.setMap=function(t){this.getMap()&&(this._interactions.Delete&&this.getMap().removeInteraction(this._interactions.Delete),this._interactions.ModifySelect&&this.getMap().removeInteraction(this._interactions.ModifySelect)),ol.control.Bar.prototype.setMap.call(this,t),this.getMap()&&(this._interactions.Delete&&this.getMap().addInteraction(this._interactions.Delete),this._interactions.ModifySelect&&this.getMap().addInteraction(this._interactions.ModifySelect))},ol.control.EditBar.prototype.getInteraction=function(t){return this._interactions[t]},ol.control.EditBar.prototype._getTitle=function(t){return t&&t.title?t.title:t},ol.control.EditBar.prototype._setSelectInteraction=function(t){var e,o=this,i=new ol.control.Bar;if(!1!==t.interactions.Delete){t.interactions.Delete instanceof ol.interaction.Delete?this._interactions.Delete=t.interactions.Delete:this._interactions.Delete=new ol.interaction.Delete;var n=this._interactions.Delete;n.setActive(!1),this.getMap()&&this.getMap().addInteraction(n),i.addControl(new ol.control.Button({className:"ol-delete",title:this._getTitle(t.interactions.Delete)||"Delete",handleClick:function(t){n.delete(e.getInteraction().getFeatures()),console.log("del");var o={type:"select",selected:[],deselected:e.getInteraction().getFeatures().getArray().slice(),mapBrowserEvent:t.mapBrowserEvent};e.getInteraction().getFeatures().clear(),e.getInteraction().dispatchEvent(o)}}))}if(!1!==t.interactions.Info&&i.addControl(new ol.control.Button({className:"ol-info",title:this._getTitle(t.interactions.Info)||"Show informations",handleClick:function(){o.dispatchEvent({type:"info",features:e.getInteraction().getFeatures()})}})),!1!==t.interactions.Select){t.interactions.Select instanceof ol.interaction.Select?this._interactions.Select=t.interactions.Select:this._interactions.Select=new ol.interaction.Select({condition:ol.events.condition.click});var r=this._interactions.Select;e=new ol.control.Toggle({className:"ol-selection",title:this._getTitle(t.interactions.Select)||"Select",interaction:r,bar:i.getControls().length?i:void 0,autoActivate:!0,active:!0}),this.addControl(e),r.on("change:active",(function(){r.getFeatures().clear()}))}},ol.control.EditBar.prototype._setEditInteraction=function(t){if(!1!==t.interactions.DrawPoint){t.interactions.DrawPoint instanceof ol.interaction.Draw?this._interactions.DrawPoint=t.interactions.DrawPoint:this._interactions.DrawPoint=new ol.interaction.Draw({type:"Point",source:this._source});var e=new ol.control.Toggle({className:"ol-drawpoint",title:this._getTitle(t.interactions.DrawPoint)||"Point",interaction:this._interactions.DrawPoint});this.addControl(e)}if(!1!==t.interactions.DrawLine){t.interactions.DrawLine instanceof ol.interaction.Draw?this._interactions.DrawLine=t.interactions.DrawLine:this._interactions.DrawLine=new ol.interaction.Draw({type:"LineString",source:this._source,geometryFunction:function(t,e){return e?e.setCoordinates(t):e=new ol.geom.LineString(t),this.nbpts=e.getCoordinates().length,e}});var o=new ol.control.Toggle({className:"ol-drawline",title:this._getTitle(t.interactions.DrawLine)||"LineString",interaction:this._interactions.DrawLine,bar:new ol.control.Bar({controls:[new ol.control.TextButton({html:this._getTitle(t.interactions.UndoDraw)||"undo",title:this._getTitle(t.interactions.UndoDraw)||"delete last point",handleClick:function(){o.getInteraction().nbpts>1&&o.getInteraction().removeLastPoint()}}),new ol.control.TextButton({html:this._getTitle(t.interactions.FinishDraw)||"finish",title:this._getTitle(t.interactions.FinishDraw)||"finish",handleClick:function(){o.getInteraction().nbpts>2&&o.getInteraction().finishDrawing()}})]})});this.addControl(o)}if(!1!==t.interactions.DrawPolygon&&(t.interactions.DrawPolygon instanceof ol.interaction.Draw?this._interactions.DrawPolygon=t.interactions.DrawPolygon:this._interactions.DrawPolygon=new ol.interaction.Draw({type:"Polygon",source:this._source,geometryFunction:function(t,e){return this.nbpts=t[0].length,e?e.setCoordinates([t[0].concat([t[0][0]])]):e=new ol.geom.Polygon(t),e}}),this._setDrawPolygon("ol-drawpolygon",this._interactions.DrawPolygon,this._getTitle(t.interactions.DrawPolygon)||"Polygon",t)),!1!==t.interactions.DrawHole&&(t.interactions.DrawHole instanceof ol.interaction.DrawHole?this._interactions.DrawHole=t.interactions.DrawHole:this._interactions.DrawHole=new ol.interaction.DrawHole,this._setDrawPolygon("ol-drawhole",this._interactions.DrawHole,this._getTitle(t.interactions.DrawHole)||"Hole",t)),!1!==t.interactions.DrawRegular){t.interactions.DrawRegular instanceof ol.interaction.DrawRegular?this._interactions.DrawRegular=t.interactions.DrawRegular:this._interactions.DrawRegular=new ol.interaction.DrawRegular({source:this._source,sides:4});var i=this._interactions.DrawRegular,n=document.createElement("DIV"),r=ol.ext.element.create("DIV",{parent:n});ol.ext.element.addListener(r,["click","touchstart"],function(){var t=i.getSides()-1;t<2&&(t=2),i.setSides(t),a.textContent=t>2?t+" pts":"circle"}.bind(this));var a=ol.ext.element.create("TEXT",{html:"4 pts",parent:n}),s=ol.ext.element.create("DIV",{parent:n});ol.ext.element.addListener(s,["click","touchstart"],function(){var t=i.getSides()+1;t<3&&(t=3),i.setSides(t),a.textContent=t+" pts"}.bind(this));var l=new ol.control.Toggle({className:"ol-drawregular",title:this._getTitle(t.interactions.DrawRegular)||"Regular",interaction:this._interactions.DrawRegular,bar:new ol.control.Bar({controls:[new ol.control.TextButton({html:n})]})});this.addControl(l)}},ol.control.EditBar.prototype._setDrawPolygon=function(t,e,o,i){var n=new ol.control.Toggle({className:t,title:o,interaction:e,bar:new ol.control.Bar({controls:[new ol.control.TextButton({html:this._getTitle(i.interactions.UndoDraw)||"undo",title:this._getTitle(i.interactions.UndoDraw)||"undo last point",handleClick:function(){n.getInteraction().nbpts>1&&n.getInteraction().removeLastPoint()}}),new ol.control.TextButton({html:this._getTitle(i.interactions.FinishDraw)||"finish",title:this._getTitle(i.interactions.FinishDraw)||"finish",handleClick:function(){n.getInteraction().nbpts>3&&n.getInteraction().finishDrawing()}})]})});this.addControl(n)},ol.control.EditBar.prototype._setModifyInteraction=function(t){if(!1!==t.interactions.ModifySelect&&!1!==t.interactions.Select&&(t.interactions.ModifySelect instanceof ol.interaction.ModifyFeature?this._interactions.ModifySelect=t.interactions.ModifySelect:this._interactions.ModifySelect=new ol.interaction.ModifyFeature({features:this.getInteraction("Select").getFeatures()}),this.getMap()&&this.getMap().addInteraction(this._interactions.ModifySelect),this._interactions.ModifySelect.setActive(this._interactions.Select.getActive()),this._interactions.Select.on("change:active",function(){this._interactions.ModifySelect.setActive(this._interactions.Select.getActive())}.bind(this))),!1!==t.interactions.Transform){t.interactions.Transform instanceof ol.interaction.Transform?this._interactions.Transform=t.interactions.Transform:this._interactions.Transform=new ol.interaction.Transform({addCondition:ol.events.condition.shiftKeyOnly});var e=new ol.control.Toggle({html:"<i></i>",className:"ol-transform",title:this._getTitle(t.interactions.Transform)||"Transform",interaction:this._interactions.Transform});this.addControl(e)}if(!1!==t.interactions.Split){t.interactions.Split instanceof ol.interaction.Split?this._interactions.Split=t.interactions.Split:this._interactions.Split=new ol.interaction.Split({sources:this._source});var o=new ol.control.Toggle({className:"ol-split",title:this._getTitle(t.interactions.Split)||"Split",interaction:this._interactions.Split});this.addControl(o)}if(!1!==t.interactions.Offset){t.interactions.Offset instanceof ol.interaction.Offset?this._interactions.Offset=t.interactions.Offset:this._interactions.Offset=new ol.interaction.Offset({source:this._source});var i=new ol.control.Toggle({html:"<i></i>",className:"ol-offset",title:this._getTitle(t.interactions.Offset)||"Offset",interaction:this._interactions.Offset});this.addControl(i)}},ol.control.Gauge=function(t){t=t||{};var e=ol.ext.element.create("DIV",{className:((t.className||"")+" ol-gauge ol-unselectable ol-control").trim()});this.title_=ol.ext.element.create("SPAN",{parent:e});var o=ol.ext.element.create("DIV",{parent:e});this.gauge_=ol.ext.element.create("BUTTON",{type:"button",style:{width:"0px"},parent:o}),ol.control.Control.call(this,{element:e,target:t.target}),this.setTitle(t.title),this.set("max",t.max||100),this.val(t.val)},ol.ext.inherits(ol.control.Gauge,ol.control.Control),ol.control.Gauge.prototype.setTitle=function(t){this.title_.innerHTML=t||"",this.title_.display=t?"":"none"},ol.control.Gauge.prototype.val=function(t){return void 0!==t&&(this.val_=t,this.gauge_.style.width=t/this.get("max")*100+"%"),this.val_},ol.control.GeoBookmark=function(t){t=t||{};var e=this,o=document.createElement("div");t.target?o.className=t.className||"ol-bookmark":(o.className=(t.className||"ol-bookmark")+" ol-unselectable ol-control ol-collapsed",o.addEventListener("mouseleave",(function(){r!==document.activeElement&&(i.style.display="none")})),this.button=ol.ext.element.create("BUTTON",{type:"button",title:t.title||"Geobookmarks",click:function(){i.style.display=""===i.style.display||"none"===i.style.display?"block":"none"}}),o.appendChild(this.button));var i=document.createElement("div");o.appendChild(i);var n=document.createElement("ul");i.appendChild(n);var r=document.createElement("input");r.setAttribute("placeholder",t.placeholder||"Add a new geomark..."),r.addEventListener("change",(function(){var t=this.value;t&&(e.addBookmark(t),this.value="",e.dispatchEvent({type:"add",name:t})),i.style.display="none"})),r.addEventListener("blur",(function(){i.style.display="none"})),i.appendChild(r),ol.control.Control.call(this,{element:o,target:t.target}),this.on("propertychange",function(t){"editable"===t.key&&(o.className=o.className.replace(" ol-editable",""),this.get("editable")&&(o.className+=" ol-editable"))}.bind(this)),this.set("namespace",t.namespace||"ol"),this.set("editable",!1!==t.editable);var a={};if(localStorage[this.get("namespace")+"@bookmark"]&&(a=JSON.parse(localStorage[this.get("namespace")+"@bookmark"])),t.marks)for(var s in t.marks)a[s]=t.marks[s];this.setBookmarks(a)},ol.ext.inherits(ol.control.GeoBookmark,ol.control.Control),ol.control.GeoBookmark.prototype.setBookmarks=function(t){t||(t=JSON.parse(localStorage[this.get("namespace")+"@bookmark"]||"{}"));var e=this.get("editable"),o=this.element.querySelector("ul"),i=this.element.querySelector("div"),n=this;for(var r in o.innerHTML="",t){var a=document.createElement("li");if(a.textContent=r,a.setAttribute("data-bookmark",JSON.stringify(t[r])),a.setAttribute("data-name",r),a.addEventListener("click",(function(){var t=JSON.parse(this.getAttribute("data-bookmark"));n.getMap().getView().setCenter(t.pos),n.getMap().getView().setZoom(t.zoom),n.getMap().getView().setRotation(t.rot||0),i.style.display="none",n.dispatchEvent({type:"select",name:this.getAttribute("data-name"),bookmark:t})})),o.appendChild(a),e&&!t[r].permanent){var s=document.createElement("button");s.setAttribute("data-name",r),s.setAttribute("title","Suppr."),s.addEventListener("click",(function(t){n.removeBookmark(this.getAttribute("data-name")),n.dispatchEvent({type:"remove",name:this.getAttribute("data-name")}),t.stopPropagation()})),a.appendChild(s)}}localStorage[this.get("namespace")+"@bookmark"]=JSON.stringify(t)},ol.control.GeoBookmark.prototype.getBookmarks=function(){return JSON.parse(localStorage[this.get("namespace")+"@bookmark"]||"{}")},ol.control.GeoBookmark.prototype.removeBookmark=function(t){if(t){var e=this.getBookmarks();delete e[t],this.setBookmarks(e)}},ol.control.GeoBookmark.prototype.addBookmark=function(t,e,o,i){if(t){var n=e,r=this.getMap().getView().getRotation();n&&n.position&&(o=n.zoom,i=n.permanent,r=n.rotation,e=n.position);var a=this.getBookmarks();a[t]&&a[t].permanent||(a[t]={pos:e||this.getMap().getView().getCenter(),zoom:o||this.getMap().getView().getZoom(),permanent:!!i},r&&(a[t].rot=r),this.setBookmarks(a))}},ol.control.GeolocationBar=function(t){t||(t={}),t.className=t.className||"ol-geobar",ol.control.Bar.call(this,t),this.setPosition(t.position||"bottom-right");var e=this.element,o=new ol.interaction.GeolocationDraw({source:t.source,zoom:t.zoom,minZoom:t.minZoom,tolerance:t.tolerance,followTrack:t.followTrack,minAccuracy:t.minAccuracy||1e4});this._geolocBt=new ol.control.Toggle({className:"geolocBt",interaction:o,onToggle:function(){o.pause(!0),o.setFollowTrack(t.followTrack),e.classList.remove("pauseTrack")}}),this.addControl(this._geolocBt),this._geolocBt.setActive(!1);var i=new ol.control.Bar;this.addControl(i);var n=new ol.control.TextButton({className:"centerBt",html:t.centerLabel||"center",handleClick:function(){o.setFollowTrack("auto")}});i.addControl(n);var r=new ol.control.Button({className:"startBt",handleClick:function(){o.pause(!1),o.setFollowTrack("auto"),e.classList.add("pauseTrack")}});i.addControl(r);var a=new ol.control.Button({className:"pauseBt",handleClick:function(){o.pause(!0),o.setFollowTrack("auto"),e.classList.remove("pauseTrack")}});i.addControl(a),o.on("follow",(function(t){t.following?e.classList.remove("centerTrack"):e.classList.add("centerTrack")})),this._geolocBt.on("change:active",(function(t){t.active?e.classList.add("ol-active"):e.classList.remove("ol-active")}))},ol.ext.inherits(ol.control.GeolocationBar,ol.control.Bar),ol.control.GeolocationBar.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Bar.prototype.setMap.call(this,t),t&&(this._listener=t.on("moveend",function(){var e=this.getInteraction();e.getActive()&&"auto"===e.get("followTrack")&&e.path_.length&&e.path_[e.path_.length-1][0]!==t.getView().getCenter()[0]&&this.element.classList.add("centerTrack")}.bind(this)))},ol.control.GeolocationBar.prototype.getInteraction=function(){return this._geolocBt.getInteraction()},ol.control.GeolocationButton=function(t){t||(t={}),t.followTrack=t.followTrack||"auto",t.zoom=t.zoom||16;var e,o=new ol.interaction.GeolocationDraw(t);ol.control.Toggle.call(this,{className:t.className=((t.className||"")+" ol-geobt").trim(),interaction:o,title:t.title||"Geolocation",onToggle:function(){o.pause(!0),o.setFollowTrack(t.followTrack||"auto")}}),this.setActive(!1),o.on("tracking",function(t){this.dispatchEvent({type:"position",coordinate:t.geolocation.getPosition()})}.bind(this)),o.on("change:active",function(){this.dispatchEvent({type:"position"}),e&&(clearTimeout(e),e=null),o.getActive()&&(e=setTimeout(function(){o.setActive(!1),e=null}.bind(this),t.delay||3e3))}.bind(this))},ol.ext.inherits(ol.control.GeolocationButton,ol.control.Toggle),ol.control.Globe=function(t){var e,o=t||{},i=this;o.target?(e=document.createElement("div"),this.panel_=o.target):((e=document.createElement("div")).classList.add("ol-globe","ol-unselectable","ol-control"),/top/.test(o.align)&&e.classList.add("ol-control-top"),/right/.test(o.align)&&e.classList.add("ol-control-right"),this.panel_=document.createElement("div"),this.panel_.classList.add("panel"),e.appendChild(this.panel_),this.pointer_=document.createElement("div"),this.pointer_.classList.add("ol-pointer"),e.appendChild(this.pointer_)),ol.control.Control.call(this,{element:e,target:o.target}),this.ovmap_=new ol.Map({controls:new ol.Collection,interactions:new ol.Collection,target:this.panel_,view:new ol.View({zoom:0,center:[0,0]}),layers:o.layers}),setTimeout((function(){i.ovmap_.updateSize()}),0),this.set("follow",o.follow||!1),this.extentLayer=new ol.layer.Vector({name:"Cache extent",source:new ol.source.Vector,style:o.style||[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,0, 1)"}),stroke:new ol.style.Stroke({width:7,color:"rgba(255,0,0, 0.8)"}),radius:5})})]}),this.ovmap_.addLayer(this.extentLayer)},ol.ext.inherits(ol.control.Globe,ol.control.Control),ol.control.Globe.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener=t.getView().on("propertychange",this.setView.bind(this)),this.setView())},ol.control.Globe.prototype.setView=function(){this.getMap()&&this.get("follow")&&this.setCenter(this.getMap().getView().getCenter())},ol.control.Globe.prototype.getGlobe=function(){return this.ovmap_},ol.control.Globe.prototype.show=function(t){!1!==t?this.element.classList.remove("ol-collapsed"):this.element.classList.add("ol-collapsed"),this.ovmap_.updateSize()},ol.control.Globe.prototype.setPosition=function(t){/top/.test(t)?this.element.classList.add("ol-control-top"):this.element.classList.remove("ol-control-top"),/right/.test(t)?this.element.classList.add("ol-control-right"):this.element.classList.remove("ol-control-right")},ol.control.Globe.prototype.setCenter=function(t,e){var o=this;if(this.pointer_.classList.add("hidden"),t){var i=this.ovmap_,n=i.getPixelFromCoordinate(t);if(n){if(!1!==e){var r=this.element.clientHeight;setTimeout((function(){o.pointer_.style.top=String(Math.min(Math.max(n[1],0),r))+"px",o.pointer_.style.left="50%",o.pointer_.classList.remove("hidden")}),800)}i.getView().animate({center:[t[0],0]})}}},ol.control.Graticule=function(t){t||(t={});var e=document.createElement("div");e.className="ol-graticule ol-unselectable ol-hidden",ol.control.CanvasBase.call(this,{element:e}),this.set("projection",t.projection||"EPSG:4326");var o=new ol.proj.Projection({code:this.get("projection")}).getMetersPerUnit();for(this.fac=1;o/this.fac>10;)this.fac*=10;this.fac=1e4/this.fac,this.set("maxResolution",t.maxResolution||1/0),this.set("step",t.step||.1),this.set("stepCoord",t.stepCoord||1),this.set("spacing",t.spacing||40),this.set("margin",t.margin||0),this.set("borderWidth",t.borderWidth||5),this.set("stroke",!1!==t.stroke),this.formatCoord=t.formatCoord||function(t){return t},t.style instanceof ol.style.Style?this.setStyle(t.style):this.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:"#000",width:1}),fill:new ol.style.Fill({color:"#fff"}),text:new ol.style.Text({stroke:new ol.style.Stroke({color:"#fff",width:2}),fill:new ol.style.Fill({color:"#000"})})}))},ol.ext.inherits(ol.control.Graticule,ol.control.CanvasBase),ol.control.Graticule.prototype.setStyle=function(t){this._style=t},ol.control.Graticule.prototype._draw=function(t){if(!(this.get("maxResolution")<t.frameState.viewState.resolution)){for(var e,o=this.getContext(t),i=o.canvas,n=t.frameState.pixelRatio,r=i.width/n,a=i.height/n,s=this.get("projection"),l=this.getMap(),c=[l.getCoordinateFromPixel([0,0]),l.getCoordinateFromPixel([r,0]),l.getCoordinateFromPixel([r,a]),l.getCoordinateFromPixel([0,a])],h=-1/0,u=1/0,p=-1/0,d=1/0,f=0;e=c[f];f++)c[f]=ol.proj.transform(e,l.getView().getProjection(),s),h=Math.max(h,c[f][0]),u=Math.min(u,c[f][0]),p=Math.max(p,c[f][1]),d=Math.min(d,c[f][1]);var g=this.get("spacing"),m=this.get("step"),y=this.get("stepCoord"),v=this.get("borderWidth"),b=this.get("margin");if((h-u)/m*g>r)(m*=Math.round((h-u)/r*g/m))>this.fac&&(m=Math.round(m/this.fac)*this.fac);u=Math.floor(u/m)*m-m,d=Math.floor(d/m)*m-m,h=Math.floor(h/m)*m+2*m,p=Math.floor(p/m)*m+2*m;var _=ol.proj.get(s).getExtent();_&&(u<_[0]&&(u=_[0]),d<_[1]&&(d=_[1]),h>_[2]&&(h=_[2]+m),p>_[3]&&(p=_[3]+m));var S=this.getStyle().getStroke()&&this.get("stroke"),w=this.getStyle().getText(),x=this.getStyle().getFill();o.save(),o.scale(n,n),o.beginPath(),o.rect(b,b,r-2*b,a-2*b),o.clip(),o.beginPath();var L,M,k,C,E,T={top:[],left:[],bottom:[],right:[]};for(L=u;L<h;L+=m)for(C=ol.proj.transform([L,d],s,l.getView().getProjection()),C=l.getPixelFromCoordinate(C),S&&o.moveTo(C[0],C[1]),k=C,M=d+m;M<=p;M+=m)E=ol.proj.transform([L,M],s,l.getView().getProjection()),E=l.getPixelFromCoordinate(E),S&&o.lineTo(E[0],E[1]),k[1]>0&&E[1]<0&&T.top.push([L,k]),k[1]>a&&E[1]<a&&T.bottom.push([L,k]),k=E;for(M=d;M<p;M+=m)for(C=ol.proj.transform([u,M],s,l.getView().getProjection()),C=l.getPixelFromCoordinate(C),S&&o.moveTo(C[0],C[1]),k=C,L=u+m;L<=h;L+=m)E=ol.proj.transform([L,M],s,l.getView().getProjection()),E=l.getPixelFromCoordinate(E),S&&o.lineTo(E[0],E[1]),k[0]<0&&E[0]>0&&T.left.push([M,k]),k[0]<r&&E[0]>r&&T.right.push([M,k]),k=E;if(S&&(o.strokeStyle=this.getStyle().getStroke().getColor(),o.lineWidth=this.getStyle().getStroke().getWidth(),o.stroke()),w){var P,O;o.fillStyle=this.getStyle().getText().getFill().getColor(),o.strokeStyle=this.getStyle().getText().getStroke().getColor(),o.lineWidth=this.getStyle().getText().getStroke().getWidth(),o.font=this.getStyle().getText().getFont(),o.textAlign="center",o.textBaseline="hanging";var A=(x?v:0)+b+2;for(f=0;P=T.top[f];f++)Math.round(P[0]/this.get("step"))%y||(O=this.formatCoord(P[0],"top"),o.strokeText(O,P[1][0],A),o.fillText(O,P[1][0],A));for(o.textBaseline="alphabetic",f=0;P=T.bottom[f];f++)Math.round(P[0]/this.get("step"))%y||(O=this.formatCoord(P[0],"bottom"),o.strokeText(O,P[1][0],a-A),o.fillText(O,P[1][0],a-A));for(o.textBaseline="middle",o.textAlign="left",f=0;P=T.left[f];f++)Math.round(P[0]/this.get("step"))%y||(O=this.formatCoord(P[0],"left"),o.strokeText(O,A,P[1][1]),o.fillText(O,A,P[1][1]));for(o.textAlign="right",f=0;P=T.right[f];f++)Math.round(P[0]/this.get("step"))%y||(O=this.formatCoord(P[0],"right"),o.strokeText(O,r-A,P[1][1]),o.fillText(O,r-A,P[1][1]))}if(x){var I,N,F=this.getStyle().getFill().getColor();for((N=this.getStyle().getStroke())?I=this.getStyle().getStroke().getColor():(I=F,F="#fff"),o.strokeStyle=I,o.lineWidth=N?N.getWidth():1,f=1;f<T.top.length;f++)o.beginPath(),o.rect(T.top[f-1][1][0],b,T.top[f][1][0]-T.top[f-1][1][0],v),o.fillStyle=Math.round(T.top[f][0]/m)%2?I:F,o.fill(),o.stroke();for(f=1;f<T.bottom.length;f++)o.beginPath(),o.rect(T.bottom[f-1][1][0],a-v-b,T.bottom[f][1][0]-T.bottom[f-1][1][0],v),o.fillStyle=Math.round(T.bottom[f][0]/m)%2?I:F,o.fill(),o.stroke();for(f=1;f<T.left.length;f++)o.beginPath(),o.rect(b,T.left[f-1][1][1],v,T.left[f][1][1]-T.left[f-1][1][1]),o.fillStyle=Math.round(T.left[f][0]/m)%2?I:F,o.fill(),o.stroke();for(f=1;f<T.right.length;f++)o.beginPath(),o.rect(r-v-b,T.right[f-1][1][1],v,T.right[f][1][1]-T.right[f-1][1][1]),o.fillStyle=Math.round(T.right[f][0]/m)%2?I:F,o.fill(),o.stroke();o.beginPath(),o.fillStyle=I,o.rect(b,b,v,v),o.rect(b,a-v-b,v,v),o.rect(r-v-b,b,v,v),o.rect(r-v-b,a-v-b,v,v),o.fill()}o.restore()}},ol.control.GridReference=function(t){t||(t={});var e=document.createElement("div");e.className=(t.target?"":"ol-control ")+"ol-gridreference ol-unselectable "+(t.className||""),t.style=t.style||new ol.style.Style({stroke:new ol.style.Stroke({color:"#000",width:1}),text:new ol.style.Text({font:"bold 14px Arial",stroke:new ol.style.Stroke({color:"#fff",width:2}),fill:new ol.style.Fill({color:"#000"})})}),ol.control.CanvasBase.call(this,{element:e,target:t.target,style:t.style}),"function"==typeof t.property&&(this.getFeatureName=t.property),"function"==typeof t.sortFeatures&&(this.sortFeatures=t.sortFeatures),"function"==typeof t.indexTitle&&(this.indexTitle=t.indexTitle),this.source_=t.source,t.source&&(this.setIndex(t.source.getFeatures(),t),t.source.once("change",function(){"ready"===t.source.getState()&&this.setIndex(t.source.getFeatures(),t)}.bind(this))),this.set("maxResolution",t.maxResolution||1/0),this.set("extent",t.extent),this.set("size",t.size),this.set("margin",t.margin||0),this.set("property",t.property||"name"),this.set("filterLabel",t.filterLabel||"filter")},ol.ext.inherits(ol.control.GridReference,ol.control.CanvasBase),ol.control.GridReference.prototype.getFeatureName=function(t){return t.get(this.get("property")||"name")},ol.control.GridReference.prototype.sortFeatures=function(t,e){return this.getFeatureName(t)==this.getFeatureName(e)?0:this.getFeatureName(t)<this.getFeatureName(e)?-1:1},ol.control.GridReference.prototype.indexTitle=function(t){return this.getFeatureName(t).charAt(0)},ol.control.GridReference.prototype.setIndex=function(t){if(this.getMap()){var e=this;t.getArray&&(t=t.getArray()),t.sort((function(t,o){return e.sortFeatures(t,o)})),this.element.innerHTML="";var o=this.element,i=document.createElement("input");i.setAttribute("type","search"),i.setAttribute("placeholder",this.get("filterLabel")||"filter");var n=function(){var t=this.value.replace(/^\*/,""),e=new RegExp(t,"i");s.querySelectorAll("li").forEach((function(t){t.classList.contains("ol-title")||e.test(t.querySelector(".ol-name").textContent)?t.style.display="":t.style.display="none"})),s.querySelectorAll("li.ol-title").forEach((function(t){var e=!1;e=[].filter.call(t.parentNode.children,(function(o){return o.previousElementSibling===t?e=!0:e})),console.log(e);var o=e[0];o.length&&!o.classList.contains("ol-title")?t.style.display="":t.style.display="none"}))};i.addEventListener("search",n),i.addEventListener("keyup",n),o.appendChild(i);var r,a,s=document.createElement("ul");o.appendChild(s);for(var l,c=0;l=t[c];c++)!function(t){if(r=e.getReference(t.getGeometry().getFirstCoordinate())){var o=e.getFeatureName(t),i=e.indexTitle(t);if(i!=a){var n=document.createElement("li");n.classList.add("ol-title"),n.textContent=i,s.appendChild(n)}a=i;var l=document.createElement("li"),c=document.createElement("span");c.classList.add("ol-name"),c.textContent=o,l.appendChild(c);var h=document.createElement("span");h.classList.add("ol-ref"),h.textContent=r,l.appendChild(h);var u=t;l.addEventListener("click",(function(){e.dispatchEvent({type:"select",feature:u})})),s.appendChild(l)}}(l)}},ol.control.GridReference.prototype.getReference=function(t){if(this.getMap()){var e=this.get("extent"),o=this.get("size"),i=Math.floor((t[0]-e[0])/(e[2]-e[0])*o[0]);if(i<0||i>=o[0])return"";var n=Math.floor((e[3]-t[1])/(e[3]-e[1])*o[1]);return n<0||n>=o[1]?"":String.fromCharCode(65+i)+n}},ol.control.GridReference.prototype._draw=function(t){if(!(this.get("maxResolution")<t.frameState.viewState.resolution)){var e=this.getContext(t),o=e.canvas,i=t.frameState.pixelRatio,n=o.width/i,r=o.height/i,a=this.get("extent"),s=this.get("size"),l=this.getMap(),c=ol.extent.boundingExtent([l.getPixelFromCoordinate([a[0],a[1]]),l.getPixelFromCoordinate([a[2],a[3]])]),h=[c[0],c[1]],u=[c[2],c[3]],p=(u[0]-h[0])/s[0],d=(u[1]-h[1])/s[1];e.save();var f,g=this.get("margin");for(e.scale(i,i),e.strokeStyle=this.getStroke().getColor(),e.lineWidth=this.getStroke().getWidth(),e.beginPath(),f=0;f<=s[0];f++)e.moveTo(h[0]+f*p,h[1]),e.lineTo(h[0]+f*p,u[1]);for(f=0;f<=s[1];f++)e.moveTo(h[0],h[1]+f*d),e.lineTo(u[0],h[1]+f*d);e.stroke(),e.font=this.getTextFont(),e.fillStyle=this.getTextFill().getColor(),e.strokeStyle=this.getTextStroke().getColor();var m,y,v,b=g+(e.lineWidth=this.getTextStroke().getWidth());for(e.textAlign="center",f=0;f<s[0];f++)m=String.fromCharCode(65+f),y=h[0]+f*p+p/2,(v=h[1]-b)<0?(v=b,e.textBaseline="hanging"):e.textBaseline="alphabetic",e.strokeText(m,y,v),e.fillText(m,y,v),(v=u[1]+b)>r?(v=r-b,e.textBaseline="alphabetic"):e.textBaseline="hanging",e.strokeText(m,y,v),e.fillText(m,y,v);for(e.textBaseline="middle",f=0;f<s[1];f++)v=h[1]+f*d+d/2,e.textAlign="right",(y=h[0]-b)<0?(y=b,e.textAlign="left"):e.textAlign="right",e.strokeText(f,y,v),e.fillText(f,y,v),(y=u[0]+b)>n?(y=n-b,e.textAlign="right"):e.textAlign="left",e.strokeText(f,y,v),e.fillText(f,y,v);e.restore()}},ol.control.Imageline=function(t){var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-imageline"+(t.target?"":" ol-unselectable ol-control")+(t.collapsed&&t.collapsible?"ol-collapsed":"")+("ontouchstart"in window?" ol-touch":"")});!t.target&&t.collapsible&&ol.ext.element.create("BUTTON",{type:"button",click:function(){this.toggle()}.bind(this),parent:e}),this._source=t.source,ol.control.Control.call(this,{element:e,target:t.target}),this._setScrolling(),this._scrolldiv.addEventListener("scroll",function(){this.getMap()&&this.getMap().render()}.bind(this)),"function"==typeof t.getImage&&(this._getImage=t.getImage),"function"==typeof t.getTitle&&(this._getTitle=t.getTitle),this.set("maxFeatures",t.maxFeatures||100),this.set("linkColor",t.linkColor||!1),this.set("hover",t.hover||!1),this.set("useExtent",t.useExtent||!1),this.refresh()},ol.ext.inherits(ol.control.Imageline,ol.control.Control),ol.control.Imageline.prototype.setMap=function(t){this._listener&&this._listener.forEach(function(t){ol.Observable.unByKey(t)}.bind(this)),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener=[t.on("postcompose",this._drawLink.bind(this)),t.on("moveend",function(){this.get("useExtent")&&this.refresh()}.bind(this))])},ol.control.Imageline.prototype.useExtent=function(t){this.set("useExtent",t),this.refresh()},ol.control.Imageline.prototype.isCollapsed=function(){return this.element.classList.contains("ol-collapsed")},ol.control.Imageline.prototype.collapse=function(t){t?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.getMap()&&setTimeout(function(){this.getMap().render()}.bind(this),this.isCollapsed()?0:250),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},ol.control.Imageline.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.getMap()&&setTimeout(function(){this.getMap().render()}.bind(this),this.isCollapsed()?0:250),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},ol.control.Imageline.prototype._getImage=function(t){return t.get("img")},ol.control.Imageline.prototype._getTitle=function(){return""},ol.control.Imageline.prototype.getFeatures=function(){var t=this.getMap();if(this.get("useExtent")&&t){var e=t.getView().calculateExtent(t.getSize());return this._source.getFeaturesInExtent(e)}return this._source.getFeatures()},ol.control.Imageline.prototype._setScrolling=function(){var t=this._scrolldiv=ol.ext.element.create("DIV",{parent:this.element});ol.ext.element.scrollDiv(t,{onmove:function(t){this._moving=t}.bind(this)})},ol.control.Imageline.prototype.refresh=function(){this._scrolldiv.innerHTML="";var t=this.getFeatures(),e=this._select?this._select.feature:null;this._select&&(this._select.elt=null),this._iline=[],this.getMap()&&this.getMap().render();for(var o,i=function(t){if(this._getImage(t)){var o=ol.ext.element.create("DIV",{className:"ol-image",parent:this._scrolldiv});ol.ext.element.create("IMG",{src:this._getImage(t),parent:o}).addEventListener("load",(function(){this.classList.add("ol-loaded")})),ol.ext.element.create("SPAN",{html:this._getTitle(t),parent:o});var i={elt:o,feature:t};o.addEventListener("click",function(){this._moving||(this.dispatchEvent({type:"select",feature:t}),this._scrolldiv.scrollLeft=o.offsetLeft+ol.ext.element.getStyle(o,"width")/2-ol.ext.element.getStyle(this.element,"width")/2,this._select&&this._select.elt.classList.remove("select"),this._select=i,this._select.elt.classList.add("select"))}.bind(this)),o.addEventListener("mouseover",function(t){this.get("hover")&&(this._select&&this._select.elt.classList.remove("select"),this._select=i,this._select.elt.classList.add("select"),this.getMap().render(),t.stopPropagation())}.bind(this)),o.addEventListener("mouseout",function(t){this.get("hover")&&(this._select&&this._select.elt.classList.remove("select"),this._select=!1,this.getMap().render(),t.stopPropagation())}.bind(this)),o.ondragstart=function(){return!1},this._iline.push(i),e===t&&(this._select=i,i.elt.classList.add("select"))}}.bind(this),n=this.get("maxFeatures"),r=0;(o=t[r])&&!(n--<0);r++)i(o);this._select&&this._select.feature&&!this._select.elt&&i(this._select.feature)},ol.control.Imageline.prototype.select=function(t,e){this._select=!1,this._iline.forEach(function(o){o.feature===t?(o.elt.classList.add("select"),this._select=o,!1!==e&&(this._scrolldiv.scrollLeft=o.elt.offsetLeft+ol.ext.element.getStyle(o.elt,"width")/2-ol.ext.element.getStyle(this.element,"width")/2)):o.elt.classList.remove("select")}.bind(this))},ol.control.Imageline.prototype._drawLink=function(t){if(!(!this.get("linkColor")|this.isCollapsed())&&(this.getMap()&&this._select&&this._select.elt)){var e=t.context||ol.ext.getMapCanvas(this.getMap()).getContext("2d"),o=t.frameState.pixelRatio,i=[this._select.elt.offsetLeft-this._scrolldiv.scrollLeft+ol.ext.element.getStyle(this._select.elt,"width")/2,parseFloat(ol.ext.element.getStyle(this.element,"top"))||this.getMap().getSize()[1]],n=this._select.feature.getGeometry().getFirstCoordinate();n=this.getMap().getPixelFromCoordinate(n),e.save(),e.fillStyle=this.get("linkColor"),e.beginPath(),n[0]>i[0]?(e.moveTo((i[0]-5)*o,i[1]*o),e.lineTo((i[0]+5)*o,(i[1]+5)*o)):(e.moveTo((i[0]-5)*o,(i[1]+5)*o),e.lineTo((i[0]+5)*o,i[1]*o)),e.lineTo(n[0]*o,n[1]*o),e.fill(),e.restore()}},ol.control.IsochroneGeoportail=function(t){var e=this;t||(t={}),null==t.typing&&(t.typing=300);var o=(t.className?t.className:"")+" ol-isochrone ol-routing";t.target||(o+=" ol-unselectable ol-control");var i=ol.ext.element.create("DIV",{className:o});t.target||ol.ext.element.create("BUTTON",{parent:i}).addEventListener("click",(function(){i.classList.toggle("ol-collapsed")}));ol.control.Control.call(this,{element:i,target:t.target}),this.set("iter",1);var n=ol.ext.element.create("DIV",{className:"content",parent:i});this._addSearchCtrl(n,t),ol.ext.element.create("BUTTON",{className:"ol-button ol-method-time selected",title:"isochrone",parent:n}).addEventListener("click",function(){this.setMethod("time")}.bind(this)),ol.ext.element.create("I",{className:"ol-button ol-method-distance",title:"isodistance",parent:n}).addEventListener("click",function(){this.setMethod("distance")}.bind(this)),ol.ext.element.create("I",{className:"ol-button ol-car selected",title:"by car",parent:n}).addEventListener("click",function(){this.setMode("car")}.bind(this)),ol.ext.element.create("I",{className:"ol-button ol-pedestrian",title:"by foot",parent:n}).addEventListener("click",function(){this.setMode("pedestrian")}.bind(this)),ol.ext.element.create("I",{className:"ol-button ol-direction-direct selected",title:"direct",parent:n}).addEventListener("click",function(){this.setDirection("direct")}.bind(this)),ol.ext.element.create("I",{className:"ol-button ol-direction-reverse",title:"reverse",parent:n}).addEventListener("click",function(){this.setDirection("reverse")}.bind(this));var r=ol.ext.element.create("DIV",{className:"ol-time",parent:n});ol.ext.element.create("DIV",{html:"isochrone:",parent:r}),ol.ext.element.create("INPUT",{type:"number",parent:r,min:0}).addEventListener("change",(function(){e.set("hour",Number(this.value))})),ol.ext.element.create("TEXT",{parent:r,html:"h"}),ol.ext.element.create("INPUT",{type:"number",parent:r,min:0}).addEventListener("change",(function(){e.set("minute",Number(this.value))})),ol.ext.element.create("TEXT",{parent:r,html:"mn"}),r=ol.ext.element.create("DIV",{className:"ol-distance",parent:n}),ol.ext.element.create("DIV",{html:"isodistance:",parent:r}),ol.ext.element.create("INPUT",{type:"number",step:"any",parent:r,min:0}).addEventListener("change",(function(){e.set("distance",Number(this.value))})),ol.ext.element.create("TEXT",{parent:r,html:"km"}),r=ol.ext.element.create("DIV",{className:"ol-iter",parent:n}),ol.ext.element.create("DIV",{html:"Iteration:",parent:r}),ol.ext.element.create("INPUT",{type:"number",parent:r,value:1,min:1}).addEventListener("change",(function(){e.set("iter",Number(this.value))})),ol.ext.element.create("I",{className:"ol-ok",html:"ok",parent:n}).addEventListener("click",function(){var t=0;switch(this.get("method")){case"distance":t=1e3*this.get("distance");break;default:t=3600*(this.get("hour")||0)+60*(this.get("minute")||0)}t&&this.get("coordinate")&&this.search(this.get("coordinate"),t)}.bind(this)),this.set("url","https://wxs.ign.fr/"+t.apiKey+"/isochrone/isochrone.json"),this._ajax=new ol.ext.Ajax({dataType:"JSON",auth:t.auth}),this._ajax.on("success",this._success.bind(this)),this._ajax.on("error",this._error.bind(this)),this._ajax.on("loadstart",function(){this.element.classList.add("ol-searching")}.bind(this)),this._ajax.on("loadend",function(){this.element.classList.remove("ol-searching")}.bind(this)),this.setMethod(t.method)},ol.ext.inherits(ol.control.IsochroneGeoportail,ol.control.Control),ol.control.IsochroneGeoportail.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this._search.setMap(t)},ol.control.IsochroneGeoportail.prototype._addSearchCtrl=function(t,e){var o=ol.ext.element.create("DIV",{parent:t}),i=this._search=new ol.control.SearchGeoportail({className:"IGNF ol-collapsed",apiKey:e.apiKey,target:o});i.on("select",function(t){i.setInput(t.search.fulltext),this.set("coordinate",t.coordinate)}.bind(this)),i.on("change:input",function(){this.set("coordinate",!1)}.bind(this))},ol.control.IsochroneGeoportail.prototype.setMethod=function(t){t=/distance/.test(t)?"distance":"time",this.element.querySelector(".ol-method-time").classList.remove("selected"),this.element.querySelector(".ol-method-distance").classList.remove("selected"),this.element.querySelector(".ol-method-"+t).classList.add("selected"),this.element.querySelector("div.ol-time").classList.remove("selected"),this.element.querySelector("div.ol-distance").classList.remove("selected"),this.element.querySelector("div.ol-"+t).classList.add("selected"),this.set("method",t)},ol.control.IsochroneGeoportail.prototype.setMode=function(t){this.set("mode",t),this.element.querySelector(".ol-car").classList.remove("selected"),this.element.querySelector(".ol-pedestrian").classList.remove("selected"),this.element.querySelector(".ol-"+t).classList.add("selected")},ol.control.IsochroneGeoportail.prototype.setDirection=function(t){this.set("direction",t),this.element.querySelector(".ol-direction-direct").classList.remove("selected"),this.element.querySelector(".ol-direction-reverse").classList.remove("selected"),this.element.querySelector(".ol-direction-"+t).classList.add("selected")},ol.control.IsochroneGeoportail.prototype.search=function(t,e,o){var i=this.getMap()?this.getMap().getView().getProjection():"EPSG:3857",n=/distance/.test(this.get("method"))?"distance":"time";if("string"==typeof e){var r=e.replace(/([0-9|.]*)([a-z]*)$/,"$2");switch(n="time",e=parseFloat(e),r){case"mn":e*=60;break;case"h":e*=3600;break;case"m":n="distance";break;case"km":n="distance",e*=1e3}}var a=Math.round(e*(this.get("iter")-(o||0))/this.get("iter"));if("number"==typeof e){var s={"gp-access-lib":"2.1.0",location:ol.proj.toLonLat(t,i),graphName:"pedestrian"===this.get("mode")?"Pieton":"Voiture",exclusions:this.get("exclusions")||void 0,method:n,time:"time"===n?a:void 0,distance:"distance"===n?a:void 0,reverse:"reverse"===this.get("direction"),smoothing:this.get("smoothing")||!0,holes:this.get("holes")||!1};this._ajax.send(this.get("url"),s,{coord:t,option:e,data:s,iteration:(o||0)+1})}},ol.control.IsochroneGeoportail.prototype._success=function(t){var e=this.getMap()?this.getMap().getView().getProjection():"EPSG:3857",o=new ol.format.WKT,i=t.response;i.feature=o.readFeature(i.wktGeometry,{dataProjection:"EPSG:4326",featureProjection:e}),i.feature.set("iteration",t.options.iteration),i.feature.set("method",t.options.data.method),i.feature.set(t.options.data.method,t.options.data[t.options.data.method]),delete i.wktGeometry,i.type="isochrone",i.iteration=t.options.iteration-1,this.dispatchEvent(i),t.options.iteration<this.get("iter")&&this.search(t.options.coord,t.options.option,t.options.iteration)},ol.control.IsochroneGeoportail.prototype._error=function(){this.dispatchEvent({type:"error"})},ol.control.LayerPopup=function(t){(t=t||{}).switcherClass="ol-layerswitcher-popup",!1!==t.mouseover&&(t.mouseover=!0),ol.control.LayerSwitcher.call(this,t)},ol.ext.inherits(ol.control.LayerPopup,ol.control.LayerSwitcher),ol.control.LayerPopup.prototype.overflow=function(){},ol.control.LayerPopup.prototype.drawList=function(t,e){var o=this,i=function(t){t.preventDefault();var i=o._getLayerForLI(this);o.switchLayerVisibility(i,e),"touchstart"==t.type&&o.element.classList.add("ol-collapsed")};e.forEach((function(e){if(o.displayInLayerSwitcher(e)){var n=ol.ext.element.create("LI",{html:e.get("title")||e.get("name"),on:{"click touchstart":i},parent:t});o._setLayerForLI(n,e),o.testLayerVisibility(e)&&n.classList.add("ol-layer-hidden"),e.getVisible()&&n.classList.add("ol-visible")}}))},ol.control.LayerSwitcherImage=function(t){(t=t||{}).switcherClass="ol-layerswitcher-image",!1!==t.mouseover&&(t.mouseover=!0),ol.control.LayerSwitcher.call(this,t)},ol.ext.inherits(ol.control.LayerSwitcherImage,ol.control.LayerSwitcher),ol.control.LayerSwitcherImage.prototype.drawList=function(t,e){var o=this,i=function(t){t.preventDefault();var i=o._getLayerForLI(this);o.switchLayerVisibility(i,e),"touchstart"==t.type&&o.element.classList.add("ol-collapsed")};ol.ext.element.setStyle(t,{height:"auto"}),e.forEach((function(e){if(o.displayInLayerSwitcher(e)){var n=e.getPreview?e.getPreview():["none"],r=ol.ext.element.create("LI",{className:"ol-imgcontainer"+(e.getVisible()?" ol-visible":""),on:{"touchstart click":i},parent:t});o._setLayerForLI(r,e),n.forEach((function(t){ol.ext.element.create("IMG",{src:t,parent:r})})),ol.ext.element.create("p",{html:e.get("title")||e.get("name"),parent:r}),o.testLayerVisibility(e)&&r.classList.add("ol-layer-hidden")}}))},ol.control.LayerSwitcherImage.prototype.overflow=function(){},ol.control.Legend=function(t){t=t||{};var e=document.createElement("div");if(t.target)e.className=t.className||"ol-legend";else{e.className=(t.className||"ol-legend")+" ol-unselectable ol-control"+(!1===t.collapsible?" ol-uncollapsible":" ol-collapsed");var o=document.createElement("button");o.setAttribute("type","button"),o.addEventListener("click",function(){this.toggle()}.bind(this)),e.appendChild(o),(o=document.createElement("button")).setAttribute("type","button"),o.className="ol-closebox",o.addEventListener("click",function(){this.toggle()}.bind(this)),e.appendChild(o)}ol.control.Control.call(this,{element:e,target:t.target}),this._legend=t.legend,this._legend.getCanvas().className="ol-legendImg",e.appendChild(this._legend.getCanvas()),e.appendChild(this._legend.getListElement()),!1===t.collapsible&&!1!==t.collapsed||this.show(),this._legend.on("select",function(t){this.dispatchEvent(t)}.bind(this))},ol.ext.inherits(ol.control.Legend,ol.control.Control),ol.control.Legend.prototype.show=function(){this.element.classList.contains("ol-collapsed")&&(this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!1}))},ol.control.Legend.prototype.hide=function(){this.element.classList.contains("ol-collapsed")||(this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!0}))},ol.control.Legend.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:this.element.classList.contains("ol-collapsed")})},ol.control.MapZone=function(t){t||(t={});var e=document.createElement("div");if(t.target)e=ol.ext.element.create("DIV",{className:t.className||"ol-mapzone"});else{e=ol.ext.element.create("DIV",{className:(t.className||"ol-mapzone")+" ol-unselectable ol-control ol-collapsed"});var o=ol.ext.element.create("BUTTON",{type:"button",on:{click:function(){e.classList.toggle("ol-collapsed"),i.forEach((function(t){t.updateSize()}))}.bind(this)},parent:e});ol.ext.element.create("I",{parent:o})}ol.control.Control.call(this,{element:e,target:t.target});var i=this._maps=[];t.zones.forEach(function(o){var n=new ol.View({zoom:6,center:[0,0],projection:t.projection}),r=ol.proj.transformExtent(o.extent,"EPSG:4326",n.getProjection());console.log(r,o.extent);var a=ol.ext.element.create("DIV",{className:"ol-mapzonezone",parent:e,click:function(){this.dispatchEvent({type:"select",coordinate:ol.extent.getCenter(r),extent:r}),!1!==t.centerOnClick&&this.getMap().getView().fit(r),this.setVisible(!1)}.bind(this)}),s=new t.layer.constructor({source:t.layer.getSource()}),l=new ol.Map({target:a,view:n,controls:[],interactions:[],layers:[s]});i.push(l),n.fit(r),ol.ext.element.create("P",{html:o.title,parent:a})}.bind(this)),setTimeout((function(){i.forEach((function(t){t.updateSize()}))}))},ol.ext.inherits(ol.control.MapZone,ol.control.Control),ol.control.MapZone.prototype.setVisible=function(t){t?(this.element.classList.remove("ol-collapsed"),this.getMaps().forEach((function(t){t.updateSize()}))):this.element.classList.add("ol-collapsed")},ol.control.MapZone.prototype.getMaps=function(){return this._maps},ol.control.MapZone.zones={},ol.control.MapZone.zones.DOM=[{title:"Guadeloupe",extent:[-61.898594315312444,15.75623038647845,-60.957887532935324,16.575317670979473]},{title:"Guyane",extent:[-54.72525931072715,2.1603763430019,-51.528236062921344,5.7984307809552575]},{title:"Martinique",extent:[-61.257556528564756,14.387506317407514,-60.76934912110432,14.895067461729951]},{title:"Mayotte",extent:[44.959844536967815,-13.01674138212816,45.35328866510648,-12.65521942207829]},{title:"La réunion",extent:[55.17059012967656,-21.407680069231688,55.88195702001797,-20.85560221637526]}],ol.control.MapZone.zones.TOM=[{title:"Polynésie Française",extent:[206.23664226630862,-22.189040615809787,221.85920743981987,-10.835039595040698]},{title:"Nouvelle Calédonie",extent:[163.76420580160925,-22.581641092751838,167.66984709498706,-19.816411635668445]},{title:"St-Pierre et Miquelon",extent:[-56.453698765748676,46.74449858188555,-56.0980198121544,47.14669874229787]},{title:"Wallis et Futuna",extent:[181.7588623143665,-14.7341169873267,183.95612353301715,-13.134720799175085]},{title:"St-Martin St-Barthélemy",extent:[-63.1726389501678,17.806097291313506,-62.7606535945649,18.13267688837938]}],ol.control.MapZone.zones.DOMTOM=[{title:"Métropole",extent:[-5.318421740712579,41.16082274292913,9.73284186155716,51.21957336557702]}].concat(ol.control.MapZone.zones.DOM,ol.control.MapZone.zones.TOM),ol.control.Notification=function(t){t=t||{};var e=document.createElement("DIV");this.contentElement=document.createElement("DIV"),e.appendChild(this.contentElement);var o=(t.className||"")+" ol-notification";t.target||(o+=" ol-unselectable ol-control ol-collapsed"),e.setAttribute("class",o),ol.control.Control.call(this,{element:e,target:t.target})},ol.ext.inherits(ol.control.Notification,ol.control.Control),ol.control.Notification.prototype.show=function(t,e){var o=this,i=this.element;t&&(t instanceof Node?(this.contentElement.innerHTML="",this.contentElement.appendChild(t)):this.contentElement.innerHTML=t),this._listener&&(clearTimeout(this._listener),this._listener=null),i.classList.add("ol-collapsed"),this._listener=setTimeout((function(){i.classList.remove("ol-collapsed"),o._listener=!e||e>=0?setTimeout((function(){i.classList.add("ol-collapsed"),o._listener=null}),e||3e3):null}),100)},ol.control.Notification.prototype.hide=function(){this._listener&&(clearTimeout(this._listener),this._listener=null),this.element.classList.add("ol-collapsed")},ol.control.Notification.prototype.toggle=function(t){this.element.classList.contains("ol-collapsed")?this.show(null,t):this.hide()},ol.control.Overlay=function(t){t||(t={});var e=ol.ext.element.create("DIV",{className:"ol-unselectable ol-overlay "+(t.className||""),html:t.content});ol.control.Control.call(this,{element:e,target:t.target});var o=this;t.hideOnClick&&e.addEventListener("click",(function(){o.hide()})),this.set("closeBox",t.closeBox),this._timeout=!1,this.setContent(t.content)},ol.ext.inherits(ol.control.Overlay,ol.control.Control),ol.control.Overlay.prototype.setContent=function(t){var e=this;if(t){var o=this.element;if(t instanceof Element?(o.innerHTML="",o.appendChild(t)):void 0!==t&&(o.innerHTML=t),this.get("closeBox")){var i=document.createElement("div");i.classList.add("ol-closebox"),i.addEventListener("click",(function(){e.hide()})),o.insertBefore(i,o.firstChild)}}},ol.control.Overlay.prototype.show=function(t,e){var o=this,i=this.element;i.style.display="block",e?(this.center_=this.getMap().getPixelFromCoordinate(e),i.style.top=this.center_[1]+"px",i.style.left=this.center_[0]+"px"):(this.center_=!1,i.style.top="",i.style.left=""),t&&this.setContent(t),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){i.classList.add("ol-visible"),i.style.top="",i.style.left="",o.dispatchEvent({type:"change:visible",visible:!0,element:o.element})}),10)},ol.control.Overlay.prototype.showImage=function(t,e){e=e||{};var o=ol.ext.element.create("DIV",{className:"ol-fullscreen-image"});ol.ext.element.create("IMG",{src:t,parent:o}),e.title&&(o.classList.add("ol-has-title"),ol.ext.element.create("P",{html:e.title,parent:o})),this.show(o,e.coordinate)},ol.control.Overlay.prototype.hide=function(){var t=this.element;this.element.classList.remove("ol-visible"),this.center_&&(t.style.top=this.center_[1]+"px",t.style.left=this.center_[0]+"px",this.center_=!1),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){t.style.display="none"}),500),this.dispatchEvent({type:"change:visible",visible:!1,element:this.element})},ol.control.Overlay.prototype.toggle=function(){this.getVisible()?this.hide():this.show()},ol.control.Overlay.prototype.getVisible=function(){return"none"!==ol.ext.element.getStyle(this.element,"display")},ol.control.Overlay.prototype.setClass=function(t){var e=this.element.classList.contains("ol-visible");this.element.className=("ol-unselectable ol-overlay "+(e?"ol-visible ":"")+t).trim()},ol.control.Overview=function(t){t=t||{};var e,o=this;if(this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom||18,this.rotation=t.rotation,t.target)e=document.createElement("div"),this.panel_=t.target;else{(e=document.createElement("div")).classList.add("ol-overview","ol-unselectable","ol-control","ol-collapsed"),/top/.test(t.align)&&e.classList.add("ol-control-top"),/right/.test(t.align)&&e.classList.add("ol-control-right");var i=document.createElement("button");i.setAttribute("type","button"),i.addEventListener("touchstart",(function(t){o.toggleMap(),t.preventDefault()})),i.addEventListener("click",(function(){o.toggleMap()})),e.appendChild(i),this.panel_=document.createElement("div"),this.panel_.classList.add("panel"),e.appendChild(this.panel_)}ol.control.Control.call(this,{element:e,target:t.target}),this.ovmap_=new ol.Map({controls:new ol.Collection,interactions:new ol.Collection,target:this.panel_,view:new ol.View({zoom:2,center:[0,0],projection:t.projection}),layers:t.layers}),this.oview_=this.ovmap_.getView(),this.extentLayer=new ol.layer.Vector({name:"Cache extent",source:new ol.source.Vector,style:t.style||[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,0, 1)"}),stroke:new ol.style.Stroke({width:7,color:"rgba(255,0,0, 0.8)"}),radius:5}),stroke:new ol.style.Stroke({width:5,color:"rgba(255,0,0,0.8)"})})]}),this.ovmap_.addLayer(this.extentLayer);this.ovmap_.addInteraction(new ol.interaction.Pointer({handleDownEvent:function(e){var i,n,r,a,s;return!1!==t.panAnimation?"elastic"==t.panAnimation||t.elasticPan?o.getMap().getView().animate({center:e.coordinate,easing:(i=2,n=.3,r=3*i*Math.PI/2,a=n>0?-1/n:-100,s=Math.cos(r)*Math.pow(2,a),function(t){return t=1-Math.cos(t*Math.PI/2),1-Math.cos(r*t)*Math.pow(2,a*t)+s*t}),duration:1e3}):o.getMap().getView().animate({center:e.coordinate,duration:300}):o.getMap().getView().setCenter(e.coordinate),!1}}))},ol.ext.inherits(ol.control.Overview,ol.control.Control),ol.control.Overview.prototype.getOverviewMap=function(){return this.ovmap_},ol.control.Overview.prototype.toggleMap=function(){this.element.classList.toggle("ol-collapsed"),this.ovmap_.updateSize(),this.setView()},ol.control.Overview.prototype.setPosition=function(t){/top/.test(t)?this.element.classList.add("ol-control-top"):this.element.classList.remove("ol-control-top"),/right/.test(t)?this.element.classList.add("ol-control-right"):this.element.classList.remove("ol-control-right")},ol.control.Overview.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener=t.getView().on("propertychange",this.setView.bind(this)),this.setView())},ol.control.Overview.prototype.calcExtent_=function(t){var e=this.getMap();if(e){var o=this.extentLayer.getSource();o.clear();var i=new ol.Feature,n=e.getSize(),r=e.getView().getResolution(),a=e.getView().getRotation(),s=e.getView().getCenter();if(r){var l=r*n[0]/2,c=r*n[1]/2,h=this.oview_.getResolution();if(l/h>5||c/h>5){var u,p,d,f=Math.cos(a),g=Math.sin(a);for(t=[[-l,-c],[-l,c],[l,c],[l,-c]],u=0;u<4;++u)p=t[u][0],d=t[u][1],t[u][0]=s[0]+p*f-d*g,t[u][1]=s[1]+p*g+d*f;i.setGeometry(new ol.geom.Polygon([t]))}else i.setGeometry(new ol.geom.Point(s));o.addFeature(i)}}},ol.control.Overview.prototype.setView=function(t){if(!t)return this.setView({key:"rotation"}),this.setView({key:"resolution"}),void this.setView({key:"center"});switch(t.key){case"rotation":this.rotation?this.oview_.setRotation(this.getMap().getView().getRotation()):this.oview_.getRotation()&&this.oview_.setRotation(0);break;case"center":var e=this.getMap().getView().calculateExtent(this.getMap().getSize()),o=this.oview_.calculateExtent(this.ovmap_.getSize());(e[0]<o[0]||e[1]<o[1]||e[2]>o[2]||e[3]>o[3])&&this.oview_.setCenter(this.getMap().getView().getCenter());break;case"resolution":var i=2*Math.round(this.oview_.getZoomForResolution(this.getMap().getView().getResolution())/2)-4;i=Math.min(this.maxZoom,Math.max(this.minZoom,i)),this.oview_.setZoom(i)}this.calcExtent_()},ol.control.Permalink=function(t){var e=t||{},o=this,i=document.createElement("button");function n(){"function"==typeof e.onclick?e.onclick(o.getLink()):o.setUrlReplace(!o.replaceState_)}this.replaceState_=!1!==e.urlReplace,this.fixed_=e.fixed||6,this.hash_=e.anchor?"#":"?",this._localStorage=e.localStorage,this._localStorage||localStorage.removeItem("ol@parmalink"),i.addEventListener("click",n,!1),i.addEventListener("touchstart",n,!1);var r=document.createElement("div");r.className=(e.className||"ol-permalink")+" ol-unselectable ol-control",r.appendChild(i),(e.hidden||!1===e.visible)&&ol.ext.element.hide(r),ol.control.Control.call(this,{element:r,target:e.target}),this.set("geohash",e.geohash),this.on("change",this.viewChange_.bind(this)),this.search_={};var a=this.replaceState_?document.location.hash||document.location.search:"";if(!a&&this._localStorage&&(a=localStorage["ol@parmalink"]),a){a=a.replace(/(^#|^\?)/,"").split("&");for(var s=0;s<a.length;s++){var l=a[s].split("=");switch(l[0]){case"lon":case"lat":case"gh":case"z":case"r":case"l":break;default:this.search_[l[0]]=l[1]}}}this.setPosition()},ol.ext.inherits(ol.control.Permalink,ol.control.Control),ol.control.Permalink.prototype.setMap=function(t){this._listener&&(ol.Observable.unByKey(this._listener.change),ol.Observable.unByKey(this._listener.moveend)),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener={change:t.getLayerGroup().on("change",this.layerChange_.bind(this)),moveend:t.on("moveend",this.viewChange_.bind(this))},this.setPosition())},ol.control.Permalink.prototype.getLayerByLink=function(t,e){!e&&this.getMap()&&(e=this.getMap().getLayers().getArray());for(var o=0;o<e.length;o++){if(e[o].get("permalink")==t)return e[o];if(e[o].getLayers){var i=this.getLayerByLink(t,e[o].getLayers().getArray());if(i)return i}}return!1},ol.control.Permalink.prototype.setGeohash=function(t){this.set("geohash",t),this.setUrlParam()},ol.control.Permalink.prototype.setPosition=function(){var t=this.getMap();if(t){var e=this.replaceState_?document.location.hash||document.location.search:"";if(!e&&this._localStorage&&(e=localStorage["ol@parmalink"]),e){var o,i,n={};for(e=e.replace(/(^#|^\?)/,"").split("&"),o=0;o<e.length;o++)n[(i=e[o].split("="))[0]]=i[1];if(n.gh){var r=n.gh.split("-"),a=ol.geohash.toLonLat(r[0]);n.lon=a[0],n.lat=a[1],n.z=r[1]}var s=ol.proj.transform([Number(n.lon),Number(n.lat)],"EPSG:4326",t.getView().getProjection());if(s[0]&&s[1]&&t.getView().setCenter(s),n.z&&t.getView().setZoom(Number(n.z)),n.r&&t.getView().setRotation(Number(n.r)),n.l){!function e(o){o||(o=t.getLayers().getArray());for(var i=0;i<o.length;i++)o[i].get("permalink")&&o[i].setVisible(!1),o[i].getLayers&&e(o[i].getLayers().getArray())}();var l=n.l.split("|");for(o=0;o<l.length;o++){i=l[o].split(":");var c=this.getLayerByLink(i[0]),h=Number(i[1]);c&&(c.setOpacity(h),c.setVisible(!0))}}}}},ol.control.Permalink.prototype.getUrlParams=function(){return this.search_},ol.control.Permalink.prototype.setUrlParam=function(t,e){t&&(void 0===e||""===e?delete this.search_[encodeURIComponent(t)]:this.search_[encodeURIComponent(t)]=encodeURIComponent(e)),this.viewChange_()},ol.control.Permalink.prototype.getUrlParam=function(t){return decodeURIComponent(this.search_[encodeURIComponent(t)]||"")},ol.control.Permalink.prototype.hasUrlParam=function(t){return this.search_.hasOwnProperty(encodeURIComponent(t))},ol.control.Permalink.prototype.getLink=function(t){var e=this.getMap(),o=ol.proj.transform(e.getView().getCenter(),e.getView().getProjection(),"EPSG:4326"),i=Math.round(10*e.getView().getZoom())/10,n=e.getView().getRotation(),r=this.layerStr_,a=(n?"&r="+Math.round(1e4*n)/1e4:"")+(r?"&l="+r:"");this.get("geohash")?a="gh="+ol.geohash.fromLonLat(o,8)+"-"+i+a:a="lon="+o[0].toFixed(this.fixed_)+"&lat="+o[1].toFixed(this.fixed_)+"&z="+i+a;for(var s in this.search_)a+="&"+s+"="+this.search_[s];return t?a:document.location.protocol+"//"+document.location.host+document.location.pathname+this.hash_+a},ol.control.Permalink.prototype.setUrlReplace=function(t){try{if(this.replaceState_=t,t)window.history.replaceState(null,null,this.getLink());else{var e="";for(var o in this.search_)e+=(""==e?"?":"&")+o+"="+this.search_[o];window.history.replaceState(null,null,document.location.origin+document.location.pathname+e)}}catch(t){}},ol.control.Permalink.prototype.viewChange_=function(){try{this.replaceState_&&window.history.replaceState(null,null,this.getLink())}catch(t){}this._localStorage&&(localStorage["ol@parmalink"]=this.getLink(!0))},ol.control.Permalink.prototype.layerChange_=function(){this._tout?(clearTimeout(this._tout),this._tout=null):this._tout=setTimeout(function(){this._tout=null;var t="";!function e(o){for(var i=0;i<o.length;i++)o[i].getVisible()&&o[i].get("permalink")&&(t&&(t+="|"),t+=o[i].get("permalink")+":"+o[i].get("opacity")),o[i].getLayers&&e(o[i].getLayers().getArray())}(this.getMap().getLayers().getArray()),this.layerStr_=t,this.viewChange_()}.bind(this),200)},ol.control.Print=function(t){t||(t={});var e=ol.ext.element.create("DIV",{className:t.className||"ol-print"});t.target||(e.classList.add("ol-unselectable","ol-control"),ol.ext.element.create("BUTTON",{type:"button",click:function(){this.print()}.bind(this),parent:e})),ol.control.Control.call(this,{element:e,target:t.target}),this.set("immediate",t.immediate),this.set("imageType",t.imageType||"image/jpeg"),this.set("quality",t.quality||.8),this.set("orientation",t.orientation)},ol.ext.inherits(ol.control.Print,ol.control.Control),ol.control.Print.prototype.toClipboard=function(t,e){try{t.canvas.toBlob((function(t){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},t.type,{value:t,enumerable:!0}))]),"function"==typeof e&&e(!0)}catch(t){"function"==typeof e&&e(!1)}}))}catch(t){"function"==typeof e&&e(!1)}},ol.control.Print.prototype.copyMap=function(t,e){this.once("print",function(t){this.toClipboard(t,e)}.bind(this)),this.print(t)},ol.control.Print.prototype.print=function(t){var e=(t=t||{}).imageType||this.get("imageType"),o=t.quality||this.get("quality");if(this.getMap()){if("silent"!==t.immediate&&this.dispatchEvent(Object.assign({type:"printing"},t)),!t.immediate)return void setTimeout(function(){(t=Object.assign({},t)).immediate="silent",this.print(t)}.bind(this),200);this.getMap().once(this.get("immediate")?"postcompose":"rendercomplete",function(i){var n,r;i.context?n=i.context.canvas:this.getMap().getViewport().querySelectorAll(".ol-layer canvas, canvas.ol-fixedoverlay").forEach(function(t){if(t.width){if(!n){n=document.createElement("canvas");var o=this.getMap().getSize();n.width=o[0],n.height=o[1],r=n.getContext("2d"),/jp.*g$/.test(e)&&(r.fillStyle=this.get("bgColor")||"white",r.fillRect(0,0,n.width,n.height))}if(r.save(),"0"===t.parentNode.style.opacity)return;r.globalAlpha=parseFloat(t.parentNode.style.opacity)||1;var i=ol.ext.element.getStyle(t,"transform")||ol.ext.element.getStyle(t,"-webkit-transform");/^matrix/.test(i)?((i=i.replace(/^matrix\(|\)$/g,"").split(",")).forEach((function(t,e){i[e]=parseFloat(t)})),r.transform(i[0],i[1],i[2],i[3],i[4],i[5]),r.drawImage(t,0,0)):r.drawImage(t,0,0,ol.ext.element.getStyle(t,"width"),ol.ext.element.getStyle(t,"height")),r.restore()}}.bind(this));var a,s,l,c,h=[210,297],u=t.orient||this.get("orientation"),p=t.margin||10;if(n){"landscape"!==u&&"portrait"!==u&&(u=n.width>n.height?"landscape":"portrait"),"landscape"===u&&(h=[h[1],h[0]]);var d=Math.min((h[0]-2*p)/n.width,(h[1]-2*p)/n.height);a=d*n.width,s=d*n.height,l=[(h[0]-a)/2,(h[1]-s)/2]}try{c=n?n.toDataURL(e,o):null}catch(f){return void this.dispatchEvent({type:"error",canvas:n})}var f=Object.assign({type:"print",print:{format:"a4",orientation:u,unit:"mm",size:h,position:l,imageWidth:a,imageHeight:s},image:c,imageType:e,canvas:n},t);this.dispatchEvent(f)}.bind(this)),this.getMap().render()}},ol.control.Profil=function(t){t=t||{},this.info=t.info||ol.control.Profil.prototype.info;var e,o=this;if(t.target)(e=document.createElement("div")).classList.add(t.className||"ol-profil");else{(e=document.createElement("div")).className=((t.className||"ol-profil")+" ol-unselectable ol-control ol-collapsed").trim(),this.button=document.createElement("button"),this.button.setAttribute("type","button");var i=function(t){o.toggle(),t.preventDefault()};this.button.addEventListener("click",i),this.button.addEventListener("touchstart",i),e.appendChild(this.button)}t.style instanceof ol.style.Style?this._style=t.style:this._style=new ol.style.Style({text:new ol.style.Text,stroke:new ol.style.Stroke({width:1.5,color:"#369"})}),this._style.getText()||this._style.setText(new ol.style.Text),t.selectStyle instanceof ol.style.Style?this._selectStyle=t.selectStyle:this._selectStyle=new ol.style.Style({fill:new ol.style.Fill({color:"#369"})});var n=document.createElement("div");n.classList.add("ol-inner"),e.appendChild(n);var r=document.createElement("div");r.style.position="relative",n.appendChild(r);var a=this.ratio=2;this.canvas_=document.createElement("canvas"),this.canvas_.width=(t.width||300)*a,this.canvas_.height=(t.height||150)*a;var s={msTransform:"scale(0.5,0.5)",msTransformOrigin:"0 0",webkitTransform:"scale(0.5,0.5)",webkitTransformOrigin:"0 0",mozTransform:"scale(0.5,0.5)",mozTransformOrigin:"0 0",transform:"scale(0.5,0.5)",transformOrigin:"0 0"};Object.keys(s).forEach((function(t){t in o.canvas_.style&&(o.canvas_.style[t]=s[t])}));var l=document.createElement("div");r.appendChild(l),l.style.width=this.canvas_.width/a+"px",l.style.height=this.canvas_.height/a+"px",l.appendChild(this.canvas_),l.addEventListener("pointerdown",this.onMove.bind(this)),document.addEventListener("pointerup",this.onMove.bind(this)),l.addEventListener("mousemove",this.onMove.bind(this)),l.addEventListener("touchmove",this.onMove.bind(this)),ol.control.Control.call(this,{element:e,target:t.target}),this.set("selectable",t.selectable),this.margin_={top:10*a,left:40*a,bottom:30*a,right:10*a},this.info.ytitle||(this.margin_.left-=20*a),this.info.xtitle||(this.margin_.bottom-=20*a),this.bar_=document.createElement("div"),this.bar_.classList.add("ol-profilbar"),this.bar_.style.top=this.margin_.top/a+"px",this.bar_.style.height=(this.canvas_.height-this.margin_.top-this.margin_.bottom)/a+"px",r.appendChild(this.bar_),this.cursor_=document.createElement("div"),this.cursor_.classList.add("ol-profilcursor"),r.appendChild(this.cursor_),this.popup_=document.createElement("div"),this.popup_.classList.add("ol-profilpopup"),this.cursor_.appendChild(this.popup_);var c=document.createElement("table");c.cellPadding="0",c.cellSpacing="0",c.style.clientWidth=this.canvas_.width/a+"px",r.appendChild(c);var h=document.createElement("tr");h.classList.add("track-info"),c.appendChild(h);var u=document.createElement("td");u.innerHTML=(this.info.zmin||"Zmin")+': <span class="zmin">',h.appendChild(u);var p=document.createElement("td");p.innerHTML=(this.info.zmax||"Zmax")+': <span class="zmax">',h.appendChild(p);var d=document.createElement("td");d.innerHTML=(this.info.distance||"Distance")+': <span class="dist">',h.appendChild(d);var f=document.createElement("td");f.innerHTML=(this.info.time||"Time")+': <span class="time">',h.appendChild(f);var g=document.createElement("tr");g.classList.add("point-info"),c.appendChild(g);var m=document.createElement("td");m.innerHTML=(this.info.altitude||"Altitude")+': <span class="z">',g.appendChild(m);var y=document.createElement("td");y.innerHTML=(this.info.distance||"Distance")+': <span class="dist">',g.appendChild(y);var v,b,_=document.createElement("td");(_.innerHTML=(this.info.time||"Time")+': <span class="time">',g.appendChild(_),this.tab_=[],t.feature&&this.setGeometry(t.feature),t.zoomable)&&(this.set("selectable",!0),this.on("change:geometry",(function(){b=null})),this.on("dragstart",(function(t){v=t.index})),this.on("dragend",function(t){if(Math.abs(v-t.index)>10){if(!b)var o=ol.ext.element.create("BUTTON",{parent:e,className:"ol-zoom-out",click:function(t){t.stopPropagation(),t.preventDefault(),b&&(this.dispatchEvent({type:"zoom"}),this.setGeometry(b,this._geometry[1])),e.removeChild(o)}.bind(this)});var i=b||this._geometry[0],n=new ol.geom.LineString(this.getSelection(v,t.index));this.setGeometry(n,this._geometry[1]),b=i,this.dispatchEvent({type:"zoom",geometry:n,start:v,end:t.index})}}.bind(this)))},ol.ext.inherits(ol.control.Profil,ol.control.Control),ol.control.Profil.prototype.info={zmin:"Zmin",zmax:"Zmax",ytitle:"Altitude (m)",xtitle:"Distance (km)",time:"Time",altitude:"Altitude",distance:"Distance",altitudeUnits:"m",distanceUnitsM:"m",distanceUnitsKM:"km"},ol.control.Profil.prototype.popup=function(t){this.popup_.innerHTML=t},ol.control.Profil.prototype._drawAt=function(t,e){t?(this.cursor_.style.left=e+"px",this.cursor_.style.top=(this.canvas_.height-this.margin_.bottom+t[1]*this.scale_[1]+this.dy_)/this.ratio+"px",this.cursor_.style.display="block",this.bar_.parentElement.classList.add("over"),this.bar_.style.left=e+"px",this.bar_.style.display="block",this.element.querySelector(".point-info .z").textContent=t[1]+this.info.altitudeUnits,this.element.querySelector(".point-info .dist").textContent=(t[0]/1e3).toFixed(1)+this.info.distanceUnitsKM,this.element.querySelector(".point-info .time").textContent=t[2],e>this.canvas_.width/this.ratio/2?this.popup_.classList.add("ol-left"):this.popup_.classList.remove("ol-left")):(this.cursor_.style.display="none",this.bar_.style.display="none",this.cursor_.style.display="none",this.bar_.parentElement.classList.remove("over"))},ol.control.Profil.prototype.showAt=function(t){var e,o,i,n=1/0;if(void 0===t)this.bar_.parentElement.classList.contains("over")&&this._drawAt();else if(t.length)for(e=1;o=this.tab_[e];e++){var r=ol.coordinate.dist2d(o[3],t);r<n&&(i=o,n=r)}else for(e=0;(o=this.tab_[e])&&(i=o,!(o[0]>=t));e++);if(i){var a=(i[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(i,a),i[3]}return null},ol.control.Profil.prototype.showAtTime=function(t,e){var o,i,n;if(t instanceof Date?t=t.getTime()/1e3:e&&(t+=this.tab_[0][3][3]),void 0===t)this.bar_.parentElement.classList.contains("over")&&this._drawAt();else for(o=0;(i=this.tab_[o])&&(n=i,!(i[3][3]>=t));o++);if(n){var r=(n[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(n,r),n[3]}return null},ol.control.Profil.prototype.pointAtTime=function(t){var e,o;for(e=1;o=this.tab_[e];e++){var i=o[3][3];if(i>=t){var n=this.tab_[e-1][3];return(n[3]+i)/2<t?n:o}}return this.tab_[this.tab_.length-1][3]},ol.control.Profil.prototype.onMove=function(t){if(this.tab_.length){var e=this.canvas_.getBoundingClientRect(),o=e.top+window.pageYOffset-document.documentElement.clientTop,i=e.left+window.pageXOffset-document.documentElement.clientLeft,n=t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageX,r=t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageY,a=n-i,s=r-o,l=this.ratio;if(a>this.margin_.left/l&&a<(this.canvas_.width-this.margin_.right)/l&&s>this.margin_.top/l&&s<(this.canvas_.height-this.margin_.bottom)/l){var c,h,u=(a*l-this.margin_.left)/this.scale_[0],p=this.tab_[0];for(c=1;h=this.tab_[c];c++)if(h[0]>=u){u<(h[0]+p[0])/2&&(c=0,h=p);break}switch(this._drawAt(h,a),this.dispatchEvent({type:"over",click:"click"===t.type,index:c,coord:h[3],time:h[2],distance:h[0]}),t.type){case"pointerdown":this._dragging={event:{type:"dragstart",index:c,coord:h[3],time:h[2],distance:h[0]},pageX:n,pageY:r};break;case"pointerup":this._dragging&&this._dragging.pageX?Math.abs(this._dragging.pageX-n)<3&&Math.abs(this._dragging.pageY-r)<3&&(this.dispatchEvent({type:"click",index:c,coord:h[3],time:h[2],distance:h[0]}),this.refresh()):this.dispatchEvent({type:"dragend",index:c,coord:h[3],time:h[2],distance:h[0]}),this._dragging=!1;break;default:if(this._dragging)if(this._dragging.pageX)(Math.abs(this._dragging.pageX-n)>3||Math.abs(this._dragging.pageY-r)>3)&&(this._dragging.pageX=this._dragging.pageY=!1,this.dispatchEvent(this._dragging.event));else{this.dispatchEvent({type:"dragging",index:c,coord:h[3],time:h[2],distance:h[0]});var d=Math.min(this._dragging.event.index,c),f=Math.max(this._dragging.event.index,c);this.refresh(),this.get("selectable")&&this._drawGraph(this.tab_.slice(d,f),this._selectStyle)}}}else this.bar_.parentElement.classList.contains("over")&&(this._drawAt(),this.dispatchEvent({type:"out"})),"pointerup"===t.type&&this._dragging&&(this.dispatchEvent({type:"dragcancel"}),this._dragging=!1)}},ol.control.Profil.prototype.show=function(){this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"show",show:!0})},ol.control.Profil.prototype.hide=function(){this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"show",show:!1})},ol.control.Profil.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed");var t=this.element.classList.contains("ol-collapsed");this.dispatchEvent({type:"show",show:!t})},ol.control.Profil.prototype.isShown=function(){return!this.element.classList.contains("ol-collapsed")},ol.control.Profil.prototype.getSelection=function(t,e){for(var o=[],i=Math.max(Math.min(t,e),0),n=Math.min(Math.max(t,e),this.tab_.length-1),r=i;r<=n;r++)o.push(this.tab_[r][3]);return o},ol.control.Profil.prototype._drawGraph=function(t,e){if(t.length){var o,i,n=this.canvas_.getContext("2d"),r=this.scale_[0],a=this.scale_[1],s=this.dy_,l=this.ratio;for(n.beginPath(),o=0;i=t[o];o++)0==o?n.moveTo(i[0]*r,i[1]*a+s):n.lineTo(i[0]*r,i[1]*a+s);e.getStroke()&&(n.strokeStyle=e.getStroke().getColor()||"#000",n.lineWidth=e.getStroke().getWidth()*l,n.setLineDash([]),n.stroke()),e.getFill()&&(n.fillStyle=e.getFill().getColor()||"#000",n.Style=e.getFill().getColor()||"#000",n.lineTo(t[t.length-1][0]*r,0),n.lineTo(t[0][0]*r,0),n.fill())}},ol.control.Profil.prototype.setGeometry=function(t,e){if(e||(e={}),t instanceof ol.Feature&&(t=t.getGeometry()),this._geometry=[t,e],/Z/.test(t.getLayout())){/M/.test(t.getLayout())?this.element.querySelector(".time").parentElement.style.display="block":this.element.querySelector(".time").parentElement.style.display="none";var o=t.getCoordinates();switch(t.getType()){case"LineString":break;case"MultiLineString":o=o[0];break;default:return}var i,n,r,a,s,l,c,h=e.projection||this.getMap().getView().getProjection(),u=1/0,p=-1/0,d=this.tab_=[];for(i=0;n=o[i];i++)(a=n[2])<u&&(u=a),a>p&&(p=a),0==i?r=0:r+=(l=o[i-1],c=n,ol.sphere.getDistance(ol.proj.transform(l,h,"EPSG:4326"),ol.proj.transform(c,h,"EPSG:4326"))),s=f(o[0][3],n[3]),d.push([r,a,s,n]);this._z=[u,p],this.set("graduation",e.graduation||100),this.set("zmin",e.zmin),this.set("zmax",e.zmax),this.set("amplitude",e.amplitude),this.set("unit",e.unit),this.set("zunit",e.zunit),this.dispatchEvent({type:"change:geometry",geometry:t}),this.refresh()}function f(t,e){if(!t||!e)return"-";var o=(e-t)/60,i=Math.trunc(o/60),n=Math.trunc(o-60*i);return i+"h"+(n<10?"0":"")+n+"mn"}},ol.control.Profil.prototype.refresh=function(){var t=this.canvas_,e=t.getContext("2d"),o=t.width,i=t.height;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,o,i);var n,r=this._z[0],a=this._z[1],s=this.tab_,l=s[s.length-1][0],c=s[s.length-1][2];if(l){e.setTransform(1,0,0,1,this.margin_.left,i-this.margin_.bottom);var h=this.ratio;o-=this.margin_.right+this.margin_.left,i-=this.margin_.top+this.margin_.bottom,e.strokeStyle=this._style.getText().getFill().getColor()||"#000",e.lineWidth=.5*h,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-i),e.moveTo(0,0),e.lineTo(o,0),e.stroke(),this.element.querySelector(".track-info .zmin").textContent=r.toFixed(2)+this.info.altitudeUnits,this.element.querySelector(".track-info .zmax").textContent=a.toFixed(2)+this.info.altitudeUnits,this.element.querySelector(".track-info .dist").textContent=l>1e3?(l/1e3).toFixed(1)+this.info.distanceUnitsKM:l.toFixed(1)+this.info.distanceUnitsM,this.element.querySelector(".track-info .time").textContent=c;for(var u=this.get("graduation");;){if(!(i/(((a=Math.ceil(a/u)*u)-(r=Math.floor(r/u)*u))/u)<15*h))break;u*=2}"number"==typeof this.get("zmin")&&r>this.get("zmin")&&(r=this.get("zmin")),"number"==typeof this.get("zmax")&&a<this.get("zmax")&&(a=this.get("zmax"));var p=this.get("amplitude");p&&(a=Math.max(r+p,a));var d=o/l,f=-i/(a-r),g=this.dy_=-r*f;for(this.scale_=[d,f],this._drawGraph(s,this._style),e.font=10*h+"px arial",e.textAlign="right",e.textBaseline="middle",e.fillStyle=this._style.getText().getFill().getColor()||"#000",e.beginPath(),n=r;n<=a;n+=u)"km"!=this.get("zunit")?e.fillText(n,-4*h,n*f+g):e.fillText((n/1e3).toFixed(1),-4*h,n*f+g),e.moveTo(-2*h,n*f+g),0!=n?e.lineTo(l*d,n*f+g):e.lineTo(0,n*f+g);e.textAlign="center",e.textBaseline="top",e.setLineDash([h,3*h]);var m,y=this.get("unit")||"km";for(l>1e3?(m=100*Math.round(l/1e3))>1e3&&(m=1e3*Math.ceil(m/1e3)):(y="m",m=l>100?10*Math.round(l/100):l>10?Math.round(l/10):l>1?Math.round(l)/10:l),n=0;n<=l;n+=m){var v="m"==y?n:n/1e3;e.fillText(Math.round(10*v)/10,n*d,4*h),e.moveTo(n*d,2*h),e.lineTo(n*d,0)}e.font=12*h+"px arial",e.fillText(this.info.xtitle.replace("(km)","("+y+")"),o/2,18*h),e.save(),e.rotate(-Math.PI/2),e.fillText(this.info.ytitle,i/2,-this.margin_.left),e.restore(),e.stroke()}else console.error("[ol/control/Profil] no data...",s)},ol.control.Profil.prototype.getImage=function(t,e){return"canvas"===t?this.canvas_:this.canvas_.toDataURL(t,e)},ol.control.RoutingGeoportail=function(t){var e=this;t||(t={}),null==t.typing&&(t.typing=300),this._classname=t.className||"search",this._source=new ol.source.Vector,this._auth=t.authentication;var o=document.createElement("DIV"),i=(t.className||"")+" ol-routing";(t.target||(i+=" ol-unselectable ol-control"),o.setAttribute("class",i),t.target)||ol.ext.element.create("BUTTON",{parent:o}).addEventListener("click",(function(){o.classList.toggle("ol-collapsed")}));ol.control.Control.call(this,{element:o,target:t.target}),this.set("url","https://wxs.ign.fr/"+t.apiKey+"/itineraire/rest/route.json");var n=ol.ext.element.create("DIV",{className:"content",parent:o}),r=ol.ext.element.create("DIV",{className:"search-input",parent:n});this._search=[],this.addSearch(r,t),this.addSearch(r,t),ol.ext.element.create("I",{className:"ol-car",title:t.carlabel||"by car",parent:n}).addEventListener("click",(function(){e.setMode("car")})),ol.ext.element.create("I",{className:"ol-pedestrian",title:t.pedlabel||"pedestrian",parent:n}).addEventListener("click",(function(){e.setMode("pedestrian")})),ol.ext.element.create("I",{className:"ol-ok",title:t.runlabel||"search",html:"OK",parent:n}).addEventListener("click",(function(){e.calculate()})),ol.ext.element.create("I",{className:"ol-cancel",html:"cancel",parent:n}).addEventListener("click",function(){this.resultElement.innerHTML=""}.bind(this)),this.resultElement=document.createElement("DIV"),this.resultElement.setAttribute("class","ol-result"),o.appendChild(this.resultElement),this.setMode(t.mode||"car"),this.set("timeout",t.timeout||1e4)},ol.ext.inherits(ol.control.RoutingGeoportail,ol.control.Control),ol.control.RoutingGeoportail.prototype.setMode=function(t,e){this.set("mode",t),this.element.querySelector(".ol-car").classList.remove("selected"),this.element.querySelector(".ol-pedestrian").classList.remove("selected"),this.element.querySelector(".ol-"+t).classList.add("selected"),e||this.calculate()},ol.control.RoutingGeoportail.prototype.setMethod=function(t,e){this.set("method",t),e||this.calculate()},ol.control.RoutingGeoportail.prototype.addButton=function(t,e,o){var i=document.createElement("I");return i.setAttribute("class",t),i.setAttribute("type","button"),i.setAttribute("title",e),i.innerHTML=o||"",this.element.appendChild(i),i},ol.control.RoutingGeoportail.prototype.getSource=function(){return this._source},ol.control.RoutingGeoportail.prototype._resetArray=function(t){this._search=[];var e=t.parentNode.querySelectorAll(".search-input > div");e.forEach(function(t){t.olsearch&&(t.olsearch.get("feature")&&(t.olsearch.get("feature").set("step",this._search.length),0===this._search.length?t.olsearch.get("feature").set("pos","start"):this._search.length===e.length-1?t.olsearch.get("feature").set("pos","end"):t.olsearch.get("feature").set("pos","")),this._search.push(t.olsearch))}.bind(this))},ol.control.RoutingGeoportail.prototype.removeSearch=function(t,e,o){t.removeChild(o),o.olsearch.get("feature")&&this._source.removeFeature(o.olsearch.get("feature")),this.getMap()&&this.getMap().removeControl(o.olsearch),this._resetArray(t)},ol.control.RoutingGeoportail.prototype.addSearch=function(t,e,o){var i=this,n=ol.ext.element.create("DIV");o?t.insertBefore(n,o.nextSibling):t.appendChild(n),ol.ext.element.create("BUTTON",{title:e.startlabel||"add/remove",parent:n}).addEventListener("click",function(o){o.ctrlKey?this._search.length>2&&this.removeSearch(t,e,n):o.shiftKey&&this.addSearch(t,e,n)}.bind(this));var r=n.olsearch=new ol.control.SearchGeoportail({className:"IGNF ol-collapsed",apiKey:e.apiKey,authentication:e.authentication,target:n,reverse:!0});r._changeCounter=0,this._resetArray(t),r.on("select",function(t){r.setInput(t.search.fulltext);var e=r.get("feature");e?(r.checkgeom=!1,t.silent||e.getGeometry().setCoordinates(t.coordinate),r.checkgeom=!0):(e=new ol.Feature(new ol.geom.Point(t.coordinate)),r.set("feature",e),this._source.addFeature(e),r.checkgeom=!0,e.getGeometry().on("change",function(){r.checkgeom&&this.onGeometryChange(r,e)}.bind(this))),e.set("name",r.getTitle(t.search)),e.set("step",this._search.indexOf(r)),0===e.get("step")?e.set("pos","start"):e.get("step")===this._search.length-1&&e.set("pos","end"),r.set("selection",t.search)}.bind(this)),r.element.querySelector("input").addEventListener("change",(function(){r.set("selection",null),i.resultElement.innerHTML=""})),this.getMap()&&this.getMap().addControl(r)},ol.control.RoutingGeoportail.prototype.onGeometryChange=function(t,e,o){var i=ol.proj.transform(e.getGeometry().getCoordinates(),this.getMap().getView().getProjection(),"EPSG:4326");if(t._handleSelect({x:i[0],y:i[1],fulltext:i[0].toFixed(6)+","+i[1].toFixed(6)},!0,{silent:!0}),o){if(t._changeCounter--,!t._changeCounter)return void t.reverseGeocode(e.getGeometry().getCoordinates(),{silent:!0})}else t._changeCounter++,setTimeout(function(){this.onGeometryChange(t,e,!0)}.bind(this),1e3)},ol.control.RoutingGeoportail.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t);for(var e=0;e<this._search.length;e++){this._search[e].setMap(t)}},ol.control.RoutingGeoportail.prototype.requestData=function(t){for(var e=t[0],o=t[t.length-1],i="",n=1;n<t.length-1;n++)i+=(i?";":"")+t[n].x+","+t[n].y;return{"gp-access-lib":"1.1.0",origin:e.x+","+e.y,destination:o.x+","+o.y,method:this.get("method")||"time",graphName:"pedestrian"===this.get("mode")?"Pieton":"Voiture",waypoints:i,format:"STANDARDEXT"}},ol.control.RoutingGeoportail.prototype.getTimeString=function(t){return(t/=60)<1?"":t<60?t.toFixed(0)+" min":(t/60).toFixed(0)+" h "+(t%60).toFixed(0)+" min"},ol.control.RoutingGeoportail.prototype.getDistanceString=function(t){return t<1e3?t.toFixed(0)+" m":(t/1e3).toFixed(2)+" km"},ol.control.RoutingGeoportail.prototype.listRouting=function(t){this.resultElement.innerHTML="";var e=this.getTimeString(t.duration);e+=" ("+this.getDistanceString(t.distance)+")";var o=document.createElement("i");o.textContent=e,this.resultElement.appendChild(o);var i=document.createElement("ul");this.resultElement.appendChild(i);for(var n,r={none:"Prendre sur ",R:"Tourner à droite sur ",FR:"Tourner légèrement à droite sur ",L:"Tourner à gauche sur ",FL:"Tourner légèrement à gauche sur ",F:"Continuer tout droit sur "},a=0;n=t.features[a];a++){var s=this.getDistanceString(n.get("distance"));e=this.getTimeString(n.get("durationT"));var l=document.createElement("li");l.classList.add(n.get("instruction")),l.innerHTML=(r[n.get("instruction")||"none"]||"#")+" "+n.get("name")+"<i>"+s+(e?" - "+e:"")+"</i>",i.appendChild(l)}},ol.control.RoutingGeoportail.prototype.handleResponse=function(t,e,o){if("ERROR"!==t.status){for(var i,n,r={type:"routing",features:[]},a=0,s=0,l=[],c=0;n=t.legs[c];c++)for(var h,u=0;h=n.steps[u];u++){for(var p,d=[],f=0;p=h.points[f];f++)p=p.split(","),d.push([parseFloat(p[0]),parseFloat(p[1])]),0!==c&&0===f||l.push(d[f]);var g={geometry:(d=new ol.geom.LineString(d)).transform("EPSG:4326",this.getMap().getView().getProjection()),name:h.name,instruction:h.navInstruction,distance:parseFloat(h.distanceMeters),duration:parseFloat(h.durationSeconds)};a+=g.distance,s+=g.duration,g.distanceT=a,g.durationT=s,i=new ol.Feature(g),r.features.push(i)}return r.distance=parseFloat(t.distanceMeters),r.duration=parseFloat(t.durationSeconds),l=new ol.geom.LineString(l),r.feature=new ol.Feature({geometry:l.transform("EPSG:4326",this.getMap().getView().getProjection()),start:this._search[0].getTitle(e),end:this._search[0].getTitle(o),distance:r.distance,duration:r.duration}),this.dispatchEvent(r),this.path=r,console.log(r),r}this.dispatchEvent({type:"errror",status:"200",statusText:t.message})},ol.control.RoutingGeoportail.prototype.calculate=function(t){if(this.resultElement.innerHTML="",t){var e=[];t.forEach((function(t){e.push({x:t[0],y:t[1]})})),t=e}else{t=[];for(var o=0;o<this._search.length;o++)this._search[o].get("selection")&&t.push(this._search[o].get("selection"))}if(t.length<2)return!1;var i=t[0],n=t[t.length-1],r=this.requestData(t),a=encodeURI(this.get("url")),s="";for(var l in r)s+=s?"&":"?",r.hasOwnProperty(l)&&(s+=l+"="+r[l]);var c=this;return this.ajax(a+s,function(t){t.status>=200&&t.status<400?c.listRouting(c.handleResponse(JSON.parse(t.response),i,n)):this.dispatchEvent({type:"error",status:t.status,statusText:t.statusText})}.bind(this),function(t){console.log("ERROR",t),this.dispatchEvent({type:"error",status:t.status,statusText:t.statusText})}.bind(this)),!0},ol.control.RoutingGeoportail.prototype.ajax=function(t,e,o){var i=this;this._request&&this._request.abort();var n=this._request=new XMLHttpRequest;n.open("GET",t,!0),n.timeout=this.get("timeout")||1e4,this._auth&&n.setRequestHeader("Authorization","Basic "+this._auth),this.element.classList.add("ol-searching"),n.onload=function(){i._request=null,i.element.classList.remove("ol-searching"),e.call(i,this)},n.ontimeout=function(){i._request=null,i.element.classList.remove("ol-searching"),o&&o.call(i,this)},n.onerror=function(){i._request=null,i.element.classList.remove("ol-searching"),o&&o.call(i,this)},n.send()},ol.control.RoutingDSR=function(t){ol.control.RoutingGeoportail.call(this,t),this.set("url","https://api-dscr.ign.fr/api/v1/route")},ol.ext.inherits(ol.control.RoutingDSR,ol.control.RoutingGeoportail),ol.control.RoutingDSR.prototype.handleResponse=function(t){if("ERROR"!==t.status){var e=(new ol.format.GeoJSON).readFeature(t.features[0],{featureProjection:this.getMap().getView().getProjection()});return console.log(t,e),this.dispatchEvent({type:"routing",feature:e}),this.path=e,e}this.dispatchEvent({type:"errror",status:"200",statusText:t.message})},ol.control.RoutingDSR.prototype.listRouting=function(t){this.resultElement.innerHTML="",ol.ext.element.create("I",{html:t.get("distance")+" ("+t.get("duration")+")",parent:this.resultElement});var e=document.createElement("ul");this.resultElement.appendChild(e),t.get("routes").forEach(function(t){var o=this.getDistanceString(t.longueur);ol.ext.element.create("LI",{html:t.numero+" "+t.nom_gestionnaire+" <i>"+o+"</i>",parent:e})}.bind(this))},ol.control.Scale=function(t){t||(t={}),null==t.typing&&(t.typing=300);var e=document.createElement("DIV"),o=(t.className||"")+" ol-scale";t.target||(o+=" ol-unselectable ol-control"),this._input=document.createElement("INPUT"),this._input.value="-",e.setAttribute("class",o),!1===t.editable&&(this._input.readOnly=!0),e.appendChild(this._input),ol.control.Control.call(this,{element:e,target:t.target}),this._input.addEventListener("change",this.setScale.bind(this)),this.set("ppi",t.ppi||96)},ol.ext.inherits(ol.control.Scale,ol.control.Control),ol.control.Scale.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),t&&(this._listener=t.on("moveend",this._showScale.bind(this)))},ol.control.Scale.prototype._showScale=function(){var t=this.getMap();if(t){var e=t.getView(),o=e.getProjection(),i=e.getCenter(),n=t.getPixelFromCoordinate(i);n[1]+=1;var r=t.getCoordinateFromPixel(n),a=ol.sphere.getDistance(ol.proj.transform(i,o,"EPSG:4326"),ol.proj.transform(r,o,"EPSG:4326"));a*=this.get("ppi")/.0254,this._input.value=this.formatScale(a)}},ol.control.Scale.prototype.formatScale=function(t){return"1 / "+(t=t>100?100*Math.round(t/100):Math.round(t)).toLocaleString()},ol.control.Scale.prototype.setScale=function(t){var e=this.getMap();if(e&&t){t.target&&(t=t.target.value);var o=t;"string"==typeof t&&((o=t.split("/")[1])||(o=t),o=o.replace(/[^\d]/g,""),o=parseInt(o));var i=e.getView(),n=i.getProjection(),r=i.getCenter(),a=e.getPixelFromCoordinate(r);a[1]+=1;var s=e.getCoordinateFromPixel(a),l=ol.sphere.getDistance(ol.proj.transform(r,n,"EPSG:4326"),ol.proj.transform(s,n,"EPSG:4326"));l*=this.get("ppi")/.0254,i.setResolution(i.getResolution()*o/l)}this._showScale()},ol.control.SearchBAN=function(t){(t=t||{}).typing=t.typing||500,t.url=t.url||"https://api-adresse.data.gouv.fr/search/",t.className=t.className||"BAN",t.copy='<a href="https://adresse.data.gouv.fr/" target="new">&copy; BAN-data.gouv.fr</a>',ol.control.SearchPhoton.call(this,t)},ol.ext.inherits(ol.control.SearchBAN,ol.control.SearchPhoton),ol.control.SearchBAN.prototype.getTitle=function(t){return t.properties.label},ol.control.SearchBAN.prototype.select=function(t){var e=t.geometry.coordinates;try{e=ol.proj.transform(t.geometry.coordinates,"EPSG:4326",this.getMap().getView().getProjection())}catch(t){}this.dispatchEvent({type:"select",search:t,coordinate:e})},ol.control.SearchDFCI=function(t){t||(t={}),t.className=t.className||"dfci",t.placeholder=t.placeholder||"Code DFCI",ol.control.Search.call(this,t)},ol.ext.inherits(ol.control.SearchDFCI,ol.control.Search),ol.control.SearchDFCI.prototype.autocomplete=function(t){if((t=(t=t.toUpperCase()).replace(/[^0-9,^A-H,^K-N]/g,"")).length<2)return this.setInput(t),[];var e,o=this.getMap().getView().getProjection(),i=[],n=ol.coordinate.fromDFCI(t,o),r=Math.floor(t.length/2)-1,a=ol.coordinate.toDFCI(n,r,o);if(a=a.replace(/[^0-9,^A-H,^K-N]/g,""),!/NaN/.test(a)&&a){if(console.log("ok",a),this.setInput(a+t.substring(a.length,t.length)),i.push({coordinate:ol.coordinate.fromDFCI(a,o),name:a}),5===t.length)for(n=ol.coordinate.fromDFCI(t+0,o),a=ol.coordinate.toDFCI(n,r+1,o).substring(0,5),e=0;e<10;e++)i.push({coordinate:ol.coordinate.fromDFCI(a+e,o),name:a+e});if(2===r)for(e=0;e<6;e++)i.push({coordinate:ol.coordinate.fromDFCI(a+"."+e,o),name:a+"."+e})}return i},ol.control.SearchFeature=function(t){t||(t={}),t.className=t.className||"feature",ol.control.Search.call(this,t),"function"==typeof t.getSearchString&&(this.getSearchString=t.getSearchString),this.set("property",t.property||"name"),this.source_=t.source},ol.ext.inherits(ol.control.SearchFeature,ol.control.Search),ol.control.SearchFeature.prototype.restoreHistory=function(){this.set("history",[])},ol.control.SearchFeature.prototype.saveHistory=function(){localStorage.removeItem("ol@search-"+this._classname)},ol.control.SearchFeature.prototype.getTitle=function(t){return t.get(this.get("property")||"name")},ol.control.SearchFeature.prototype.getSearchString=function(t){return this.getTitle(t)},ol.control.SearchFeature.prototype.getSource=function(){return this.source_},ol.control.SearchFeature.prototype.setSource=function(t){this.source_=t},ol.control.SearchFeature.prototype.autocomplete=function(t){var e=[];if(this.source_){t=t.replace(/^\*/,"");for(var o,i=new RegExp(t,"i"),n=this.source_.getFeatures(),r=this.get("maxItems"),a=0;o=n[a];a++){var s=this.getSearchString(o);if(void 0!==s&&i.test(s)&&(e.push(o),--r<=0))break}}return e},ol.control.SearchGPS=function(t){t||(t={}),t.className=(t.className||"")+" ol-searchgps",t.placeholder=t.placeholder||"lon,lat",ol.control.Search.call(this,t),this.geolocation=new ol.Geolocation({projection:"EPSG:4326",trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}}),ol.ext.element.create("BUTTON",{className:"ol-geoloc",title:"Locate with GPS",parent:this.element,click:function(){this.geolocation.setTracking(!0)}.bind(this)});var e=ol.ext.element.create("LABEL",{className:"ol-switch",parent:this.element});ol.ext.element.create("TEXT",{html:"decimal",parent:e}),ol.ext.element.create("INPUT",{type:"checkbox",parent:e,on:{change:function(t){t.target.checked?this.element.classList.add("ol-dms"):this.element.classList.remove("ol-dms")}.bind(this)}}),ol.ext.element.create("SPAN",{parent:e}),ol.ext.element.create("TEXT",{html:"DMS",parent:e}),this._createForm();var o=this.element.querySelector("ul.autocomplete");this.element.appendChild(o)},ol.ext.inherits(ol.control.SearchGPS,ol.control.Search),ol.control.SearchGPS.prototype._createForm=function(){var t=function(t){if(t.target.classList.contains("ol-dms")&&(i.value=(n.value<0?-1:1)*Number(n.value)+Number(r.value)/60+Number(a.value)/3600,i.value=(n.value<0?-1:1)*Math.round(1e7*i.value)/1e7,s.value=(l.value<0?-1:1)*Number(l.value)+Number(c.value)/60+Number(h.value)/3600,s.value=(l.value<0?-1:1)*Math.round(1e7*s.value)/1e7),i.value||s.value?this._input.value=i.value+","+s.value:this._input.value="",!t.target.classList.contains("ol-dms")){var e=ol.coordinate.toStringHDMS([Number(i.value),Number(s.value)]),o=e.replace(/(N|S|E|W)/g,"").split("″");o[1]=o[1].trim().split(" "),n.value=(/W/.test(e)?-1:1)*parseInt(o[1][0]),r.value=parseInt(o[1][1]),a.value=parseInt(o[1][2]),o[0]=o[0].trim().split(" "),l.value=(/W/.test(e)?-1:1)*parseInt(o[0][0]),c.value=parseInt(o[0][1]),h.value=parseInt(o[0][2])}this.search()}.bind(this);function e(e,i){var n=ol.ext.element.create("INPUT",{className:e,type:"number",step:"any",lang:"en",parent:o,on:{"change keyup":t}});return i&&ol.ext.element.create("SPAN",{className:"ol-dms",html:i,parent:o}),n}var o=ol.ext.element.create("DIV",{className:"ol-longitude",parent:this.element});ol.ext.element.create("LABEL",{html:"Longitude",parent:o});var i=e("ol-decimal"),n=e("ol-dms","°"),r=e("ol-dms","'"),a=e("ol-dms",'"');o=ol.ext.element.create("DIV",{className:"ol-latitude",parent:this.element}),ol.ext.element.create("LABEL",{html:"Latitude",parent:o});var s=e("ol-decimal"),l=e("ol-dms","°"),c=e("ol-dms","'"),h=e("ol-dms",'"');this.button.addEventListener("click",(function(){i.focus()})),this.on("select",function(t){i.value=t.search.gps[0],s.value=t.search.gps[1]}.bind(this)),this.geolocation.on("change",function(){this.geolocation.setTracking(!1);var t=this.geolocation.getPosition();i.value=t[0],s.value=t[1],this._triggerCustomEvent("keyup",i)}.bind(this))},ol.control.SearchGPS.prototype.autocomplete=function(t){var e=[],o=t.split(",");o[0]=Number(o[0]),o[1]=Number(o[1]),(t=ol.coordinate.toStringHDMS(o))&&(t=t.replace(/(°|′|″) /g,"$1"));var i=ol.proj.transform([o[0],o[1]],"EPSG:4326",this.getMap().getView().getProjection());return e.push({gps:o,coordinate:i,name:t}),e},ol.control.SearchGeoportailParcelle=function(t){var e=this;t.type="Commune",t.className=(t.className?t.className:"")+" IGNF-parcelle ol-collapsed-list ol-collapsed-num",t.inputLabel="Commune",t.noCollapse=!0,t.placeholder=t.placeholder||"Choisissez une commune...",ol.control.SearchGeoportail.call(this,t),this.set("copy",null);var o=this.element,i=document.createElement("DIV");o.appendChild(i);var n,r=document.createElement("LABEL");r.innerText="Préfixe",i.appendChild(r),(r=document.createElement("LABEL")).innerText="Section",i.appendChild(r),(r=document.createElement("LABEL")).innerText="Numéro",i.appendChild(r),i.appendChild(document.createElement("BR")),this._inputParcelle={prefix:document.createElement("INPUT"),section:document.createElement("INPUT"),numero:document.createElement("INPUT")},this._inputParcelle.prefix.setAttribute("maxlength",3),this._inputParcelle.section.setAttribute("maxlength",2),this._inputParcelle.numero.setAttribute("maxlength",4);var a=function(){n&&clearTimeout(n),n=setTimeout((function(){e.autocompleteParcelle()}),t.typing||0)};for(var s in this._inputParcelle)i.appendChild(this._inputParcelle[s]),this._inputParcelle[s].addEventListener("keyup",a),this._inputParcelle[s].addEventListener("blur",(function(){n=setTimeout((function(){o.classList.add("ol-collapsed-num")}),200)})),this._inputParcelle[s].addEventListener("focus",(function(){clearTimeout(n),o.classList.remove("ol-collapsed-num")}));this.activateParcelle(!1);var l=document.createElement("DIV");l.className="autocomplete-parcelle",o.appendChild(l);var c=document.createElement("UL");c.classList.add("autocomplete-parcelle"),l.appendChild(c),(c=document.createElement("UL")).classList.add("autocomplete-page"),l.appendChild(c),this._input.addEventListener("blur",(function(){setTimeout((function(){o.classList.add("ol-collapsed-list")}),200)})),this._input.addEventListener("focus",(function(){o.classList.remove("ol-collapsed-list"),e._listParcelle([]),e._commune&&(e._commune=null,e._input.value="",e.drawList_()),e.activateParcelle(!1)})),this.on("select",this.selectCommune.bind(this)),this.set("pageSize",t.pageSize||5)},ol.ext.inherits(ol.control.SearchGeoportailParcelle,ol.control.SearchGeoportail),ol.control.SearchGeoportailParcelle.prototype.selectCommune=function(t){this._commune=t.search.insee,this._input.value=t.search.insee+" - "+t.search.fulltext,this.activateParcelle(!0),this._inputParcelle.numero.focus(),this.autocompleteParcelle()},ol.control.SearchGeoportailParcelle.prototype.setParcelle=function(t,e){this._inputParcelle.prefix.value=(t.Commune||"")+(t.CommuneAbsorbee||""),this._inputParcelle.section.value=t.Section||"",this._inputParcelle.numero.value=t.Numero||"",e&&this._triggerCustomEvent("keyup",this._inputParcelle.prefix)},ol.control.SearchGeoportailParcelle.prototype.activateParcelle=function(t){for(var e in this._inputParcelle)this._inputParcelle[e].readOnly=!t;t?this._inputParcelle.section.parentElement.classList.add("ol-active"):this._inputParcelle.section.parentElement.classList.remove("ol-active")},ol.control.SearchGeoportailParcelle.prototype.autocompleteParcelle=function(){function t(t,e,o){if(!t)return t;for(o=o||"0";t.length<e;)t=o+t;return t.replace(/\*/g,"_")}var e=this._commune,o=t(this._inputParcelle.prefix.value,3);"000"===o&&(o="___");var i=t(this._inputParcelle.section.value,2),n=t(this._inputParcelle.numero.value,4,"0"),r=e+(o||"___")+(i||"__")+(n||(i?"____":"0001"));this.searchParcelle(r,function(t){this._listParcelle(t)}.bind(this),(function(){console.log("oops")}))},ol.control.SearchGeoportailParcelle.prototype.searchParcelle=function(t,e){var o='<?xml version="1.0" encoding="UTF-8"?><XLS xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml" xmlns="http://www.opengis.net/xls" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.2" xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"><RequestHeader/><Request requestID="1" version="1.2" methodName="LocationUtilityService"><GeocodeRequest returnFreeForm="false"><Address countryCode="CadastralParcel"><freeFormAddress>'+t+"+</freeFormAddress></Address></GeocodeRequest></Request></XLS>";this.ajax(this.get("url").replace("ols/apis/completion","geoportail/ols"),{xls:o},(function(t){for(var o,i=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("GeocodedAddress"),n=[],r=0;o=i[r];r++){for(var a,s=(o.getElementsByTagName("gml:pos")[0]||o.getElementsByTagName("pos")[0]).childNodes[0].nodeValue.split(" "),l=o.getElementsByTagName("Place"),c={lon:Number(s[1]),lat:Number(s[0])},h=0;a=l[h];h++)c[a.attributes.type.value]=a.childNodes[0].nodeValue;n.push(c)}e(n)}),{dataType:"XML"})},ol.control.SearchGeoportailParcelle.prototype._listParcelle=function(t){var e=this,o=this.element.querySelector("ul.autocomplete-parcelle");o.innerHTML="";var i=this.element.querySelector("ul.autocomplete-page");function n(t){var e,n=o.children,r="ol-list-"+t;for(e=0;e<n.length;e++)n[e].style.display=n[e].className===r?"":"none";for(n=i.children,e=0;e<n.length;e++)n[e].className=n[e].innerText==t?"selected":"";i.style.display=n.length>1?"":"none"}i.innerHTML="",this._listParc=[],t.sort((function(t,e){var o=t.INSEE+t.CommuneAbsorbee+t.Section+t.Numero,i=e.INSEE+e.CommuneAbsorbee+e.Section+e.Numero;return o===i?0:o<i?-1:1}));for(var r,a=this.get("pageSize"),s=0;r=t[s];s++){var l=document.createElement("LI");l.setAttribute("data-search",s),a>0&&l.classList.add("ol-list-"+Math.floor(s/a)),this._listParc.push(r),l.addEventListener("click",(function(t){e._handleParcelle(e._listParc[t.currentTarget.getAttribute("data-search")])})),l.innerHTML=r.INSEE+r.CommuneAbsorbee+r.Section+r.Numero,o.appendChild(l),a>0&&!(s%a)&&((l=document.createElement("LI")).innerText=Math.floor(s/a),l.addEventListener("click",(function(t){n(t.currentTarget.innerText)})),i.appendChild(l))}a>0&&n(0)},ol.control.SearchGeoportailParcelle.prototype._handleParcelle=function(t){this.dispatchEvent({type:"parcelle",search:t,coordinate:ol.proj.fromLonLat([t.lon,t.lat],this.getMap().getView().getProjection())})},ol.control.SearchNominatim=function(t){(t=t||{}).className=t.className||"nominatim",t.typing=t.typing||500,t.url=t.url||"https://nominatim.openstreetmap.org/search",t.copy='<a href="http://www.openstreetmap.org/copyright" target="new">&copy; OpenStreetMap contributors</a>',ol.control.SearchJSON.call(this,t),this.set("polygon",t.polygon),this.set("viewbox",t.viewbox),this.set("bounded",t.bounded)},ol.ext.inherits(ol.control.SearchNominatim,ol.control.SearchJSON),ol.control.SearchNominatim.prototype.getTitle=function(t){var e=[];t.class&&e.push(t.class),t.type&&e.push(t.type);var o=t.display_name+(e.length?"<i>"+e.join(" - ")+"</i>":"");return t.icon&&(o="<img src='"+t.icon+"' />"+o),o},ol.control.SearchNominatim.prototype.requestData=function(t){var e={format:"json",addressdetails:1,q:t,polygon_geojson:this.get("polygon")?1:0,bounded:this.get("bounded")?1:0,limit:this.get("maxItems")};return this.get("viewbox")&&(e.viewbox=this.get("viewbox")),e},ol.control.SearchNominatim.prototype.select=function(t){var e=[Number(t.lon),Number(t.lat)];try{e=ol.proj.transform(e,"EPSG:4326",this.getMap().getView().getProjection())}catch(t){}this.dispatchEvent({type:"select",search:t,coordinate:e})},ol.control.SearchJSON.prototype.handleResponse=function(t){return t.results||t},ol.control.SearchNominatim.prototype.reverseGeocode=function(t,e){var o=ol.proj.transform(t,this.getMap().getView().getProjection(),"EPSG:4326");this.ajax(this.get("url").replace("search","reverse"),{lon:o[0],lat:o[1],format:"json"},function(t){e?e.call(this,[t]):t&&!t.error&&this._handleSelect(t,!0)}.bind(this))},ol.control.SearchWikipedia=function(t){(t=t||{}).lang=t.lang||"en",t.className=t.className||"ol-search-wikipedia",t.url="https://"+t.lang+".wikipedia.org/w/api.php",t.placeholder=t.placeholder||"search string, File:filename",t.copy='<a href="https://'+t.lang+'.wikipedia.org/" target="new">Wikipedia&reg; - CC-By-SA</a>',ol.control.SearchJSON.call(this,t),this.set("lang",t.lang)},ol.ext.inherits(ol.control.SearchWikipedia,ol.control.SearchJSON),ol.control.SearchWikipedia.prototype.getTitle=function(t){return ol.ext.element.create("DIV",{html:t.title,title:t.desc})},ol.control.SearchWikipedia.prototype.setLang=function(t){this.set("lang",t),this.set("url","https://"+t+".wikipedia.org/w/api.php")},ol.control.SearchWikipedia.prototype.requestData=function(t){return{action:"opensearch",search:t,lang:this.get("lang"),format:"json",origin:"*",limit:this.get("maxItems")}},ol.control.SearchWikipedia.prototype.handleResponse=function(t){for(var e=[],o=0;o<t[1].length;o++)e.push({title:t[1][o],desc:t[2][o],uri:t[3][o]});return e},ol.control.SearchWikipedia.prototype.select=function(t){var e=decodeURIComponent(t.uri.split("/").pop()).replace(/'/,"%27");ol.ext.Ajax.get({url:t.uri.split("wiki/")[0]+"w/api.php",data:{action:"query",prop:"pageimages|coordinates|extracts",exintro:1,explaintext:1,piprop:"original",origin:"*",format:"json",redirects:1,titles:e},options:{encode:!1},success:function(e){var o=e.query.pages[Object.keys(e.query.pages).pop()];console.log(o);var i,n={title:t.title,desc:o.extract||t.desc,url:t.uri,img:o.original?o.original.source:void 0,pageid:o.pageid};o.coordinates&&(n.lon=o.coordinates[0].lon,n.lat=o.coordinates[0].lat,i=[n.lon,n.lat],i=ol.proj.transform(i,"EPSG:4326",this.getMap().getView().getProjection())),this.dispatchEvent({type:"select",search:n,coordinate:i})}.bind(this)})},ol.control.Select=function(t){var e=this;t||(t={});var o=t.content=document.createElement("div");this._ul=ol.ext.element.create("UL",{parent:o}),this._all=ol.ext.element.create("INPUT",{type:"checkbox",checked:!0});var i=ol.ext.element.create("LABEL",{html:this._all,parent:o});ol.ext.element.appendText(i,t.allLabel||"match all"),this._useCase=ol.ext.element.create("INPUT",{type:"checkbox"});var n=ol.ext.element.create("LABEL",{html:this._useCase,parent:o});ol.ext.element.appendText(n,t.caseLabel||"case sensitive"),ol.control.SelectBase.call(this,t),ol.ext.element.create("BUTTON",{className:"ol-append",html:t.addLabel||"add rule",click:function(){e.addCondition()},parent:o}),this._conditions=[],this.set("attrPlaceHolder",t.attrPlaceHolder||"attribute"),this.set("valuePlaceHolder",t.valuePlaceHolder||"value"),this.addCondition()},ol.ext.inherits(ol.control.Select,ol.control.SelectBase),ol.control.Select.prototype.addCondition=function(t){t=t||{},this._conditions.push({attr:t.attr||"",op:t.op||"=",val:t.val||""}),this._drawlist()},ol.control.Select.prototype.getConditions=function(){return{usecase:this._useCase.checked,all:this._all.checked,conditions:this._conditions}},ol.control.Select.prototype.setConditions=function(t){this._useCase.checked=t.usecase,this._all.checked=t.all,this._conditions=t.conditions,this._drawlist()},ol.control.Select.prototype.getConditionsString=function(t){for(var e,o="",i=0;e=t.conditions[i];i++)e.attr&&(o+=(o?t.all?" AND ":" OR ":"")+e.attr+this.operationsList[e.op]+e.val);return o},ol.control.Select.prototype._drawlist=function(){this._ul.innerHTML="";for(var t=0;t<this._conditions.length;t++)this._ul.appendChild(this._getLiCondition(t))},ol.control.Select.prototype._autocomplete=function(t,e){e.classList.remove("ol-hidden"),e.innerHTML="";for(var o,i={},n=this.get("source"),r=0;o=n[r];r++)for(var a,s=o.getFeatures(),l=0;(a=s[l])&&(Object.assign(i,a.getProperties()),!(l>100));l++);var c=new RegExp(t,"i");for(var h in i)if("geometry"!==h&&c.test(h)){var u=document.createElement("li");u.textContent=h,u.addEventListener("click",(function(){e.previousElementSibling.value=this.textContent;var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),e.previousElementSibling.dispatchEvent(t),e.classList.add("ol-hidden")})),e.appendChild(u)}},ol.control.Select.prototype._getLiCondition=function(t){var e=this,o=document.createElement("li"),i=document.createElement("div");i.classList.add("ol-autocomplete"),i.addEventListener("mouseleave",(function(){this.querySelector("ul").classList.add("ol-hidden")})),o.appendChild(i);var n=document.createElement("input");n.classList.add("ol-attr"),n.setAttribute("type","search"),n.setAttribute("placeholder",this.get("attrPlaceHolder")),n.addEventListener("keyup",(function(){e._autocomplete(this.value,this.nextElementSibling)})),n.addEventListener("focusout",(function(){setTimeout((function(){i.querySelector("ul").classList.add("ol-hidden")}),300)})),n.addEventListener("click",(function(){setTimeout(function(){e._autocomplete(this.value,this.nextElementSibling),this.nextElementSibling.classList.remove("ol-hidden")}.bind(this))})),n.addEventListener("change",(function(){e._conditions[t].attr=this.value})),n.value=e._conditions[t].attr,i.appendChild(n);var r=document.createElement("ul");r.classList.add("ol-hidden"),i.appendChild(r);var a=document.createElement("select");for(var s in o.appendChild(a),this.operationsList){var l=document.createElement("option");l.value=s,l.textContent=this.operationsList[s],a.appendChild(l)}a.value=e._conditions[t].op,a.addEventListener("change",(function(){e._conditions[t].op=this.value}));var c=document.createElement("input");if(c.setAttribute("type","text"),c.setAttribute("placeholder",this.get("valuePlaceHolder")),c.addEventListener("change",(function(){e._conditions[t].val=this.value})),c.value=e._conditions[t].val,o.appendChild(c),this._conditions.length>1){var h=document.createElement("div");h.classList.add("ol-delete"),h.addEventListener("click",(function(){e.removeCondition(t)})),o.appendChild(h)}return o},ol.control.Select.prototype.removeCondition=function(t){this._conditions.splice(t,1),this._drawlist()},ol.control.Select.prototype.doSelect=function(t){return(t=t||{}).useCase=t.useCase||this._useCase.checked,t.matchAll=t.matchAll||this._all.checked,t.conditions=t.conditions||this._conditions,ol.control.SelectBase.prototype.doSelect.call(this,t)},ol.control.SelectCheck=function(t){t||(t={});var e=t.content=ol.ext.element.create("DIV");t.label&&ol.ext.element.create("LABEL",{html:t.label,parent:e}),this._input=ol.ext.element.create("DIV",{parent:e}),t.className=t.className||"ol-select-check",ol.control.SelectBase.call(this,t),this.set("property",t.property||"name"),this.set("max",t.max||1e4),this.set("defaultLabel",t.defaultLabel),this.set("type",t.type),this._selectAll=t.selectAll,this._onchoice=t.onchoice,this.setValues()},ol.ext.inherits(ol.control.SelectCheck,ol.control.SelectBase),ol.control.SelectCheck.prototype.setMap=function(t){ol.control.SelectBase.prototype.setMap.call(this,t),this.setValues()},ol.control.SelectCheck.prototype.doSelect=function(t){t=t||{};var e=[];return this._checks.forEach(function(t){t.checked&&t.value&&e.push({attr:this.get("property"),op:"=",val:t.value})}.bind(this)),e.length?ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,conditions:e}):ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,matchAll:this._selectAll})},ol.control.SelectCheck.prototype.setValues=function(t){var e,o;if(t=t||{},console.log(t),t.values)t.values instanceof Array?(o={},t.values.forEach((function(t){o[t]=t}))):o=t.values;else{o={};var i=this.get("property");this.getSources().forEach(function(t){for(var e=t.getFeatures(),n=Math.min(e.length,this.get("max")),r=0;r<n;r++){var a=e[r].get(i);a&&(o[a]=a)}}.bind(this))}if(Object.keys(o).length){t.sort?(e={},Object.keys(o).sort().forEach((function(t){e[t]=o[t]}))):e=o,ol.ext.element.setHTML(this._input,""),this._checks=[];var n="radio_"+(new Date).getTime(),r=function(t,e){var o=ol.ext.element.create("LABEL",{className:"radio"===this.get("type")?"ol-radio":"ol-checkbox",parent:this._input});this._checks.push(ol.ext.element.create("INPUT",{name:n,type:"radio"===this.get("type")?"radio":"checkbox",value:t,change:function(){this._onchoice?this._onchoice():this.doSelect()}.bind(this),parent:o})),ol.ext.element.create("DIV",{html:e,parent:o})}.bind(this);for(var a in this.get("defaultLabel")&&"radio"===this.get("type")&&r("",this.get("defaultLabel")),e)r(a,e[a])}},ol.control.SelectCondition=function(t){t||(t={});var e=t.content=ol.ext.element.create("DIV"),o=ol.ext.element.create("LABEL",{parent:e});this._check=ol.ext.element.create("INPUT",{type:"checkbox",change:function(){this._onchoice?this._onchoice():this.doSelect()}.bind(this),parent:o}),ol.ext.element.create("DIV",{html:t.label||"condition",parent:o}),this._input=ol.ext.element.create("DIV",{parent:e}),t.className=t.className||"ol-select-condition",ol.control.SelectBase.call(this,t),this.setCondition(t.condition),this._selectAll=t.selectAll,this._onchoice=t.onchoice},ol.ext.inherits(ol.control.SelectCondition,ol.control.SelectBase),ol.control.SelectCondition.prototype.setCondition=function(t){this._conditions=t?t instanceof Array?t:[t]:[]},ol.control.SelectCondition.prototype.addCondition=function(t){this._conditions.push(t)},ol.control.SelectCondition.prototype.doSelect=function(t){t=t||{};var e=this._conditions;return this._check.checked?ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,conditions:e}):ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,matchAll:this._selectAll})},ol.control.SelectFulltext=function(t){t||(t={});var e=t.content=ol.ext.element.create("DIV");t.label&&ol.ext.element.create("LABEL",{html:t.label,parent:e}),this._input=ol.ext.element.create("INPUT",{placeHolder:t.placeHolder||"search...",change:function(){this._onchoice&&this._onchoice()}.bind(this),parent:e}),ol.control.SelectBase.call(this,t),this._onchoice=t.onchoice,this.set("property",t.property||"name")},ol.ext.inherits(ol.control.SelectFulltext,ol.control.SelectBase),ol.control.SelectFulltext.prototype.doSelect=function(t){return t=t||{},ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,useCase:!1,conditions:[{attr:this.get("property"),op:"contain",val:this._input.value}]})},ol.control.SelectMulti=function(t){t||(t={}),t.content=ol.ext.element.create("DIV"),this._container=ol.ext.element.create("UL",{parent:t.content}),t.className=t.className||"ol-select-multi",ol.control.SelectBase.call(this,t),this._controls=[],t.controls.forEach(this.addControl.bind(this))},ol.ext.inherits(ol.control.SelectMulti,ol.control.SelectBase),ol.control.SelectMulti.prototype.setMap=function(t){this.getMap()&&this._controls.forEach(function(t){this.getMap().remveControl(t)}.bind(this)),ol.control.SelectBase.prototype.setMap.call(this,t),this.getMap()&&this._controls.forEach(function(t){this.getMap().addControl(t)}.bind(this))},ol.control.SelectMulti.prototype.addControl=function(t){t instanceof ol.control.SelectBase&&(this._controls.push(t),t.setTarget(ol.ext.element.create("LI",{parent:this._container})),t._selectAll=!0,t._onchoice=this.doSelect.bind(this),this.getMap()&&this.getMap().addControl(t))},ol.control.SelectMulti.prototype.getControls=function(){return this._controls},ol.control.SelectMulti.prototype.doSelect=function(){var t=[];return this.getSources().forEach((function(e){t=t.concat(e.getFeatures())})),this._controls.forEach((function(e){t=e.doSelect({features:t})})),this.dispatchEvent({type:"select",features:t}),t},ol.control.SelectPopup=function(t){t||(t={});var e=t.content=ol.ext.element.create("DIV");t.label&&ol.ext.element.create("LABEL",{html:t.label,parent:e}),this._input=ol.ext.element.create("SELECT",{on:{change:function(){this._onchoice?this._onchoice():this.doSelect()}.bind(this)},parent:e}),t.className=t.className||"ol-select-popup",ol.control.SelectBase.call(this,t),this.set("property",t.property||"name"),this.set("max",t.max||1e4),this.set("defaultLabel",t.defaultLabel),this._selectAll=t.selectAll,this._onchoice=t.onchoice,this.setValues()},ol.ext.inherits(ol.control.SelectPopup,ol.control.SelectBase),ol.control.SelectPopup.prototype.setMap=function(t){ol.control.SelectBase.prototype.setMap.call(this,t),this.setValues()},ol.control.SelectPopup.prototype.doSelect=function(t){return t=t||{},this._input.value?ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,conditions:[{attr:this.get("property"),op:"=",val:this._input.value}]}):ol.control.SelectBase.prototype.doSelect.call(this,{features:t.features,matchAll:this._selectAll})},ol.control.SelectPopup.prototype.setValues=function(t){var e,o;if((t=t||{}).values)t.values instanceof Array?(o={},t.values.forEach((function(t){o[t]=t}))):o=t.values;else{o={};var i=this.get("property");this.getSources().forEach(function(t){for(var e=t.getFeatures(),n=Math.min(e.length,this.get("max")),r=0;r<n;r++){var a=e[r].get(i);a&&(o[a]=a)}}.bind(this))}for(var n in t.sort?(e={},Object.keys(o).sort().forEach((function(t){e[t]=o[t]}))):e=o,ol.ext.element.setHTML(this._input,""),ol.ext.element.create("OPTION",{className:"ol-default",html:this.get("defaultLabel")||"",value:"",parent:this._input}),e)ol.ext.element.create("OPTION",{html:e[n],value:n,parent:this._input})},ol.control.Status=function(t){t=t||{};var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-status"+(t.target?"":" ol-unselectable ol-control")});ol.control.Control.call(this,{element:e,target:t.target}),this.setVisible(!1!==t.visible),t.position&&this.setPosition(t.position),this.status(t.status||"")},ol.ext.inherits(ol.control.Status,ol.control.Control),ol.control.Status.prototype.setVisible=function(t){t?this.element.classList.add("ol-visible"):this.element.classList.remove("ol-visible")},ol.control.Status.prototype.status=function(t){var e=t||"";if(e){if(ol.ext.element.show(this.element),"object"===o(e)&&!(e instanceof String))for(var i in e="",t)e+="<label>"+i+":</label> "+t[i]+"<br/>";ol.ext.element.setHTML(this.element,e)}else ol.ext.element.hide(this.element)},ol.control.Status.prototype.setPosition=function(t){this.element.classList.remove("ol-left"),this.element.classList.remove("ol-right"),this.element.classList.remove("ol-bottom"),this.element.classList.remove("ol-center"),/^left$|^right$|^bottom$|^center$/.test(t)&&this.element.classList.add("ol-"+t)},ol.control.Status.prototype.show=function(t){!1===t?ol.ext.element.hide(this.element):ol.ext.element.show(this.element)},ol.control.Status.prototype.hide=function(){ol.ext.element.hide(this.element)},ol.control.Status.prototype.toggle=function(){ol.ext.element.toggle(this.element)},ol.control.Status.prototype.isShown=function(){return"none"===this.element.style.display},ol.control.Storymap=function(t){t.target&&(t.html?t.html instanceof Element&&(t.html=t.html.innerHTML):t.html=t.target.innerHTML,t.target.innerHTML="");var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-storymap"+(t.target?"":" ol-unselectable ol-control")+("ontouchstart"in window?" ol-touch":""),html:t.html});e.querySelectorAll(".chapter").forEach(function(t){t.addEventListener("click",function(e){this.element.classList.contains("ol-move")||(t.classList.contains("ol-select")?"IMG"===e.target.tagName&&e.target.dataset.title&&this.dispatchEvent({coordinate:this.getMap()?this.getMap().getCoordinateFromPixel([e.layerX,e.layerY]):null,type:"clickimage",img:e.target,title:e.target.dataset.title,element:t,name:t.getAttribute("name"),originalEvent:e}):(this.element.scrollTop=t.offsetTop-30,e.preventDefault()))}.bind(this))}.bind(this)),ol.control.Control.call(this,{element:e,target:t.target}),ol.ext.element.scrollDiv(this.element,{vertical:!0,mousewheel:!0});var o=this.element.querySelectorAll(".ol-scroll-next");o.forEach(function(t){t.addEventListener("click",function(e){if(t.parentElement.classList.contains("ol-select")){for(var o,i=this.element.querySelectorAll(".chapter"),n=t.offsetTop,r=0;o=i[r];r++)if(o.offsetTop>n){n=o.offsetTop;break}this.element.scrollTop=n-30,e.stopPropagation(),e.preventDefault()}}.bind(this))}.bind(this)),(o=this.element.querySelectorAll(".ol-scroll-top")).forEach(function(t){t.addEventListener("click",function(t){this.element.scrollTop=0,t.stopPropagation(),t.preventDefault()}.bind(this))}.bind(this));var i=function(t){var e=[parseFloat(t.getAttribute("data-lon")),parseFloat(t.getAttribute("data-lat"))],o=ol.proj.fromLonLat(e,this.getMap().getView().getProjection()),i=parseFloat(t.getAttribute("data-zoom"));return{type:"scrollto",element:t,name:t.getAttribute("name"),coordinate:o,lon:e,zoom:i}}.bind(this),n=this.element.querySelectorAll(".chapter")[0];setTimeout(function(){n.classList.add("ol-select"),this.dispatchEvent(i(n))}.bind(this)),this.element.addEventListener("scroll",function(){var t,e=this.element.querySelectorAll(".chapter"),o=ol.ext.element.getStyle(this.element,"height");if(this.element.scrollTop)for(var r,a=0;r=e[a];a++){if(r.offsetTop-this.element.scrollTop>o/3)break;t=r}else t=e[0];if(t&&t!==n){n&&n.classList.remove("ol-select"),(n=t).classList.add("ol-select");var s=i(n),l=this.getMap().getView();switch(l.cancelAnimations(),n.getAttribute("data-animation")){case"flyto":l.animate({center:s.coordinate,duration:2e3}),l.animate({zoom:Math.min(l.getZoom(),s.zoom)-1,duration:1e3},{zoom:s.zoom,duration:1e3})}this.dispatchEvent(s)}}.bind(this))},ol.ext.inherits(ol.control.Storymap,ol.control.Control),ol.control.Storymap.prototype.setChapter=function(t){for(var e,o=this.element.querySelectorAll(".chapter"),i=0;e=o[i];i++)e.getAttribute("name")===t&&(this.element.scrollTop=e.offsetTop-30)},ol.control.Swipe=function(t){t=t||{};var e=document.createElement("button"),o=document.createElement("div");o.className=(t.className||"ol-swipe")+" ol-unselectable ol-control",o.appendChild(e),o.addEventListener("mousedown",this.move.bind(this)),o.addEventListener("touchstart",this.move.bind(this)),ol.control.Control.call(this,{element:o}),this.precomposeRight_=this.precomposeRight.bind(this),this.precomposeLeft_=this.precomposeLeft.bind(this),this.postcompose_=this.postcompose.bind(this),this.layers=[],t.layers&&this.addLayer(t.layers,!1),t.rightLayers&&this.addLayer(t.rightLayers,!0),this.on("propertychange",function(){this.getMap()&&this.getMap().renderSync(),"horizontal"===this.get("orientation")?(this.element.style.top=100*this.get("position")+"%",this.element.style.left=""):("vertical"!==this.get("orientation")&&this.set("orientation","vertical"),this.element.style.left=100*this.get("position")+"%",this.element.style.top=""),this.element.classList.remove("horizontal","vertical"),this.element.classList.add(this.get("orientation"))}.bind(this)),this.set("position",t.position||.5),this.set("orientation",t.orientation||"vertical")},ol.ext.inherits(ol.control.Swipe,ol.control.Control),ol.control.Swipe.prototype.setMap=function(t){var e,o;if(this.getMap()){for(e=0;e<this.layers.length;e++)(o=this.layers[e]).right?o.layer.un(["precompose","prerender"],this.precomposeRight_):o.layer.un(["precompose","prerender"],this.precomposeLeft_),o.layer.un(["postcompose","postrender"],this.postcompose_);this.getMap().renderSync()}if(ol.control.Control.prototype.setMap.call(this,t),t){for(this._listener=[],e=0;e<this.layers.length;e++)(o=this.layers[e]).right?o.layer.on(["precompose","prerender"],this.precomposeRight_):o.layer.on(["precompose","prerender"],this.precomposeLeft_),o.layer.on(["postcompose","postrender"],this.postcompose_);t.renderSync()}},ol.control.Swipe.prototype.isLayer_=function(t){for(var e=0;e<this.layers.length;e++)if(this.layers[e].layer===t)return e;return-1},ol.control.Swipe.prototype.addLayer=function(t,e){t instanceof Array||(t=[t]);for(var o=0;o<t.length;o++){var i=t[o];this.isLayer_(i)<0&&(this.layers.push({layer:i,right:e}),this.getMap()&&(e?i.on(["precompose","prerender"],this.precomposeRight_):i.on(["precompose","prerender"],this.precomposeLeft_),i.on(["postcompose","postrender"],this.postcompose_),this.getMap().renderSync()))}},ol.control.Swipe.prototype.removeLayer=function(t){t instanceof Array||(t=[t]);for(var e=0;e<t.length;e++){var o=this.isLayer_(t[e]);o>=0&&this.getMap()&&(this.layers[o].right?t[e].un(["precompose","prerender"],this.precomposeRight_):t[e].un(["precompose","prerender"],this.precomposeLeft_),t[e].un(["postcompose","postrender"],this.postcompose_),this.layers.splice(o,1),this.getMap().renderSync())}},ol.control.Swipe.prototype.move=function(t){var e,o=this;switch(t.type){case"touchcancel":case"touchend":case"mouseup":o.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.removeEventListener(t,o.move)}));break;case"mousedown":case"touchstart":o.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.addEventListener(t,o.move.bind(o))}));case"mousemove":case"touchmove":if(o.isMoving)if("vertical"===o.get("orientation")){var i=t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageX;if(!i)break;i-=o.getMap().getTargetElement().getBoundingClientRect().left+window.pageXOffset-document.documentElement.clientLeft,e=o.getMap().getSize()[0],e=Math.min(Math.max(0,1-(e-i)/e),1),o.set("position",e)}else{var n=t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY||t.changedTouches&&t.changedTouches.length&&t.changedTouches[0].pageY;if(!n)break;n-=o.getMap().getTargetElement().getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop,e=o.getMap().getSize()[1],e=Math.min(Math.max(0,1-(e-n)/e),1),o.set("position",e)}}},ol.control.Swipe.prototype._drawRect=function(t,e){var o=t.inversePixelTransform;if(o){[[e[0][0],e[0][1]],[e[0][0],e[1][1]],[e[1][0],e[1][1]],[e[1][0],e[0][1]],[e[0][0],e[0][1]]].forEach((function(e,i){e=[e[0]*o[0]-e[1]*o[1]+o[4],-e[0]*o[2]+e[1]*o[3]+o[5]],i?t.context.lineTo(e[0],e[1]):t.context.moveTo(e[0],e[1])}))}else{var i=t.frameState.pixelRatio;t.context.rect(e[0][0]*i,e[0][1]*i,e[1][0]*i,e[1][1]*i)}},ol.control.Swipe.prototype.precomposeLeft=function(t){var e=t.context,o=t.frameState.size;e.save(),e.beginPath();var i=[[0,0],[o[0],o[1]]];"vertical"===this.get("orientation")?i[1]=[o[0]*this.get("position"),o[1]]:i[1]=[o[0],o[1]*this.get("position")],this._drawRect(t,i),e.clip()},ol.control.Swipe.prototype.precomposeRight=function(t){var e=t.context,o=t.frameState.size;e.save(),e.beginPath();var i=[[0,0],[o[0],o[1]]];"vertical"===this.get("orientation")?i[0]=[o[0]*this.get("position"),0]:i[0]=[0,o[1]*this.get("position")],this._drawRect(t,i),e.clip()},ol.control.Swipe.prototype.postcompose=function(t){"ol-layer"!==t.target.getClassName()&&t.target.get("declutter")?setTimeout((function(){t.context.restore()}),0):t.context.restore()},ol.control.Target=function(t){t=t||{},this.style=t.style||[new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:11,radius1:0,radius2:0,snapToPixel:!0,stroke:new ol.style.Stroke({color:"#fff",width:3})})}),new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:11,radius1:0,radius2:0,snapToPixel:!0,stroke:new ol.style.Stroke({color:"#000",width:1})})})],this.style instanceof Array||(this.style=[this.style]),this.composite=t.composite||"";var e=document.createElement("div");e.className="ol-target ol-unselectable ol-control",ol.control.CanvasBase.call(this,{element:e,target:t.target}),this.setVisible(!1!==t.visible)},ol.ext.inherits(ol.control.Target,ol.control.CanvasBase),ol.control.Target.prototype.setVisible=function(t){this.set("visible",t),this.getMap()&&this.getMap().renderSync()},ol.control.Target.prototype.getVisible=function(){return this.get("visible")},ol.control.Target.prototype._draw=function(t){var e=this.getContext(t);if(e&&this.getMap()&&this.getVisible()){var o=t.frameState.pixelRatio;e.save(),e.scale(o,o);var i=e.canvas.width/(2*o),n=e.canvas.height/(2*o),r=new ol.geom.Point(this.getMap().getCoordinateFromPixel([i,n]));this.composite&&(e.globalCompositeOperation=this.composite);for(var a=0;a<this.style.length;a++){var s=this.style[a];if(s instanceof ol.style.Style){var l=t.vectorContext;if(!l){var c={inversePixelTransform:[o,0,0,o,0,0],context:e,frameState:{pixelRatio:o,extent:t.frameState.extent,coordinateToPixelTransform:t.frameState.coordinateToPixelTransform,viewState:t.frameState.viewState}};l=ol.render.getVectorContext(c)}l.setStyle(s),l.drawGeometry(r)}}e.restore()}},ol.control.TextButton=function(t){(t=t||{}).className=(t.className||"")+" ol-text-button",ol.control.Button.call(this,t)},ol.ext.inherits(ol.control.TextButton,ol.control.Button),ol.control.Timeline=function(t){var e=ol.ext.element.create("DIV",{className:(t.className||"")+" ol-timeline"+(t.target?"":" ol-unselectable ol-control")+(t.zoomButton?" ol-hasbutton":"")+("ontouchstart"in window?" ol-touch":"")});ol.control.Control.call(this,{element:e,target:t.target}),this._scrollDiv=ol.ext.element.create("DIV",{className:"ol-scroll",parent:this.element}),this._buttons=ol.ext.element.create("DIV",{className:"ol-buttons",parent:this.element}),t.zoomButton&&(this.addButton({className:"ol-zoom-in",handleClick:function(){var t=this.get("zoom");t>=1?t++:t=Math.min(1,t+.1),t=Math.round(100*t)/100,this.refresh(t)}.bind(this)}),this.addButton({className:"ol-zoom-out",handleClick:function(){var t=this.get("zoom");t>1?t--:t-=.1,t=Math.round(100*t)/100,this.refresh(t)}.bind(this)})),this._intervalDiv=ol.ext.element.create("DIV",{className:"ol-center-date",parent:this.element}),this.element.addEventListener("mouseover",function(){this._select&&this._select.elt.classList.remove("ol-select")}.bind(this));var o=null;this._scrollDiv.addEventListener("scroll",function(){this._setScrollLeft(),o&&(clearTimeout(o),o=null),o=setTimeout(function(){this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}.bind(this),t.scrollTimeout||15)}.bind(this)),this._scrollDiv.addEventListener("gesturechange",(function(){})),ol.ext.element.scrollDiv(this._scrollDiv,{onmove:function(t){this._moving=t}.bind(this)}),this._tline=[],this._scrollLeft=0,this.set("maxWidth",t.maxWidth||2e3),this.set("minDate",t.minDate||1/0),this.set("maxDate",t.maxDate||-1/0),this.set("graduation",t.graduation),this.set("minZoom",t.minZoom||.2),this.set("maxZoom",t.maxZoom||4),this.setInterval(t.interval),t.getHTML&&(this._getHTML=t.getHTML),t.getFeatureDate&&(this._getFeatureDate=t.getFeatureDate),t.endFeatureDate&&(this._endFeatureDate=t.endFeatureDate),this.setFeatures(t.features||t.source,t.zoom)},ol.ext.inherits(ol.control.Timeline,ol.control.Control),ol.control.Timeline.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.refresh(this.get("zoom")||1,!0)},ol.control.Timeline.prototype.addButton=function(t){this.element.classList.add("ol-hasbutton"),ol.ext.element.create("BUTTON",{className:t.className||void 0,title:t.title,html:t.html,click:t.handleClick,parent:this._buttons})},ol.control.Timeline.prototype.setInterval=function(t){"string"==typeof t&&(t=/s$/.test(t)?1e3*parseFloat(t):/mn$/.test(t)?1e3*parseFloat(t)*60:/h$/.test(t)?1e3*parseFloat(t)*3600:/d$/.test(t)?1e3*parseFloat(t)*3600*24:/y$/.test(t)?1e3*parseFloat(t)*3600*24*365:0),this.set("interval",t||0),t?this.element.classList.add("ol-interval"):this.element.classList.remove("ol-interval"),this.refresh(this.get("zoom"))},ol.control.Timeline.prototype._getHTML=function(t){return t.get("name")||""},ol.control.Timeline.prototype._getFeatureDate=function(t){return t&&t.get?t.get("date"):null},ol.control.Timeline.prototype._endFeatureDate=function(){},ol.control.Timeline.prototype.isCollapsed=function(){return this.element.classList.contains("ol-collapsed")},ol.control.Timeline.prototype.collapse=function(t){t?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},ol.control.Timeline.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},ol.control.Timeline.prototype.setFeatures=function(t,e){this._features=this._source=null,t instanceof ol.source.Vector?this._source=t:this._features=t instanceof Array?t:[],this.refresh(e)},ol.control.Timeline.prototype.getFeatures=function(){return this._features||this._source.getFeatures()},ol.control.Timeline.prototype.refresh=function(t,e){if(this.getMap()){t||(t=this.get("zoom")),t=Math.min(this.get("maxZoom"),Math.max(this.get("minZoom"),t||1)),this.set("zoom",t),this._scrollDiv.innerHTML="";var o,i,n=this.getFeatures(),r=this._tline=[];n.forEach(function(t){(o=this._getFeatureDate(t))&&(o instanceof Date||(o=new Date(o)),this._endFeatureDate&&((i=this._endFeatureDate(t))instanceof Date||(i=new Date(i))),isNaN(o)||r.push({date:o,end:isNaN(i)?null:i,feature:t}))}.bind(this)),r.sort((function(t,e){return t.date<e.date?-1:t.date===e.date?0:1}));var a=ol.ext.element.create("DIV",{parent:this._scrollDiv}),s=this._minDate=Math.min(this.get("minDate"),r.length?r[0].date:1/0),l=this._maxDate=Math.max(this.get("maxDate"),r.length?r[r.length-1].date:-1/0);isFinite(s)||(this._minDate=s=new Date),isFinite(l)||(this._maxDate=l=new Date);var c=l-s,h=this.get("maxWidth"),u=this._scale=(c>h?h/c:1)*t;c=(l-(s=this._minDate=this._minDate-10/u))*u,ol.ext.element.setStyle(a,{width:c,maxWidth:"unset"}),this._drawTime(a,s,l,u),this.get("interval")?ol.ext.element.setStyle(this._intervalDiv,{width:this.get("interval")*u}):ol.ext.element.setStyle(this._intervalDiv,{width:""});var p=[],d=ol.ext.element.getStyle(this._scrollDiv,"lineHeight"),f=ol.ext.element.create("DIV",{className:"ol-features",parent:a});r.forEach(function(t){for(var e=t.date,o=t.elt=ol.ext.element.create("DIV",{className:"ol-feature",style:{left:Math.round((e-s)*u)},html:this._getHTML(t.feature),parent:f}),i=o.querySelectorAll("img"),n=0;n<i.length;n++)i[n].ondragstart=function(){return!1};t.end&&ol.ext.element.setStyle(o,{minWidth:(t.end-e)*u,width:(t.end-e)*u,maxWidth:"unset"});var r,a,l=ol.ext.element.getStyle(o,"left");for(o.addEventListener("click",function(){this._moving||this.dispatchEvent({type:"select",feature:t.feature})}.bind(this)),r=0;(a=p[r])&&!(l>a);r++);p[r]=l+ol.ext.element.getStyle(o,"width"),ol.ext.element.setStyle(o,{top:r*d})}.bind(this)),this._nbline=p.length,e&&this.setDate(this._minDate,{anim:!1,position:"start"}),this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}},ol.control.Timeline.prototype._getOffsetFromDate=function(t){return(t-this._minDate)*this._scale},ol.control.Timeline.prototype._getDateFromOffset=function(t){return t/this._scale+this._minDate},ol.control.Timeline.prototype._setScrollLeft=function(t){this._scrollLeft=t,void 0!==t&&(this._scrollDiv.scrollLeft=t)},ol.control.Timeline.prototype._getScrollLeft=function(){return void 0===this._scrollLeft?this._scrollDiv.scrollLeft:this._scrollLeft},ol.control.Timeline.prototype._drawTime=function(t,e,o,i){var n,r,a,s,l=ol.ext.element.create("DIV",{className:"ol-times",parent:t}),c=ol.ext.element.getStyle(l,"left"),h=ol.ext.element.getStyle(l,"height"),u=new Date(this._minDate).getFullYear();r=(new Date(0).setFullYear(String(u))-new Date(0).setFullYear(String(u-1)))*i;for(var p=Math.round(2*h/r)+1;!((n=new Date(0).setFullYear(u))>this._maxDate);)ol.ext.element.create("DIV",{className:"ol-time ol-year",style:{left:this._getOffsetFromDate(n)-c},html:u,parent:l}),u+=p;if(/day|month/.test(this.get("graduation"))&&(r=(new Date(0,0,1).setFullYear(String(u))-new Date(0,0,1).setFullYear(String(u-1)))*i,(s=Math.max(1,Math.round(12/Math.round(r/h/2))))<12))for(u=new Date(this._minDate).getFullYear(),a=s+1;(n=new Date(0,0,1)).setFullYear(u),n.setMonth(a-1),!(n>this._maxDate);)ol.ext.element.create("DIV",{className:"ol-time ol-month",style:{left:this._getOffsetFromDate(n)-c},html:n.toLocaleDateString(void 0,{month:"short"}),parent:l}),(a+=s)>12&&(u++,a=s+1);if("day"===this.get("graduation")){r=(new Date(0,1,1)-new Date(0,0,1))*i;var d=Math.max(1,Math.round(31/Math.round(r/h/2)));if(d<31){u=new Date(this._minDate).getFullYear(),a=0;for(var f=d;;)if((n=new Date(0,0,1)).setFullYear(u),n.setMonth(a),n.setDate(f),isNaN(n))++a>12&&(a=1,u++),f=d;else{if(n>this._maxDate)break;if(f>1){var g=this._getOffsetFromDate(n);this._getOffsetFromDate(new Date(u,a+1,1))-g>h&&ol.ext.element.create("DIV",{className:"ol-time ol-day",style:{left:g-c},html:f,parent:l})}u=n.getFullYear(),a=n.getMonth(),(f=n.getDate()+d)>new Date(u,a+1,0).getDate()&&(a++,f=d)}}}},ol.control.Timeline.prototype.setDate=function(t,e){var o;if(e=e||{},t instanceof Date?o=t:(this.getFeatures().indexOf(t)>=0&&(o=this._getFeatureDate(t)),!o||o instanceof Date||(o=new Date(o)),o&&!isNaN(o)||(o=new Date(String(t)))),!isNaN(o)){!1===e.anim&&this._scrollDiv.classList.add("ol-move");var i=this._getOffsetFromDate(o);if("start"===e.position?i+=ol.ext.element.outerWidth(this._scrollDiv)/2-ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2:"end"===e.position&&(i-=ol.ext.element.outerWidth(this._scrollDiv)/2-ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2),this._setScrollLeft(i),!1===e.anim&&this._scrollDiv.classList.remove("ol-move"),t)for(var n,r=0;n=this._tline[r];r++)n.feature===t?(n.elt.classList.add("ol-select"),this._select=n):n.elt.classList.remove("ol-select")}},ol.control.Timeline.prototype.roundDate=function(t,e){switch(e){case"mn":return new Date(this._roundTo(t,6e4));case"hour":return new Date(this._roundTo(t,36e5));case"day":return new Date(this._roundTo(t,864e5));case"month":return(t=new Date(this._roundTo(t,864e5))).getDate()>15&&(t=new Date(t.setMonth(t.getMonth()+1))),t=t.setDate(1),new Date(t);default:return new Date(t)}},ol.control.Timeline.prototype.getDate=function(t,e){var o;switch(e||(e=t),t){case"start":o=this.get("interval")?-ol.ext.element.getStyle(this._intervalDiv,"width")/2+ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2:-ol.ext.element.outerWidth(this._scrollDiv)/2+ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2;break;case"end":o=this.get("interval")?ol.ext.element.getStyle(this._intervalDiv,"width")/2-ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2:ol.ext.element.outerWidth(this._scrollDiv)/2-ol.ext.element.getStyle(this._scrollDiv,"marginLeft")/2;break;default:o=0}var i=this._getDateFromOffset(this._getScrollLeft()+o);return i=this.roundDate(i,e),new Date(i)},ol.control.Timeline.prototype._roundTo=function(t,e){return Math.round(t/e)*e},ol.control.Timeline.prototype.getStartDate=function(){return new Date(this.get("minDate"))},ol.control.Timeline.prototype.getEndDate=function(){return new Date(this.get("maxDate"))},ol.control.WMSCapabilities=function(t){t=t||{};var e=Object.assign({},t||{});this._proxy=t.proxy,e.target===document.body&&delete e.target,e.target?(e.className=((e.className||"")+" ol-wmscapabilities ol-hidden").trim(),delete e.target):(e.className=((e.className||"")+" ol-wmscapabilities").trim(),e.handleClick=function(){this.showDialog()}.bind(this)),ol.control.Button.call(this,e),this.set("srs",t.srs||[]),this.set("cors",t.cors),this.set("trace",t.trace),this.set("title",t.title),this.set("loadLabel",t.loadLabel),this.createDialog(t);var o=new ol.format.WMSCapabilities;this._ajax=new ol.ext.Ajax({dataType:"text",auth:t.authentication}),this._ajax.on("success",function(t){try{var e=o.read(t.response);this.showCapabilitis(e)}catch(t){this.showError({type:"load",error:t})}}.bind(this)),this._ajax.on("error",function(t){this.showError({type:"load",error:t})}.bind(this)),this._ajax.on("loadstart",function(){this._elements.element.classList.add("ol-searching")}.bind(this)),this._ajax.on("loadend",function(){this._elements.element.classList.remove("ol-searching")}.bind(this))},ol.ext.inherits(ol.control.WMSCapabilities,ol.control.Button),ol.control.WMSCapabilities.prototype.error={load:"Can't retrieve service capabilities, try to add it manually...",badUrl:"The input value is not a valid url...",srs:"The service projection looks different from that of your map, it may not display correctly..."},ol.control.WMSCapabilities.prototype.labels={formTitle:"Title:",formLayer:"Layers:",formMap:"Map:",formFormat:"Format:",formMinZoom:"Min zoom level:",formMaxZoom:"Max zoom level:",formExtent:"Extent:",formProjection:"Projection:",formCrossOrigin:"CrossOrigin:",formVersion:"Version:",formAttribution:"Attribution"},ol.control.WMSCapabilities.prototype.createDialog=function(t){var e=t.target;e&&e!==document.body||(this._dialog=new ol.control.Dialog({className:"ol-wmscapabilities",closeBox:!0,closeOnSubmit:!1,target:t.target}),this._dialog.on("button",function(t){"submit"===t.button&&this.getCapabilities(t.inputs.url.value)}.bind(this)),e=null);var i=ol.ext.element.create("DIV",{className:("ol-wmscapabilities "+(t.className||"")).trim(),parent:e});this._elements={element:e||i};var n=ol.ext.element.create("DIV",{className:"ol-url",parent:i}),r=this._elements.input=ol.ext.element.create("INPUT",{className:"url",placeholder:t.placeholder||"service url...",autocorrect:"off",autocapitalize:"off",parent:n});if(r.addEventListener("keyup",function(e){13===e.keyCode&&this.getCapabilities(r.value,t)}.bind(this)),t.services){var a=ol.ext.element.create("SELECT",{className:"url",on:{change:function(e){var o=e.target.options[e.target.selectedIndex].value;this.getCapabilities(o,t),e.target.selectedIndex=0}.bind(this)},parent:n});for(var s in ol.ext.element.create("OPTION",{html:" ",parent:a}),t.services)ol.ext.element.create("OPTION",{html:s,value:t.services[s],parent:a})}ol.ext.element.create("BUTTON",{click:function(){this.getCapabilities(r.value,t)}.bind(this),html:t.searchLabel||"search",parent:n}),this._elements.error=ol.ext.element.create("DIV",{className:"ol-error",parent:n});var l=this._elements.result=ol.ext.element.create("DIV",{className:"ol-result",parent:i}),c=ol.ext.element.create("DIV",{className:"ol-preview",html:t.previewLabel||"preview",parent:l});this._elements.preview=ol.ext.element.create("IMG",{parent:c}),this._img=new Image,this._img.crossOrigin="Anonymous",this._img.addEventListener("error",function(){c.className="ol-preview tainted"}.bind(this)),this._img.addEventListener("load",function(){c.className="ol-preview ok"}.bind(this));var h=this._elements.select=ol.ext.element.create("SELECT",{className:"ol-select-list",size:t.popupLayer?0:10,on:{change:function(){h.options[h.selectedIndex].click()}.bind(this)},parent:l});this._elements.data=ol.ext.element.create("DIV",{className:"ol-data",parent:l}),this._elements.buttons=ol.ext.element.create("DIV",{className:"ol-buttons",parent:l}),this._elements.legend=ol.ext.element.create("IMG",{className:"ol-legend",parent:l});var u=this._elements.form=ol.ext.element.create("UL",{className:"ol-wmsform",parent:i}),p=function(t,e,i){var n=ol.ext.element.create("li",{parent:u});if(ol.ext.element.create("LABEL",{html:this.labels[t],parent:n}),"boolean"==typeof e)this._elements[t]=ol.ext.element.create("INPUT",{type:"checkbox",checked:e,parent:n});else if(e instanceof Array){var r=this._elements[t]=ol.ext.element.create("SELECT",{parent:n});e.forEach(function(t){ol.ext.element.create("OPTION",{html:t,value:t,parent:r})}.bind(this))}else this._elements[t]=ol.ext.element.create("INPUT",{value:void 0===e?"":e,placeholder:i||"",type:o(e),parent:n})}.bind(this);return p("formTitle"),p("formLayer","","layer1,layer2,..."),p("formMap"),p("formFormat",["image/png","image/jpeg"]),p("formMinZoom",0),p("formMaxZoom",20),p("formExtent","","xmin,ymin,xmax,ymax"),p("formProjection",""),p("formCrossOrigin",!1),p("formVersion","1.3.0"),p("formAttribution",""),ol.ext.element.create("BUTTON",{html:this.get("loadLabel")||"Load",click:function(){var t=parseInt(this._elements.formMinZoom.value),e=parseInt(this._elements.formMaxZoom.value),o=new ol.View({projection:this.getMap().getView().getProjection()});o.setZoom(t);var i=o.getResolution();o.setZoom(e);var n=o.getResolution(),r=[];this._elements.formExtent.value&&this._elements.formExtent.value.split(",").forEach((function(t){r.push(parseFloat(t))})),4!==r.length&&(r=void 0);var a=[];this._elements.formAttribution.value&&a.push(this._elements.formAttribution.value);var s={layer:{title:this._elements.formTitle.value,extent:r,maxResolution:i,minResolution:n},source:{url:this._elements.input.value,crossOrigin:this._elements.formCrossOrigin.checked?"anonymous":null,projection:this._elements.formProjection.value,attributions:a,params:{FORMAT:this._elements.formFormat.options[this._elements.formFormat.selectedIndex].value,LAYERS:this._elements.formLayer.value,VERSION:this._elements.formVersion.value}},data:{title:this._elements.formTitle.value}};this._elements.formMap.value&&(s.source.param.MAP=this._elements.formMap.value);var l=this.getLayerFromOptions(s);this.dispatchEvent({type:"load",layer:l,options:s}),this._dialog.hide()}.bind(this),parent:u}),i},ol.control.WMSCapabilities.prototype.getLayerFromOptions=function(t){t.layer.source=new ol.source.TileWMS(t.source);var e=new ol.layer.Tile(t.layer);return delete t.layer.source,e},ol.control.WMSCapabilities.prototype.setMap=function(t){ol.control.Button.prototype.setMap.call(this,t),this._dialog&&this._dialog.setMap(t)},ol.control.WMSCapabilities.prototype.showDialog=function(t,e){t&&this.showError(),this._elements.formProjection.value||(this._elements.formProjection.value=this.getMap().getView().getProjection().getCode()),this._dialog.show({title:void 0===this.get("title")?"WMS":this.get("title"),content:this._elements.element}),this.getCapabilities(t,e)},ol.control.WMSCapabilities.prototype.getCapabilities=function(t,e){if(t)if(/(https?:\/\/)([\da-z.-]+)\.([a-z]{2,6})([/\w.-]*)*\/?/g.test(t)){e=e||{};var o=(t=t.split("?"))[1];t=t[0],this._elements.formMap.value="",this._elements.formLayer.value="",this._elements.formTitle.value="",this._elements.formProjection.value=this.getMap().getView().getProjection().getCode(),this._elements.formFormat.selectedIndex=0;var i=e.map||"";o&&(o=o.replace(/^\?/,"").split("&")).forEach(function(t){if((t=t.split("="))[1]=decodeURIComponent(t[1]||""),/^map$/i.test(t[0])&&(i=t[1],this._elements.formMap.value=i),/^layers$/i.test(t[0])&&(this._elements.formLayer.value=t[1],this._elements.formTitle.value=t[1].split(",")[0]),/^crs$/i.test(t[0])&&(this._elements.formProjection.value=t[1]),/^format$/i.test(t[0]))for(var e,o=0;e=this._elements.formFormat.options[o];o++)if(e.value===t[1]){this._elements.formFormat.selectedIndex=o;break}}.bind(this)),this._elements.input.value=(t||"")+(i?"?map="+i:""),this.clearForm();var n={SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:e.version||"1.3.0"};if(i&&(n.MAP=i),this._proxy){var r="";for(var a in n)r+=(r?"&":"")+a+"="+n[a];this._ajax.send(this._proxy,{url:r},{timeout:e.timeout||1e4})}else this._ajax.send(t,n,{timeout:e.timeout||1e4})}else this.showError({type:"badUrl"})},ol.control.WMSCapabilities.prototype.showError=function(t){this._elements.error.innerHTML=t?this.error[t.type]||"ERROR ("+t.type+")":"",t&&"load"===t.type?this._elements.form.classList.add("visible"):this._elements.form.classList.remove("visible")},ol.control.WMSCapabilities.prototype.clearForm=function(){this._elements.result.classList.remove("ol-visible"),this.showError(),this._elements.select.innerHTML="",this._elements.data.innerHTML="",this._elements.preview.src="",this._elements.legend.src="",this._elements.legend.classList.remove("visible")},ol.control.WMSCapabilities.prototype.showCapabilitis=function(t){var e=this;this._elements.result.classList.add("ol-visible");var o=[],i=function(e,n){n=n||0,e.Layer.forEach(function(r){r.Attribution||(r.Attribution=e.Attribution),r.EX_GeographicBoundingBox||(r.EX_GeographicBoundingBox=e.EX_GeographicBoundingBox);var a=ol.ext.element.create("OPTION",{className:(r.Layer?"ol-title ":"")+"level-"+n,html:r.Name||r.Title,click:function(e){if(!e.isTrusted){var i=this.getOptionsFromCap(r,t),n=this.getLayerFromOptions(i);o.forEach((function(t){t.classList.remove("selected")})),a.classList.add("selected"),this._elements.buttons.innerHTML="",ol.ext.element.create("BUTTON",{html:this.get("loadLabel")||"Load",click:function(){this.dispatchEvent({type:"load",layer:n,options:i}),this._dialog&&this._dialog.hide()}.bind(this),parent:this._elements.buttons}),ol.ext.element.create("BUTTON",{html:"+",className:"ol-wmsform",click:function(){this._elements.form.classList.toggle("visible"),this._elements.legend.classList.toggle("visible")}.bind(this),parent:this._elements.buttons});var s=this.getMap().getView().getResolution(),l=this.getMap().getView().getCenter();this._elements.preview.src=n.getPreview(l,s,this.getMap().getView().getProjection()),this._img.src=this._elements.preview.src,this._elements.data.innerHTML="",ol.ext.element.create("p",{className:"ol-title",html:i.data.title,parent:this._elements.data}),ol.ext.element.create("p",{html:i.data.abstract,parent:this._elements.data}),i.data.legend.length?(this._elements.legend.src=i.data.legend[0],this._elements.legend.classList.add("visible")):(this._elements.legend.src="",this._elements.legend.classList.remove("visible"))}}.bind(this),parent:this._elements.select});o.push(a),r.Layer&&i(r,n+1)}.bind(this))}.bind(this);this._elements.select.innerHTML="",ol.ext.element.create("OPTION",{html:"layer...",className:"ol-info",parent:this._elements.select,click:function(){e._elements.buttons.innerHTML="",e._elements.data.innerHTML="",e._elements.legend.src="",e._elements.legend.classList.remove("visible"),e._elements.preview.src=""}}),i(t.Capability.Layer)},ol.control.WMSCapabilities.prototype.getLayerResolution=function(t,e,o){var i="min"===t?"MinScaleDenominator":"MaxScaleDenominator";if(void 0!==e[i])return e[i]/(72/2.54*100);if(!e.Layer)return"min"===t?0:156543.03392804097;o="min"===t?156543.03392804097:0;for(var n=0;n<e.Layer.length;n++){var r=this.getLayerResolution(t,e.Layer[n],o);void 0!==r&&(o=Math[t](o,r))}return o},ol.control.WMSCapabilities.prototype.getOptionsFromCap=function(t,e){var o,i,n=e.Capability.Request.GetMap.Format,r=[/png/,/jpeg/,/gif/];for(i=0;i<3;i++){for(var a=0;a<n.length;a++)if(r[i].test(n[a])){o=n[a];break}if(o)break}o||(o=n[0]);var s=this.getMap().getView().getProjection().getCode();this.showError();var l=!1;t.CRS?t.CRS.indexOf(s)>=0?l=!0:t.CRS.indexOf("EPSG:4326")>=0?(s="EPSG:4326",l=!0):this.get("srs").forEach((function(e){t.CRS.indexOf(e)>=0&&(s=e,l=!0)})):l=!1,l||(this.showError({type:"srs"}),this.get("trace")&&console.log("BAD srs: ",t.CRS));var c=t.EX_GeographicBoundingBox;c&&(c=ol.proj.transformExtent(c,"EPSG:4326",this.getMap().getView().getProjection()));var h=[];t.Attribution&&h.push('<a href="'+encodeURI(t.Attribution.OnlineResource)+'">&copy; '+t.Attribution.Title.replace(/</g,"&lt;")+"</a>");var u,p={title:t.Title,extent:c,queryable:t.queryable,abstract:t.Abstract,minResolution:this.getLayerResolution("min",t),maxResolution:this.getLayerResolution("max",t)||156543.03392804097},d={url:e.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,projection:s,attributions:h,crossOrigin:this.get("cors")?"anonymous":null,params:{LAYERS:t.Name,FORMAT:o,VERSION:e.version||"1.3.0"}};for(this._elements.formTitle.value=p.title,this._elements.formLayer.value=d.params.LAYERS,i=0;u=this._elements.formFormat.options[i];i++)if(u.value===d.params.FORMAT){this._elements.formFormat.selectedIndex=i;break}var f=new ol.View({projection:this.getMap().getView().getProjection()});if(f.setResolution(p.minResolution),this._elements.formMaxZoom.value=Math.round(f.getZoom()),f.setResolution(p.maxResolution),this._elements.formMinZoom.value=Math.round(f.getZoom()),this._elements.formExtent.value=c?c.join(","):"",this._elements.formProjection.value=d.projection,this._elements.formAttribution.value=d.attributions[0]||"",this.get("trace")){var g=JSON.stringify([d],null,"\t").replace(/\\"/g,'"');p.source="new ol.source.TileWMS("+g+")";var m="new ol.layer.Tile ("+JSON.stringify(p,null,"\t")+")";m=m.replace(/\\"/g,'"').replace(/"new/g,"new").replace(/\)"/g,")").replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace("([\n\t","(").replace("}\n])","})"),console.log(m),delete p.source}var y=[];return t.Style&&t.Style.forEach((function(t){t.LegendURL&&y.push(t.LegendURL[0].OnlineResource)})),{layer:p,source:d,data:{title:t.Title,abstract:t.Abstract,logo:t.Attribution&&t.Attribution.LogoURL?t.Attribution.LogoURL.OnlineResource:void 0,keyword:t.KeywordList,legend:y,opaque:t.opaque,queryable:t.queryable}}},ol.featureAnimation=function(t){t=t||{},this.duration_="number"==typeof t.duration?t.duration>=0?t.duration:0:1e3,this.fade_="function"==typeof t.fade?t.fade:null,this.repeat_=Number(t.repeat);var e="function"==typeof t.easing?t.easing:ol.easing.linear;t.revers?this.easing_=function(t){return 1-e(t)}:this.easing_=e,this.hiddenStyle=t.hiddenStyle,ol.Object.call(this)},ol.ext.inherits(ol.featureAnimation,ol.Object),ol.featureAnimation.hiddenStyle=new ol.style.Style({image:new ol.style.Circle({}),stroke:new ol.style.Stroke({color:"transparent"})}),ol.featureAnimation.prototype.drawGeom_=function(t,e,o){this.fade_&&(t.context.globalAlpha=this.fade_(1-t.elapsed));for(var i=t.style,n=0;n<i.length;n++)try{var r=t.vectorContext||ol.render.getVectorContext(t);r.setStyle(i[n]),i[n].getZIndex()<0?r.drawGeometry(o||e):r.drawGeometry(e)}catch(t){}},ol.featureAnimation.prototype.animate=function(){return!1},ol.Map.prototype.animateFeature=function(t,e){var o=this._featureAnimationLayer;o||(o=this._featureAnimationLayer=new ol.layer.Vector({source:new ol.source.Vector})).setMap(this),o.getSource().addFeature(t);var i=e.on("animationend",(function(e){e.feature===t&&(o.getSource().removeFeature(t),ol.Observable.unByKey(i))}));o.animateFeature(t,e)},ol.layer.Base.prototype.animateFeature=function(t,e,o){var i,n=this,r=t.getStyle(),a=r||(this.getStyleFunction?this.getStyleFunction()(t):null);a||(a=[]),a instanceof Array||(a=[a]);var s={vectorContext:null,frameState:null,start:0,time:0,elapsed:0,extent:!1,feature:t,geom:t.getGeometry(),typeGeom:t.getGeometry().getType(),bbox:t.getGeometry().getExtent(),coord:ol.extent.getCenter(t.getGeometry().getExtent()),style:a};e instanceof Array||(e=[e]);for(var l=e.length-1;l>=0;l--)0===e[l].duration_&&e.splice(l,1);var c=0,h=0,u=o&&this.getFilters?this.getFilters():[];function p(o){s.type=o.type;try{s.vectorContext=o.vectorContext||ol.render.getVectorContext(o)}catch(o){}if(s.frameState=o.frameState,s.inversePixelTransform=o.inversePixelTransform,s.extent||(s.extent=o.frameState.extent,s.start=o.frameState.time,s.context=o.context),s.time=o.frameState.time-s.start,s.elapsed=s.time/e[h].duration_,s.elapsed>1&&(s.elapsed=1),o.context.save(),u.forEach((function(t){t.get("active")&&t.precompose(o)})),this.getOpacity&&(o.context.globalAlpha=this.getOpacity()),e[h].animate(s)){var i={type:"animating",step:h,start:s.start,time:s.time,elapsed:s.elapsed,rotation:s.rotation||0,geom:s.geom,coordinate:s.coord,feature:t};e[h].dispatchEvent(i),n.dispatchEvent(i)}else++c<e[h].repeat_?s.extent=!1:h<e.length-1?(e[h].dispatchEvent({type:"animationend",feature:t}),h++,c=0,s.extent=!1):d();u.forEach((function(t){t.get("active")&&t.postcompose(o)})),o.context.restore(),o.frameState.animate=!0}function d(o){ol.Observable.unByKey(i),i=null,t.setStyle(r);var a={type:"animationend",feature:t};if(o)for(var s in o)o.hasOwnProperty(s)&&(a[s]=o[s]);e[h].dispatchEvent(a),n.dispatchEvent(a)}function f(o){if(e.length&&!i){i=n.on(["postcompose","postrender"],p.bind(n)),n.renderSync?n.renderSync():n.changed(),t.setStyle(e[h].hiddenStyle||ol.featureAnimation.hiddenStyle);var r={type:"animationstart",feature:t};if(o)for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);e[h].dispatchEvent(r),n.dispatchEvent(r)}}return f(),{start:f,stop:d,isPlaying:function(){return!!i}}},ol.featureAnimation.Blink=function(t){ol.featureAnimation.call(this,t),this.set("nb",t.nb||10)},ol.ext.inherits(ol.featureAnimation.Blink,ol.featureAnimation),ol.featureAnimation.Blink.prototype.animate=function(t){return Math.round(this.easing_(t.elapsed)*this.get("nb"))%2||this.drawGeom_(t,t.geom),t.time<=this.duration_},ol.featureAnimation.Bounce=function(t){t=t||{},ol.featureAnimation.call(this,t),this.amplitude_=t.amplitude||40,this.bounce_=-Math.PI*(t.bounce||3)},ol.ext.inherits(ol.featureAnimation.Bounce,ol.featureAnimation),ol.featureAnimation.Bounce.prototype.animate=function(t){var e=t.geom.clone(),o=Math.abs(Math.sin(this.bounce_*t.elapsed))*this.amplitude_*(1-this.easing_(t.elapsed))*t.frameState.viewState.resolution;return e.translate(0,o),this.drawGeom_(t,e,t.geom),t.time<=this.duration_},ol.featureAnimation.Drop=function(t){t=t||{},this.speed_=t.speed||0,ol.featureAnimation.call(this,t),this.side_=t.side||"top"},ol.ext.inherits(ol.featureAnimation.Drop,ol.featureAnimation),ol.featureAnimation.Drop.prototype.animate=function(t){if(!t.time){var e=t.frameState.viewState.rotation,o=t.frameState.size[1]*t.frameState.viewState.resolution;"top"!=this.side_&&(o*=-1),this.dx=-Math.sin(e)*o,this.dy=Math.cos(e)*o,this.speed_&&(this.duration_=o/this.speed_/t.frameState.viewState.resolution)}var i=t.geom.clone();return i.translate(this.dx*(1-this.easing_(t.elapsed)),this.dy*(1-this.easing_(t.elapsed))),this.drawGeom_(t,i,t.geom),t.time<=this.duration_},ol.featureAnimation.Fade=function(t){t=t||{},this.speed_=t.speed||0,ol.featureAnimation.call(this,t)},ol.ext.inherits(ol.featureAnimation.Fade,ol.featureAnimation),ol.featureAnimation.Fade.prototype.animate=function(t){return t.context.globalAlpha=this.easing_(t.elapsed),this.drawGeom_(t,t.geom),t.time<=this.duration_},ol.featureAnimation.None=function(t){ol.featureAnimation.call(this,t)},ol.ext.inherits(ol.featureAnimation.None,ol.featureAnimation),ol.featureAnimation.None.prototype.animate=function(t){return t.time<=this.duration_},ol.featureAnimation.Null=function(){ol.featureAnimation.call(this,{duration:0})},ol.ext.inherits(ol.featureAnimation.Null,ol.featureAnimation),ol.featureAnimation.Path=function(t){switch(t=t||{},ol.featureAnimation.call(this,t),this.speed_=t.speed||0,this.path_=t.path,t.rotate){case!0:case 0:this.rotate_=0;break;default:this.rotate_=t.rotate||!1}this.path_&&this.path_.getGeometry&&(this.path_=this.path_.getGeometry()),this.path_&&this.path_.getLineString&&(this.path_=this.path_.getLineString()),this.path_.getLength?(this.dist_=this.path_.getLength(),this.path_&&this.path_.getCoordinates&&(this.path_=this.path_.getCoordinates())):this.dist_=0,this.speed_>0&&(this.duration_=this.dist_/this.speed_)},ol.ext.inherits(ol.featureAnimation.Path,ol.featureAnimation),ol.featureAnimation.Path.prototype.animate=function(t){if(!t.time&&!this.dist_)return!1;var e,o,i,n,r,a,s=this.dist_*this.easing_(t.elapsed),l=0;o=this.path_[0];for(var c=1;c<this.path_.length;c++){if(e=o,n=(o=this.path_[c])[0]-e[0],r=o[1]-e[1],(a=Math.sqrt(n*n+r*r))&&l+a>=s){i=(s-l)/a,o=[e[0]+(o[0]-e[0])*i,e[1]+(o[1]-e[1])*i];break}l+=a}var h=t.style;if(t.rotation=Math.PI/2+Math.atan2(e[1]-o[1],e[0]-o[0]),!1!==this.rotate_){var u=[],p=this.rotate_-t.rotation+t.frameState.viewState.rotation;t.rotation=Math.PI/2+Math.atan2(e[1]-o[1],e[0]-o[0]);for(var d=0;i=t.style[d];d++)i.getImage()&&i.getImage().setRotation(p),u.push(i);t.style=u}return t.geom.setCoordinates(o),this.drawGeom_(t,t.geom),t.style=h,t.time<=this.duration_},ol.featureAnimation.Shake=function(t){t=t||{},ol.featureAnimation.call(this,t),this.amplitude_=t.amplitude||40,this.bounce_=-Math.PI*(t.bounce||6),this.horizontal_=t.horizontal},ol.ext.inherits(ol.featureAnimation.Shake,ol.featureAnimation),ol.featureAnimation.Shake.prototype.animate=function(t){var e=t.geom.clone(),o=t.geom.clone(),i=this.easing_(t.elapsed);return i=Math.sin(this.bounce_*i)*this.amplitude_*(1-i)*t.frameState.viewState.resolution,this.horizontal_?(e.translate(i,0),o.translate(i,0)):e.translate(0,i),this.drawGeom_(t,e,o),t.time<=this.duration_},ol.featureAnimation.Show=function(t){ol.featureAnimation.call(this,t)},ol.ext.inherits(ol.featureAnimation.Show,ol.featureAnimation),ol.featureAnimation.Show.prototype.animate=function(t){return this.drawGeom_(t,t.geom),t.time<=this.duration_},ol.featureAnimation.Slide=function(t){t=t||{},this.speed_=t.speed||0,ol.featureAnimation.call(this,t),this.side_=t.side||"left"},ol.ext.inherits(ol.featureAnimation.Slide,ol.featureAnimation),ol.featureAnimation.Slide.prototype.animate=function(t){t.time||("left"==this.side_?this.dx=t.extent[0]-t.bbox[2]:this.dx=t.extent[2]-t.bbox[0],this.speed_&&(this.duration_=Math.abs(this.dx)/this.speed_/t.frameState.viewState.resolution));var e=t.geom.clone();return e.translate(this.dx*(1-this.easing_(t.elapsed)),0),this.drawGeom_(t,e),t.time<=this.duration_},ol.featureAnimation.Teleport=function(t){ol.featureAnimation.call(this,t)},ol.ext.inherits(ol.featureAnimation.Teleport,ol.featureAnimation),ol.featureAnimation.Teleport.prototype.animate=function(t){var e=this.easing_(t.elapsed);if(e){t.context.save();var o=t.frameState.pixelRatio;t.context.globalAlpha=e,t.context.scale(e,1/e);var i=t.frameState.coordinateToPixelTransform,n=(1/e-1)*o*(i[0]*t.coord[0]+i[1]*t.coord[1]+i[4]),r=(e-1)*o*(i[2]*t.coord[0]+i[3]*t.coord[1]+i[5]);t.context.translate(n,r),this.drawGeom_(t,t.geom),t.context.restore()}return t.time<=this.duration_},ol.featureAnimation.Throw=function(t){t=t||{},ol.featureAnimation.call(this,t),this.speed_=t.speed||0,this.side_=t.side||"left"},ol.ext.inherits(ol.featureAnimation.Throw,ol.featureAnimation),ol.featureAnimation.Throw.prototype.animate=function(t){var e,o;!t.time&&this.speed_&&("left"==this.side_?(e=this.dx=t.extent[0]-t.bbox[2],o=this.dy=t.extent[3]-t.bbox[1]):(e=this.dx=t.extent[2]-t.bbox[0],o=this.dy=t.extent[3]-t.bbox[1]),this.duration_=Math.sqrt(e*e+o*o)/this.speed_/t.frameState.viewState.resolution);var i=t.geom.clone(),n=t.geom.clone();return i.translate(this.dx*(1-this.easing_(t.elapsed)),this.dy*Math.cos(Math.PI/2*this.easing_(t.elapsed))),n.translate(this.dx*(1-this.easing_(t.elapsed)),0),this.drawGeom_(t,i,n),t.time<=this.duration_},ol.featureAnimation.Zoom=function(t){t=t||{},ol.featureAnimation.call(this,t),this.set("zoomout",t.zoomOut)},ol.ext.inherits(ol.featureAnimation.Zoom,ol.featureAnimation),ol.featureAnimation.ZoomOut=function(t){(t=t||{}).zoomOut=!0,ol.featureAnimation.Zoom.call(this,t)},ol.ext.inherits(ol.featureAnimation.ZoomOut,ol.featureAnimation.Zoom),ol.featureAnimation.Zoom.prototype.animate=function(t){var e=this.easing_(t.elapsed);if(e){this.get("zoomout")&&(e=1/e);var o,i,n=t.style,r=[];for(o=0;o<n.length;o++)(i=n[o].getImage())&&(r[o]=i.getScale(),"postrender"===t.type?i.setScale(r[o]*e/t.frameState.pixelRatio):i.setScale(r[o]*e));for(this.drawGeom_(t,t.geom),o=0;o<n.length;o++)(i=n[o].getImage())&&i.setScale(r[o])}return t.time<=this.duration_},ol.filter={},ol.filter.Base=function(t){ol.Object.call(this),this._listener=[],t&&!1===t.active?this.set("active",!1):this.set("active",!0)},ol.ext.inherits(ol.filter.Base,ol.Object),ol.filter.Base.prototype.setActive=function(t){this.set("active",!0===t)},ol.filter.Base.prototype.getActive=function(){return this.get("active")},function(){function t(t){this.get("active")&&t.context&&this.precompose(t)}function e(t){this.get("active")&&t.context&&this.postcompose(t)}function o(){this.renderSync?this.renderSync():this.changed()}function i(i){this.filters_||(this.filters_=[]),this.filters_.push(i),i.precompose&&i._listener.push({listener:this.on(["precompose","prerender"],t.bind(i)),target:this}),i.postcompose&&i._listener.push({listener:this.on(["postcompose","postrender"],e.bind(i)),target:this}),i._listener.push({listener:i.on("propertychange",o.bind(this)),target:this}),o.call(this)}function n(t){var e;for(this.filters_||(this.filters_=[]),e=this.filters_.length-1;e>=0;e--)this.filters_[e]===t&&this.filters_.splice(e,1);for(e=t._listener.length-1;e>=0;e--)t._listener[e].target===this&&(ol.Observable.unByKey(t._listener[e].listener),t._listener.splice(e,1));o.call(this)}ol.Map.prototype.addFilter=function(t){console.warn("[OL-EXT] addFilter deprecated on map."),i.call(this,t)},ol.Map.prototype.removeFilter=function(t){n.call(this,t)},ol.Map.prototype.getFilters=function(){return this.filters_||[]},ol.layer.Base.prototype.addFilter=function(t){i.call(this,t)},ol.layer.Base.prototype.removeFilter=function(t){n.call(this,t)},ol.layer.Base.prototype.getFilters=function(){return this.filters_||[]}}(),ol.filter.Mask=function(t){if(t=t||{},ol.filter.Base.call(this,t),t.feature)switch(t.feature.getGeometry().getType()){case"Polygon":case"MultiPolygon":this.feature_=t.feature}this.set("inner",t.inner),this.fillColor_=t.fill&&ol.color.asString(t.fill.getColor())||"rgba(0,0,0,0.2)"},ol.ext.inherits(ol.filter.Mask,ol.filter.Base),ol.filter.Mask.prototype.drawFeaturePath_=function(t,e){var o,i=t.context,n=i.canvas,r=t.frameState.pixelRatio;if(t.frameState.coordinateToPixelTransform){var a=t.frameState.coordinateToPixelTransform;if(t.inversePixelTransform){var s=t.inversePixelTransform;o=function(t){return[(t=[t[0]*a[0]+t[1]*a[1]+a[4],t[0]*a[2]+t[1]*a[3]+a[5]])[0]*s[0]-t[1]*s[1]+s[4],-t[0]*s[2]+t[1]*s[3]+s[5]]}}else o=function(t){return[(t[0]*a[0]+t[1]*a[1]+a[4])*r,(t[0]*a[2]+t[1]*a[3]+a[5])*r]}}else a=t.frameState.coordinateToPixelMatrix,o=function(t){return[(t[0]*a[0]+t[1]*a[1]+a[12])*r,(t[0]*a[4]+t[1]*a[5]+a[13])*r]};var l=this.feature_.getGeometry().getCoordinates();"Polygon"==this.feature_.getGeometry().getType()&&(l=[l]),i.beginPath(),e&&(i.moveTo(0,0),i.lineTo(n.width,0),i.lineTo(n.width,n.height),i.lineTo(0,n.height),i.lineTo(0,0));for(var c=0;c<l.length;c++)for(var h=l[c],u=0;u<h.length;u++){var p=o(h[u][0]);i.moveTo(p[0],p[1]);for(var d=1;d<h[u].length;d++)p=o(h[u][d]),i.lineTo(p[0],p[1])}},ol.filter.Mask.prototype.postcompose=function(t){if(this.feature_){var e=t.context;e.save(),this.drawFeaturePath_(t,!this.get("inner")),e.fillStyle=this.fillColor_,e.fill("evenodd"),e.restore()}},ol.filter.CanvasFilter=function(t){ol.filter.Base.call(this,t),this._svg={}},ol.ext.inherits(ol.filter.CanvasFilter,ol.filter.Base),ol.filter.CanvasFilter.prototype.addSVGFilter=function(t){t.getId&&(t="#"+t.getId()),this._svg[t]=1,this.dispatchEvent({type:"propertychange",key:"svg",oldValue:this._svg})},ol.filter.CanvasFilter.prototype.removeSVGFilter=function(t){t.getId&&(t="#"+t.getId()),delete this._svg[t],this.dispatchEvent({type:"propertychange",key:"svg",oldValue:this._svg})},ol.filter.CanvasFilter.prototype.precompose=function(){},ol.filter.CanvasFilter.prototype.postcompose=function(t){var e=[];for(var o in void 0!==this.get("url")&&e.push("url("+this.get("url")+")"),this._svg)e.push("url("+o+")");void 0!==this.get("blur")&&e.push("blur("+this.get("blur")+"px)"),void 0!==this.get("brightness")&&e.push("brightness("+this.get("brightness")+"%)"),void 0!==this.get("contrast")&&e.push("contrast("+this.get("contrast")+"%)"),void 0!==this.get("shadow")&&e.push("drop-shadow("+this.get("shadow")[0]+"px "+this.get("shadow")[1]+"px "+(this.get("shadowBlur")||0)+"px "+this.get("shadowColor")+")"),void 0!==this.get("grayscale")&&e.push("grayscale("+this.get("grayscale")+"%)"),void 0!==this.get("hueRotate")&&e.push("hue-rotate("+this.get("hueRotate")+"deg)"),void 0!==this.get("invert")&&e.push("invert("+this.get("invert")+"%)"),void 0!==this.get("saturate")&&e.push("saturate("+this.get("saturate")+"%)"),void 0!==this.get("sepia")&&e.push("sepia("+this.get("sepia")+"%)"),(e=e.join(" "))&&(t.context.save(),t.context.filter=e,t.context.drawImage(t.context.canvas,0,0),t.context.restore())},ol.filter.Clip=function(t){if(t=t||{},ol.filter.Base.call(this,t),this.set("coords",t.coords),this.set("units",t.units),this.set("keepAspectRatio",t.keepAspectRatio),this.set("extent",t.extent||[0,0,1,1]),this.set("color",t.color),!t.extent&&"%"!=t.units&&t.coords){for(var e,o=1/0,i=1/0,n=-1/0,r=-1/0,a=0;e=t.coords[a];a++)o>e[0]&&(o=e[0]),n<e[0]&&(n=e[0]),i>e[1]&&(i=e[1]),r<e[1]&&(r=e[1]);t.extent=[o,i,n,r]}},ol.ext.inherits(ol.filter.Clip,ol.filter.Base),ol.filter.Clip.prototype.clipPath_=function(t){var e=t.context,o=t.frameState.size,i=this.get("coords");if(i){var n=this.get("extent"),r=1,a=1;"%"==this.get("units")&&(r=o[0]/(n[2]-n[0]),a=o[1]/(n[3]-n[1])),this.get("keepAspectRatio")&&(r=a=Math.min(r,a));var s=this.get("position"),l=0,c=0;/left/.test(s)?l=-n[0]*r:/center/.test(s)?l=o[0]/2-(n[2]-n[0])*r/2:/right/.test(s)&&(l=o[0]-(n[2]-n[0])*r);var h=function(t){return t*r+l};/top/.test(s)?c=-n[1]*a:/middle/.test(s)?c=o[1]/2-(n[3]-n[1])*a/2:/bottom/.test(s)&&(c=o[1]-(n[3]-n[1])*a);var u=function(t){return t*a+c},p=[h(i[0][0]),u(i[0][1])],d=t.inversePixelTransform;d&&(p=[p[0]*d[0]-p[1]*d[1]+d[4],-p[0]*d[2]+p[1]*d[3]+d[5]]),e.moveTo(p[0],p[1]);for(var f,g=1;f=i[g];g++)p=[h(f[0]),u(f[1])],d&&(p=[p[0]*d[0]-p[1]*d[1]+d[4],-p[0]*d[2]+p[1]*d[3]+d[5]]),e.lineTo(p[0],p[1]);p=[h(i[0][0]),u(i[0][1])],d&&(p=[p[0]*d[0]-p[1]*d[1]+d[4],-p[0]*d[2]+p[1]*d[3]+d[5]]),e.moveTo(p[0],p[1])}},ol.filter.Clip.prototype.precompose=function(t){this.get("color")||(t.context.save(),t.context.beginPath(),this.clipPath_(t),t.context.clip())},ol.filter.Clip.prototype.postcompose=function(t){if(this.get("color")){var e=t.context,o=t.context.canvas;e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,o.height),e.lineTo(o.width,o.height),e.lineTo(o.width,o.height),e.lineTo(o.width,0),e.lineTo(0,0),this.clipPath_(t),e.fillStyle=this.get("color"),e.fill("evenodd")}t.context.restore()},ol.filter.Colorize=function(t){ol.filter.Base.call(this,t),this.setFilter(t)},ol.ext.inherits(ol.filter.Colorize,ol.filter.Base),ol.filter.Colorize.prototype.setFilter=function(t){switch(t=t||{}){case"grayscale":t={operation:"hue",color:[0,0,0],value:1};break;case"invert":t={operation:"difference",color:[255,255,255],value:1};break;case"sepia":t={operation:"color",color:[153,102,51],value:.6}}var e,o=t.color?ol.color.asArray(t.color):[t.red,t.green,t.blue,t.value];switch(this.set("color",ol.color.asString(o)),this.set("value",t.value||1),t.operation){case"color":case"hue":case"difference":case"color-dodge":case"enhance":this.set("operation",t.operation);break;case"saturation":e=255*(t.value||0),this.set("color",ol.color.asString([0,0,e,e||1])),this.set("operation",t.operation);break;case"luminosity":e=255*(t.value||0),this.set("color",ol.color.asString([e,e,e,255])),this.set("operation","hard-light");break;case"contrast":e=255*(t.value||0),this.set("color",ol.color.asString([e,e,e,255])),this.set("operation","soft-light");break;default:this.set("operation","color")}},ol.filter.Colorize.prototype.setValue=function(t){this.set("value",t);var e=ol.color.asArray(this.get("color"));e[3]=t,this.set("color",ol.color.asString(e))},ol.filter.Colorize.prototype.setColor=function(t){(t=ol.color.asArray(t))&&(t[3]=this.get("value"),this.set("color",ol.color.asString(t)))},ol.filter.Colorize.prototype.precompose=function(){},ol.filter.Colorize.prototype.postcompose=function(t){var e=t.context,o=e.canvas;if(e.save(),"enhance"==this.get("operation")){var i=this.get("value");if(i){var n=o.width,r=o.height;e.globalCompositeOperation="color-burn",e.globalAlpha=i,e.drawImage(o,0,0,n,r),e.drawImage(o,0,0,n,r),e.drawImage(o,0,0,n,r)}}else e.globalCompositeOperation=this.get("operation"),e.fillStyle=this.get("color"),e.fillRect(0,0,o.width,o.height);e.restore()},ol.filter.Composite=function(t){ol.filter.Base.call(this,t),this.set("operation",t.operation||"source-over")},ol.ext.inherits(ol.filter.Composite,ol.filter.Base),ol.filter.Composite.prototype.setOperation=function(t){this.set("operation",t||"source-over")},ol.filter.Composite.prototype.precompose=function(t){var e=t.context;e.save(),e.globalCompositeOperation=this.get("operation")},ol.filter.Composite.prototype.postcompose=function(t){t.context.restore()},ol.filter.Crop=function(t){t=t||{},ol.filter.Mask.call(this,t)},ol.ext.inherits(ol.filter.Crop,ol.filter.Mask),ol.filter.Crop.prototype.precompose=function(t){if(this.feature_){var e=t.context;e.save(),this.drawFeaturePath_(t,this.get("inner")),e.clip("evenodd")}},ol.filter.Crop.prototype.postcompose=function(t){this.feature_&&t.context.restore()},ol.filter.Fold=function(t){t=t||{},ol.filter.Base.call(this,t),this.set("fold",t.fold||[8,4]),this.set("margin",t.margin||8),this.set("padding",t.padding||8),"number"==typeof t.fsize&&(t.fsize=[t.fsize,t.fsize]),this.set("fsize",t.fsize||[8,10]),this.set("fill",t.fill),this.set("shadow",!1!==t.shadow)},ol.ext.inherits(ol.filter.Fold,ol.filter.Base),ol.filter.Fold.prototype.drawLine_=function(t,e,o){var i,n,r,a=t.canvas,s=this.get("fold"),l=a.width,c=a.height;for(t.beginPath(),t.moveTo(o,o),r=1;r<=s[0];r++)i=r*l/s[0]-(r==s[0]?o:0),n=e[1]*(r%2)+o,t.lineTo(i,n);for(r=1;r<=s[1];r++)i=l-e[0]*(r%2)-o,n=r*c/s[1]-(r==s[1]?e[0]*(s[0]%2)+o:0),t.lineTo(i,n);for(r=s[0];r>0;r--)i=r*l/s[0]-(r==s[0]?e[0]*(s[1]%2)+o:0),n=c-e[1]*(r%2)-o,t.lineTo(i,n);for(r=s[1];r>0;r--)i=e[0]*(r%2)+o,n=r*c/s[1]-(r==s[1]?o:0),t.lineTo(i,n);t.closePath()},ol.filter.Fold.prototype.precompose=function(t){var e=t.context;e.save(),e.shadowColor="rgba(0,0,0,0.3)",e.shadowBlur=8,e.shadowOffsetX=2,e.shadowOffsetY=3,this.drawLine_(e,this.get("fsize"),this.get("margin")),e.fillStyle="#fff",this.get("fill")&&e.fill(),e.strokeStyle="rgba(0,0,0,0.1)",e.stroke(),e.restore(),e.save(),this.drawLine_(e,this.get("fsize"),this.get("margin")+this.get("padding")),e.clip()},ol.filter.Fold.prototype.postcompose=function(t){var e=t.context,o=e.canvas;if(e.restore(),e.save(),this.drawLine_(e,this.get("fsize"),this.get("margin")),e.clip(),this.get("shadow")){var i=this.get("fold"),n=o.width/i[0],r=o.height/i[1],a=e.createRadialGradient(5*n/8,5*n/8,n/4,n/2,n/2,n);a.addColorStop(0,"transparent"),a.addColorStop(1,"rgba(0,0,0,0.2)"),e.fillStyle=a,e.scale(1,r/n);for(var s=0;s<i[0];s++)for(var l=0;l<i[1];l++)e.save(),e.translate(s*n,l*n),e.fillRect(0,0,n,n),e.restore()}e.restore()},ol.filter.Lego=function(t){t||(t={}),ol.filter.Base.call(this,t);var e=new Image;e.src=this.img[t.img]||this.img.ol3,e.crossOrigin=t.crossOrigin||null,this.pattern={canvas:document.createElement("canvas")},this.setBrick(t.brickSize,e),this.internal_=document.createElement("canvas")},ol.ext.inherits(ol.filter.Lego,ol.filter.Base),ol.filter.Lego.prototype.img={brick:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAAAnNCSVQICFXsRgQAAAAJcEhZcwAAD10AAA9dAah0GUAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAGAElEQVRo3sWZy4tkVx3HP+fcc29Vd1dP17TdTcbJPDKPMGR0kVEZkuBCF0EE9Z8QXLhxMUsRF4oLwYWQTSCgSxUXroQhoiEuskgEUUQh+BhHOpkZO11dr3vvefxc3FPlNHNvPbrD1Dl016XoqvM539/znFbcZo3VjbFmxcMA3Mg2fSoAiQJDov7/B1o9+aEgkycv4PBSPU9eHeDEixNwOAFXPYvFia0+rcnQEeBr218cfLIwCqW1UWillEYphUKpCmCCIQAiCEhAJIggTiSISBAfggTvJZTifQghWO+89cOQexuOXN8Pwz/9ff9X/xF0uEA7AmTsjLp/2xZQCgXHlj0OEBEAeRwGkep3qN6pfibDB3DBixMnvdCXt8J3FZowNYFSjgv71RtPaehjD0alalVOqCtHU3qlAGrVAGbidCtUYLUAiV6dCUx8XV4BhUKjY0AJgUB4LE8sA7CkCRSalFYnE72WiBrLSCKCp6TALZNRDEDCwgAKQ/vyRidN9c32K1sbqlCP/C+P9kXJI597PA7HkGJRCLNUGCY767udF9e+9dz1S5ueoRzIEZa1OxcK9td+/fAHvYH0LY6MkgHFIuYwS0ifXe1+qXvn1vk99QfzCwokToUylPrre1/de/vMnf9+5MsSg2HMELegAsl86duvnP3e8y/f1r83v8Li1RO7k/9c2t/avHnt27xpyhRDguEIuxDA3OXXX93+8a0rz6ZvcKgadqUEL73wx+9sb5//WWKTGCOHsxEWM0H71e2ffmF3lPyEkZppVyVYefCw/9a5f3epSvsWh7MMsUgeaL20/dpLu4fJXZUvFCgi46/8i5RNFCCc4bA5JuZ7f/Kp7g9fuLSdvLnY8lEHxz8ItOPcaN7gPAB1tvPl7udupT9nvGSmLLlHSosWLdbJTgpgLna+eVv9hiO1ZIpFOGBEFmejBnrO/tc/0znXTf+sHMuPwD0MrSnETID6/SXPrH/junp3Xiw3atCjxJCRktKu10DHzrZ+pOvpc5cP/6T8CWtt4BATZ4tkBoCvTz8tbTb8TnHiYi/0pgCmPufMUkB1ss9vtU7Trgt9EgyGhIS0zgjRB6RukaSdfHpLPly2xTg2chQJmgRN2qiAa3DBtu5kYXgqAIFYEzTJDAVCnQIqaA+O0wyFjj8q1oY6AB/qd5nLw9JvcpqOOcFMT5dqlg/UAoy5exS2TgGg6DxhkHofqHVCGYf3ho/S904DcHZ6jpZ6lWMY1iogCDxsn8oDduP3BEI9QvSBWgU8YRDeGezsyEk1SNlD8HF51wjQoEAgHNkffXBw+XfJiZbXXCTBT2fZaAJfn4iEEt+z73bTk92jZTxPwOFxVCeGRif0tt4HCtxB+f0P7l//rTlBAN6gjcNicThcfU2NCnjf0NU43L59vf2XZf1A8wzX8JRTgLw+Ckx17SahIZGOyMri7dHalXf6DJdYfovPAgVlRLAzAXwI0gCQU5La8m6SXeH9pi+pWf5lUooIUFKSN6V0A1AE39RyeAYYEpvYNjf4OwP8XNuf50UycnKKKURjSTMALkjzzgpyEhI0LW7ygHvYRh00G7zARQL5dBYU9JtLWvQB52e0VX0MOl5anmOP+3yIjZldpteZijZXuIbBxZ1PAEbkc05GVspZtnX04hlHEDKucpUePYbklCgyNjjDLp9AERhjKSNAQc6IwSzPMQClt37OIeOQ7vQWxJPSZSf2OZMyK1h8jHsbNSgY0Z/tNRWA2HmuVXLIZsxnliw2mROAyR2Rjwmn8vyC0XynrUwQ3PzGs6QX06rDRgD9GIDEjF9pUFLSXyRsowLFIp2/44icDpZ02umq6S3ZxDwupp3hYs1cVMAu1noLBZaMNbJoAD3tl6prOodnTF5feBoBRmGweO8fyClISMlIowkkApRYyqbeZ5YJQrHc4UNieeGYArL8NeUkFcvgJKc/AU56ajxejod+/DT/W/IkQC4P3GoBwoGsFKAf9v2qAGIxej9MU8rTGdNjWtVsJv315aL3YwDYqG5MTDxAPMvTNkJS3ReY6AmtlTrhKsf/AHgAA6ezGE+FAAAAAElFTkSuQmCC",ol3:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAAAnNCSVQICFXsRgQAAAAJcEhZcwAAD10AAA9dAah0GUAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAHtUlEQVRo3sWZTWxcVxXHf/d9zIztcTz+pE6cOHXiyLJJadKgKE2oCBLlQwIWSCxYI0WiGxZZIYRAArFAYoEEi0hIsGBBURd0g4iK2lJAaWlaojZVKkU0H26cxB8Zz/f7uPeweHdebDLPnqlQ5l2N5/mN7tz/+Z//OffcM4rPUKCPl0eBAqqfAEAt5Ia1LwCuAg93CyCnAzgj7TstEKMluW+/x0AsWmKBmFggTu4lIpYome2Qw0kA8I2xL9T2Bp5COY6ncJRSDkopFEolANowBEAEATGIGBEkFjEiYkQbI0ZrMaFobYwxkY51pOumpSNTiau6bm7oZX1NP4Ai+ylYADkmGqUPxwSUQsG2ZbcDsBAA2QoGkeSvSZ4kr/alDcRGSyyxbJqqvG5+pHAwbRegVMz+leTBY7qcbTee8vsmQycRmnL6CkD1G4DXFl0fGegvANfpnws8+947AwqFg2MDSjAYzJY80QuAHl2gcPDJF3PiDLiimtIQC0ETEhD3klE8AJeuASg8CgeHir7vLBVOjwypQK3plyoromRNtzSamJg6QbcgvJ7C0J0YnCweG/jek/Ozw5q6bEiFiIHz+wNWBv68+rPNmlQjYnKE1Ai6cYfXA/W5Q6Uvl84f3zel3vH+SIDYoVAeofOdqa9PvbHn/PoDHYZ4eDSpE3fJgLs79YXToz858uxJ5+/en4jQ6hHr5OPZlZHhpcM/4BUv9PFw8agQdQVg1+UHnx/75fG5Gf83lFWGVUrQsmmu/HBsbN8f3Mi1MVLeGUJ3Lig8P/a7s5MN97c01I5+VUIk91err0/fLqFwgBHKOzmimzyQPzX2q1OTZfeianUVKCLNr93EZxiFIOyhnB0Tu6vf/XTp54uzY+4r3S1veYj5CEPBjqFsA3cDoEaLXy199rj/Is0eM2XILXzy5MkzSO6TAvAOFF84qf5KRfWYYhE2aJCzI5MDbxf7B58pTpf89x8qX1yWGKXKFaUBZIF1tWo/KzJPiYi3VAgYbrFEnpiYiBzBTgx0ts99YvDcvHr7YSBJka/Q4k1u3jz5eQ/EYebkXvL241NUeZN/31gkDwibhHjk8PGzTh+OrWw7X/6g/+TB8nuJrQCc4Z/KU08rb+1f/1gCSqy9NUNoP72txtXRb40dfJ+nkgMEZTw78riZLhDRndNP3vGG9GBKnRzhrppmilfhmcWoRYkxyuxv86euUaT24h4W2WN53WQmheB1ygc7MaCKuc+N5LeW6wfOXeUorwFQZIV5RlnbNqcGjBMyaAFUcfHwcHHxOznBakA6JQq34B4dkXtt+8QjvnCQa/Z/jxpFCmdbpPSJI7NyhMVzK/j2UQuFi4OLkz57FECcIcGCU8yZeirQvdxjjuvpTKGAem2EcjpjkjnUC5cvfIm/bRG3Y4e7AwOmEwPKOJotfhvlPj61dGaBEChtAdD88Yeq9et1LqWOUTj2lYzOItSmcxi2ZDXUw+k0n0bqDoXDJBsMM8rHKeIKFbxgIV9nL3cSFlPpZQBoa6AjgCYXK2YkndbckkxmWWfu2D00ozzYNinOlagwbRct/k92zNJARxFK01yur/mX2wDWGE0jfuHyNfa+Y6hQYNsmJQ45hqwwFaPpOVo6s2zDsCMDgsBq2sBR9xj8ZvX70+LJc9w+scA1Sjz49rjMy7zMywE5IY64PMcNDlkHKCbt9xhMZwhOooGODGhMzVyqTUxIm4Pll9797ixnWFZ3WORdSqz//hI+Pv7LT5dXOcNZltUa49y3qplC0Hb5uBMAbwcGDKYS/eLu6YMfrSZCUhWY+QCfGZ7iZYRbarSdYMfd0bvXazh8ii/yF2vcAVwitB1hZirWnROREFLYjN4uLQ5QTZ/WmeA2VwDUHbBks351HRxK3OaqtTTHEQwxmpjkxJApQh111kBAvBH+9O7y/KveFsfcYyNj82qywqZdxmWBAjEREbHdkrNEqNE6o6qJiVeiC4UPHuqg20PvExxGE6YAWp2jwEvabmIyqpoGuTB4ozEwd6lKvYflRzgBBIQWQrQjAG2MZABoEeJH4UU3N8f1rC/psPyz+AQWQEhIK6s09wACk+EC0NTwcCM3KrDAf6ihd6ui2ccxcrRoEaQg6lnQPYDYSLZlAS1cXBzyLHGfW0SZPDgMscgBDK10BARUs48mVgNxtl2GKh6ObVpOM8Uy94hsZpe0nakoMMdhPGJreRtAg9YuJ6NIwp18G7OJsilVyHGIQ2yySZ0WIYocQ+xhknEUhiYRoQUQ0KJBbSfleAChjvQuh4wypbQLovEpMWHrnPY2K0RoG/eR5SCgQXVn1SQAJNpNWiFlhm0+i8jZIrMNoN0j0jbhJMoPaOwu2sQFJt69oRKyadNqTGQBOFsAiM34CQchIdVuwtYyEOgu4jumQosiEX5a6aq0S9Z2T2zTThfdkS0MRN21lISAiBwD5KwDnLReStp0MZomrc4bTyaAhql131gztAhw8cnhWxeIBRASEWbVPju5wAS9/VYgdnthGwPSe5uynYqlpun9EuCTzHt0O67r5uP8teRRAC25H/cXgNmQvgKomhXdLwB2M7pu0pTyeK70mJYUm251sLfo/T8AGEoKes8eIGZ43E5wk36BBwhO2mbqgwZa9C0CAP4LFLGzNDDzmrAAAAAASUVORK5CYII=",lego:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA/CAQAAAD9VthUAAAAAnNCSVQICFXsRgQAAAAJcEhZcwAADzoAAA86AZc528IAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAHvElEQVRYw8WZWWxcVxnHf+fec2fGu+M4qbPH2EmTLk4FApqQNrgiVYyKeClIwBsvPCAQkZAQPND2gRekCoGQEItYHhBLurCksoTKA6QNJW0CBZLWCc3qEBvHy3hsz93O+XiYMxM7nhmPGxGf++Dre2fO7/v+5/u+s4zigzSxVq3osaZNAwzkuq1nPeUrAE9p99JTAKWn5WYEwErpv9TdGbECRlKMgBEjRlIgsqlAKBBaSKUokAjgkcFz+Ce6BvM9sVbKU55WKKWUh1IeoJQCFhsgIIIgIohYEWwq1ooVK9ZasdbG1hhrjUmMsYlZsJEJzYIpmLwZs/8xZ9JpaGYHOYfPyvrChrdbpAxbjFRltCqhnQ2yxBTKf0WQUgNrwYqIFStGUkkllqIU5E/2aQBbEV8pz/ZM3Or8/95UmeUB+J63RiHoAWi1ZHTvNl6pNfXe99Taeq/W1HvuYOzvKG5c4q1afIWHj4eHBwgWwWCQ1aWvBvC8VXngE5DbmO3UxrOeqEhmTFEcPiIiadwEfVttWxmd623tyu7Mfnrjru5cM0Th+Nyp2Z/MztvJNDLkSImZJ27MhNWIr8j1tn+g9at7+/ubivaSHYkmjPF1f+sj7Uc3Xc29VPjm1JSJEzJkCZkjaVT8hvzubDvQ8cz9AwPeG/rHFD3BZkoeTqLwCuqzrQf7nw9+UJhOidEEFAhX0sCJr1fyXm/uPLr5849n/u1/j3mMWtqtYEFm5v/2pXUHdhzNjgaxzunQQzNX3wDdWIT0dT3bP3Qo8wIXSVWNDpWQys2xmW/3fbn1WpAWXUrWNaARvN+/7lu7jzysf8q4siuEh5A8fX5/+8XepLyEs8zfCd7raP/K9scf1T9iQjUUzU+JynOR3TQBgpAS1a16dVtusONTH8kc42ZjcFFKEApcJyBHjizt+O8Wr3e2P7Uv+3curyT7InhJ8nFCMmTJkqWlVlnzVsj0psc69vbrV1SyKnjJgCsEZMiQoanWINcfe39v6xfv808Suu6f5EVlQA7QAcC/1DXp42GmuazOiaJbjjDFSTUNCLOEZMiQEJAjrZYB9b0PmoPe7fpNZQAkYFb1A9CphtWwGlbNkmX/R59TpzhPAAwdf37XKWac1JZJAnc1VSfp0ufSqtK3NT/Y3DJVKZ5tYbHiwfvJAjc5dO7Pw4cZOb4vc51ccvZjh7ZfubaTC8y4evgeAjQaTYCpgZfq06TXpD++Rd6hHHTdZ8JKDs8yAsAD92/gjxSfGNvYzp7Wt3nj6sS2D5NxtXAeHNwnIFpOqSe+bg+2d6ejFXzXS8WlJUSyhBiKoAqj1yFuYQLQZCvFOMLDx8evPFuOF7HV0sqzXmsuP1mJ5tbfVirYc++VITnItvyN8rhJjqIrL7qS50KCX1mWeLXFr5Z02nqiJ2+lXOasIQHJkD75C6DjtQ8dH6Eg99FHyD+LBRclaomnqgL3lo++w4utWsBVbNYtr1htYZFBZgm2299Z5rmXl4+ZtwaPjDlt9CJ0gIeqXNXFN7WKDtMLnW1y+9e6Txc5z2le25Te0BTVic89ovf3yIXE1QeP4FbJbmCla21V723evjklncued/0mZA6AcEABfH/6rXzb2IM5fJD1zLvIB02zm3ak+iK0hK8mvmBnzA/Hoy3LJoyW4XIITn5daAbaX0w3XBnIIsCBL7zDpFNvPWoRvBY+larBZ5Gb6eX20xXxf/2QDMkgmc+sl8MyJH2cf/Seka3yGFv+kR7Ok/1riwxhvruJUYffhGCxWKS0IqqReFXFN5g583qaNokC0aSf/JUaVn95ufNrJ9SwGlapMkkUXuPMAy/E24CJbQVeVWeIXDAFbEYwWCymes3XAMZW9d5gC8k3Rn++79hJjErvvcBB0P53/sBBAOa5knmdnWwlywlQZ7mHfQivOsd6yVDEkGIwxDVrfo2yY4nJ5tMTLe9rkYKSkUtcEqXk9/DKok9d5nLlfpzxyn0Tu7Gk7jLVNx8eQFw98oUi6Vz07NiZ3c/4y+bz+i1gHxliEhJnQFKn6MbVu01ISRaSX2b8vk/4q4D77GErCTGxM2EBW1P8pLr4YJkjiKORhZ91hR1qpsG9m89O9pASOXxMXF6wrCb0ACIidBJe8ZNdjHID24DsA/RhCImInAnztQqr897UeI1lDp3ToU8TO2jiat39q0cLD7GJlNBdERFhLd8dPjamtldx98K8dhNGD91cZ6zKPl6hyNJPP5rYIcsGFGprVva+Nl4GF455lVzI0UcvU0ySX7R5aKabHnrwMRSJlhiQr7fT1QCprYPnmKHgzjQtliwZNrIZHyHBkHHLSMG4KI+JK6Lna+9wFuETUzecLAUHN6QkBARofHwCFImr6Mbld+Lw0Upwhy/acKWUMswS07YI77tllHJTqsW4t4lLtcLKBwyl0JN05YQSiqS0knW+a7eGu4W3rrgmJMwRNpCkLvRsaBoqKAkzZGgi66S/HV+Sf4GQxvor4xPbYDkVIuLS2RZ6CV4wRMQkNNpXGb9go1V8BSElJXRrWIXCupM9We2hvMPPG1bbaqxf3sWhamTzhjVpHsCc/a9dQ3xo82uJL9jRNRLfTTnnBO+u/pTkLT5c8fPNd9nt5tLmRbsVynbsXR704Bbeq775v0uht3btfyZT7OA5knjdAAAAAElFTkSuQmCC"},ol.filter.Lego.prototype.set=function(t,e){ol.filter.Base.prototype.set.call(this,t,e),"brickSize"==t&&this.pattern.canvas.width!=e&&this.setBrick(e)},ol.filter.Lego.prototype.setBrick=function(t,e,o){if(t=Number(t)||30,"string"==typeof e){var i=new Image;i.src=this.img[e]||this.img.ol3,i.crossOrigin=o||null,e=i}if(e&&(this.pattern.img=e),this.pattern.img.width)this.pattern.canvas.width=this.pattern.canvas.height=t,this.pattern.ctx=this.pattern.canvas.getContext("2d"),this.pattern.ctx.fillStyle=this.pattern.ctx.createPattern(this.pattern.img,"repeat"),this.set("brickSize",t),e&&this.set("img",e.src);else{var n=this;this.pattern.img.onload=function(){n.setBrick(t,e)}}},ol.filter.Lego.prototype.getPattern=function(t,e){if(!this.pattern.ctx)return"transparent";var o=this.pattern.canvas,i=this.pattern.ctx,n=o.width/this.pattern.img.width;return i.save(),i.clearRect(0,0,o.width,o.height),i.scale(n,n),t/=n,e/=n,i.translate(t,e),i.beginPath(),i.clearRect(-2*o.width,-2*o.height,4*o.width,4*o.height),i.rect(-t,-e,2*o.width/n,2*o.height/n),i.fill(),i.restore(),i.createPattern(o,"repeat")},ol.filter.Lego.prototype.postcompose=function(t){var e=t.context,o=e.canvas,i=t.frameState.pixelRatio;"postrender"===t.type&&(i=1),e.save();var n=this.pattern.canvas.width*i,r=t.frameState.extent,a=t.frameState.viewState.resolution/i,s=[-Math.round(r[0]/a%n),Math.round(r[1]/a%n)],l=this.internal_.getContext("2d"),c=this.internal_.width=o.width,h=this.internal_.height=o.height;l.webkitImageSmoothingEnabled=l.mozImageSmoothingEnabled=l.msImageSmoothingEnabled=l.imageSmoothingEnabled=!1;var u=Math.floor((c-s[0])/n),p=Math.floor((h-s[1])/n);l.drawImage(o,s[0],s[1],u*n,p*n,0,0,u,p),e.webkitImageSmoothingEnabled=e.mozImageSmoothingEnabled=e.msImageSmoothingEnabled=e.imageSmoothingEnabled=!1,e.clearRect(0,0,c,h),e.drawImage(this.internal_,0,0,u,p,s[0],s[1],u*n,p*n),e.scale(i,i),e.fillStyle=this.getPattern(s[0]/i,s[1]/i),e.rect(0,0,c,h),e.fill(),e.restore()},ol.filter.PencilSketch=function(t){t=t||{},ol.filter.Base.call(this,t),this.set("blur",t.blur||8),this.set("intensity",t.intensity||.8)},ol.ext.inherits(ol.filter.PencilSketch,ol.filter.Base),ol.filter.PencilSketch.prototype.precompose=function(){},ol.filter.PencilSketch.prototype.postcompose=function(t){var e=t.context,o=e.canvas,i=o.width,n=o.height,r=document.createElement("canvas");r.width=i,r.height=n;var a=r.getContext("2d");a.filter="grayscale(1) invert(1) blur("+this.get("blur")+"px)",a.drawImage(o,0,0),e.save(),this.get("color")?(e.globalCompositeOperation="darken",e.globalAlpha=.3,e.drawImage(o,0,0)):(e.filter="grayscale(1)",e.drawImage(o,0,0)),e.globalCompositeOperation="color-dodge",e.globalAlpha=this.get("intensity"),e.drawImage(r,0,0),e.restore()},ol.filter.Pointillism=function(t){t=t||{},ol.filter.Base.call(this,t),this.set("saturate",Number(t.saturate)||2),this.pixels=[]},ol.ext.inherits(ol.filter.Pointillism,ol.filter.Base),ol.filter.Pointillism.prototype._getPixels=function(t){if(t>this.pixels.length)for(;this.pixels.length<t;)this.pixels.push([Math.random(),Math.random(),4*Math.random()+2]);return t},ol.filter.Pointillism.prototype.precompose=function(){},ol.filter.Pointillism.prototype.postcompose=function(t){var e=t.context,o=e.canvas,i=o.width,n=o.height,r=document.createElement("canvas");r.width=i,r.height=n;var a=r.getContext("2d");a.filter="saturate("+Math.round(2*this.get("saturate")*100)+"%)",a.drawImage(o,0,0),e.save(),e.filter="blur(3px) saturate("+100*this.get("saturate")+"%)",e.drawImage(o,0,0),e.filter="none",e.opacity=.5;for(var s=this._getPixels(i*n/50),l=0;l<s;l++){var c=Math.floor(this.pixels[l][0]*i),h=Math.floor(this.pixels[l][1]*n);e.fillStyle=ol.color.asString(a.getImageData(c,h,1,1).data),e.beginPath(),e.arc(c,h,this.pixels[l][2],0,2*Math.PI),e.fill()}e.restore()},ol.filter.SVGFilter=function(t){ol.filter.Base.call(this),this._svg={},t&&(t instanceof Array||(t=[t]),t.forEach(function(t){this.addSVGFilter(t)}.bind(this)))},ol.ext.inherits(ol.filter.SVGFilter,ol.filter.Base),ol.filter.SVGFilter.prototype.addSVGFilter=function(t){var e="#"+t.getId();this._svg[e]=1,this.dispatchEvent({type:"propertychange",key:"svg",oldValue:this._svg})},ol.filter.SVGFilter.prototype.removeSVGFilter=function(t){var e="#"+t.getId();delete this._svg[e],this.dispatchEvent({type:"propertychange",key:"svg",oldValue:this._svg})},ol.filter.SVGFilter.prototype.precompose=function(){},ol.filter.SVGFilter.prototype.postcompose=function(t){var e=[];for(var o in this._svg)e.push("url("+o+")");e=e.join(" ");var i=document.createElement("canvas");i.width=t.context.canvas.width,i.height=t.context.canvas.height,i.getContext("2d").drawImage(t.context.canvas,0,0),e&&(t.context.save(),t.context.clearRect(0,0,i.width,i.height),t.context.filter=e,t.context.drawImage(i,0,0),t.context.restore())},ol.filter.Texture=function(t){ol.filter.Base.call(this,t),this.setFilter(t)},ol.ext.inherits(ol.filter.Texture,ol.filter.Base),ol.filter.Texture.prototype.setFilter=function(t){var e;(t=t||{}).img?e=t.img:(e=new Image,t.src&&(ol.filter.Texture.Image&&ol.filter.Texture.Image[t.src]?e.src=ol.filter.Texture.Image[t.src]:e.src||(e.src=t.src)),e.crossOrigin=t.crossOrigin||null),this.set("rotateWithView",!1!==t.rotateWithView),this.set("opacity","number"==typeof t.opacity?t.opacity:1),this.set("ready",!1);var o=this;function i(e){o.pattern={},o.pattern.scale=t.scale||1,o.pattern.canvas=document.createElement("canvas"),o.pattern.canvas.width=e.width*o.pattern.scale,o.pattern.canvas.height=e.height*o.pattern.scale,o.pattern.canvas.width=e.width,o.pattern.canvas.height=e.height,o.pattern.ctx=o.pattern.canvas.getContext("2d"),o.pattern.ctx.fillStyle=o.pattern.ctx.createPattern(e,"repeat"),o.set("ready",!0)}e.width?i(e):e.onload=function(){i(e)}},ol.filter.Texture.prototype.getPattern=function(t,e){var o=this.pattern.canvas,i=this.pattern.ctx;return i.save(),i.translate(-t,e),i.beginPath(),i.rect(t,-e,o.width,o.height),i.fill(),i.restore(),i.createPattern(o,"repeat")},ol.filter.Texture.prototype.postcompose=function(t){if(this.pattern){var e=t.context,o=e.canvas,i=1.5*Math.max(o.width,o.height),n=t.frameState.pixelToCoordinateTransform;n||((n=t.frameState.pixelToCoordinateMatrix)[2]=n[4],n[3]=n[5],n[4]=n[12],n[5]=n[13]);var r=t.frameState.pixelRatio,a=t.frameState.viewState.resolution,s=o.width/2,l=o.height/2;if(e.save(),e.globalCompositeOperation="multiply",e.globalAlpha=this.get("opacity"),e.scale(r*this.pattern.scale,r*this.pattern.scale),this.get("rotateWithView"))a*=this.pattern.scale,e.fillStyle=this.getPattern((s*n[0]+l*n[1]+n[4])/a,(s*n[2]+l*n[3]+n[5])/a),e.translate(s/this.pattern.scale,l/this.pattern.scale),e.rotate(t.frameState.viewState.rotation),e.beginPath(),e.rect(-s-i,-l-i,2*i,2*i),e.fill();else{var c=-(s*n[0]+l*n[1]+n[4])/a,h=(s*n[2]+l*n[3]+n[5])/a,u=Math.cos(t.frameState.viewState.rotation),p=Math.sin(t.frameState.viewState.rotation),d=(c*u-h*p)/this.pattern.scale,f=(c*p+h*u)/this.pattern.scale;e.translate(d,f),e.beginPath(),e.fillStyle=this.pattern.ctx.fillStyle,e.rect(-d-i,-f-i,2*i,2*i),e.fill()}e.restore()}},ol.format.GeoJSONX=function(t){t=t||{},ol.format.GeoJSON.call(this,t),this._hash={},this._count=0,this._extended=t.extended,"function"==typeof t.whiteList?this._whiteList=t.whiteList:t.whiteList&&t.whiteList.indexOf?this._whiteList=function(e){return t.whiteList.indexOf(e)>-1}:this._whiteList=function(){return!0},"function"==typeof t.blackList?this._blackList=t.blackList:t.blackList&&t.blackList.indexOf?this._blackList=function(e){return t.blackList.indexOf(e)>-1}:this._blackList=function(){return!1},this._deleteNull=!1!==t.deleteNullProperties&&[null,void 0,""];var e=2;t.dataProjection&&"EPSG:4326"!==t.dataProjection||(e=7),isNaN(parseInt(t.decimals))||(e=parseInt(t.decimals)),this._decimals=e},ol.ext.inherits(ol.format.GeoJSONX,ol.format.GeoJSON),ol.format.GeoJSONX.prototype._radix="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ !#$%&'()*-.:<=>?@[]^_`{|}~",ol.format.GeoJSONX.prototype._size=ol.format.GeoJSONX.prototype._radix.length,ol.format.GeoJSONX.prototype._type={Point:0,LineString:1,Polygon:2,MultiPoint:3,MultiLineString:4,MultiPolygon:5,GeometryCollection:null},ol.format.GeoJSONX.prototype._toType=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],ol.format.GeoJSONX.prototype.encodeNumber=function(t,e){!isNaN(Number(t))&&null!==t&&isFinite(t)||(t=0),e||0===e||(e=this._decimals),(t=Math.round(t*Math.pow(10,e)))<0?t=-2*t-1:t*=2;for(var o,i="",n=t;o=n%this._size,i=this._radix.charAt(o)+i,0!=(n=Math.floor(n/this._size)););return i},ol.format.GeoJSONX.prototype.decodeNumber=function(t,e){e||0===e||(e=this._decimals);var o=0;t.split("").forEach(function(t){o=o*this._size+this._radix.indexOf(t)}.bind(this));var i=Math.floor(o/2);return i!==o/2&&(i=-1-i),i/Math.pow(10,e)},ol.format.GeoJSONX.prototype.encodeCoordinates=function(t,e){var o;if("number"==typeof t[0])return this.encodeNumber(t[0],e)+","+this.encodeNumber(t[1],e);if(t.length&&t[0]){if("number"==typeof t[0][0]){var i=[0,0],n=[];for(o=0;o<t.length;o++){t[o]=[Math.round(t[o][0]*Math.pow(10,e)),Math.round(t[o][1]*Math.pow(10,e))];var r=t[o][0]-i[0],a=t[o][1]-i[1];0!=o&&0===r&&0===a||(n.push(this.encodeNumber(r,0)+","+this.encodeNumber(a,0)),i=t[o])}return n.join(";")}for(o=0;o<t.length;o++)t[o]=this.encodeCoordinates(t[o],e);return t}return this.encodeCoordinates([0,0],e)},ol.format.GeoJSONX.prototype.decodeCoordinates=function(t,e){var o;if("string"==typeof t){if((t=t.split(";")).length>1){var i=[0,0];return t.forEach(function(o,n){t[n]=o.split(","),t[n][0]=this.decodeNumber(t[n][0],e)+i[0],t[n][1]=this.decodeNumber(t[n][1],e)+i[1],i=t[n]}.bind(this)),t}return t=t[0].split(","),[this.decodeNumber(t[0],e),this.decodeNumber(t[1],e)]}if(t.length){var n=[];for(o=0;o<t.length;o++)n[o]=this.decodeCoordinates(t[o],e);return n}return[0,0]},ol.format.GeoJSONX.prototype.writeFeaturesObject=function(t,e){e=e||{},this._count=0,this._hash={};var o=ol.format.GeoJSON.prototype.writeFeaturesObject.call(this,t,e);o.decimals=this._decimals,o.hashProperties=[],Object.keys(this._hash).forEach(function(t){o.hashProperties.push(t)}.bind(this)),this._count=0,this._hash={};var i=o.features;return delete o.features,o.features=i,o},ol.format.GeoJSONX.prototype.writeFeatureObject=function(t,e){var o=ol.format.GeoJSON.prototype.writeFeatureObject.call(this,t,e);if("Feature"!==o.type)throw"GeoJSONX doesn't support "+o.type+".";var i,n=[];if("Point"===o.geometry.type)n.push(this.encodeCoordinates(o.geometry.coordinates,this._decimals));else if("MultiPoint"===o.geometry.type){var r=[];o.geometry.coordinates.forEach(function(t){r.push(this.encodeCoordinates(t,this._decimals))}.bind(this)),n.push([this._type[o.geometry.type],r.join(";")])}else{if(!this._type[o.geometry.type])throw"GeoJSONX doesn't support "+o.geometry.type+".";n.push([this._type[o.geometry.type],this.encodeCoordinates(o.geometry.coordinates,this._decimals)])}var a=[];for(i in o.properties)this._whiteList(i)&&!this._blackList(i)&&(this._hash.hasOwnProperty(i)||(this._hash[i]=this._count,this._count++),(!this._deleteNull||this._deleteNull.indexOf(o.properties[i])<0)&&a.push(this._hash[i],o.properties[i]));if((a.length||this._extended)&&n.push(a),this._extended){var s=!1;for(i in a={},o)/^type$|^geometry$|^properties$/.test(i)||(a[i]=o[i],s=!0);s&&n.push(a)}return n},ol.format.GeoJSONX.prototype.writeGeometryObject=function(t,e){var o=ol.format.GeoJSON.prototype.writeGeometryObject.call(this,t,e);return"Point"===o.type?this.encodeCoordinates(o.coordinates,this._decimals):[this._type[o.type],this.encodeCoordinates(o.coordinates,this._decimals)]},ol.format.GeoJSONX.prototype.readFeaturesFromObject=function(t,e){if(this._hashProperties=t.hashProperties||[],(e=e||{}).decimals=parseInt(t.decimals),!e.decimals&&0!==e.decimals)throw"Bad file format...";return ol.format.GeoJSON.prototype.readFeaturesFromObject.call(this,t,e)},ol.format.GeoJSONX.prototype.readFeatureFromObject=function(t,e){var o={type:"Feature"};if("string"==typeof t[0])o.geometry={type:"Point",coordinates:this.decodeCoordinates(t[0],"number"==typeof e.decimals?e.decimals:this.decimals)};else if(o.geometry={type:this._toType[t[0][0]]},"MultiPoint"===o.geometry.type){var i=o.geometry.coordinates=[];t[0][1].split(";").forEach(function(t){t=t.split(","),i.push([this.decodeNumber(t[0],e.decimals),this.decodeNumber(t[1],e.decimals)])}.bind(this))}else o.geometry.coordinates=this.decodeCoordinates(t[0][1],"number"==typeof e.decimals?e.decimals:this.decimals);if(this._hashProperties&&t[1]){o.properties={};for(var n=t[1],r=0;r<n.length;r+=2)o.properties[this._hashProperties[n[r]]]=n[r+1]}else o.properties=t[1];if(t[2])for(var a in t[2])o[a]=t[2][a];return ol.format.GeoJSON.prototype.readFeatureFromObject.call(this,o,e)},ol.format.GeoJSONP=function(t){t=t||{},ol.format.GeoJSONX.call(this,t),this._lineFormat=new ol.format.Polyline({factor:Math.pow(10,t.decimals||6)})},ol.ext.inherits(ol.format.GeoJSONP,ol.format.GeoJSONX),ol.format.GeoJSONP.prototype.encodeCoordinates=function(t){var e;if("number"==typeof t[0])return e=new ol.geom.Point(t),this._lineFormat.writeGeometry(e);if(t.length&&t[0]){if("number"==typeof t[0][0])return e=new ol.geom.LineString(t),this._lineFormat.writeGeometry(e);for(var o=[],i=0;i<t.length;i++)o[i]=this.encodeCoordinates(t[i]);return o}return this.encodeCoordinates([0,0])},ol.format.GeoJSONP.prototype.decodeCoordinates=function(t){var e,o;if("string"==typeof t)return(o=this._lineFormat.readGeometry(t)).getCoordinates()[0];if(t.length){var i=[];if("string"==typeof t[0])for(e=0;e<t.length;e++)o=this._lineFormat.readGeometry(t[e]),i[e]=o.getCoordinates();else for(e=0;e<t.length;e++)i[e]=this.decodeCoordinates(t[e]);return i}return null},ol.format.GeoRSS=function(t){t=t||{},ol.Object.call(this,t)},ol.ext.inherits(ol.format.GeoRSS,ol.Object),ol.format.GeoRSS.prototype.readFeature=function(t,e){e=e||{};for(var o,i=t.children,n=new ol.Feature,r=0;o=i[r];r++)n.set(o.tagName,o.innerHTML);var a,s,l=[];if(n.get("geo:long"))s=new ol.geom.Point([parseFloat(n.get("geo:long")),parseFloat(n.get("geo:lat"))]),n.unset("geo:long"),n.unset("geo:lat");else if(n.get("georss:point"))l=n.get("georss:point").trim().split(" "),s=new ol.geom.Point([parseFloat(l[1]),parseFloat(l[0])]),n.unset("georss:point");else{if(!n.get("georss:polygon"))return n.get("georss:where")?(console.warn("[GeoRSS] GML format not implemented"),n.unset("georss:where"),null):(console.warn("[GeoRSS] unknown geometry"),null);a=n.get("georss:polygon").trim().split(" ");for(var c=0;c<a.length;c+=2)l.push([parseFloat(a[c+1]),parseFloat(a[c])]);s=new ol.geom.Polygon([l]),n.unset("georss:polygon")}return(e.featureProjection||this.get("featureProjection"))&&s.transform(e.dataProjection||this.get("dataProjection")||"EPSG:4326",e.featureProjection||this.get("featureProjection")),n.setGeometry(s),n},ol.format.GeoRSS.prototype.readFeatures=function(t,e){var o;if("string"==typeof t){var i=(new DOMParser).parseFromString(t,"text/xml");o=i.getElementsByTagName(this.getDocumentItemsTagName(i))}else if(t instanceof Document)o=t.getElementsByTagName(this.getDocumentItemsTagName(t));else{if(!(t instanceof Node))return[];o=t}for(var n,r=[],a=0;n=o[a];a++){var s=this.readFeature(n,e);s&&r.push(s)}return r},ol.format.GeoRSS.prototype.getDocumentItemsTagName=function(t){switch(t.documentElement.tagName){case"feed":return"entry";default:return"item"}},ol.interaction.CurrentMap=function(t){var e=(t=t||{}).condition||function(){return!0};ol.interaction.Interaction.call(this,{handleEvent:function(t){return e(t)&&(this.isCurrentMap()||(this.setCurrentMap(this.getMap()),this.dispatchEvent({type:"focus",map:this.getMap()}),this.getMap().dispatchEvent({type:"focus",map:this.getMap()}))),!0}.bind(this)}),t.onKeyDown&&document.addEventListener("keydown",function(e){this.isCurrentMap()&&!/INPUT|TEXTAREA|SELECT/.test(document.activeElement.tagName)&&t.onKeyDown({type:e.type,map:this.getMap(),originalEvent:e})}.bind(this)),t.onKeyPress&&document.addEventListener("keydown",function(e){this.isCurrentMap()&&!/INPUT|TEXTAREA|SELECT/.test(document.activeElement.tagName)&&t.onKeyPress({type:e.type,map:this.getMap(),originalEvent:e})}.bind(this)),t.onKeyUp&&document.addEventListener("keydown",function(e){this.isCurrentMap()&&!/INPUT|TEXTAREA|SELECT/.test(document.activeElement.tagName)&&t.onKeyUp({type:e.type,map:this.getMap(),originalEvent:e})}.bind(this))},ol.ext.inherits(ol.interaction.CurrentMap,ol.interaction.Interaction),ol.interaction.CurrentMap.prototype._currentMap=void 0,ol.interaction.CurrentMap.prototype.isCurrentMap=function(){return this.getMap()===ol.interaction.CurrentMap.prototype._currentMap},ol.interaction.CurrentMap.prototype.getCurrentMap=function(){return ol.interaction.CurrentMap.prototype._currentMap},ol.interaction.CurrentMap.prototype.setCurrentMap=function(t){ol.interaction.CurrentMap.prototype._currentMap=t},ol.interaction.CenterTouch=function(t){t=t||{},this._listener={};var e=/^pointermove$|^pointerup$/;this.ctouch=new ol.interaction.Interaction({handleEvent:function(t){return e.test(t.type)&&this.getMap()&&(t.coordinate=this.getMap().getView().getCenter(),t.pixel=this.getMap().getSize(),t.pixel=[t.pixel[0]/2,t.pixel[1]/2]),!0}}),this._target=new ol.control.Target({style:t.targetStyle,composite:t.composite}),ol.interaction.Interaction.call(this,{handleEvent:function(o){return e.test(o.type)&&(this.pos_=o.coordinate),!t.handleEvent||t.handleEvent.call(this,o)}})},ol.ext.inherits(ol.interaction.CenterTouch,ol.interaction.Interaction),ol.interaction.CenterTouch.prototype.setMap=function(t){this.getMap()&&(this.getMap().removeInteraction(this.ctouch),this.getMap().removeInteraction(this._target)),ol.interaction.Interaction.prototype.setMap.call(this,t),this.getMap()&&this.getActive()&&(this.getMap().addInteraction(this.ctouch),this.getMap().addControl(this._target))},ol.interaction.CenterTouch.prototype.setActive=function(t){ol.interaction.Interaction.prototype.setActive.call(this,t),this.pos_=null,this.getMap()&&(this.getActive()?(this.getMap().addInteraction(this.ctouch),this.getMap().addControl(this._target)):(this.getMap().removeInteraction(this.ctouch),this.getMap().removeControl(this._target)))},ol.interaction.CenterTouch.prototype.getPosition=function(){if(!this.pos_){var t=this.getMap().getSize();t=[t[0]/2,t[1]/2],this.pos_=this.getMap().getCoordinateFromPixel(t)}return this.pos_},ol.interaction.Clip=function(t){this.layers_=[],ol.interaction.Pointer.call(this,{handleDownEvent:this.setPosition,handleMoveEvent:this.setPosition}),this.precomposeBind_=this.precompose_.bind(this),this.postcomposeBind_=this.postcompose_.bind(this),t=t||{},this.pos=!1,this.radius=t.radius||100,t.layers&&this.addLayer(t.layers)},ol.ext.inherits(ol.interaction.Clip,ol.interaction.Pointer),ol.interaction.Clip.prototype.setMap=function(t){var e;if(this.getMap()){for(e=0;e<this.layers_.length;e++)this.layers_[e].un(["precompose","prerender"],this.precomposeBind_),this.layers_[e].un(["postcompose","postrender"],this.postcomposeBind_);this.getMap().renderSync()}if(ol.interaction.Pointer.prototype.setMap.call(this,t),t){for(e=0;e<this.layers_.length;e++)this.layers_[e].on(["precompose","prerender"],this.precomposeBind_),this.layers_[e].on(["postcompose","postrender"],this.postcomposeBind_);t.renderSync()}},ol.interaction.Clip.prototype.setRadius=function(t){this.radius=t,this.getMap()&&this.getMap().renderSync()},ol.interaction.Clip.prototype.getRadius=function(){return this.radius},ol.interaction.Clip.prototype.addLayer=function(t){t instanceof Array||(t=[t]);for(var e=0;e<t.length;e++)this.getMap()&&(t[e].on(["precompose","prerender"],this.precomposeBind_),t[e].on(["postcompose","postrender"],this.postcomposeBind_),this.getMap().renderSync()),this.layers_.push(t[e])},ol.interaction.Clip.prototype.removeLayer=function(t){t instanceof Array||(t=[t]);for(var e=0;e<t.length;e++){var o;for(o=0;o<this.layers_.length&&this.layers_[o]!==t[e];o++);o!=this.layers_.length&&this.getMap()&&(this.layers_[o].un(["precompose","prerender"],this.precomposeBind_),this.layers_[o].un(["postcompose","postrender"],this.postcomposeBind_),this.layers_.splice(o,1),this.getMap().renderSync())}},ol.interaction.Clip.prototype.setPosition=function(t){t.pixel?this.pos=t.pixel:t&&t instanceof Array?this.pos=t:t=[-1e7,-1e7],this.getMap()&&this.getMap().renderSync()},ol.interaction.Clip.prototype.precompose_=function(t){if(this.getActive()){var e=t.context,o=t.frameState.pixelRatio;e.save(),e.beginPath();var i=[this.pos[0],this.pos[1]],n=this.radius,r=t.inversePixelTransform;r?i=[i[0]*r[0]-i[1]*r[1]+r[4],-i[0]*r[2]+i[1]*r[3]+r[5]]:(i[0]*=o,i[1]*=o,n*=o),e.arc(i[0],i[1],n,0,2*Math.PI),e.clip()}},ol.interaction.Clip.prototype.postcompose_=function(t){this.getActive()&&t.context.restore()},ol.interaction.Clip.prototype.setActive=function(t){if(t!==this.getActive()){var e;if(ol.interaction.Pointer.prototype.setActive.call(this,t),t)for(e=0;e<this.layers_.length;e++)this.layers_[e].on(["precompose","prerender"],this.precomposeBind_),this.layers_[e].on(["postcompose","postrender"],this.postcomposeBind_);else for(e=0;e<this.layers_.length;e++)this.layers_[e].un(["precompose","prerender"],this.precomposeBind_),this.layers_[e].un(["postcompose","postrender"],this.postcomposeBind_);this.getMap()&&this.getMap().renderSync()}},ol.interaction.CopyPaste=function(t){t=t||{},this.features=[],this._cloneFeature=!0;var e=t.condition;"function"!=typeof e&&(e=function(t){if(t.originalEvent.ctrlKey){if(/^c$/i.test(t.originalEvent.key))return"copy";if(/^x$/i.test(t.originalEvent.key))return"cut";if(/^v$/i.test(t.originalEvent.key))return"paste"}return!1}),this._featuresSource=t.features||new ol.Collection,this.setSources(t.sources),this.setDestination(t.destination),ol.interaction.CurrentMap.call(this,{condition:t.mapCondition,onKeyDown:function(t){switch(e(t)){case"copy":this.copy({silent:!1});break;case"cut":this.copy({cut:!0,silent:!1});break;case"paste":this.paste({silent:!1})}}.bind(this)})},ol.ext.inherits(ol.interaction.CopyPaste,ol.interaction.CurrentMap),ol.interaction.CopyPaste.prototype.setSources=function(t){t?(this._source=[],this._source=t instanceof Array?t:[t]):this._source=null},ol.interaction.CopyPaste.prototype.getSources=function(){return this._source},ol.interaction.CopyPaste.prototype.setDestination=function(t){this._destination=t},ol.interaction.CopyPaste.prototype.getDestination=function(){return this._destination},ol.interaction.CopyPaste.prototype.getFeatures=function(){return this.features},ol.interaction.CopyPaste.prototype.copy=function(t){var e=(t=t||{}).features||this._featuresSource.getArray();if(t.cut){var o=this._source||[this._destination];e.forEach((function(t){o.forEach((function(e){try{e.removeFeature(t)}catch(t){}}))}))}this._cloneFeature?(this.features=[],e.forEach(function(t){this.features.push(t.clone())}.bind(this))):this.features=e,!1===t.silent&&this.dispatchEvent({type:t.cut?"cut":"copy",time:(new Date).getTime()})},ol.interaction.CopyPaste.prototype.paste=function(t){var e=(t=t||{}).features||this.features;if(e){var o=t.destination||this._destination;o&&(o.addFeatures(this.features),this._cloneFeature&&this.copy({features:this.features}))}!1===t.silent&&this.dispatchEvent({type:"paste",features:e,time:(new Date).getTime()})},ol.interaction.Delete=function(t){ol.interaction.Select.call(this,t),this.on("select",function(t){this.getFeatures().clear(),this.delete(t.selected)}.bind(this))},ol.ext.inherits(ol.interaction.Delete,ol.interaction.Select),ol.interaction.Delete.prototype._getSources=function(t){if(!this.getMap())return[];t||(t=this.getMap().getLayers());var e=[];return t.forEach(function(t){t.getLayers?e=e.concat(this._getSources(t.getLayers())):t.getSource&&t.getSource()instanceof ol.source.Vector&&e.push(t.getSource())}.bind(this)),e},ol.interaction.Delete.prototype.delete=function(t){if(t&&(t.length||t.getLength())){this.dispatchEvent({type:"deletestart",features:t});var e=[];this._getSources().forEach((function(o){try{t.forEach((function(t){o.removeFeature(t),e.push(t)}))}catch(t){}})),this.dispatchEvent({type:"deleteend",features:e})}},ol.interaction.DragOverlay=function(t){t||(t={});var e=t.offset||[0,0];ol.interaction.Pointer.call(this,{handleDownEvent:function(o){var i=o.frameState.viewState.resolution,n=[o.coordinate[0]+e[0]*i,o.coordinate[1]-e[1]*i];return/^(BUTTON|A)$/.test(o.originalEvent.target.tagName)?(this._dragging=!1,!0):!!this._dragging&&(!1!==t.centerOnClick?this._dragging.setPosition(n,!0):n=this._dragging.getPosition(),this.dispatchEvent({type:"dragstart",overlay:this._dragging,originalEvent:o.originalEvent,frameState:o.frameState,coordinate:n}),!0)},handleDragEvent:function(t){var o=t.frameState.viewState.resolution,i=[t.coordinate[0]+e[0]*o,t.coordinate[1]-e[1]*o];this._dragging&&(this._dragging.setPosition(i,!0),this.dispatchEvent({type:"dragging",overlay:this._dragging,originalEvent:t.originalEvent,frameState:t.frameState,coordinate:i}))},handleUpEvent:function(t){var o=t.frameState.viewState.resolution,i=[t.coordinate[0]+e[0]*o,t.coordinate[1]-e[1]*o];return!!this._dragging&&(this.dispatchEvent({type:"dragend",overlay:this._dragging,originalEvent:t.originalEvent,frameState:t.frameState,coordinate:i}),this._dragging=!1,!0)}}),this._overlays=[],t.overlays instanceof Array||(t.overlays=[t.overlays]),t.overlays.forEach(this.addOverlay.bind(this))},ol.ext.inherits(ol.interaction.DragOverlay,ol.interaction.Pointer),ol.interaction.DragOverlay.prototype.addOverlay=function(t){for(var e,o=0;e=this._overlays[o];o++)if(e===t)return;if(t.element.parentElement&&t.element.parentElement.classList.contains("ol-overlaycontainer-stopevent"))console.warn("[DragOverlay.addOverlay] overlay must be created with stopEvent set to false!");else{var i=function(){this.getMap()===t.getMap()&&(this._dragging=t)}.bind(this);this._overlays.push({overlay:t,listener:i}),t.element.addEventListener("pointerdown",i)}},ol.interaction.DragOverlay.prototype.removeOverlay=function(t){for(var e,o=0;e=this._overlays[o];o++)if(e.overlay===t){var i=this._overlays.splice(o,1)[0];t.element.removeEventListener("pointerdown",i.listener);break}},ol.interaction.DrawHole=function(t){t||(t={});var e=this;this._select=new ol.interaction.Select({style:t.style}),this._select.setActive(!1);var o,i=t.geometryFunction;if(o=i?function(t,o){return o=e._geometryFn(t,o),i(t,o)}:function(t,o){return e._geometryFn(t,o)},t.type="Polygon",t.geometryFunction=o,ol.interaction.Draw.call(this,t),t.layers&&("function"==typeof t.layers?this.layers_=t.layers:t.layers.indexOf&&(this.layers_=function(e){return t.layers.indexOf(e)>=0})),"function"==typeof t.features)this._features=t.features;else if(t.features){var n=t.features;this._features=function(t){return n.indexOf?!!n[n.indexOf(t)]:!!n.item(n.getArray().indexOf(t))}}else this._features=function(){return!0};this.on("drawstart",this._startDrawing.bind(this)),this.on("drawend",this._finishDrawing.bind(this))},ol.ext.inherits(ol.interaction.DrawHole,ol.interaction.Draw),ol.interaction.DrawHole.prototype.setMap=function(t){this.getMap()&&this.getMap().removeInteraction(this._select),t&&t.addInteraction(this._select),ol.interaction.Draw.prototype.setMap.call(this,t)},ol.interaction.DrawHole.prototype.setActive=function(t){this._select.getFeatures().clear(),ol.interaction.Draw.prototype.setActive.call(this,t)},ol.interaction.DrawHole.prototype.removeLastPoint=function(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&ol.interaction.Draw.prototype.removeLastPoint.call(this)},ol.interaction.DrawHole.prototype.getPolygon=function(){return this._polygon},ol.interaction.DrawHole.prototype._startDrawing=function(t){var e=this.getMap();this._feature=t.feature;var o=t.feature.getGeometry().getCoordinates()[0][0];this._current=null,e.forEachFeatureAtPixel(e.getPixelFromCoordinate(o),function(t,e){if(this._features(t,e)){var i=t.getGeometry();if("Polygon"===i.getType()&&i.intersectsCoordinate(o))this._polygonIndex=!1,this._polygon=i,this._current=t;else if("MultiPolygon"===i.getType()&&i.intersectsCoordinate(o))for(var n,r=0;n=i.getPolygon(r);r++)if(n.intersectsCoordinate(o)){this._polygonIndex=r,this._polygon=n,this._current=t;break}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))},ol.interaction.DrawHole.prototype._finishDrawing=function(t){t.hole=t.feature,t.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var e=t.hole.getGeometry().getCoordinates()[0];if(e.length>3)if(!1!==this._polygonIndex){for(var o,i=t.feature.getGeometry(),n=new ol.geom.MultiPolygon([]),r=0;o=i.getPolygon(r);r++)r===this._polygonIndex?(o.appendLinearRing(new ol.geom.LinearRing(e)),n.appendPolygon(o)):n.appendPolygon(o);t.feature.setGeometry(n)}else this.getPolygon().appendLinearRing(new ol.geom.LinearRing(e));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()},ol.interaction.DrawHole.prototype._geometryFn=function(t,e){var o=t[0].pop();return this.getPolygon()&&!this.getPolygon().intersectsCoordinate(o)||(this.lastOKCoord=[o[0],o[1]]),t[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),e?e.setCoordinates([t[0].concat([t[0][0]])]):e=new ol.geom.Polygon(t),e},ol.interaction.DrawRegular=function(t){t||(t={}),this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.maxCircleCoordinates_=t.maxCircleCoordinates||100,this.features_=t.features,this.source_=t.source,this.squareFn_=t.squareCondition,this.centeredFn_=t.centerCondition,this.canRotate_=!1!==t.canRotate,this.geometryName_=t.geometryName,this.setSides(t.sides);var e=ol.style.Style.defaultStyle(!0);this.sketch_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.sketch_,useSpatialIndex:!1}),name:"DrawRegular overlay",displayInLayerSwitcher:!1,style:t.style||e}),ol.interaction.Interaction.call(this,{handleEvent:this.handleEvent_})},ol.ext.inherits(ol.interaction.DrawRegular,ol.interaction.Interaction),ol.interaction.DrawRegular.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Interaction.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t)},ol.interaction.DrawRegular.prototype.setActive=function(t){this.reset(),ol.interaction.Interaction.prototype.setActive.call(this,t)},ol.interaction.DrawRegular.prototype.reset=function(){this.overlayLayer_.getSource().clear(),this.started_=!1},ol.interaction.DrawRegular.prototype.setSides=function(t){t=parseInt(t),this.sides_=t>2?t:0},ol.interaction.DrawRegular.prototype.canRotate=function(t){return!0!==t&&!1!==t||(this.canRotate_=t),this.canRotate_},ol.interaction.DrawRegular.prototype.getSides=function(){return this.sides_},ol.interaction.DrawRegular.prototype.startAngle={default:Math.PI/2,3:-Math.PI/2,4:Math.PI/4},ol.interaction.DrawRegular.prototype.getGeom_=function(){if(this.overlayLayer_.getSource().clear(),!this.center_)return!1;var t;if(this.coord_){var e,o,i,n,r,a=this.center_,s=this.coord_;if(!this.sides_&&this.square_&&!this.centered_)return a=[(s[0]+a[0])/2,(s[1]+a[1])/2],e=[s[0]-a[0],s[1]-a[1]],i=Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=new ol.geom.Circle(a,i,"XY"),r=this.getMap().getPixelFromCoordinate(a),o=Math.max(100,Math.abs(r[0]-this.coordPx_[0]),Math.abs(r[1]-this.coordPx_[1])),o=Math.min(this.maxCircleCoordinates_,Math.round(o/3)),ol.geom.Polygon.fromCircle(n,o,0);var l=this.canRotate_&&this.centered_&&this.square_;if(e=[s[0]-a[0],s[1]-a[1]],this.square_&&!l){var c=Math.max(Math.abs(e[0]),Math.abs(e[1]));s=[a[0]+(e[0]>0?c:-c),a[1]+(e[1]>0?c:-c)]}if((i=Math.sqrt(e[0]*e[0]+e[1]*e[1]))>0){var h;if(n=new ol.geom.Circle(a,i,"XY"),h=l?Math.atan2(e[1],e[0]):this.startAngle[this.sides_]||this.startAngle.default,this.sides_?t=ol.geom.Polygon.fromCircle(n,this.sides_,h):(r=this.getMap().getPixelFromCoordinate(this.center_),o=Math.max(100,Math.abs(r[0]-this.coordPx_[0]),Math.abs(r[1]-this.coordPx_[1])),o=Math.min(this.maxCircleCoordinates_,Math.round(o/(this.centered_?3:5))),t=ol.geom.Polygon.fromCircle(n,o,0)),l)return t;var u=t.getExtent(),p=((a=this.centered_?[2*this.center_[0]-this.coord_[0],2*this.center_[1]-this.coord_[1]]:this.center_)[0]-s[0])/(u[0]-u[2]),d=(a[1]-s[1])/(u[1]-u[3]);if(this.square_){var f=Math.min(Math.abs(p),Math.abs(d));p=Math.sign(p)*f,d=Math.sign(d)*f}var g=[a[0]-u[0]*p,a[1]-u[1]*d];return t.applyTransform((function(t,e,o){for(var i=0;i<t.length;i+=o)e[i]=t[i]*p+g[0],e[i+1]=t[i+1]*d+g[1];return e})),t}}return new ol.geom.Point(this.center_)},ol.interaction.DrawRegular.prototype.drawSketch_=function(t){if(this.overlayLayer_.getSource().clear(),t){this.square_=this.squareFn_?this.squareFn_(t):t.originalEvent.shiftKey,this.centered_=this.centeredFn_?this.centeredFn_(t):t.originalEvent.metaKey||t.originalEvent.ctrlKey;var e=this.getGeom_();if(e){var o=this.feature_;return this.geometryName_&&o.setGeometryName(this.geometryName_),"Polygon"===e.getType()&&o.getGeometry().setCoordinates(e.getCoordinates()),this.overlayLayer_.getSource().addFeature(o),this.coord_&&this.square_&&(this.canRotate_&&this.centered_&&this.coord_||!this.sides_&&!this.centered_)&&this.overlayLayer_.getSource().addFeature(new ol.Feature(new ol.geom.LineString([this.center_,this.coord_]))),o}}},ol.interaction.DrawRegular.prototype.drawPoint_=function(t,e){e||this.overlayLayer_.getSource().clear(),this.overlayLayer_.getSource().addFeature(new ol.Feature(new ol.geom.Point(t)))},ol.interaction.DrawRegular.prototype.handleEvent_=function(t){var e,o;switch(this._eventTime=new Date,t.type){case"pointerdown":this.downPx_=t.pixel,this.start_(t);this._longTouch=!1,setTimeout(function(){this._longTouch=new Date-this._eventTime>450,this._longTouch&&this.handleMoveEvent_(t)}.bind(this),500);break;case"pointerup":this.started_&&this.coord_&&(e=this.downPx_[0]-t.pixel[0])*e+(o=this.downPx_[1]-t.pixel[1])*o<=this.squaredClickTolerance_&&("pointermove"==this.lastEvent||"keydown"==this.lastEvent||(e=this.upPx_[0]-t.pixel[0])*e+(o=this.upPx_[1]-t.pixel[1])*o<=this.squaredClickTolerance_?this.end_(t):(this.handleMoveEvent_(t),this.drawPoint_(t.coordinate,!0))),this.upPx_=t.pixel;break;case"pointerdrag":if(this.started_){var i=this.getMap().getPixelFromCoordinate(this.center_);(e=i[0]-t.pixel[0])*e+(o=i[1]-t.pixel[1])*o<=this.squaredClickTolerance_&&this.reset()}return!this._longTouch;case"pointermove":this.started_&&(e=this.downPx_[0]-t.pixel[0])*e+(o=this.downPx_[1]-t.pixel[1])*o>this.squaredClickTolerance_&&(this.handleMoveEvent_(t),this.lastEvent=t.type);break;default:if(this.lastEvent=t.type,this.started_&&"dblclick"===t.type)return!1}return!0},ol.interaction.DrawRegular.prototype.finishDrawing=function(){this.started_&&this.coord_&&this.end_({pixel:this.upPx_,coordinate:this.coord_})},ol.interaction.DrawRegular.prototype.handleMoveEvent_=function(t){if(this.started_){this.coord_=t.coordinate,this.coordPx_=t.pixel;var e=this.drawSketch_(t);this.dispatchEvent({type:"drawing",feature:e,pixel:t.pixel,startCoordinate:this.center_,coordinate:t.coordinate,square:this.square_,centered:this.centered_})}else this.drawPoint_(t.coordinate)},ol.interaction.DrawRegular.prototype.start_=function(t){if(this.started_)this.coord_=t.coordinate;else{this.started_=!0,this.center_=t.coordinate,this.coord_=null;var e=new ol.geom.Polygon([[t.coordinate,t.coordinate,t.coordinate]]),o=this.feature_=new ol.Feature(e);this.drawSketch_(t),this.dispatchEvent({type:"drawstart",feature:o,pixel:t.pixel,coordinate:t.coordinate})}},ol.interaction.DrawRegular.prototype.end_=function(t){if(this.coord_=t.coordinate,this.started_=!1,this.coord_&&this.center_[0]!=this.coord_[0]&&this.center_[1]!=this.coord_[1]){var e=this.feature_;this.geometryName_&&e.setGeometryName(this.geometryName_),e.setGeometry(this.getGeom_()),this.source_?this.source_.addFeature(e):this.features_&&this.features_.push(e),this.dispatchEvent({type:"drawend",feature:e,pixel:t.pixel,coordinate:t.coordinate,square:this.square_,centered:this.centered_})}else this.dispatchEvent({type:"drawcancel",feature:null,pixel:t.pixel,coordinate:t.coordinate,square:this.square_,centered:this.centered_});this.center_=this.coord_=null,this.drawSketch_()},ol.interaction.DrawTouch=function(t){(t=t||{}).handleEvent=function(t){if(this.get("tap"))switch(this.sketch.setPosition(this.getPosition()),t.type){case"singleclick":this.addPoint();break;case"dblclick":return this.addPoint(),this.finishDrawing(),!1}return!0},t.sketchStyle||(t.sketchStyle=ol.style.Style.defaultStyle());var e=this.sketch=new ol.layer.SketchOverlay(t);e.on(["drawstart","drawabort"],function(t){this.dispatchEvent(t)}.bind(this)),e.on(["drawend"],function(e){e.feature&&e.valid&&t.source&&t.source.addFeature(e.feature),this.dispatchEvent(e)}.bind(this)),ol.interaction.CenterTouch.call(this,t),this._source=t.source,this.set("tap",!1!==t.tap)},ol.ext.inherits(ol.interaction.DrawTouch,ol.interaction.CenterTouch),ol.interaction.DrawTouch.prototype.setMap=function(t){if(this._listener)for(var e in this._listener)ol.Observable.unByKey(e);this._listener={},ol.interaction.CenterTouch.prototype.setMap.call(this,t),this.sketch.setMap(t),t&&(this._listener.center=t.on("postcompose",function(){ol.coordinate.equal(this.getPosition(),this.sketch.getPosition()||[])||this.sketch.setPosition(this.getPosition())}.bind(this)))},ol.interaction.DrawTouch.prototype.setGeometryType=function(t){return this.sketch.setGeometryType(t)},ol.interaction.DrawTouch.prototype.getGeometryType=function(){return this.sketch.getGeometryType()},ol.interaction.DrawTouch.prototype.finishDrawing=function(){this.sketch.finishDrawing(!0)},ol.interaction.DrawTouch.prototype.addPoint=function(){this.sketch.addPoint(this.getPosition())},ol.interaction.DrawTouch.prototype.removeLastPoint=function(){this.sketch.removeLastPoint()},ol.interaction.DrawTouch.prototype.setActive=function(t){ol.interaction.CenterTouch.prototype.setActive.call(this,t),this.sketch.abortDrawing(),this.sketch.setVisible(t)},ol.interaction.DropFile=function(t){t=t||{},ol.interaction.DragAndDrop.call(this,{});var e=t.zone||document;e.addEventListener("dragenter",this.onstop),e.addEventListener("dragover",this.onstop),e.addEventListener("dragleave",this.onstop),this.formatConstructors_=t.formatConstructors||[ol.format.GPX,ol.format.GeoJSONX,ol.format.GeoJSONP,ol.format.GeoJSON,ol.format.IGC,ol.format.KML,ol.format.TopoJSON],this.projection_=t.projection,this.accept_=t.accept||["gpx","json","geojsonx","geojsonp","geojson","igc","kml","topojson"];var o=this;e.addEventListener("drop",(function(t){return o.ondrop(t)}))},ol.ext.inherits(ol.interaction.DropFile,ol.interaction.DragAndDrop),ol.interaction.DropFile.prototype.setMap=function(t){ol.interaction.Interaction.prototype.setMap.call(this,t)},ol.interaction.DropFile.prototype.onstop=function(t){return t.preventDefault(),t.stopPropagation(),!1},ol.interaction.DropFile.prototype.ondrop=function(t){if(t.preventDefault(),t.dataTransfer&&t.dataTransfer.files.length)for(var e,o=this,i=t.dataTransfer.files,n=/\.([0-9a-z]+)(?=[?#])|(\.)(?:[\w]+)$/,r=0;e=i[r];r++){var a=e.name.match(n)[0];o.dispatchEvent({type:"loadstart",file:e,filesize:e.size,filetype:e.type,fileextension:a,projection:l});var s=new FileReader,l=this.projection_||(this.getMap()?this.getMap().getView().getProjection():null),c=this.formatConstructors_,h=function(t,e,o){try{return t.readFeatures(e,o)}catch(t){}},u=e;s.onload=function(t){var e,i,n=t.target.result,r=[];for(e=0,i=c.length;e<i;++e){var a=new(0,c[e]);if((r=h(a,n,{featureProjection:l}))&&r.length>0)return o.dispatchEvent({type:"addfeatures",features:r,file:u,projection:l}),void o.dispatchEvent({type:"loadend",features:r,file:u,projection:l})}o.dispatchEvent({type:"loadend",file:u,result:n})},s.readAsText(e)}return!1},ol.interaction.FillAttribute=function(t,e){if((t=t||{}).condition||(t.condition=ol.events.condition.click),ol.interaction.Select.call(this,t),this.setActive(!1!==t.active),this._attributes=e,this.on("select",function(t){this.getFeatures().clear(),this.fill(t.selected,this._attributes)}.bind(this)),!1!==t.cursor){var o=document.createElement("CANVAS");o.width=o.height=32;var i=o.getContext("2d");i.beginPath(),i.moveTo(9,3),i.lineTo(2,9),i.lineTo(10,17),i.lineTo(17,11),i.closePath(),i.fillStyle="#fff",i.fill(),i.stroke(),i.beginPath(),i.moveTo(6,4),i.lineTo(0,8),i.lineTo(0,13),i.lineTo(3,17),i.lineTo(3,8),i.closePath(),i.fillStyle="#000",i.fill(),i.stroke(),i.moveTo(8,8),i.lineTo(10,0),i.lineTo(11,0),i.lineTo(13,3),i.lineTo(13,7),i.stroke(),this._cursor="url("+o.toDataURL()+") 0 13, auto"}},ol.ext.inherits(ol.interaction.FillAttribute,ol.interaction.Select),ol.interaction.FillAttribute.prototype.setActive=function(t){t!==this.getActive()&&(ol.interaction.Select.prototype.setActive.call(this,t),this.getMap()&&this._cursor&&(t?(this._previousCursor=this.getMap().getTargetElement().style.cursor,this.getMap().getTargetElement().style.cursor=this._cursor):(this.getMap().getTargetElement().style.cursor=this._previousCursor,this._previousCursor=void 0)))},ol.interaction.FillAttribute.prototype.setAttributes=function(t){this._attributes=t};ol.interaction.FillAttribute.prototype.setAttribute=function(t,e){this._attributes[t]=e},ol.interaction.FillAttribute.prototype.getAttributes=function(){return this._attributes},ol.interaction.FillAttribute.prototype.getAttribute=function(t){return this._attributes[t]},ol.interaction.FillAttribute.prototype.fill=function(t,e){t.length&&e&&(this.dispatchEvent({type:"setattributestart",features:t,properties:e}),t.forEach((function(t){for(var o in e)t.set(o,e[o])})),this.dispatchEvent({type:"setattributeend",features:t,properties:e}))},ol.interaction.Flashlight=function(t){ol.interaction.Pointer.call(this,{handleDownEvent:this.setPosition,handleMoveEvent:this.setPosition}),t=t||{},this.pos=!1,this.radius=t.radius||100,this.setColor(t)},ol.ext.inherits(ol.interaction.Flashlight,ol.interaction.Pointer),ol.interaction.Flashlight.prototype.setMap=function(t){this.getMap()&&this.getMap().render(),this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.interaction.Pointer.prototype.setMap.call(this,t),t&&(this._listener=t.on("postcompose",this.postcompose_.bind(this)))},ol.interaction.Flashlight.prototype.setRadius=function(t){this.radius=t,this.getMap()&&this.getMap().renderSync()},ol.interaction.Flashlight.prototype.setColor=function(t){var e=t.fill?t.fill:[0,0,0,.8],o=ol.color.asArray(e);this.startColor=ol.color.asString(o),t.color?o=this.endColor=ol.color.asString(ol.color.asArray(t.color)||t.color):(o[3]=0,this.endColor=ol.color.asString(o)),o[3]=.1,this.midColor=ol.color.asString(o),this.getMap()&&this.getMap().renderSync()},ol.interaction.Flashlight.prototype.setPosition=function(t){t.pixel?this.pos=t.pixel:this.pos=t,this.getMap()&&this.getMap().renderSync()},ol.interaction.Flashlight.prototype.postcompose_=function(t){var e=ol.ext.getMapCanvas(this.getMap()).getContext("2d"),o=t.frameState.pixelRatio,i=e.canvas.width,n=e.canvas.height;if(e.save(),e.scale(o,o),this.pos){var r=Math.max(i,n),a=e.createRadialGradient(this.pos[0],this.pos[1],i*this.radius/r,this.pos[0],this.pos[1],n*this.radius/r);a.addColorStop(0,this.startColor),a.addColorStop(.8,this.midColor),a.addColorStop(1,this.endColor),e.fillStyle=a,e.fillRect(this.pos[0]-r,this.pos[1]-r,2*r,2*r)}else e.fillStyle=this.startColor,e.fillRect(0,0,i,n);e.restore()},ol.interaction.FocusMap=function(){ol.interaction.Interaction.call(this,{}),this.focusBt=ol.ext.element.create("BUTTON",{on:{focus:function(){this.dispatchEvent({type:"focus"})}.bind(this)},style:{position:"absolute",zIndex:-1,top:0,opacity:0}})},ol.ext.inherits(ol.interaction.FocusMap,ol.interaction.Interaction),ol.interaction.FocusMap.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,this.getMap()&&this.getMap().getViewport().removeChild(this.focusBt),ol.interaction.Interaction.prototype.setMap.call(this,t),this.getMap()&&(this._listener=this.getMap().on("pointerdown",function(){this.getActive()&&this.focusBt.focus()}.bind(this)),this.getMap().getViewport().appendChild(this.focusBt))},ol.interaction.GeolocationDraw=function(t){t||(t={}),this.geolocation=new ol.Geolocation({projection:"EPSG:4326",trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}}),this.geolocation.on("change",this.draw_.bind(this)),this.path_=[],this.lastPosition_=!1;var e=[255,255,255,1],o=[0,153,255,1],i=new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:o}),stroke:new ol.style.Stroke({color:e,width:1.5})}),n=[new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:5})}),new ol.style.Style({stroke:new ol.style.Stroke({color:o,width:3}),fill:new ol.style.Fill({color:[255,255,255,.5]})})],r=new ol.style.RegularShape({radius:10.5,points:3,rotation:0,fill:new ol.style.Fill({color:o}),stroke:new ol.style.Stroke({color:e,width:1.5})}),a=r.getImage(),s=a.getContext("2d"),l=document.createElement("canvas");l.width=l.height=a.width,l.getContext("2d").drawImage(a,0,0),s.clearRect(0,0,a.width,a.height),s.drawImage(l,0,0,a.width,a.height,3,0,a.width-6,a.height);this.locStyle={error:new ol.style.Style({fill:new ol.style.Fill({color:[255,0,0,.2]})}),warn:new ol.style.Style({fill:new ol.style.Fill({color:[255,192,0,.2]})}),ok:new ol.style.Style({fill:new ol.style.Fill({color:[0,255,0,.2]})})},this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector,name:"GeolocationDraw overlay",style:t.style||function(t){return void 0===t.get("heading")?n[1].setImage(i):(n[1].setImage(r),r.setRotation(t.get("heading")||0)),n}}),this.sketch_=[new ol.Feature,new ol.Feature,new ol.Feature],this.overlayLayer_.getSource().addFeatures(this.sketch_),this.features_=t.features,this.source_=t.source,this.condition_=t.condition||function(t){return t.getAccuracy()<this.get("minAccuracy")},ol.interaction.Interaction.call(this,{handleEvent:function(){return!this.get("followTrack")||"auto"==this.get("followTrack")}}),this.set("type",t.type||"LineString"),this.set("attributes",t.attributes||{}),this.set("minAccuracy",t.minAccuracy||20),this.set("tolerance",t.tolerance||5),this.set("zoom",t.zoom),this.set("minZoom",t.minZoom),this.setFollowTrack(void 0===t.followTrack||t.followTrack),this.setActive(!1)},ol.ext.inherits(ol.interaction.GeolocationDraw,ol.interaction.Interaction),ol.interaction.GeolocationDraw.prototype.simplify3D=function(t,e){var o=t.getCoordinates(),i=this.getMap().getView().getProjection();"Polygon"===this.get("type")&&(o=o[0]);for(var n,r=[o[0]],a=ol.proj.transform(o[0],i,"EPSG:4326"),s=1;s<o.length;s++){n=ol.proj.transform(o[s],i,"EPSG:4326"),ol.sphere.getDistance(a,n)>e&&(r.push(o[s]),a=n)}return r[r.length-1]!==o[o.length-1]&&r.push(o[o.length-1]),t="Polygon"===this.get("type")?new ol.geom.Polygon([r],"XYZM"):new ol.geom.LineString(r,"XYZM")},ol.interaction.GeolocationDraw.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Pointer.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t),t&&this.geolocation.setProjection(t.getView().getProjection())},ol.interaction.GeolocationDraw.prototype.setActive=function(t){if(t!==this.getActive())if(ol.interaction.Interaction.prototype.setActive.call(this,t),this.overlayLayer_.setVisible(t),this.getMap()&&(this.geolocation.setTracking(t),this.getMap().renderSync()),this.pause(!t),t)this.reset(),this.dispatchEvent({type:"drawstart",feature:this.sketch_[1]});else{var e=this.sketch_[1].clone();e.getGeometry()&&(this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),this.dispatchEvent({type:"drawend",feature:e}))}},ol.interaction.GeolocationDraw.prototype.simulate=function(t,e){if(this._track&&clearTimeout(this._track.timeout),t){var o=(e=e||{}).delay||1e3;this._track={track:t,pos:0,timeout:setTimeout(function t(){if(this._track.pos>=this._track.track.length)this._track=!1;else{var i=this._track.track[this._track.pos];i[2]=i[3]||0,i[3]=(new Date).getTime(),this._track.pos++,!1!==e.repeat&&(this._track.pos=this._track.pos%this._track.track.length),this.getActive()&&this.draw_(!0,i,e.accuracy),this._track.timeout=setTimeout(t.bind(this),o)}}.bind(this),0)}}else this._track=!1},ol.interaction.GeolocationDraw.prototype.simulating=function(){return!!this._track},ol.interaction.GeolocationDraw.prototype.reset=function(){this.sketch_[1].setGeometry(),this.path_=[],this.lastPosition_=!1},ol.interaction.GeolocationDraw.prototype.start=function(){this.setActive(!0)},ol.interaction.GeolocationDraw.prototype.stop=function(){this.setActive(!1)},ol.interaction.GeolocationDraw.prototype.pause=function(t){this.pause_=!1!==t},ol.interaction.GeolocationDraw.prototype.isPaused=function(){return this.pause_},ol.interaction.GeolocationDraw.prototype.setFollowTrack=function(t){this.set("followTrack",t);var e,o=this.getMap();if(this.getActive()&&o)if("position"!==t&&(e=this.get("minZoom")?Math.max(this.get("minZoom"),o.getView().getZoom()):this.get("zoom")),!1===t||this.lastPosition_)"auto"===t&&this.lastPosition_&&o.getView().animate({center:this.lastPosition_,zoom:e});else{var i=this.path_[this.path_.length-1];i&&o.getView().animate({center:i,zoom:e})}this.lastPosition_=!1,this.dispatchEvent({type:"follow",following:!1!==t})},ol.interaction.GeolocationDraw.prototype.draw_=function(t,e,o){var i=this.getMap();if(i){var n,r,a,s,l;if(this._track){if(!0!==t)return;if(r=e,n=o||10,this.path_&&this.path_.length){var c=this.path_[this.path_.length-1];l=Math.atan2(e[0]-c[0],e[1]-c[1])}var h=new ol.geom.Circle(r,i.getView().getResolution()*n);a=ol.geom.Polygon.fromCircle(h)}else n=(s=this.geolocation).getAccuracy(),r=this.getPosition(s),a=s.getAccuracyGeometry(),l=s.getHeading();switch(this.get("followTrack")){case!0:1==this.get("followTrack")&&(this.get("minZoom")?this.get("minZoom")>i.getView().getZoom()&&i.getView().setZoom(this.get("minZoom")):i.getView().setZoom(this.get("zoom")||16),ol.extent.containsExtent(i.getView().calculateExtent(i.getSize()),a.getExtent())||i.getView().fit(a.getExtent())),i.getView().setCenter(r);break;case"position":i.getView().setCenter(r);break;case"auto":if(this.lastPosition_){var u=i.getView().getCenter();u[0]!=this.lastPosition_[0]||u[1]!=this.lastPosition_[1]?this.setFollowTrack(!1):(i.getView().setCenter(r),this.lastPosition_=r)}else i.getView().setCenter(r),this.get("minZoom")?this.get("minZoom")>i.getView().getZoom()&&i.getView().setZoom(this.get("minZoom")):this.get("zoom")&&i.getView().setZoom(this.get("zoom")),this.lastPosition_=r;break;case"visible":ol.extent.containsCoordinate(i.getView().calculateExtent(i.getSize()),r)||i.getView().setCenter(r)}var p,d=this.sketch_[0];if(d.setGeometry(a),n<this.get("minAccuracy")/2?d.setStyle(this.locStyle.ok):n<this.get("minAccuracy")?d.setStyle(this.locStyle.warn):d.setStyle(this.locStyle.error),this.pause_&&(this.lastPosition_=r),!this.pause_&&(!s||this.condition_.call(this,s))){switch(d=this.sketch_[1],this.path_.push(r),this.get("type")){case"Point":this.path_=[r],d.setGeometry(new ol.geom.Point(r,"XYZM"));var f=this.get("attributes");f.heading&&d.set("heading",s.getHeading()),f.accuracy&&d.set("accuracy",s.getAccuracy()),f.altitudeAccuracy&&d.set("altitudeAccuracy",s.getAltitudeAccuracy()),f.speed&&d.set("speed",s.getSpeed());break;case"LineString":this.path_.length>1?(p=new ol.geom.LineString(this.path_,"XYZM"),this.get("tolerance")&&(p=this.simplify3D(p,this.get("tolerance"))),d.setGeometry(p)):d.setGeometry();break;case"Polygon":this.path_.length>2?(p=new ol.geom.Polygon([this.path_],"XYZM"),this.get("tolerance")&&(p=this.simplify3D(p,this.get("tolerance"))),d.setGeometry(p)):d.setGeometry()}this.dispatchEvent({type:"drawing",feature:this.sketch_[1],geolocation:s})}this.sketch_[2].setGeometry(new ol.geom.Point(r)),this.sketch_[2].set("heading",l),this.dispatchEvent({type:"tracking",feature:this.sketch_[1],geolocation:s})}},ol.interaction.GeolocationDraw.prototype.getPosition=function(t){var e=t.getPosition();return e.push(Math.round(100*(t.getAltitude()||0))/100),e.push(Math.round((new Date).getTime()/1e3)),e},ol.interaction.Hover=function(t){t||(t={});var e=this;ol.interaction.Interaction.call(this,{handleEvent:function(o){return"pointermove"==o.type&&e.handleMove_(o),!t.handleEvent||t.handleEvent(o)}}),t.layers&&t.layers.length?this.setFeatureFilter((function(e,o){return t.layers.indexOf(o)>=0})):this.setFeatureFilter(t.featureFilter),this.setLayerFilter(t.layerFilter),this.set("hitTolerance",t.hitTolerance),this.setCursor(t.cursor)},ol.ext.inherits(ol.interaction.Hover,ol.interaction.Interaction),ol.interaction.Hover.prototype.setMap=function(t){void 0!==this.previousCursor_&&this.getMap()&&(this.getMap().getTargetElement().style.cursor=this.previousCursor_,this.previousCursor_=void 0),ol.interaction.Interaction.prototype.setMap.call(this,t)},ol.interaction.Hover.prototype.setActive=function(t){if(ol.interaction.Interaction.prototype.setActive.call(this,t),this.cursor_&&this.getMap()){var e=this.getMap().getTargetElement().style;void 0!==this.previousCursor_&&(e.cursor=this.previousCursor_,this.previousCursor_=void 0)}},ol.interaction.Hover.prototype.setCursor=function(t){!t&&void 0!==this.previousCursor_&&this.getMap()&&(this.getMap().getTargetElement().style.cursor=this.previousCursor_,this.previousCursor_=void 0),this.cursor_=t},ol.interaction.Hover.prototype.setFeatureFilter=function(t){this.featureFilter_="function"==typeof t?t:function(){return!0}},ol.interaction.Hover.prototype.setLayerFilter=function(t){this.layerFilter_="function"==typeof t?t:function(){return!0}},ol.interaction.Hover.prototype.handleMove_=function(t){var e=this.getMap();if(e){var o,i,n=this,r=e.forEachFeatureAtPixel(t.pixel,(function(t,e){return n.layerFilter_.call(null,e)&&n.featureFilter_.call(null,t,e)?(o=t,i=e,!0):(o=i=null,!1)}),{hitTolerance:this.get("hitTolerance")});if(r&&this.dispatchEvent({type:"hover",feature:o,layer:i,coordinate:t.coordinate,pixel:t.pixel,map:t.map,dragging:t.dragging}),this.feature_===o&&this.layer_===i||(this.feature_=o,this.layer_=i,o?this.dispatchEvent({type:"enter",feature:o,layer:i,coordinate:t.coordinate,pixel:t.pixel,map:t.map,dragging:t.dragging}):this.dispatchEvent({type:"leave",coordinate:t.coordinate,pixel:t.pixel,map:t.map,dragging:t.dragging})),this.cursor_){var a=e.getTargetElement().style;r?a.cursor!=this.cursor_&&(this.previousCursor_=a.cursor,a.cursor=this.cursor_):void 0!==this.previousCursor_&&(a.cursor=this.previousCursor_,this.previousCursor_=void 0)}}},ol.interaction.LongTouch=function(t){t||(t={}),this.delay_=t.delay||1e3;var e=t.handleLongTouchEvent||function(){},o=null;ol.interaction.Interaction.call(this,{handleEvent:function(t){if(this.getActive())switch(t.type){case"pointerdown":o&&clearTimeout(o),o=setTimeout((function(){t.type="longtouch",e(t)}),this.delay_);break;case"pointerdrag":case"pointerup":o&&(clearTimeout(o),o=null)}else o&&(clearTimeout(o),o=null);return!0}})},ol.ext.inherits(ol.interaction.LongTouch,ol.interaction.Interaction),ol.interaction.Modify.prototype.getModifiedFeatures=function(){var t={};this.dragSegments_.forEach((function(e){var o=e[0].feature;window.ol&&window.ol.util?t[ol.util.getUid(o)]=o:t[ol.getUid(o)]=o}));var e=[];for(var o in t)e.push(t[o]);return e},ol.interaction.ModifyFeature=function(t){var e,o;t||(t={}),ol.interaction.Pointer.call(this,{handleEvent:function(t){switch(t.type){case"pointerdown":return e=this.handleDownEvent(t),o=e||this._deleteCondition(t),!e;case"pointerup":return e=!1,this.handleUpEvent(t);case"pointerdrag":return!e||this.handleDragEvent(t);case"pointermove":return!!e||this.handleMoveEvent(t);case"singleclick":case"click":return!o;default:return!0}}}),this.snapDistance_=t.pixelTolerance||10,this.tolerance_=1e-10,this.cursor_=t.cursor,this.sources_=t.sources?t.sources instanceof Array?t.sources:[t.sources]:[],t.source&&this.sources_.push(t.source),t.features&&this.sources_.push(new ol.source.Vector({features:t.features})),this.filterSplit_=t.filter||function(){return!0},this._condition=t.condition||ol.events.condition.primaryAction,this._deleteCondition=t.deleteCondition||ol.events.condition.altKeyOnly,this._insertVertexCondition=t.insertVertexCondition||ol.events.condition.always;var i=function(){return[new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:[0,153,255,1]}),stroke:new ol.style.Stroke({color:"#FFF",width:1.25})})})]};t.style&&(i="function"==typeof t.style?t.style:function(){return t.style}),this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1}),name:"Modify overlay",displayInLayerSwitcher:!1,style:i,wrapX:t.wrapX})},ol.ext.inherits(ol.interaction.ModifyFeature,ol.interaction.Pointer),ol.interaction.ModifyFeature.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Interaction.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t)},ol.interaction.ModifyFeature.prototype.setActive=function(t){ol.interaction.Interaction.prototype.setActive.call(this,t),this.overlayLayer_&&this.overlayLayer_.getSource().clear()},ol.interaction.ModifyFeature.prototype.getClosestFeature=function(t){for(var e,o,i=this.snapDistance_+1,n=0;n<this.sources_.length;n++){var r=this.sources_[n];if((e=r.getClosestFeatureToCoordinate(t.coordinate))&&this.filterSplit_(e)){var a=e.getGeometry().getClosestPoint(t.coordinate),s=ol.coordinate.dist2d(t.coordinate,a)/t.frameState.viewState.resolution;s<i&&(i=s,o=a);break}}if(i>this.snapDistance_)return this.currentFeature&&this.dispatchEvent({type:"select",selected:[],deselected:[this.currentFeature]}),this.currentFeature=null,!1;var l=this.getNearestCoord(o,e.getGeometry());if(l){l=l.coord;var c=this.getMap().getPixelFromCoordinate(l);return ol.coordinate.dist2d(t.pixel,c)<this.snapDistance_&&(o=l),this.currentFeature!==e&&this.dispatchEvent({type:"select",selected:[e],deselected:[this.currentFeature]}),this.currentFeature=e,{source:r,feature:e,coord:o}}},ol.interaction.ModifyFeature.prototype.getNearestCoord=function(t,e){var o,i,n,r,a;switch(e.getType()){case"Point":return{coord:e.getCoordinates(),dist:ol.coordinate.dist2d(e.getCoordinates(),t)};case"MultiPoint":return this.getNearestCoord(t,new ol.geom.LineString(e.getCoordinates()));case"LineString":case"LinearRing":var s;a=Number.MAX_VALUE;var l=e.getCoordinates();for(o=0;o<l.length;o++)(s=ol.coordinate.dist2d(t,l[o]))<a&&(a=s,r=l[o]);return{coord:r,dist:a};case"MultiLineString":var c=e.getLineStrings();for(r=!1,a=Number.MAX_VALUE,o=0;i=c[o];o++)(n=this.getNearestCoord(t,i))&&n.dist<a&&(r=n,a=n.dist,r.ring=o);return r;case"Polygon":var h=e.getLinearRings();for(r=!1,a=Number.MAX_VALUE,o=0;i=h[o];o++)(n=this.getNearestCoord(t,i))&&n.dist<a&&(r=n,a=n.dist,r.ring=o);return r;case"MultiPolygon":var u=e.getPolygons();for(r=!1,a=Number.MAX_VALUE,o=0;i=u[o];o++)(n=this.getNearestCoord(t,i))&&n.dist<a&&(r=n,a=n.dist,r.poly=o);return r;case"GeometryCollection":var p=e.getGeometries();for(r=!1,a=Number.MAX_VALUE,o=0;i=p[o];o++)(n=this.getNearestCoord(t,i))&&n.dist<a&&(r=n,a=n.dist,r.geom=o);return r;default:return!1}},ol.interaction.ModifyFeature.prototype.getArcs=function(t,e){var o,i,n,r,a,s=!1;switch(t.getType()){case"Point":ol.coordinate.equal(e,t.getCoordinates())&&(s={geom:t,type:t.getType(),coord1:[],coord2:[],node:!0});break;case"MultiPoint":for(o=t.getCoordinates(),i=0;i<o.length;i++)if(ol.coordinate.equal(e,o[i])){s={geom:t,type:t.getType(),index:i,coord1:[],coord2:[],node:!0};break}break;case"LinearRing":case"LineString":var l=t.getClosestPoint(e);if(ol.coordinate.dist2d(l,e)<1.5*this.tolerance_){var c;if((c="LinearRing"===t.getType()?(a=new ol.geom.LineString(t.getCoordinates())).splitAt(e,this.tolerance_):t.splitAt(e,this.tolerance_)).length>2){for(o=c[1].getCoordinates(),i=2;n=c[i];i++){var h=n.getCoordinates();h.shift(),o=o.concat(h)}c=[c[0],new ol.geom.LineString(o)]}if(2===c.length){var u=c[0].getCoordinates(),p=c[1].getCoordinates(),d=u.length+p.length-1;u.pop(),p.shift(),s={geom:t,type:t.getType(),coord1:u,coord2:p,node:t.getCoordinates().length===d,closed:!1}}else if(1===c.length){n=c[0].getCoordinates();var f=ol.coordinate.equal(n[0],e),g=ol.coordinate.equal(n[n.length-1],e);f?(n.shift(),g&&n.pop(),s={geom:t,type:t.getType(),coord1:[],coord2:n,node:!0,closed:g}):g&&(n.pop(),s={geom:t,type:t.getType(),coord1:n,coord2:[],node:!0,closed:!1})}}break;case"MultiLineString":var m=t.getLineStrings();for(i=0;r=m[i];i++)if(s=this.getArcs(r,e)){s.geom=t,s.type=t.getType(),s.lstring=i;break}break;case"Polygon":var y=t.getLinearRings();for(i=0;r=y[i];i++)if(s=this.getArcs(r,e)){s.geom=t,s.type=t.getType(),s.index=i;break}break;case"MultiPolygon":var v=t.getPolygons();for(i=0;r=v[i];i++)if(s=this.getArcs(r,e)){s.geom=t,s.type=t.getType(),s.poly=i;break}break;case"GeometryCollection":for(a=t.getGeometries(),i=0;r=a[i];i++)if(s=this.getArcs(r,e)){s.geom=t,s.g=i,s.typeg=s.type,s.type=t.getType();break}break;default:console.error("ol/interaction/ModifyFeature "+t.getType()+" not supported!")}return s},ol.interaction.ModifyFeature.prototype.handleDownEvent=function(t){if(!this.getActive())return!1;var e=this.getClosestFeature(t);if(e&&(this._condition(t)||this._deleteCondition(t))){var o=[];return this.arcs=[],this.sources_.forEach(function(t){var i=ol.extent.buffer(ol.extent.boundingExtent([e.coord]),this.tolerance_);o=o.concat(o,t.getFeaturesInExtent(i))}.bind(this)),this._modifiedFeatures=[],o.forEach(function(o){var i=this.getArcs(o.getGeometry(),e.coord);i&&(this._insertVertexCondition(t)||i.node)&&(i.feature=o,this._modifiedFeatures.push(o),this.arcs.push(i))}.bind(this)),!this._modifiedFeatures.length||(this._deleteCondition(t)?!this._removePoint(e,t):(this.dispatchEvent({type:"modifystart",coordinate:e.coord,originalEvent:t.originalEvent,features:this._modifiedFeatures}),this.handleDragEvent({coordinate:e.coord,originalEvent:t.originalEvent}),!0))}return!1},ol.interaction.ModifyFeature.prototype.getModifiedFeatures=function(){return this._modifiedFeatures||[]},ol.interaction.ModifyFeature.prototype.removePoint=function(){this._removePoint({},{})},ol.interaction.ModifyFeature.prototype._getModification=function(t){var e=t.coord1.concat(t.coord2);switch(t.type){case"LineString":if(t.closed&&e.push(e[0]),e.length>1&&t.geom.getCoordinates().length!=e.length)return t.coords=e,!0;break;case"MultiLineString":if(t.closed&&e.push(e[0]),e.length>1){var o=t.geom.getCoordinates();if(o[t.lstring].length!=e.length)return o[t.lstring]=e,t.coords=o,!0}break;case"Polygon":if(t.closed&&e.push(e[0]),e.length>3&&(o=t.geom.getCoordinates())[t.index].length!=e.length)return o[t.index]=e,t.coords=o,!0;break;case"MultiPolygon":if(t.closed&&e.push(e[0]),e.length>3&&(o=t.geom.getCoordinates())[t.poly][t.index].length!=e.length)return o[t.poly][t.index]=e,t.coords=o,!0;break;case"GeometryCollection":t.type=t.typeg;var i=t.geom,n=i.getGeometries();t.geom=n[t.g];var r=this._getModification(t);return i.setGeometries(n),t.geom=i,t.type="GeometryCollection",r}return!1},ol.interaction.ModifyFeature.prototype._removePoint=function(t,e){if(!this.arcs)return!1;this.overlayLayer_.getSource().clear();var o=!1;return this.arcs.forEach(function(t){o=o||this._getModification(t)}.bind(this)),o&&(this.dispatchEvent({type:"modifystart",coordinate:t.coord,originalEvent:e.originalEvent,features:this._modifiedFeatures}),this.arcs.forEach(function(t){if("GeometryCollection"===t.geom.getType()){if(t.coords){var e=t.geom.getGeometries();e[t.g].setCoordinates(t.coords),t.geom.setGeometries(e)}}else t.coords&&t.geom.setCoordinates(t.coords)}.bind(this)),this.dispatchEvent({type:"modifyend",coordinate:t.coord,originalEvent:e.originalEvent,features:this._modifiedFeatures})),this.arcs=[],o},ol.interaction.ModifyFeature.prototype.handleUpEvent=function(t){return!!this.getActive()&&(!this.arcs||!this.arcs.length||(this.overlayLayer_.getSource().clear(),this.dispatchEvent({type:"modifyend",coordinate:t.coordinate,originalEvent:t.originalEvent,features:this._modifiedFeatures}),this.arcs=[],!0))},ol.interaction.ModifyFeature.prototype.setArcCoordinates=function(t,e){var o;switch(t.type){case"Point":t.geom.setCoordinates(e[0]);break;case"MultiPoint":(o=t.geom.getCoordinates())[t.index]=e[0],t.geom.setCoordinates(o);break;case"LineString":t.geom.setCoordinates(e);break;case"MultiLineString":(o=t.geom.getCoordinates())[t.lstring]=e,t.geom.setCoordinates(o);break;case"Polygon":(o=t.geom.getCoordinates())[t.index]=e,t.geom.setCoordinates(o);break;case"MultiPolygon":(o=t.geom.getCoordinates())[t.poly][t.index]=e,t.geom.setCoordinates(o);break;case"GeometryCollection":t.type=t.typeg;var i=t.geom,n=i.getGeometries();t.geom=n[t.g],this.setArcCoordinates(t,e),i.setGeometries(n),t.geom=i,t.type="GeometryCollection"}},ol.interaction.ModifyFeature.prototype.handleDragEvent=function(t){if(!this.getActive())return!1;if(!this.arcs)return!0;this.overlayLayer_.getSource().clear();var e=new ol.Feature(new ol.geom.Point(t.coordinate));return this.overlayLayer_.getSource().addFeature(e),!this.arcs.length||(this.arcs.forEach(function(e){var o=e.coord1.concat([t.coordinate],e.coord2);e.closed&&o.push(t.coordinate),this.setArcCoordinates(e,o)}.bind(this)),this.dispatchEvent({type:"modifying",coordinate:t.coordinate,originalEvent:t.originalEvent,features:this._modifiedFeatures}),!0)},ol.interaction.ModifyFeature.prototype.handleMoveEvent=function(t){if(!this.getActive())return!1;this.overlayLayer_.getSource().clear();var e=this.getClosestFeature(t);if(e){var o=new ol.Feature(new ol.geom.Point(e.coord));this.overlayLayer_.getSource().addFeature(o)}var i=t.map.getTargetElement();this.cursor_&&(e?i.style.cursor!=this.cursor_&&(this.previousCursor_=i.style.cursor,i.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(i.style.cursor=this.previousCursor_,this.previousCursor_=void 0))},ol.interaction.ModifyFeature.prototype.getCurrentFeature=function(){return this.currentFeature},ol.interaction.ModifyTouch=function(t){var e=this;t||(t={}),this._popup=new ol.Overlay.Popup({popupClass:t.className||"modifytouch",positioning:t.positioning||"bottom-rigth",offsetBox:t.offsetBox||10}),this._source=t.source,this._features=t.features;var o=document.createElement("a");o.appendChild(document.createTextNode(t.title||"remove point")),o.onclick=function(){e.removePoint()},this.setPopupContent(o);var i=(t.pixelTolerance||0)+5;t.condition=function(t){var e,o,n=this.getMap().getFeaturesAtPixel(t.pixel,{hitTolerance:i}),r=!1;if(n){var a=this._features;if(!a){e=[t.pixel[0]-i,t.pixel[1]-i],o=[t.pixel[0]+i,t.pixel[1]+i],e=this.getMap().getCoordinateFromPixel(e),o=this.getMap().getCoordinateFromPixel(o);var s=ol.extent.boundingExtent([e,o]);a=this._source.getFeaturesInExtent(s)}a.getArray&&(a=a.getArray());for(var l,c=0;(l=n[c])&&!(a.indexOf(l)>=0);c++);if(l){e=t.pixel,o=l.getGeometry().getClosestPoint(t.coordinate),o=this.getMap().getPixelFromCoordinate(o);var h=e[0]-o[0],u=e[1]-o[1];r=Math.sqrt(h*h+u*u)<i}}return this.showDeleteBt(r?{type:"show",feature:l,coordinate:t.coordinate}:{type:"hide"}),!0},t.insertVertexCondition=function(){return this.showDeleteBt({type:"hide"}),!0},ol.interaction.Modify.call(this,t),this.on(["modifystart","modifyend"],(function(){this.showDeleteBt({type:"hide",modifying:!0})})),this.set("usePopup",!1!==t.usePopup)},ol.ext.inherits(ol.interaction.ModifyTouch,ol.interaction.Modify),ol.interaction.ModifyTouch.prototype.setMap=function(t){this.getMap()&&this.getMap().removeOverlay(this._popup),ol.interaction.Modify.prototype.setMap.call(this,t),this.getMap()&&this.getMap().addOverlay(this._popup)},ol.interaction.ModifyTouch.prototype.setActive=function(t){ol.interaction.Modify.prototype.setActive.call(this,t),this.showDeleteBt({type:"hide"})},ol.interaction.ModifyTouch.prototype.removePoint=function(){new Date-this._timeout<200||(ol.interaction.Modify.prototype.removePoint.call(this),this.showDeleteBt({type:"hide"}))},ol.interaction.ModifyTouch.prototype.showDeleteBt=function(t){this.get("usePopup")&&"show"===t.type?this._popup.show(t.coordinate,this._menu):this._popup.hide(),t.type+="popup",this.dispatchEvent(t),this._timeout=new Date},ol.interaction.ModifyTouch.prototype.setPopupContent=function(t){this._menu=t},ol.interaction.ModifyTouch.prototype.getPopupContent=function(){return this._menu},ol.interaction.Offset=function(t){t||(t={}),ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=t.features,this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this.set("duplicate",t.duplicate),this.source_=t.source,this._style="function"==typeof t.style?t.style:function(){return t.style?t.style:ol.style.Style.defaultStyle(!0)},this.previousCursor_=!1},ol.ext.inherits(ol.interaction.Offset,ol.interaction.Pointer),ol.interaction.Offset.prototype.setMap=function(t){ol.interaction.Pointer.prototype.setMap.call(this,t)},ol.interaction.Offset.prototype.getFeatureAtPixel_=function(t){var e=this;return this.getMap().forEachFeatureAtPixel(t.pixel,(function(o,i){var n;if(e.layers_){for(var r=0;r<e.layers_.length;r++)if(e.layers_[r]===i){n=o;break}}else e.features_?e.features_.forEach((function(t){t===o&&(n=o)})):n=o;var a=n.getGeometry().getType();if(n&&/Polygon|LineString/.test(a)){if("Polygon"===a&&n.getGeometry().getCoordinates().length>1)return!1;var s=n.getGeometry().getClosestPoint(t.coordinate),l=s[0]-t.coordinate[0],c=s[1]-t.coordinate[1];return Math.sqrt(l*l+c*c)/t.frameState.viewState.resolution<5&&{feature:n,hit:s,coordinates:n.getGeometry().getCoordinates(),geom:n.getGeometry().clone(),geomType:a}}return!1}),{hitTolerance:5})},ol.interaction.Offset.prototype.handleDownEvent_=function(t){return this.current_=this.getFeatureAtPixel_(t),!!this.current_&&(this.currentStyle_=this.current_.feature.getStyle(),this.current_.feature.setStyle(this._style(this.current_.feature)),this.source_&&(this.get("duplicate")||t.originalEvent.ctrlKey)?(this.current_.feature=this.current_.feature.clone(),this.source_.addFeature(this.current_.feature)):this.dispatchEvent({type:"modifystart",features:[this.current_.feature]}),this.dispatchEvent({type:"offsetstart",feature:this.current_.feature,offset:0}),!0)},ol.interaction.Offset.prototype.handleDragEvent_=function(t){var e,o,i,n,r=this.current_.geom.getClosestPoint(t.coordinate),a=ol.coordinate.dist2d(r,t.coordinate);switch(this.current_.geomType){case"Polygon":if(e=ol.coordinate.findSegment(r,this.current_.coordinates[0]).segment){o=[e[1][0]-e[0][0],e[1][1]-e[0][1]],i=[t.coordinate[0]-r[0],t.coordinate[1]-r[1]],o[0]*i[1]-o[1]*i[0]>0&&(a=-a),n=[];for(var s=0;s<this.current_.coordinates.length;s++)n.push(ol.coordinate.offsetCoords(this.current_.coordinates[s],0==s?a:-a));this.current_.feature.setGeometry(new ol.geom.Polygon(n))}break;case"LineString":(e=ol.coordinate.findSegment(r,this.current_.coordinates).segment)&&(o=[e[1][0]-e[0][0],e[1][1]-e[0][1]],i=[t.coordinate[0]-r[0],t.coordinate[1]-r[1]],o[0]*i[1]-o[1]*i[0]>0&&(a=-a),n=ol.coordinate.offsetCoords(this.current_.coordinates,a),this.current_.feature.setGeometry(new ol.geom.LineString(n)))}this.dispatchEvent({type:"offsetting",feature:this.current_.feature,offset:a,segment:[r,t.coordinate],coordinate:t.coordinate})},ol.interaction.Offset.prototype.handleUpEvent_=function(t){this.dispatchEvent({type:"offsetend",feature:this.current_.feature,coordinate:t.coordinate}),this.current_.feature.setStyle(this.currentStyle_),this.current_=!1},ol.interaction.Offset.prototype.handleMoveEvent_=function(t){this.getFeatureAtPixel_(t)?(!1===this.previousCursor_&&(this.previousCursor_=t.map.getTargetElement().style.cursor),t.map.getTargetElement().style.cursor="pointer"):(t.map.getTargetElement().style.cursor=this.previousCursor_,this.previousCursor_=!1)},ol.interaction.Ripple=function(t){ol.interaction.Pointer.call(this,{handleDownEvent:this.rainDrop,handleMoveEvent:this.rainDrop}),t=t||{},this.riprad=t.radius||3,this.ripplemap=[],this.last_map=[],this.rains(this.interval),t.layer.on(["postcompose","postrender"],this.postcompose_.bind(this))},ol.ext.inherits(ol.interaction.Ripple,ol.interaction.Pointer),ol.interaction.Ripple.prototype.rains=function(t){this.onrain&&clearTimeout(this.onrain);var e=this,o=("number"==typeof t?t:1e3)/2,i=3*o/2,n=Math.random;i&&function t(){e.width&&e.rainDrop([n()*e.width,n()*e.height]),e.onrain=setTimeout(t,n()*o+i)}()},ol.interaction.Ripple.prototype.rainDrop=function(t){if(this.width){var e,o;t.pixel?(e=t.pixel[0]*this.ratio,o=t.pixel[1]*this.ratio):(e=t[0]*this.ratio,o=t[1]*this.ratio),e<<=0;for(var i=(o<<=0)-this.riprad*this.ratio;i<o+this.riprad*this.ratio;i++)for(var n=e-this.riprad*this.ratio;n<e+this.riprad*this.ratio;n++)this.ripplemap[this.oldind+i*this.width+n]+=128}},ol.interaction.Ripple.prototype.postcompose_=function(t){var e,o,i,n,r,a=t.context,s=a.canvas;if(this.width!=s.width||this.height!=s.height){this.width=s.width,this.height=s.height,this.ratio=t.frameState.pixelRatio,this.half_width=this.width>>1,this.half_height=this.height>>1,this.size=this.width*(this.height+2)*2,this.oldind=this.width,this.newind=this.width*(this.height+3);for(var l=0;l<this.size;l++)this.last_map[l]=this.ripplemap[l]=0}this.texture=a.getImageData(0,0,this.width,this.height),this.ripple=a.getImageData(0,0,this.width,this.height);var c=this.oldind;this.oldind=this.newind,this.newind=c,l=0;for(var h=this.ripple.data,u=this.texture.data,p=0;p<this.height;p++)for(var d=0;d<this.width;d++){var f=this.newind+l,g=this.oldind+l;i=this.ripplemap[g-this.width]+this.ripplemap[g+this.width]+this.ripplemap[g-1]+this.ripplemap[g+1]>>1,i-=this.ripplemap[f],i-=i>>5,this.ripplemap[f]=i,i=1024-i,this.last_map[l]!=i&&(this.last_map[l]=i,e=((d-this.half_width)*i/1024<<0)+this.half_width,o=((p-this.half_height)*i/1024<<0)+this.half_height,e>=this.width&&(e=this.width-1),e<0&&(e=0),o>=this.height&&(o=this.height-1),o<0&&(o=0),r=4*(e+o*this.width),h[n=4*l]=u[r],h[n+1]=u[r+1],h[n+2]=u[r+2]),++l}a.putImageData(this.ripple,0,0),this.getMap().render()},ol.interaction.SelectCluster=function(t){var e;t=t||{},this.pointRadius=t.pointRadius||12,this.circleMaxObjects=t.circleMaxObjects||10,this.maxObjects=t.maxObjects||60,this.spiral=!1!==t.spiral,this.animate=t.animate,this.animationDuration=t.animationDuration||500,this.selectCluster_=!1!==t.selectCluster;var o=this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:new ol.Collection,wrapX:t.wrapX,useSpatialIndex:!0}),name:"Cluster overlay",updateWhileAnimating:!0,updateWhileInteracting:!0,displayInLayerSwitcher:!1,style:t.featureStyle});t.layers&&("function"==typeof t.layers?(e=t.layers,t.layers=function(t){return t===o||e(t)}):t.layers.push&&t.layers.push(this.overlayLayer_)),t.filter?(e=t.filter,t.filter=function(t,o){return!(!o&&t.get("selectclusterlink"))&&e(t,o)}):t.filter=function(t,e){return!(!e&&t.get("selectclusterlink"))},this.filter_=t.filter,ol.interaction.Select.call(this,t),this.on("select",this.selectCluster.bind(this))},ol.ext.inherits(ol.interaction.SelectCluster,ol.interaction.Select),ol.interaction.SelectCluster.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.interaction.Select.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t),t&&t.getView()&&(this._listener=t.getView().on("change:resolution",this.clear.bind(this)))},ol.interaction.SelectCluster.prototype.clear=function(){this.getFeatures().clear(),this.overlayLayer_.getSource().clear()},ol.interaction.SelectCluster.prototype.getLayer=function(){return this.overlayLayer_},ol.interaction.SelectCluster.prototype.selectCluster=function(t){if(t instanceof ol.Feature&&(t={selected:[t]}),t.selected.length){var e=t.selected[0];if(!e.get("selectclusterfeature")){var o=this.overlayLayer_.getSource();o.clear();var i=e.get("features");if(i&&1!=i.length){this.selectCluster_||this.getFeatures().clear();var n,r,a,s,l,c,h,u=e.getGeometry().getCoordinates(),p=this.getMap().getView().getResolution(),d=[];if(!this.spiral||i.length<=this.circleMaxObjects)for(s=Math.min(i.length,this.circleMaxObjects),n=p*this.pointRadius*(.5+s/4),a=0;a<s;a++)r=2*Math.PI*a/s,2!=s&&4!=s||(r+=Math.PI/4),l=[u[0]+n*Math.sin(r),u[1]+n*Math.cos(r)],(c=new ol.Feature({selectclusterfeature:!0,features:[i[a]],geometry:new ol.geom.Point(l)})).setStyle(i[a].getStyle()),d.push(c),h=new ol.Feature({selectclusterlink:!0,geometry:new ol.geom.LineString([u,l])}),d.push(h);else{r=0;var f=2*this.pointRadius;for(s=Math.min(this.maxObjects,i.length),a=0;a<s;a++){r+=(f+.1)/(n=f/2+f*r/(2*Math.PI));var g=p*n*Math.sin(r),m=p*n*Math.cos(r);l=[u[0]+g,u[1]+m],(c=new ol.Feature({selectclusterfeature:!0,features:[i[a]],geometry:new ol.geom.Point(l)})).setStyle(i[a].getStyle()),d.push(c),h=new ol.Feature({selectclusterlink:!0,geometry:new ol.geom.LineString([u,l])}),d.push(h)}}o.clear(),this.animate?this.animateCluster_(u,d):o.addFeatures(d)}}}else this.clear()},ol.interaction.SelectCluster.prototype.animateCluster_=function(t,e){if(this.listenerKey_&&ol.Observable.unByKey(this.listenerKey_),e.length){var o=this.overlayLayer_.getStyle(),i="function"==typeof o?o:o.length?function(){return o}:function(){return[o]},n=this.animationDuration||500,r=(new Date).getTime();this.listenerKey_=this.overlayLayer_.on(["postcompose","postrender"],function(o){for(var a,s=o.vectorContext||ol.render.getVectorContext(o),l=o.frameState.pixelRatio,c=this.getMap().getView().getResolution(),h=ol.easing.easeOut((o.frameState.time-r)/n),u=0;a=e[u];u++)if(a.get("features")){var p=a.getGeometry().getCoordinates();p[0]=t[0]+h*(p[0]-t[0]),p[1]=t[1]+h*(p[1]-t[1]);for(var d=new ol.geom.Point(p),f=i(a,c),g=0;g<f.length;g++){var m,y=!ol.Map.prototype.getFeaturesAtPixel&&f[g].getImage();y&&(m=y.getScale(),y.setScale(l)),s.setStyle?(s.setStyle(f[g]),s.drawGeometry(d)):(s.setImageStyle(y),s.drawPointGeometry(d)),y&&y.setScale(m)}}if(h>1)return ol.Observable.unByKey(this.listenerKey_),this.overlayLayer_.getSource().addFeatures(e),void this.overlayLayer_.changed();o.frameState.animate=!0}.bind(this));var a=new ol.Feature(new ol.geom.Point(this.getMap().getView().getCenter()));a.setStyle(new ol.style.Style({image:new ol.style.Circle({})})),this.overlayLayer_.getSource().addFeature(a)}},ol.interaction.SelectCluster.prototype.getClusterExtent=function(t){if(!t.get("features"))return null;var e=ol.extent.createEmpty();return t.get("features").forEach((function(t){e=ol.extent.extend(e,t.getGeometry().getExtent())})),e[0]===e[2]&&e[1]===e[3]?null:e},ol.interaction.SnapGuides=function(t){function e(t,e){var o=t[1][0]-t[0][0],i=t[1][1]-t[0][1],n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=o*r-i*n;if(0!=a){var s=(o*t[0][1]-o*e[0][1]-i*t[0][0]+i*e[0][0])/a;return[e[0][0]+s*n,e[0][1]+s*r]}return!1}function o(t,e){var o=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(o*o+i*i)}t||(t={}),this.snapDistance_=t.pixelTolerance||10,this.enableInitialGuides_=t.enableInitialGuides||!1;var i=[new ol.style.Style({stroke:new ol.style.Stroke({color:"#ffcc33",lineDash:[8,5],width:1.25})})];t.style&&(i=t.style instanceof Array?t.style:[t.style]),this.overlaySource_=new ol.source.Vector({features:new ol.Collection,useSpatialIndex:!1});var n=t.vectorClass||ol.layer.Vector;this.overlayLayer_=new n({renderMode:"image",source:this.overlaySource_,style:function(){return i},name:"Snap overlay",displayInLayerSwitcher:!1}),ol.interaction.Interaction.call(this,{handleEvent:function(t){if(this.getActive()){for(var i,n=this.overlaySource_.getFeatures(),r=null,a=null,s=t.frameState.viewState.resolution,l=0;i=n[l];l++){var c=i.getGeometry().getClosestPoint(t.coordinate);if(o(c,t.coordinate)/s<this.snapDistance_){if(r){var h=e(r.getGeometry().getCoordinates(),i.getGeometry().getCoordinates());h&&o(h,t.coordinate)/s<this.snapDistance_&&(a=h)}else a=c;r=i}}a&&(t.coordinate=a)}return!0}})},ol.ext.inherits(ol.interaction.SnapGuides,ol.interaction.Interaction),ol.interaction.SnapGuides.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Interaction.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t),t&&(this.projExtent_=t.getView().getProjection().getExtent())},ol.interaction.SnapGuides.prototype.setActive=function(t){this.overlayLayer_.setVisible(t),ol.interaction.Interaction.prototype.setActive.call(this,t)},ol.interaction.SnapGuides.prototype.clearGuides=function(t){if(t)for(var e,o=0;e=t[o];o++)try{this.overlaySource_.removeFeature(e)}catch(t){}else this.overlaySource_.clear()},ol.interaction.SnapGuides.prototype.getGuides=function(){return this.overlaySource_.getFeaturesCollection()},ol.interaction.SnapGuides.prototype.addGuide=function(t,e){if(t){var o=this.getMap(),i=o.getView().calculateExtent(o.getSize()),n=Math.max(this.projExtent_[2]-this.projExtent_[0],this.projExtent_[3]-this.projExtent_[1]);(i=ol.extent.buffer(i,1.5*n))[0]<this.projExtent_[0]&&(i[0]=this.projExtent_[0]),i[1]<this.projExtent_[1]&&(i[1]=this.projExtent_[1]),i[2]>this.projExtent_[2]&&(i[2]=this.projExtent_[2]),i[3]>this.projExtent_[3]&&(i[3]=this.projExtent_[3]);var r=t[0][0]-t[1][0],a=t[0][1]-t[1][1],s=1/Math.sqrt(r*r+a*a),l=function(o){for(var l,c=[],h=n*o*2,u=0;(o>0?u<h:u>h)&&(l=e?[t[0][0]+a*s*u,t[0][1]-r*s*u]:[t[0][0]+r*s*u,t[0][1]+a*s*u],ol.extent.containsCoordinate(i,l));u+=n*o/100)c.push(l);return new ol.Feature(new ol.geom.LineString([c[0],c[c.length-1]]))},c=l(1),h=l(-1);return this.overlaySource_.addFeature(c),this.overlaySource_.addFeature(h),[c,h]}},ol.interaction.SnapGuides.prototype.addOrthoGuide=function(t){return this.addGuide(t,!0)},ol.interaction.SnapGuides.prototype.setDrawInteraction=function(t){var e=this,o=0,i=[];function n(t){var n=t.target.getCoordinates();switch(t.target.getType()){case"Point":return;case"Polygon":n=n[0].slice(0,-1)}var r=n.length;if(2===r&&e.enableInitialGuides_){var a=n[0][0],s=n[0][1];n=[[a,s],[a,s-1]]}if(r!=o&&(e.enableInitialGuides_?r>=2:r>2)){e.clearGuides(i);try{var l=n[r-2],c=n[r-2-1];r>2&&(l[0]!==c[0]||l[1]!==c[1])&&(i=e.addOrthoGuide([n[r-2],n[r-2-1]])),i=(i=i.concat(e.addGuide([n[0],n[1]]))).concat(e.addOrthoGuide([n[0],n[1]])),o=r}catch(t){}}}t.on("drawstart",(function(t){t.feature.getGeometry().on("change",n)})),t.on(["drawend","change:active"],(function(t){e.clearGuides(i),t.feature&&t.feature.getGeometry().un("change",n),o=0,i=[]}))},ol.interaction.SnapGuides.prototype.setModifyInteraction=function(t){function e(t,e){return(t%e+e)%e}var o=this,i=[];function n(t){var n=t.target.vertexFeature_;if(n){var r=t.target.getModifiedFeatures()[0].getGeometry(),a=r.getCoordinates();switch(r.getType()){case"Point":return;case"Polygon":a=a[0].slice(0,-1)}var s=n.getGeometry().getCoordinates(),l=a.findIndex((function(t){return t[0]===s[0]&&t[1]===s[1]})),c=a.length;o.clearGuides(i),i=(i=(i=(i=o.addOrthoGuide([a[e(l-1,c)],a[e(l-2,c)]])).concat(o.addGuide([a[e(l-1,c)],a[e(l-2,c)]]))).concat(o.addGuide([a[e(l+1,c)],a[e(l+2,c)]]))).concat(o.addOrthoGuide([a[e(l+1,c)],a[e(l+2,c)]]))}}t.on("modifystart",(function(t){setTimeout(n,0,t)})),t.on("modifyend",(function(){o.clearGuides(i),i=[]}))},ol.interaction.SnapLayerPixel=function(t){t=t||{},this._layer=t.layer,this._layer.on(["postcompose","postrender"],function(t){this._ctx=t.context}.bind(this));var e=t.radius||8,o=2*e;ol.interaction.Interaction.call(this,{handleEvent:function(t){if(this._layer.getVisible()&&this._layer.getOpacity()&&ol.events.condition.altKeyOnly(t)&&this.getMap()){var i,n,r,a,s=t.pixel[0]-e,l=t.pixel[1]-e,c=this._ctx.getImageData(s,l,o,o).data,h=-1,u=[];for(i=0;i<o;i++)for(u.push([]),n=0;n<o;n++){var p=c[3+4*(i+n*o)];u[i].push(p>10?p:0)}for(i=1;i<o-1;i++)for(n=1;n<o-1;n++){var d=u[i][n+1]+u[i][n]+u[i][n+1]+u[i-1][n-1]+u[i-1][n]+u[i-1][n+1]+u[i+1][n-1]+u[i+1][n]+u[i+1][n+1];d>h&&(h=d,r=i,a=n)}t.pixel=[s+r,l+a],t.coordinate=this.getMap().getCoordinateFromPixel(t.pixel)}return!0}})},ol.ext.inherits(ol.interaction.SnapLayerPixel,ol.interaction.Interaction),ol.interaction.Split=function(t){t||(t={}),ol.interaction.Interaction.call(this,{handleEvent:function(t){switch(t.type){case"singleclick":return this.handleDownEvent(t);case"pointermove":return this.handleMoveEvent(t);default:return!0}}}),this.snapDistance_=t.snapDistance||25,this.tolerance_=t.tolerance||1e-10,this.cursor_=t.cursor,this.sources_=t.sources?t.sources instanceof Array?t.sources:[t.sources]:[],t.features&&this.sources_.push(new ol.source.Vector({features:t.features})),this.filterSplit_=t.filter||function(){return!0};var e=[255,255,255,1],o=[0,153,255,1],i=new ol.style.Fill({color:"rgba(255,255,255,0.4)"}),n=new ol.style.Stroke({color:"#3399CC",width:1.25}),r=[new ol.style.Style({image:new ol.style.Circle({fill:i,stroke:n,radius:5}),fill:i,stroke:n})],a=[new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:5})}),new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:o}),stroke:new ol.style.Stroke({color:e,width:1.5})}),stroke:new ol.style.Stroke({color:o,width:3})})];t.sketchStyle&&(r=t.sketchStyle instanceof Array?t.sketchStyle:[t.sketchStyle]),t.featureStyle&&(a=t.featureStyle instanceof Array?t.featureStyle:[t.featureStyle]),this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1}),name:"Split overlay",displayInLayerSwitcher:!1,style:function(t){return t._sketch_?r:a}})},ol.ext.inherits(ol.interaction.Split,ol.interaction.Interaction),ol.interaction.Split.prototype.setMap=function(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Interaction.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t)},ol.interaction.Split.prototype.getClosestFeature=function(t){var e,o,i,n,r=this.snapDistance_+1;if(this.sources_.forEach((function(a){var s=a.getClosestFeatureToCoordinate(t.coordinate);if(s&&s.getGeometry().splitAt){var l=s.getGeometry().getClosestPoint(t.coordinate),c=new ol.geom.LineString([t.coordinate,l]),h=c.getLength()/t.frameState.viewState.resolution;h<r&&(e=a,r=h,o=s,n=c,i=l)}})),r>this.snapDistance_)return!1;var a=this.getNearestCoord(i,o.getGeometry().getCoordinates()),s=this.getMap().getPixelFromCoordinate(a);return ol.coordinate.dist2d(t.pixel,s)<this.snapDistance_&&(i=a),{source:e,feature:o,coord:i,link:n}},ol.interaction.Split.prototype.getNearestCoord=function(t,e){for(var o,i,n=Number.MAX_VALUE,r=0;r<e.length;r++)(o=ol.coordinate.dist2d(t,e[r]))<n&&(n=o,i=e[r]);return i},ol.interaction.Split.prototype.handleDownEvent=function(t){var e=this.getClosestFeature(t);if(e){this.overlayLayer_.getSource().clear();var o,i=e.feature.getGeometry().splitAt(e.coord,this.tolerance_);if(i.length>1){var n=[];for(o=0;o<i.length;o++){var r=e.feature.clone();r.setGeometry(i[o]),n.push(r)}for(this.dispatchEvent({type:"beforesplit",original:e.feature,features:n}),e.source.dispatchEvent({type:"beforesplit",original:e.feature,features:n}),e.source.removeFeature(e.feature),o=0;o<n.length;o++)e.source.addFeature(n[o]);this.dispatchEvent({type:"aftersplit",original:e.feature,features:n}),e.source.dispatchEvent({type:"aftersplit",original:e.feature,features:n})}}return!1},ol.interaction.Split.prototype.handleMoveEvent=function(t){var e=t.map;this.overlayLayer_.getSource().clear();var o,i,n=this.getClosestFeature(t);n&&this.filterSplit_(n.feature)?(this.overlayLayer_.getSource().addFeature(n.feature),(o=new ol.Feature(new ol.geom.Point(n.coord)))._sketch_=!0,this.overlayLayer_.getSource().addFeature(o),(i=new ol.Feature(n.link))._sketch_=!0,this.overlayLayer_.getSource().addFeature(i),this.dispatchEvent({type:"pointermove",coordinate:t.coordinate,frameState:t.frameState,originalEvent:t.originalEvent,map:t.map,pixel:t.pixel,feature:n.feature,linkGeometry:n.link})):this.dispatchEvent(t);var r=e.getTargetElement();this.cursor_&&(n?r.style.cursor!=this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0))},ol.interaction.Splitter=function(t){t||(t={}),ol.interaction.Interaction.call(this,{handleEvent:function(t){return"pointermove"!=t.type&&"pointerdrag"!=t.type?(this.lastEvent_&&(this.splitSource(this.lastEvent_.feature),this.lastEvent_=null),this.moving_=!1):this.moving_=!0,!0}}),this.added_=[],this.removed_=[],t.features?this.source_=new ol.source.Vector({features:t.features}):this.source_=t.source?t.source:new ol.source.Vector({features:new ol.Collection});var e=this.triggerSource;t.triggerFeatures&&(e=new ol.source.Vector({features:t.triggerFeatures})),e?(e.on("addfeature",this.onAddFeature.bind(this)),e.on("changefeature",this.onChangeFeature.bind(this)),e.on("removefeature",this.onRemoveFeature.bind(this))):(this.source_.on("addfeature",this.onAddFeature.bind(this)),this.source_.on("changefeature",this.onChangeFeature.bind(this)),this.source_.on("removefeature",this.onRemoveFeature.bind(this))),this.tolerance_=t.tolerance||1e-10,this.filterSplit_=t.filter||function(){return!0}},ol.ext.inherits(ol.interaction.Splitter,ol.interaction.Interaction),ol.interaction.Splitter.prototype.intersectSegs=function(t,e){var o=this.tolerance_,i=t[0][0]-t[1][0],n=e[0][0]-e[1][0],r=t[0][1]-t[1][1],a=e[0][1]-e[1][1],s=i*a-r*n;if(Math.abs(s)<o)return!1;var l=((t[0][0]-e[1][0])*a-(t[0][1]-e[1][1])*n)/s;if(Math.abs(l)<o)return t[0];if(Math.abs(1-l)<o)return t[1];if(l<0||l>1)return!1;var c=((t[0][1]-e[1][1])*i-(t[0][0]-e[1][0])*r)/s;if(Math.abs(c)<o)return e[1];if(Math.abs(1-c)<o)return e[0];if(c<0||c>1)return!1;var h=t[0][0]*t[1][1]-t[0][1]*t[1][0],u=e[0][0]*e[1][1]-e[0][1]*e[1][0];return[(h*n-u*i)/s,(h*a-u*r)/s]},ol.interaction.Splitter.prototype.splitSource=function(t){if(!this.splitting){var e,o,i,n=this;this.source_.dispatchEvent({type:"beforesplit",feaure:t,source:this.source_}),this.splitting=!0,this.added_=[],this.removed_=[];var r,a=t.getGeometry().getCoordinates(),s=[];for(e=0;e<a.length-1;e++){r=[a[e],a[e+1]];for(var l,c=ol.extent.buffer(ol.extent.boundingExtent(r),this.tolerance_);;){var h=!1;if(this.source_.forEachFeatureIntersectingExtent(c,m.bind(this)),!h)break;var u=h;for(this.source_.removeFeature(u),o=0;o<l.length;o++)(i=u.clone()).setGeometry(l[o]),this.source_.addFeature(i)}}for(e=0;e<a.length-2;e++)for(var p=e+1;p<a.length-1;p++){var d=this.intersectSegs([a[e],a[e+1]],[a[p],a[p+1]]);d&&d!=a[e+1]&&s.push(d)}var f=!1;if(s.length){var g=t.getGeometry().splitAt(s,this.tolerance_);if(g.length>1){for(o=0;o<g.length;o++)(i=t.clone()).setGeometry(g[o]),this.source_.addFeature(i);f=!0}}setTimeout((function(){f&&n.source_.removeFeature(t),n.source_.dispatchEvent({type:"aftersplit",featureAdded:n.added_,featureRemoved:n.removed_,source:this.source_}),n.splitting=!1}),0)}function m(e){if(e!==t)for(var o=e.getGeometry().getCoordinates(),i=0;i<o.length-1;i++){var n=this.intersectSegs(r,[o[i],o[i+1]]);if(n&&(s.push(n),(l=e.getGeometry().splitAt(n,this.tolerance_))&&l.length>1))return h=e,!0}return!1}},ol.interaction.Splitter.prototype.onAddFeature=function(t){this.splitSource(t.feature),this.splitting&&this.added_.push(t.feature)},ol.interaction.Splitter.prototype.onRemoveFeature=function(t){if(this.splitting){var e=this.added_.indexOf(t.feature);-1==e?this.removed_.push(t.feature):this.added_.splice(e,1)}},ol.interaction.Splitter.prototype.onChangeFeature=function(t){this.moving_?this.lastEvent_=t:this.splitSource(t.feature)},ol.interaction.Synchronize=function(t){t||(t={});var e=this;ol.interaction.Interaction.call(this,{handleEvent:function(t){return"pointermove"==t.type&&e.handleMove_(t),!0}}),this.maps=t.maps},ol.ext.inherits(ol.interaction.Synchronize,ol.interaction.Interaction),ol.interaction.Synchronize.prototype.setMap=function(t){this._listener&&(ol.Observable.unByKey(this._listener.center),ol.Observable.unByKey(this._listener.rotation),ol.Observable.unByKey(this._listener.resolution),this.getMap().getTargetElement().removeEventListener("mouseout",this._listener.mouseout)),this._listener=null,ol.interaction.Interaction.prototype.setMap.call(this,t),t&&(this._listener={},this._listener.center=this.getMap().getView().on("change:center",this.syncMaps.bind(this)),this._listener.rotation=this.getMap().getView().on("change:rotation",this.syncMaps.bind(this)),this._listener.resolution=this.getMap().getView().on("change:resolution",this.syncMaps.bind(this)),this._listener.mouseout=this.handleMouseOut_.bind(this),this.getMap().getTargetElement()&&this.getMap().getTargetElement().addEventListener("mouseout",this._listener.mouseout),this.syncMaps())},ol.interaction.Synchronize.prototype.syncMaps=function(t){var e=this.getMap();if(!e.get("lockView")&&(t||(t={type:"all"}),e))for(var o=0;o<this.maps.length;o++){switch(this.maps[o].set("lockView",!0),t.type){case"change:rotation":this.maps[o].getView().getRotation()!=e.getView().getRotation()&&this.maps[o].getView().setRotation(e.getView().getRotation());break;case"change:center":this.maps[o].getView().getCenter()!=e.getView().getCenter()&&this.maps[o].getView().setCenter(e.getView().getCenter());break;case"change:resolution":this.maps[o].getView().getResolution()!=e.getView().getResolution()&&this.maps[o].getView().setResolution(e.getView().getResolution());break;default:this.maps[o].getView().setRotation(e.getView().getRotation()),this.maps[o].getView().setCenter(e.getView().getCenter()),this.maps[o].getView().setResolution(e.getView().getResolution())}this.maps[o].set("lockView",!1)}},ol.interaction.Synchronize.prototype.handleMove_=function(t){for(var e=0;e<this.maps.length;e++)this.maps[e].showTarget(t.coordinate);this.getMap().showTarget()},ol.interaction.Synchronize.prototype.handleMouseOut_=function(){for(var t=0;t<this.maps.length;t++)this.maps[t]._targetOverlay&&this.maps[t]._targetOverlay.setPosition(void 0)},ol.Map.prototype.showTarget=function(t){if(!this._targetOverlay){var e=document.createElement("div");e.classList.add("ol-target"),this._targetOverlay=new ol.Overlay({element:e}),this._targetOverlay.setPositioning("center-center"),this.addOverlay(this._targetOverlay),e.parentElement.classList.add("ol-target-overlay"),this._targetOverlay.setPosition([0,0])}this._targetOverlay.setPosition(t)},ol.Map.prototype.hideTarget=function(){this.removeOverlay(this._targetOverlay),this._targetOverlay=void 0},ol.interaction.TinkerBell=function(t){t=t||{},ol.interaction.Pointer.call(this,{handleDownEvent:this.onMove,handleMoveEvent:this.onMove}),this.set("color",t.color?ol.color.asString(t.color):"#fff"),this.sparkle=[0,0],this.sparkles=[],this.lastSparkle=this.time=new Date;var e=this;this.out_=function(){e.isout_=!0},this.isout_=!0},ol.ext.inherits(ol.interaction.TinkerBell,ol.interaction.Pointer),ol.interaction.TinkerBell.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,this.getMap()&&(t.getViewport().removeEventListener("mouseout",this.out_,!1),this.getMap().render()),ol.interaction.Pointer.prototype.setMap.call(this,t),t&&(this._listener=t.on("postcompose",this.postcompose_.bind(this)),t.getViewport().addEventListener("mouseout",this.out_,!1))},ol.interaction.TinkerBell.prototype.onMove=function(t){this.sparkle=t.pixel,this.isout_=!1,this.getMap().render()},ol.interaction.TinkerBell.prototype.postcompose_=function(t){var e=t.context||ol.ext.getMapCanvas(this.getMap()).getContext("2d"),o=t.frameState.time-this.time;this.time=t.frameState.time,t.frameState.time-this.lastSparkle>30&&!this.isout_&&(this.lastSparkle=t.frameState.time,this.sparkles.push({p:[this.sparkle[0]+15*Math.random()-7.5,this.sparkle[1]+15*Math.random()],o:1})),e.save(),e.scale(t.frameState.pixelRatio,t.frameState.pixelRatio),e.fillStyle=this.get("color");for(var i,n=this.sparkles.length-1;i=this.sparkles[n];n--){if(i.o<.2){this.sparkles.splice(0,n+1);break}e.globalAlpha=i.o,e.beginPath(),e.arc(i.p[0],i.p[1],2.2,0,2*Math.PI,!1),e.fill(),i.o*=.98,i.p[0]+=Math.random()-.5,i.p[1]+=o*(1+Math.random())/30}e.restore(),this.sparkles.length&&this.getMap().render()},ol.interaction.TouchCompass=function(t){t=t||{};var e={handleDownEvent:function(t){var e=this.getCenter_(),o=t.pixel[0]-e[0],i=t.pixel[1]-e[1];return this.start=t,Math.sqrt(o*o+i*i)<this.size/2},handleDragEvent:function(t){this.pos||(this.pos=this.start,this.getMap().renderSync()),this.pos=t},handleUpEvent:function(){return this.pos=!1,!0}};if(ol.interaction.Pointer.call(this,e),this.ondrag_=t.onDrag,this.size=t.size||80,this.alpha=t.alpha||.5,!ol.interaction.TouchCompass.prototype.compass){var o=ol.interaction.TouchCompass.prototype.compass=document.createElement("canvas"),i=o.getContext("2d"),n=o.width=o.height=this.size,r=n/10,a=n/2,s=.22*a;i.translate(a,a),i.fillStyle="#999",i.strokeStyle="#ccc",i.lineWidth=r,i.beginPath(),i.arc(0,0,.42*n,0,2*Math.PI),i.fill(),i.stroke(),i.fillStyle="#99f",i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(s,s),i.moveTo(0,0),i.lineTo(-a,0),i.lineTo(-s,-s),i.moveTo(0,0),i.lineTo(0,a),i.lineTo(-s,s),i.moveTo(0,0),i.lineTo(0,-a),i.lineTo(s,-s),i.moveTo(0,0),i.fill(),i.fillStyle="#eee",i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(s,-s),i.moveTo(0,0),i.lineTo(-a,0),i.lineTo(-s,s),i.moveTo(0,0),i.lineTo(0,a),i.lineTo(s,s),i.moveTo(0,0),i.lineTo(0,-a),i.lineTo(-s,-s),i.moveTo(0,0),i.fill()}},ol.ext.inherits(ol.interaction.TouchCompass,ol.interaction.Pointer),ol.interaction.TouchCompass.prototype.compass=null,ol.interaction.TouchCompass.prototype.setMap=function(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.interaction.Pointer.prototype.setMap.call(this,t),t&&(this._listener=t.on("postcompose",this.drawCompass_.bind(this)),ol.ext.getMapCanvas(t))},ol.interaction.TouchCompass.prototype.setActive=function(t){ol.interaction.Pointer.prototype.setActive.call(this,t),this.getMap()&&this.getMap().renderSync()},ol.interaction.TouchCompass.prototype.getCenter_=function(){var t=this.size,e=this.getMap().getSize();return[e[0]/2,e[1]-10-t/2]},ol.interaction.TouchCompass.prototype.drawCompass_=function(t){if(this.getActive()){var e=t.context||ol.ext.getMapCanvas(this.getMap()).getContext("2d"),o=t.frameState.pixelRatio;e.save(),e.scale(o,o),e.globalAlpha=this.alpha,e.strokeStyle="#fff",e.lineWidth=5;var i=this.size,n=this.getCenter_();if(e.drawImage(this.compass,0,0,this.compass.width,this.compass.height,n[0]-i/2,n[1]-i/2,i,i),this.pos)for(var r=this.pos.pixel[0]-this.start.pixel[0],a=this.pos.pixel[1]-this.start.pixel[1],s=1;s<=4;s++)e.beginPath(),e.arc(n[0]+r/4*s,n[1]+a/4*s,i/2*(.6+.4*s/4),0,2*Math.PI),e.stroke();if(e.restore(),this.pos){if(this.ondrag_){var l=this.getMap().getView().getResolution(),c={dpixel:[this.pos.pixel[0]-this.start.pixel[0],this.pos.pixel[1]-this.start.pixel[1]]};c.traction=[c.dpixel[0]*l,-c.dpixel[1]*l],this.ondrag_(c,this.pos)}t.frameState.animate=!0}}},ol.interaction.TouchCursor=function(t){t=t||{},this._listeners={};var e=[-35,-35];if(this.ctouch=new ol.interaction.Interaction({handleEvent:function(t){if(!/drag/.test(t.type)&&this.getMap())t.coordinate=this.overlay.getPosition(),t.pixel=this.getMap().getPixelFromCoordinate(t.coordinate),this._lastEvent=t;else{var o=t.frameState.viewState.resolution,i=Math.cos(t.frameState.viewState.rotation),n=Math.sin(t.frameState.viewState.rotation);t.coordinate=[t.coordinate[0]+i*e[0]*o+n*e[1]*o,t.coordinate[1]+n*e[0]*o-i*e[1]*o],t.pixel=this.getMap().getPixelFromCoordinate(t.coordinate)}return!0}.bind(this)}),this.ctouch.set("onTop",!0),this.overlay=new ol.Overlay.Fixed({className:("ol-touch-cursor "+(t.className||"")).trim(),positioning:"top-left",element:ol.ext.element.create("DIV",{}),stopEvent:!1}),ol.interaction.DragOverlay.call(this,{centerOnClick:!1,overlays:this.overlay}),this.setPosition(t.coordinate,!0),this.set("maxButtons",t.maxButtons||5),t.buttons){t.buttons.length>this.get("maxButtons")&&this.set("maxButtons",t.buttons.length);var o=this.overlay.element,i=t.buttons.length>4?0:1;t.buttons.forEach((function(t,e){e<5&&ol.ext.element.create("DIV",{className:((t.className||"")+" ol-button ol-button-"+(e+i)).trim(),html:ol.ext.element.create("DIV",{html:t.html}),click:t.click,on:t.on,parent:o})}))}var n=!1,r=!1;this.on("dragstart",(function(t){return this._pixel=this.getMap().getPixelFromCoordinate(this.overlay.getPosition()),r=t,!t.overlay})),this.on("dragend",function(t){return this._pixel=this.getMap().getPixelFromCoordinate(this.overlay.getPosition()),!t.overlay||(n?(this.dispatchEvent({type:"dragend",dragging:n,originalEvent:t.originalEvent,frameState:t.frameState,pixel:this._pixel,coordinate:this.overlay.getPosition()}),n=!1):t.originalEvent.target===this.overlay.element&&this.dispatchEvent({type:"click",dragging:n,originalEvent:t.originalEvent,frameState:t.frameState,pixel:this._pixel,coordinate:this.overlay.getPosition()}),!1)}.bind(this)),this.on("dragging",function(t){return this._pixel=this.getMap().getPixelFromCoordinate(this.overlay.getPosition()),!t.overlay||(n=!0,r&&(this.dispatchEvent({type:"dragstart",dragging:n,originalEvent:r.originalEvent,frameState:t.frameState,pixel:this._pixel,coordinate:r.coordinate}),r=!1),this.dispatchEvent({type:"dragging",dragging:n,originalEvent:t.originalEvent,frameState:t.frameState,pixel:this._pixel,coordinate:this.overlay.getPosition()}),!1)}.bind(this))},ol.ext.inherits(ol.interaction.TouchCursor,ol.interaction.DragOverlay),ol.interaction.TouchCursor.prototype.setMap=function(t){for(var e in this.getMap()&&(this.getMap().removeInteraction(this.ctouch),this.getActive()&&this.getMap().removeOverlay(this.overlay)),this._listeners)ol.Observable.unByKey(this._listeners[e]);this._listeners={},ol.interaction.DragOverlay.prototype.setMap.call(this,t),t&&(this.getActive()&&(t.addOverlay(this.overlay),setTimeout(function(){this.setPosition(this.getPosition()||t.getView().getCenter())}.bind(this))),t.addInteraction(this.ctouch),this._listeners.addInteraction=t.getInteractions().on("add",function(e){e.element.get("onTop")||(t.removeInteraction(this.ctouch),t.addInteraction(this.ctouch))}.bind(this)))},ol.interaction.TouchCursor.prototype.setActive=function(t,e){t!==this.getActive()?(this.ctouch.setActive(t),t?(this.getMap()&&this.getMap().addOverlay(this.overlay),e?this.setPosition(e):this.getMap()&&this.setPosition(this.getMap().getView().getCenter()),this._activate=setTimeout(function(){this.overlay.element.classList.add("active")}.bind(this),100)):(this.setPosition(),this.overlay.element.classList.remove("active"),this._activate&&clearTimeout(this._activate),this.getMap()&&this.getMap().removeOverlay(this.overlay)),ol.interaction.DragOverlay.prototype.setActive.call(this,t)):e?this.setPosition(e):this.getMap()&&this.setPosition(this.getMap().getView().getCenter())},ol.interaction.TouchCursor.prototype.setPosition=function(t){this.overlay.setPosition(t,!0),this.getMap()&&t&&(this._pixel=this.getMap().getPixelFromCoordinate(t))},ol.interaction.TouchCursor.prototype.offsetPosition=function(t){var e=this.overlay.getPosition();e&&this.overlay.setPosition([e[0]+t[0],e[1]+t[1]])},ol.interaction.TouchCursor.prototype.getPosition=function(){return this.overlay.getPosition()},ol.interaction.TouchCursor.prototype.getPixel=function(){if(this.getMap())return this.getMap().getPixelFromCoordinate(this.getPosition())},ol.interaction.TouchCursor.prototype.getOverlay=function(){return this.overlay},ol.interaction.TouchCursor.prototype.getOverlayElement=function(){return this.overlay.element},ol.interaction.TouchCursor.prototype.getButtonElement=function(t){return"number"==typeof t?this.getOverlayElement().getElementsByClassName("ol-button")[t]:this.getOverlayElement().getElementsByClassName(t)[0]},ol.interaction.TouchCursor.prototype.removeButton=function(t){if(void 0===t)for(var e=this.getOverlayElement().getElementsByClassName("ol-button"),o=e.length-1;o>=0;o--)this.getOverlayElement().removeChild(e[o]);else{var i=this.getButtonElement(t);i&&this.getOverlayElement().removeChild(i)}},ol.interaction.TouchCursor.prototype.addButton=function(t){var e=this.getOverlayElement().getElementsByClassName("ol-button"),o=this.get("maxButtons")||5;if(e.length>=o)console.error("[ol/interaction/TouchCursor~addButton] too many button on the cursor (max="+o+")...");else{var i=ol.ext.element.create("DIV",{className:((t.className||"")+" ol-button").trim(),html:ol.ext.element.create("DIV",{html:t.html}),click:t.click,on:t.on});t.before&&0!==e.length?this.getOverlayElement().insertBefore(i,e[0]):this.getOverlayElement().appendChild(i);for(var n=e.length>=o?0:1,r=0;r<e.length;r++)e[r].className=e[r].className.replace(/ol-button-\d/g,"").trim()+" ol-button-"+(r+n)}},ol.interaction.TouchCursorDraw=function(t){t=t||{};var e=this.sketch=new ol.layer.SketchOverlay({type:t.type});e.on("drawend",function(e){e.valid&&t.source&&t.source.addFeature(e.feature),this.dispatchEvent(e)}.bind(this)),e.on("drawstart",function(t){this.dispatchEvent(t)}.bind(this)),e.on("drawabort",function(t){this.dispatchEvent(t)}.bind(this)),ol.interaction.TouchCursor.call(this,{className:t.className,coordinate:t.coordinate}),this.set("types",t.types),this.setType(t.type),this.on("click",function(){this.sketch.addPoint(this.getPosition())}.bind(this)),this.on("dragging",function(){this.sketch.setPosition(this.getPosition())}.bind(this))},ol.ext.inherits(ol.interaction.TouchCursorDraw,ol.interaction.TouchCursor),ol.interaction.TouchCursorDraw.prototype.setMap=function(t){ol.interaction.TouchCursor.prototype.setMap.call(this,t),this.sketch.setMap(t),t&&(this._listeners.movend=t.on("moveend",function(){this.sketch.setPosition(this.getPosition())}.bind(this)))},ol.interaction.TouchCursorDraw.prototype.setActive=function(t,e){ol.interaction.TouchCursor.prototype.setActive.call(this,t,e),this.sketch.abortDrawing(),this.sketch.setPosition(e),this.sketch.setVisible(t)},ol.interaction.TouchCursorDraw.prototype.setType=function(t){this.removeButton();var e=this.sketch;this.getOverlayElement().classList.remove(e.getGeometryType());var o=e.setGeometryType();t=e.setGeometryType(t),this.getOverlayElement().classList.add(t),this.dispatchEvent({type:"change:type",oldValue:o});var i=this.get("types");if(i&&i.length){var n=i[(i.indexOf(t)+1)%i.length];this.addButton({className:"ol-button-type "+n,click:function(){this.setType(n)}.bind(this)})}"Point"!==t&&(this.addButton({className:"ol-button-x",click:function(){e.abortDrawing()}}),"Circle"!==t&&(this.addButton({className:"ol-button-check",click:function(){e.finishDrawing(!0)}}),this.addButton({className:"ol-button-remove",click:function(){e.removeLastPoint()}})))},ol.interaction.TouchCursorDraw.prototype.getType=function(){return this.sketch.getGeometryType()},ol.interaction.TouchCursorModify=function(t){t=t||{};var e=!1,o=!1,i=!1,n=this._modify=new ol.interaction.ModifyFeature({source:t.source,sources:t.sources,features:t.features,pixelTolerance:t.pixelTolerance,filter:t.filter,style:t.style||[new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:10,radius2:0,stroke:new ol.style.Stroke({color:[255,255,255,.5],width:3})})}),new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:10,radius2:0,stroke:new ol.style.Stroke({color:[0,153,255,1],width:1.25})})})],wrapX:t.wrapX,condition:function(t){return t.dragging||o},deleteCondition:function(){return i}});ol.interaction.TouchCursor.call(this,{className:("disable "+t.className).trim(),coordinate:t.coordinate,buttons:[{className:"ol-button-move",on:{pointerdown:function(){e=!0},pointerup:function(){e=!1}}},{className:"ol-button-add",click:function(){o=!0,n.handleDownEvent(this._lastEvent),n.handleUpEvent(this._lastEvent),o=!1}.bind(this)},{className:"ol-button-remove",click:function(){i=!0,n.handleDownEvent(this._lastEvent),i=!1}.bind(this)}]}),n.on("select",function(t){t.selected.length?this.getOverlayElement().classList.remove("disable"):this.getOverlayElement().classList.add("disable")}.bind(this)),this.on("dragstart",function(){e&&n.handleDownEvent(this._lastEvent)}.bind(this)),this.on("dragging",(function(t){e&&n.handleDragEvent(t)})),this.on("dragend",(function(t){n.handleUpEvent(t),e=!1}))},ol.ext.inherits(ol.interaction.TouchCursorModify,ol.interaction.TouchCursor),ol.interaction.TouchCursorModify.prototype.setMap=function(t){this.getMap()&&this.getMap().removeInteraction(this._modify),t&&t.addInteraction(this._modify),ol.interaction.TouchCursor.prototype.setMap.call(this,t)},ol.interaction.TouchCursorModify.prototype.setActive=function(t,e){ol.interaction.TouchCursor.prototype.setActive.call(this,t,e),this._modify.setActive(t)},ol.interaction.TouchCursorModify.prototype.getInteraction=function(){return this._modify},ol.interaction.TouchCursorSelect=function(t){t=t||{},ol.interaction.TouchCursor.call(this,{className:"ol-select "+(t.className||""),coordinate:t.coordinate}),this._selection=null,this._layerFilter=t.layerFilter,this._filter=t._filter,this._style=t.style||ol.style.Style.defaultStyle(!0),this.set("hitTolerance",t.hitTolerance||0),this.on(["change:active","dragging"],(function(){this.select()}))},ol.ext.inherits(ol.interaction.TouchCursorSelect,ol.interaction.TouchCursor),ol.interaction.TouchCursorSelect.prototype.setMap=function(t){ol.interaction.TouchCursor.prototype.setMap.call(this,t),t&&(this._listeners.movend=t.on("moveend",function(){this.select()}.bind(this)))},ol.interaction.TouchCursorSelect.prototype.getSelection=function(){return this._selection?this._selection.feature:null},ol.interaction.TouchCursorSelect.prototype.setPosition=function(t){ol.interaction.TouchCursor.prototype.setPosition.call(this,t),this.select()},ol.interaction.TouchCursorSelect.prototype.select=function(t){var e=this._selection;if(this.getActive()&&this.getPosition()){if(!t){var o=this.getMap().getFeaturesAtPixel(this.getPixel(),{layerFilter:this._layerFilter,filter:this._filter,hitTolerance:this.get("hitTolerance")});t=o?o[0]:null}t?e&&t===e.feature?e=null:(this._selection={feature:t,style:t.getStyle()},t.setStyle(this._style),this.dispatchEvent({type:"select",selected:[t],deselected:e?[e.feature]:[]})):(this._selection=null,this.dispatchEvent({type:"select",selected:[],deselected:e?[e.feature]:[]}))}else this._selection=null,this.dispatchEvent({type:"select",selected:[],deselected:e?[e.feature]:[]});e&&e.feature.setStyle(e.style),this._selection?this.getOverlayElement().classList.remove("disable"):this.getOverlayElement().classList.add("disable")},ol.interaction.Transform=function(t){t||(t={});var e=this;this.selection_=new ol.Collection,this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(t){return e.style[(t.get("handle")||"default")+(t.get("constraint")||"")+(t.get("option")||"")]}}),ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=t.features,"function"==typeof t.filter&&(this._filter=t.filter),this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this._handleEvent=t.condition||function(){return!0},this.addFn_=t.addCondition||function(){return!1},this.set("translateFeature",!1!==t.translateFeature),this.set("translate",!1!==t.translate),this.set("translateBBox",!0===t.translateBBox),this.set("stretch",!1!==t.stretch),this.set("scale",!1!==t.scale),this.set("rotate",!1!==t.rotate),this.set("keepAspectRatio",t.keepAspectRatio||function(t){return t.originalEvent.shiftKey}),this.set("modifyCenter",t.modifyCenter||function(t){return t.originalEvent.metaKey||t.originalEvent.ctrlKey}),this.set("noFlip",t.noFlip||!1),this.set("selection",!1!==t.selection),this.set("hitTolerance",t.hitTolerance||0),this.set("enableRotatedTransform",t.enableRotatedTransform||!1),this.on("propertychange",(function(){this.drawSketch_()})),this.setDefaultStyle()},ol.ext.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"},ol.interaction.Transform.prototype.setMap=function(t){var e=this.getMap();if(e){var o=e.getTargetElement();e.removeLayer(this.overlayLayer_),this.previousCursor_&&o&&(o.style.cursor=this.previousCursor_),this.previousCursor_=void 0}ol.interaction.Pointer.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t),null===t&&this.select(null),null!==t&&(this.isTouch=/touch/.test(t.getViewport().className),this.setDefaultStyle())},ol.interaction.Transform.prototype.setActive=function(t){this.select(null),this.overlayLayer_.setVisible(t),ol.interaction.Pointer.prototype.setActive.call(this,t)},ol.interaction.Transform.prototype.setDefaultStyle=function(t){var e=(t=t||{}).pointStroke||new ol.style.Stroke({color:[255,0,0,1],width:1}),o=t.stroke||new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),i=t.fill||new ol.style.Fill({color:[255,0,0,.01]}),n=t.pointFill||new ol.style.Fill({color:[255,255,255,.8]}),r=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?12:6,points:15});r.getAnchor()[0]=this.isTouch?-10:-5;var a=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),s=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function l(t,e,o){return[new ol.style.Style({image:t,stroke:e,fill:o})]}this.style={default:l(a,o,i),translate:l(a,e,n),rotate:l(r,e,n),rotate0:l(a,e,n),scale:l(a,e,n),scale1:l(a,e,n),scale2:l(a,e,n),scale3:l(a,e,n),scalev:l(s,e,n),scaleh1:l(s,e,n),scalev2:l(s,e,n),scaleh3:l(s,e,n)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(t,e){if(e){this.style[t]=e instanceof Array?e:[e];for(var o=0;o<this.style[t].length;o++){var i=this.style[t][o].getImage();i&&("rotate"==t&&(i.getAnchor()[0]=-5),this.isTouch&&i.setScale(1.8));var n=this.style[t][o].getText();n&&("rotate"==t&&n.setOffsetX(this.isTouch?14:7),this.isTouch&&n.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(t){var e=this;return this.getMap().forEachFeatureAtPixel(t,(function(t,o){var i=!1;if(!o){if(t===e.bbox_)return!!e.get("translateBBox")&&{feature:t,handle:"translate",constraint:"",option:""};if(e.handles_.forEach((function(e){e===t&&(i=!0)})),i)return{feature:t,handle:t.get("handle"),constraint:t.get("constraint"),option:t.get("option")}}if(!e.get("selection"))return e.selection_.getArray().some((function(e){return t===e}))?{feature:t}:null;if(e._filter)return e._filter(t,o)?{feature:t}:null;if(e.layers_){for(var n=0;n<e.layers_.length;n++)if(e.layers_[n]===o)return{feature:t};return null}return e.features_?(e.features_.forEach((function(e){e===t&&(i=!0)})),i?{feature:t}:null):{feature:t}}),{hitTolerance:this.get("hitTolerance")})||{}},ol.interaction.Transform.prototype.getGeometryRotateToZero_=function(t,e){var o=t.getGeometry(),i=this.getMap().getView().getRotation();if(0===i||!this.get("enableRotatedTransform"))return e?o.clone():o;var n=o.clone();return n.rotate(-1*i,this.getMap().getView().getCenter()),n},ol.interaction.Transform.prototype.drawSketch_=function(t){var e,o,i;if(this.overlayLayer_.getSource().clear(),this.selection_.getLength()){var n=this.getMap().getView().getRotation(),r=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();if(r=ol.extent.buffer(r,0),this.selection_.forEach(function(t){var e=this.getGeometryRotateToZero_(t).getExtent();ol.extent.extend(r,e)}.bind(this)),!0===t)this.ispt_||(this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"})),i=ol.geom.Polygon.fromExtent(r),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o=this.bbox_=new ol.Feature(i),this.overlayLayer_.getSource().addFeature(o));else{if(this.ispt_){var a=this.getMap().getPixelFromCoordinate([r[0],r[1]]);r=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([a[0]-10,a[1]-10]),this.getMap().getCoordinateFromPixel([a[0]+10,a[1]+10])])}i=ol.geom.Polygon.fromExtent(r),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o=this.bbox_=new ol.Feature(i);var s=[],l=i.getCoordinates()[0];if(!this.ispt_){if(s.push(o),!this.iscircle_&&this.get("stretch")&&this.get("scale"))for(e=0;e<l.length-1;e++)o=new ol.Feature({geometry:new ol.geom.Point([(l[e][0]+l[e+1][0])/2,(l[e][1]+l[e+1][1])/2]),handle:"scale",constraint:e%2?"h":"v",option:e}),s.push(o);if(this.get("scale"))for(e=0;e<l.length-1;e++)o=new ol.Feature({geometry:new ol.geom.Point(l[e]),handle:"scale",option:e}),s.push(o);this.get("translate")&&!this.get("translateFeature")&&(o=new ol.Feature({geometry:new ol.geom.Point([(l[0][0]+l[2][0])/2,(l[0][1]+l[2][1])/2]),handle:"translate"}),s.push(o))}!this.iscircle_&&this.get("rotate")&&(o=new ol.Feature({geometry:new ol.geom.Point(l[3]),handle:"rotate"}),s.push(o)),this.overlayLayer_.getSource().addFeatures(s)}}},ol.interaction.Transform.prototype.select=function(t,e){if(!t)return this.selection_.clear(),void this.drawSketch_();if(t.getGeometry&&t.getGeometry()){if(e)this.selection_.push(t);else{var o=this.selection_.getArray().indexOf(t);this.selection_.removeAt(o)}this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:t,features:this.selection_})}},ol.interaction.Transform.prototype.setSelection=function(t){this.selection_.clear(),t.forEach(function(t){this.selection_.push(t)}.bind(this)),this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})},ol.interaction.Transform.prototype.watchFeatures_=function(){this._featureListeners&&this._featureListeners.forEach((function(t){ol.Observable.unByKey(t)})),this._featureListeners=[],this.selection_.forEach(function(t){this._featureListeners.push(t.on("change",function(){this.isUpdating_||this.drawSketch_()}.bind(this)))}.bind(this))},ol.interaction.Transform.prototype.handleDownEvent_=function(t){if(this._handleEvent(t,this.selection_)){var e=this.getFeatureAtPixel_(t.pixel),o=e.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(o)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(e.handle="translate"),e.handle){this.mode_=e.handle,this.opt_=e.option,this.constraint_=e.constraint;var i=this.getMap().getView().getRotation();this.coordinate_=t.coordinate,this.pixel_=t.pixel,this.geoms_=[],this.rotatedGeoms_=[];for(var n,r=ol.extent.createEmpty(),a=ol.extent.createEmpty(),s=0;n=this.selection_.item(s);s++)if(this.geoms_.push(n.getGeometry().clone()),r=ol.extent.extend(r,n.getGeometry().getExtent()),this.get("enableRotatedTransform")&&0!==i){var l=this.getGeometryRotateToZero_(n,!0);this.rotatedGeoms_.push(l),a=ol.extent.extend(a,l.getExtent())}if(this.extent_=ol.geom.Polygon.fromExtent(r).getCoordinates()[0],this.get("enableRotatedTransform")&&0!==i&&(this.rotatedExtent_=ol.geom.Polygon.fromExtent(a).getCoordinates()[0]),"rotate"===this.mode_){this.center_=this.getCenter()||ol.extent.getCenter(r);var c=t.map.getTargetElement();c.style.cursor=this.Cursors.rotate0,this.previousCursor_=c.style.cursor}else this.center_=ol.extent.getCenter(r);return this.angle_=Math.atan2(this.center_[1]-t.coordinate[1],this.center_[0]-t.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!0}if(this.get("selection")){if(o){this.addFn_(t)||this.selection_.clear();var h=this.selection_.getArray().indexOf(o);h<0?this.selection_.push(o):this.selection_.removeAt(h)}else this.selection_.clear();return this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:o,features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!1}}},ol.interaction.Transform.prototype.getFeatures=function(){return this.selection_},ol.interaction.Transform.prototype.getCenter=function(){return this.get("center")},ol.interaction.Transform.prototype.setCenter=function(t){return this.set("center",t)},ol.interaction.Transform.prototype.handleDragEvent_=function(t){if(this._handleEvent(t,this.features_)){var e,o,i,n=this.getMap().getView().getRotation(),r=[this.coordinate_[0],this.coordinate_[1]],a=[t.coordinate[0],t.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":var s=Math.atan2(this.center_[1]-a[1],this.center_[0]-a[0]);if(!this.ispt)for(e=0;o=this.selection_.item(e);e++)(i=this.geoms_[e].clone()).rotate(s-this.angle_,this.center_),"Circle"==i.getType()&&i.setCenterAndRadius(i.getCenter(),i.getRadius()),o.setGeometry(i);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:s-this.angle_,pixel:t.pixel,coordinate:t.coordinate});break;case"translate":var l=a[0]-r[0],c=a[1]-r[1];for(e=0;o=this.selection_.item(e);e++)o.getGeometry().translate(l,c);this.handles_.forEach((function(t){t.getGeometry().translate(l,c)})),this.coordinate_=t.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[l,c],pixel:t.pixel,coordinate:t.coordinate});break;case"scale":var h=this.center_;if(this.get("modifyCenter")(t)){var u=this.extent_;this.get("enableRotatedTransform")&&0!==n&&(u=this.rotatedExtent_),h=u[(Number(this.opt_)+2)%4]}var p=this.coordinate_,d=t.coordinate;if(this.get("enableRotatedTransform")&&0!==n){var f=new ol.geom.Point(this.coordinate_);f.rotate(-1*n,h),p=f.getCoordinates();var g=new ol.geom.Point(t.coordinate);g.rotate(-1*n,h),d=g.getCoordinates()}var m=(d[0]-h[0])/(p[0]-h[0]),y=(d[1]-h[1])/(p[1]-h[1]);if(this.get("enableRotatedTransform")&&0!==n){var v=new ol.geom.Point(h);v.rotate(-1*n,this.getMap().getView().getCenter()),h=v.getCoordinates()}for(this.get("noFlip")&&(m<0&&(m=-m),y<0&&(y=-y)),this.constraint_?"h"==this.constraint_?m=1:y=1:this.get("keepAspectRatio")(t)&&(m=y=Math.min(m,y)),e=0;o=this.selection_.item(e);e++)(i=0!==n&&this.get("enableRotatedTransform")?this.rotatedGeoms_[e].clone():this.geoms_[e].clone()).applyTransform((function(t,e,o){if(o<2)return e;for(var n=0;n<t.length;n+=o)1!=m&&(e[n]=h[0]+(t[n]-h[0])*m),1!=y&&(e[n+1]=h[1]+(t[n+1]-h[1])*y);return"Circle"==i.getType()&&i.setCenterAndRadius(i.getCenter(),i.getRadius()),e})),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o.setGeometry(i);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[m,y],pixel:t.pixel,coordinate:t.coordinate})}this.isUpdating_=!1}},ol.interaction.Transform.prototype.handleMoveEvent_=function(t){if(this._handleEvent(t,this.features_)&&!this.mode_){var e=this.getFeatureAtPixel_(t.pixel),o=t.map.getTargetElement();if(e.feature){var i=e.handle?this.Cursors[(e.handle||"default")+(e.constraint||"")+(e.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=o.style.cursor),o.style.cursor=i}else void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(t){"rotate"===this.mode_&&(t.map.getTargetElement().style.cursor=this.Cursors.default,this.previousCursor_=void 0);return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1},ol.interaction.Transform.prototype.getFeatures=function(){return this.selection_},ol.interaction.Transform=function(t){t||(t={});var e=this;this.selection_=new ol.Collection,this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(t){return e.style[(t.get("handle")||"default")+(t.get("constraint")||"")+(t.get("option")||"")]}}),ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=t.features,"function"==typeof t.filter&&(this._filter=t.filter),this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this._handleEvent=t.condition||function(){return!0},this.addFn_=t.addCondition||function(){return!1},this.set("translateFeature",!1!==t.translateFeature),this.set("translate",!1!==t.translate),this.set("translateBBox",!0===t.translateBBox),this.set("stretch",!1!==t.stretch),this.set("scale",!1!==t.scale),this.set("rotate",!1!==t.rotate),this.set("keepAspectRatio",t.keepAspectRatio||function(t){return t.originalEvent.shiftKey}),this.set("modifyCenter",t.modifyCenter||function(t){return t.originalEvent.metaKey||t.originalEvent.ctrlKey}),this.set("noFlip",t.noFlip||!1),this.set("selection",!1!==t.selection),this.set("hitTolerance",t.hitTolerance||0),this.set("enableRotatedTransform",t.enableRotatedTransform||!1),this.on("propertychange",(function(){this.drawSketch_()})),this.setDefaultStyle()},ol.ext.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"},ol.interaction.Transform.prototype.setMap=function(t){var e=this.getMap();if(e){var o=e.getTargetElement();e.removeLayer(this.overlayLayer_),this.previousCursor_&&o&&(o.style.cursor=this.previousCursor_),this.previousCursor_=void 0}ol.interaction.Pointer.prototype.setMap.call(this,t),this.overlayLayer_.setMap(t),null===t&&this.select(null),null!==t&&(this.isTouch=/touch/.test(t.getViewport().className),this.setDefaultStyle())},ol.interaction.Transform.prototype.setActive=function(t){this.select(null),this.overlayLayer_.setVisible(t),ol.interaction.Pointer.prototype.setActive.call(this,t)},ol.interaction.Transform.prototype.setDefaultStyle=function(t){var e=(t=t||{}).pointStroke||new ol.style.Stroke({color:[255,0,0,1],width:1}),o=t.stroke||new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),i=t.fill||new ol.style.Fill({color:[255,0,0,.01]}),n=t.pointFill||new ol.style.Fill({color:[255,255,255,.8]}),r=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?12:6,points:15});r.getAnchor()[0]=this.isTouch?-10:-5;var a=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),s=new ol.style.RegularShape({fill:n,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function l(t,e,o){return[new ol.style.Style({image:t,stroke:e,fill:o})]}this.style={default:l(a,o,i),translate:l(a,e,n),rotate:l(r,e,n),rotate0:l(a,e,n),scale:l(a,e,n),scale1:l(a,e,n),scale2:l(a,e,n),scale3:l(a,e,n),scalev:l(s,e,n),scaleh1:l(s,e,n),scalev2:l(s,e,n),scaleh3:l(s,e,n)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(t,e){if(e){this.style[t]=e instanceof Array?e:[e];for(var o=0;o<this.style[t].length;o++){var i=this.style[t][o].getImage();i&&("rotate"==t&&(i.getAnchor()[0]=-5),this.isTouch&&i.setScale(1.8));var n=this.style[t][o].getText();n&&("rotate"==t&&n.setOffsetX(this.isTouch?14:7),this.isTouch&&n.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(t){var e=this;return this.getMap().forEachFeatureAtPixel(t,(function(t,o){var i=!1;if(!o){if(t===e.bbox_)return!!e.get("translateBBox")&&{feature:t,handle:"translate",constraint:"",option:""};if(e.handles_.forEach((function(e){e===t&&(i=!0)})),i)return{feature:t,handle:t.get("handle"),constraint:t.get("constraint"),option:t.get("option")}}if(!e.get("selection"))return e.selection_.getArray().some((function(e){return t===e}))?{feature:t}:null;if(e._filter)return e._filter(t,o)?{feature:t}:null;if(e.layers_){for(var n=0;n<e.layers_.length;n++)if(e.layers_[n]===o)return{feature:t};return null}return e.features_?(e.features_.forEach((function(e){e===t&&(i=!0)})),i?{feature:t}:null):{feature:t}}),{hitTolerance:this.get("hitTolerance")})||{}},ol.interaction.Transform.prototype.getGeometryRotateToZero_=function(t,e){var o=t.getGeometry(),i=this.getMap().getView().getRotation();if(0===i||!this.get("enableRotatedTransform"))return e?o.clone():o;var n=o.clone();return n.rotate(-1*i,this.getMap().getView().getCenter()),n},ol.interaction.Transform.prototype.drawSketch_=function(t){var e,o,i;if(this.overlayLayer_.getSource().clear(),this.selection_.getLength()){var n=this.getMap().getView().getRotation(),r=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();if(r=ol.extent.buffer(r,0),this.selection_.forEach(function(t){var e=this.getGeometryRotateToZero_(t).getExtent();ol.extent.extend(r,e)}.bind(this)),!0===t)this.ispt_||(this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"})),i=ol.geom.Polygon.fromExtent(r),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o=this.bbox_=new ol.Feature(i),this.overlayLayer_.getSource().addFeature(o));else{if(this.ispt_){var a=this.getMap().getPixelFromCoordinate([r[0],r[1]]);r=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([a[0]-10,a[1]-10]),this.getMap().getCoordinateFromPixel([a[0]+10,a[1]+10])])}i=ol.geom.Polygon.fromExtent(r),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o=this.bbox_=new ol.Feature(i);var s=[],l=i.getCoordinates()[0];if(!this.ispt_){if(s.push(o),!this.iscircle_&&this.get("stretch")&&this.get("scale"))for(e=0;e<l.length-1;e++)o=new ol.Feature({geometry:new ol.geom.Point([(l[e][0]+l[e+1][0])/2,(l[e][1]+l[e+1][1])/2]),handle:"scale",constraint:e%2?"h":"v",option:e}),s.push(o);if(this.get("scale"))for(e=0;e<l.length-1;e++)o=new ol.Feature({geometry:new ol.geom.Point(l[e]),handle:"scale",option:e}),s.push(o);this.get("translate")&&!this.get("translateFeature")&&(o=new ol.Feature({geometry:new ol.geom.Point([(l[0][0]+l[2][0])/2,(l[0][1]+l[2][1])/2]),handle:"translate"}),s.push(o))}!this.iscircle_&&this.get("rotate")&&(o=new ol.Feature({geometry:new ol.geom.Point(l[3]),handle:"rotate"}),s.push(o)),this.overlayLayer_.getSource().addFeatures(s)}}},ol.interaction.Transform.prototype.select=function(t,e){if(!t)return this.selection_.clear(),void this.drawSketch_();if(t.getGeometry&&t.getGeometry()){if(e)this.selection_.push(t);else{var o=this.selection_.getArray().indexOf(t);this.selection_.removeAt(o)}this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:t,features:this.selection_})}},ol.interaction.Transform.prototype.setSelection=function(t){this.selection_.clear(),t.forEach(function(t){this.selection_.push(t)}.bind(this)),this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})},ol.interaction.Transform.prototype.watchFeatures_=function(){this._featureListeners&&this._featureListeners.forEach((function(t){ol.Observable.unByKey(t)})),this._featureListeners=[],this.selection_.forEach(function(t){this._featureListeners.push(t.on("change",function(){this.isUpdating_||this.drawSketch_()}.bind(this)))}.bind(this))},ol.interaction.Transform.prototype.handleDownEvent_=function(t){if(this._handleEvent(t,this.selection_)){var e=this.getFeatureAtPixel_(t.pixel),o=e.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(o)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(e.handle="translate"),e.handle){this.mode_=e.handle,this.opt_=e.option,this.constraint_=e.constraint;var i=this.getMap().getView().getRotation();this.coordinate_=t.coordinate,this.pixel_=t.pixel,this.geoms_=[],this.rotatedGeoms_=[];for(var n,r=ol.extent.createEmpty(),a=ol.extent.createEmpty(),s=0;n=this.selection_.item(s);s++)if(this.geoms_.push(n.getGeometry().clone()),r=ol.extent.extend(r,n.getGeometry().getExtent()),this.get("enableRotatedTransform")&&0!==i){var l=this.getGeometryRotateToZero_(n,!0);this.rotatedGeoms_.push(l),a=ol.extent.extend(a,l.getExtent())}if(this.extent_=ol.geom.Polygon.fromExtent(r).getCoordinates()[0],this.get("enableRotatedTransform")&&0!==i&&(this.rotatedExtent_=ol.geom.Polygon.fromExtent(a).getCoordinates()[0]),"rotate"===this.mode_){this.center_=this.getCenter()||ol.extent.getCenter(r);var c=t.map.getTargetElement();c.style.cursor=this.Cursors.rotate0,this.previousCursor_=c.style.cursor}else this.center_=ol.extent.getCenter(r);return this.angle_=Math.atan2(this.center_[1]-t.coordinate[1],this.center_[0]-t.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!0}if(this.get("selection")){if(o){this.addFn_(t)||this.selection_.clear();var h=this.selection_.getArray().indexOf(o);h<0?this.selection_.push(o):this.selection_.removeAt(h)}else this.selection_.clear();return this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:o,features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!1}}},ol.interaction.Transform.prototype.getFeatures=function(){return this.selection_},ol.interaction.Transform.prototype.getCenter=function(){return this.get("center")},ol.interaction.Transform.prototype.setCenter=function(t){return this.set("center",t)},ol.interaction.Transform.prototype.handleDragEvent_=function(t){if(this._handleEvent(t,this.features_)){var e,o,i,n=this.getMap().getView().getRotation(),r=[this.coordinate_[0],this.coordinate_[1]],a=[t.coordinate[0],t.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":var s=Math.atan2(this.center_[1]-a[1],this.center_[0]-a[0]);if(!this.ispt)for(e=0;o=this.selection_.item(e);e++)(i=this.geoms_[e].clone()).rotate(s-this.angle_,this.center_),"Circle"==i.getType()&&i.setCenterAndRadius(i.getCenter(),i.getRadius()),o.setGeometry(i);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:s-this.angle_,pixel:t.pixel,coordinate:t.coordinate});break;case"translate":var l=a[0]-r[0],c=a[1]-r[1];for(e=0;o=this.selection_.item(e);e++)o.getGeometry().translate(l,c);this.handles_.forEach((function(t){t.getGeometry().translate(l,c)})),this.coordinate_=t.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[l,c],pixel:t.pixel,coordinate:t.coordinate});break;case"scale":var h=this.center_;if(this.get("modifyCenter")(t)){var u=this.extent_;this.get("enableRotatedTransform")&&0!==n&&(u=this.rotatedExtent_),h=u[(Number(this.opt_)+2)%4]}var p=this.coordinate_,d=t.coordinate;if(this.get("enableRotatedTransform")&&0!==n){var f=new ol.geom.Point(this.coordinate_);f.rotate(-1*n,h),p=f.getCoordinates();var g=new ol.geom.Point(t.coordinate);g.rotate(-1*n,h),d=g.getCoordinates()}var m=(d[0]-h[0])/(p[0]-h[0]),y=(d[1]-h[1])/(p[1]-h[1]);if(this.get("enableRotatedTransform")&&0!==n){var v=new ol.geom.Point(h);v.rotate(-1*n,this.getMap().getView().getCenter()),h=v.getCoordinates()}for(this.get("noFlip")&&(m<0&&(m=-m),y<0&&(y=-y)),this.constraint_?"h"==this.constraint_?m=1:y=1:this.get("keepAspectRatio")(t)&&(m=y=Math.min(m,y)),e=0;o=this.selection_.item(e);e++)(i=0!==n&&this.get("enableRotatedTransform")?this.rotatedGeoms_[e].clone():this.geoms_[e].clone()).applyTransform((function(t,e,o){if(o<2)return e;for(var n=0;n<t.length;n+=o)1!=m&&(e[n]=h[0]+(t[n]-h[0])*m),1!=y&&(e[n+1]=h[1]+(t[n+1]-h[1])*y);return"Circle"==i.getType()&&i.setCenterAndRadius(i.getCenter(),i.getRadius()),e})),this.get("enableRotatedTransform")&&0!==n&&i.rotate(n,this.getMap().getView().getCenter()),o.setGeometry(i);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[m,y],pixel:t.pixel,coordinate:t.coordinate})}this.isUpdating_=!1}},ol.interaction.Transform.prototype.handleMoveEvent_=function(t){if(this._handleEvent(t,this.features_)&&!this.mode_){var e=this.getFeatureAtPixel_(t.pixel),o=t.map.getTargetElement();if(e.feature){var i=e.handle?this.Cursors[(e.handle||"default")+(e.constraint||"")+(e.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=o.style.cursor),o.style.cursor=i}else void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(t){"rotate"===this.mode_&&(t.map.getTargetElement().style.cursor=this.Cursors.default,this.previousCursor_=void 0);return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1},ol.interaction.Transform.prototype.getFeatures=function(){return this.selection_},ol.interaction.UndoRedo=function(t){t||(t={}),ol.interaction.Interaction.call(this,{handleEvent:function(){return!0}}),this._undoStack=[],this._redoStack=[],this._block=0,this._record=!0,this._defs={}},ol.ext.inherits(ol.interaction.UndoRedo,ol.interaction.Interaction),ol.interaction.UndoRedo.prototype.define=function(t,e,o){this._defs["_"+t]={undo:e,redo:o}},ol.interaction.UndoRedo.prototype.push=function(t,e){return!!this._defs["_"+t]&&(this._undoStack.push({type:"_"+t,prop:e}),!0)},ol.interaction.UndoRedo.prototype.setActive=function(t){ol.interaction.Interaction.prototype.setActive.call(this,t),this._record=t},ol.interaction.UndoRedo.prototype.setMap=function(t){this._mapListener&&this._mapListener.forEach((function(t){ol.Observable.unByKey(t)})),this._mapListener=[],ol.interaction.Interaction.prototype.setMap.call(this,t),t&&(this._mapListener.push(t.on("undoblockstart",this.blockStart.bind(this))),this._mapListener.push(t.on("undoblockend",this.blockEnd.bind(this)))),this._watchSources(),this._watchInteractions()},ol.interaction.UndoRedo.prototype._watchSources=function(){var t=this.getMap();(this._sourceListener&&this._sourceListener.forEach((function(t){ol.Observable.unByKey(t)})),this._sourceListener=[],t)&&(function t(e,o){return o||(o=[]),e.forEach((function(e){e instanceof ol.layer.Vector?o.push(e):e.getLayers&&t(e.getLayers(),o)})),o}(t.getLayers()).forEach(function(t){var e=t.getSource();this._sourceListener.push(e.on(["addfeature","removefeature"],this._onAddRemove.bind(this))),this._sourceListener.push(e.on("clearstart",this.blockStart.bind(this))),this._sourceListener.push(e.on("clearend",this.blockEnd.bind(this)))}.bind(this)),this._sourceListener.push(t.getLayers().on(["add","remove"],this._watchSources.bind(this))))},ol.interaction.UndoRedo.prototype._watchInteractions=function(){var t=this.getMap();this._interactionListener&&this._interactionListener.forEach((function(t){ol.Observable.unByKey(t)})),this._interactionListener=[],t&&(t.getInteractions().forEach(function(t){this._interactionListener.push(t.on(["setattributestart","modifystart","rotatestart","translatestart","scalestart","deletestart","deleteend","beforesplit","aftersplit"],this._onInteraction.bind(this)))}.bind(this)),this._interactionListener.push(t.getInteractions().on(["add","remove"],this._watchInteractions.bind(this))))},ol.interaction.UndoRedo.prototype._onAddRemove=function(t){this._record&&(this._undoStack.push({type:t.type,source:t.target,feature:t.feature}),this._redoStack=[])},ol.interaction.UndoRedo.prototype._onInteraction=function(t){var e=this._onInteraction[t.type];e&&e.call(this,t)},ol.interaction.UndoRedo.prototype._onInteraction.setattributestart=function(t){this.blockStart();var e=Object.assign({},t.properties);t.features.forEach(function(t){var o={};for(var i in e)o[i]=t.get(i);this._undoStack.push({type:"changeattribute",feature:t,newProperties:e,oldProperties:o})}.bind(this)),this.blockEnd()},ol.interaction.UndoRedo.prototype._onInteraction.rotatestart=ol.interaction.UndoRedo.prototype._onInteraction.translatestart=ol.interaction.UndoRedo.prototype._onInteraction.scalestart=ol.interaction.UndoRedo.prototype._onInteraction.modifystart=function(t){this.blockStart(),t.features.forEach(function(t){this._undoStack.push({type:"changefeature",feature:t,oldFeature:t.clone()})}.bind(this)),this.blockEnd()},ol.interaction.UndoRedo.prototype.blockStart=function(){this._undoStack.push({type:"blockstart"}),this._redoStack=[]},ol.interaction.UndoRedo.prototype._onInteraction.beforesplit=ol.interaction.UndoRedo.prototype._onInteraction.deletestart=ol.interaction.UndoRedo.prototype.blockStart,ol.interaction.UndoRedo.prototype.blockEnd=function(){this._undoStack.push({type:"blockend"})},ol.interaction.UndoRedo.prototype._onInteraction.aftersplit=ol.interaction.UndoRedo.prototype._onInteraction.deleteend=ol.interaction.UndoRedo.prototype.blockEnd,ol.interaction.UndoRedo.prototype._handleDo=function(t,e){if(this.getActive()){switch(this._record=!1,t.type){case"addfeature":e?t.source.removeFeature(t.feature):t.source.addFeature(t.feature);break;case"removefeature":e?t.source.addFeature(t.feature):t.source.removeFeature(t.feature);break;case"changefeature":var o=t.feature.getGeometry();t.feature.setGeometry(t.oldFeature.getGeometry()),t.oldFeature.setGeometry(o);break;case"changeattribute":var i=t.newProperties,n=t.oldProperties;for(var r in n)void 0===n?t.feature.unset(r):t.feature.set(r,n[r]);t.oldProperties=i,t.newProperties=n;break;case"blockstart":this._block+=e?-1:1;break;case"blockend":this._block+=e?1:-1;break;default:this._defs[t.type]?e?this._defs[t.type].undo(t.prop):this._defs[t.type].redo(t.prop):console.warn('[UndoRedoInteraction]: "'+t.type.substr(1)+'" is not defined.')}this._block<0&&(this._block=0),this._block&&(e?this.undo():this.redo()),this._record=!0,this.dispatchEvent({type:e?"undo":"redo",action:t})}},ol.interaction.UndoRedo.prototype.undo=function(){var t=this._undoStack.pop();t&&(this._redoStack.push(t),this._handleDo(t,!0))},ol.interaction.UndoRedo.prototype.redo=function(){var t=this._redoStack.pop();t&&(this._undoStack.push(t),this._handleDo(t,!1))},ol.interaction.UndoRedo.prototype.clear=function(){this._undoStack=[],this._redoStack=[]},ol.interaction.UndoRedo.prototype.hasUndo=function(){return this._undoStack.length},ol.interaction.UndoRedo.prototype.hasRedo=function(){return this._redoStack.length},ol.source.BinBase=function(t){t=t||{},this._bindModify=this._onModifyFeature.bind(this),this._watch=!0,ol.source.Vector.call(this,t),this._origin=t.source,this._listen=!1!==t.listenChange,this._geomFn=t.geometryFunction||ol.coordinate.getFeatureCenter||function(t){return t.getGeometry().getFirstCoordinate()},this.reset(),this._origin.on("addfeature",this._onAddFeature.bind(this)),this._origin.on("removefeature",this._onRemoveFeature.bind(this)),this._origin.on("clearstart",this._onClearFeature.bind(this)),this._origin.on("clearend",this._onClearFeature.bind(this)),"function"==typeof t.flatAttributes&&(this._flatAttributes=t.flatAttributes)},ol.ext.inherits(ol.source.BinBase,ol.source.Vector),ol.source.BinBase.prototype._onAddFeature=function(t,e,o){var i=t.feature||t.target;(e=e||this.getBinAt(this._geomFn(i),!0))&&e.get("features").push(i),this._listen&&!1!==o&&i.on("change",this._bindModify)},ol.source.BinBase.prototype._onRemoveFeature=function(t,e,o){if(this._watch){var i=t.feature||t.target;if(e=e||this.getBinAt(this._geomFn(i))){for(var n,r=e.get("features"),a=0;n=r[a];a++)if(n===i){r.splice(a,1);break}r.length||this.removeFeature(e)}this._listen&&!1!==o&&i.un("change",this._bindModify)}},ol.source.BinBase.prototype._onClearFeature=function(t){"clearstart"===t.type?(this._listen&&this._origin.getFeatures().forEach(function(t){t.un("change",this._bindModify)}.bind(this)),this.clear(),this._watch=!1):this._watch=!0},ol.source.BinBase.prototype.getBin=function(t){for(var e,o=this.getFeatures(),i=0;e=o[i];i++)for(var n,r=e.get("features"),a=0;n=r[a];a++)if(n===t)return e;return null},ol.source.BinBase.prototype.getGridGeomAt=function(t){return new ol.geom.Polygon([t])},ol.source.BinBase.prototype.getBinAt=function(t,e){var o={},i=this.getGridGeomAt(t,o);if(!i)return null;var n=i.getInteriorPoint?i.getInteriorPoint().getCoordinates():i.getInteriorPoints().getCoordinates()[0],r=this.getFeaturesAtCoordinate(n)[0];return!r&&e&&(o.geometry=i,o.features=[],o.center=n,r=new ol.Feature(o),this.addFeature(r)),r||null},ol.source.BinBase.prototype._onModifyFeature=function(t){var e=this.getBin(t.target),o=this.getBinAt(this._geomFn(t.target),"create");e!==o&&(e&&this._onRemoveFeature(t,e,!1),o&&this._onAddFeature(t,o,!1)),this.changed()},ol.source.BinBase.prototype.reset=function(){this.clear();for(var t,e=this._origin.getFeatures(),o=0;t=e[o];o++)this._onAddFeature({feature:t});this.changed()},ol.source.BinBase.prototype.getGridFeatures=function(){var t=[];return this.getFeatures().forEach(function(e){var o=new ol.Feature(e.getGeometry().clone());for(var i in e.getProperties())"features"!==i&&"geometry"!==i&&o.set(i,e.get(i));o.set("nb",e.get("features").length),this._flatAttributes(o,e.get("features")),t.push(o)}.bind(this)),t},ol.source.BinBase.prototype._flatAttributes=function(){},ol.source.BinBase.prototype.getSource=function(){return this._origin},ol.source.DBPedia=function(t){var e=t||{};e.loader=this._loaderFn,this._url=e.url||"http://fr.dbpedia.org/sparql",this._maxResolution=e.maxResolution||100,this._lang=e.lang||"fr",this._limit=e.limit||1e3,e.attributions||(e.attributions=["&copy; <a href='http://dbpedia.org/'>DBpedia</a> CC-by-SA"]),e.strategy||(e.strategy=ol.loadingstrategy.bbox),ol.source.Vector.call(this,e)},ol.ext.inherits(ol.source.DBPedia,ol.source.Vector),ol.source.DBPedia.prototype.readFeature=function(t,e,o){for(var i in e)"uri"===e[i].type&&(e[i].value=encodeURI(e[i].value)),t.set(i,e[i].value);return!o||o.get("subject")!=e.subject.value||(o.set("type",o.get("type")+"\n"+e.type.value),!1)},ol.source.DBPedia.prototype.querySubject=function(){return"?subject rdfs:label ?label. OPTIONAL {?subject dbpedia-owl:thumbnail ?thumbnail}.OPTIONAL {?subject dbpedia-owl:abstract ?abstract} . OPTIONAL {?subject rdf:type ?type}"},ol.source.DBPedia.prototype.queryFilter=function(){return"lang(?label) = '"+this._lang+"' && lang(?abstract) = '"+this._lang+"'"},ol.source.DBPedia.prototype._loaderFn=function(t,e,o){if(!(e>this._maxResolution)){var i=this,n=ol.proj.transformExtent(t,o,"EPSG:4326"),r="PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> SELECT DISTINCT * WHERE { ?subject geo:lat ?lat . ?subject geo:long ?long . "+this.querySubject()+" . FILTER("+this.queryFilter()+") . FILTER(xsd:float(?lat) <= "+n[3]+" && "+n[1]+" <= xsd:float(?lat) && xsd:float(?long) <= "+n[2]+" && "+n[0]+" <= xsd:float(?long) ) . } LIMIT "+this._limit;ol.ext.Ajax.get({url:this._url,data:{query:r,format:"json"},success:function(t){var e,n,r,a=t.results.bindings,s=[],l=null;for(var c in a)e=a[c],n=[Number(a[c].long.value),Number(a[c].lat.value)],r=new ol.Feature(new ol.geom.Point(ol.proj.transform(n,"EPSG:4326",o))),i.readFeature(r,e,l)&&(s.push(r),l=r);i.addFeatures(s)}})}},ol.style.clearDBPediaStyleCache,ol.style.dbPediaStyleFunction,i={},ol.style.clearDBPediaStyleCache=function(){i={}},ol.style.dbPediaStyleFunction=function(t){var e;switch(t||(t={}),o(t.glyph)){case"function":e=t.glyph;break;case"string":e=function(){return t.glyph};break;default:e=function(t){var e=t.get("type");if(e){if(e.match("/Museum"))return"fa-camera";if(e.match("/Monument"))return"fa-building";if(e.match("/Sculpture"))return"fa-android";if(e.match("/Religious"))return"fa-institution";if(e.match("/Castle"))return"fa-key";if(e.match("Water"))return"fa-tint";if(e.match("Island"))return"fa-leaf";if(e.match("/Event"))return"fa-heart";if(e.match("/Artwork"))return"fa-asterisk";if(e.match("/Stadium"))return"fa-futbol-o";if(e.match("/Place"))return"fa-street-view"}return"fa-star"}}var n=t.radius||8,r=t.fill||new ol.style.Fill({color:"navy"}),a=t.stroke||new ol.style.Stroke({color:"#fff",width:2}),s=t.prefix?t.prefix+"_":"";return function(t){var o=e(t),l=s+o,c=i[l];return c||(i[l]=c=new ol.style.Style({image:new ol.style.FontSymbol({glyph:o,radius:n,fill:r,stroke:a})})),[c]}},ol.source.DFCI=function(t){(t=t||{}).loader=this._calcGrid,t.strategy=function(t,e){return this.resolution&&this.resolution!=e&&(this.clear(),this.refresh()),[t]},this._bbox=[[0,16e5],[11e5,26e5]],ol.source.Vector.call(this,t),this.set("resolutions",t.resolutions||[1e3,100,20]),proj4.defs["EPSG:27572"]||proj4.defs("EPSG:27572","+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"),ol.proj.proj4.register(proj4)},ol.ext.inherits(ol.source.DFCI,ol.source.Vector),ol.source.DFCI.prototype._calcGrid=function(t,e,o){var i,n,r=this.get("resolutions");e>(r[0]||1e3)?this.resolution!=e&&(this._features0||(n=[this._bbox[0][0],this._bbox[0][1],this._bbox[1][0],this._bbox[1][1]],this._features0=this._getFeatures(0,n,o)),this.addFeatures(this._features0)):e>(r[1]||100)?(this.clear(),n=ol.proj.transformExtent(t,o,"EPSG:27572"),i=this._getFeatures(1,n,o),this.addFeatures(i)):e>(r[2]||0)?(this.clear(),n=ol.proj.transformExtent(t,o,"EPSG:27572"),i=this._getFeatures(2,n,o),this.addFeatures(i)):(this.clear(),n=ol.proj.transformExtent(t,o,"EPSG:27572"),i=this._getFeatures(3,n,o),this.addFeatures(i)),this.resolution=e},ol.source.DFCI.prototype._midPt=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},ol.source.DFCI.prototype._trFeature=function(t,e,o,i){var n=new ol.geom.Polygon([t]),r=new ol.Feature(n.transform("EPSG:27572",i));return r.set("id",e),r.set("level",o),r},ol.source.DFCI.prototype._getFeatures=function(t,e,o){var i,n=[],r=1e5;t>0&&(r/=5),t>1&&(r/=10);for(var a=[Math.max(this._bbox[0][0],Math.floor(e[0]/r)*r),Math.max(this._bbox[0][1],Math.floor(e[1]/r)*r)],s=[Math.min(this._bbox[1][0]+99999,Math.floor(e[2]/r)*r),Math.min(this._bbox[1][1]+99999,Math.floor(e[3]/r)*r)],l=a[0];l<=s[0];l+=r)for(var c=a[1];c<=s[1];c+=r){var h,u=[[l,c],[l+r,c],[l+r,c+r],[l,c+r],[l,c]];if(t>2){var p=this._midPt(u[0],u[2]),d=[];for(i=0;i<u.length;i++)d.push(this._midPt(u[i],p));for(n.push(this._trFeature(d,ol.coordinate.toDFCI([l,c],2)+".5",t,o)),i=0;i<4;i++)(d=[]).push(u[i]),d.push(this._midPt(u[i],u[(i+1)%4])),d.push(this._midPt(p,d[1])),d.push(this._midPt(p,u[i])),h=this._midPt(u[i],u[(i+3)%4]),d.push(this._midPt(p,h)),d.push(h),d.push(u[i]),n.push(this._trFeature(d,ol.coordinate.toDFCI([l,c],2)+"."+(4-i),t,o))}else n.push(this._trFeature(u,ol.coordinate.toDFCI([l,c],t),t,o))}return n},ol.source.DayNight=function(t){(t=t||{}).loader=this._loader,t.strategy=ol.loadingstrategy.all,ol.source.Vector.call(this,t),this.set("time",t.time||new Date),this.set("step",t.step||1)},ol.ext.inherits(ol.source.DayNight,ol.source.Vector),ol.source.DayNight.prototype._loader=function(t,e,o){var i=this.getCoordinates(this.get("time")),n=new ol.geom.Polygon([i]);n.transform("EPSG:4326",o),this.addFeature(new ol.Feature(n))},ol.source.DayNight.prototype.setTime=function(t){this.set("time",t),this.refresh()},ol.source.DayNight.prototype.getCoordinates=function(t,e){for(var o=180/Math.PI,i=Math.PI/180,n=(t?new Date(t):new Date)/864e5+2440587.5,r=(18.697374558+24.06570982441908*(n-2451545))%24,a=[],s=function(t){var e=Math.PI/180,o=t-2451545,i=280.46+.9856474*o,n=357.528+.9856003*o;return n%=360,{lambda:(i%=360)+1.915*Math.sin(n*e)+.02*Math.sin(2*n*e),R:1.00014-.01671*Math.cos(n*e)-.0014*Math.cos(2*n*e)}}(n),l=function(t){var e=(t-2451545)/36525;return 23.43929111-e*(46.836769/3600-e*(1831e-7/3600+e*(5.565e-7-e*(1.6e-10-4.34e-8*e/3600))))}(n),c=function(t,e){var o=180/Math.PI,i=Math.PI/180,n=Math.atan(Math.cos(e*i)*Math.tan(t*i))*o,r=Math.asin(Math.sin(e*i)*Math.sin(t*i))*o;return{alpha:n+=90*Math.floor(t/90)-90*Math.floor(n/90),delta:r}}(s.lambda,l),h=this.get("step")||1,u=-180;u<=180;u+=h){var p=u,d=15*r+p-c.alpha,f=Math.atan(-Math.cos(d*i)/Math.tan(c.delta*i))*o;a.push([p,f])}switch(e){case"line":break;case"day":c.delta*=-1;default:f=c.delta<0?90:-90;for(var g=180;g>=-180;g-=h)a.push([g,f]);a.push(a[0])}if("daynight"===e){var m=[];a.forEach((function(t){m.push(t.slice())})),m[0][1]=-m[0][1],m[m.length-1][1]=-m[0][1],m[m.length-1][1]=-m[0][1],a=[a,m]}return a},ol.source.Delaunay=function(t){t=t||{},this._nodes=t.source,delete t.source,ol.source.Vector.call(this,t),this.hull=[],this._nodes.on("addfeature",this._onAddNode.bind(this)),this._nodes.on("removefeature",this._onRemoveNode.bind(this)),this.set("epsilon",t.epsilon||1e-4)},ol.ext.inherits(ol.source.Delaunay,ol.source.Vector),ol.source.Delaunay.prototype.clear=function(t){ol.source.Vector.prototype.clear.call(this,t),this.getNodeSource().clear(t)},ol.source.Delaunay.prototype._addTriangle=function(t){t.push(t[0]);var e=new ol.Feature(new ol.geom.Polygon([t]));return this.addFeature(e),this.flip.push(e),e},ol.source.Delaunay.prototype.getNodes=function(){return this._nodes.getFeatures()},ol.source.Delaunay.prototype.getNodeSource=function(){return this._nodes},ol.source.Delaunay.prototype._onRemoveNode=function(t){var e=t.feature.getGeometry().getCoordinates();if(e&&!this.getNodesAt(e).length){var o,i=this.getTrianglesAt(e);this.flip=[];for(var n=[];i.length;){var r=i.pop();this.removeFeature(r),r=r.getGeometry().getCoordinates()[0];var a=[];for(o=0;o<3;o++)l=r[o],ol.coordinate.equal(l,e)||a.push(l);n.push(a)}for(a=n.pop(),o=0;;){var s=n[o];if(m(s[0],s[1],0)||m(s[1],s[0],0)||m(s[0],s[1],a.length-1)||m(s[1],s[0],a.length-1)?(n.splice(o,1),o=0):o++,!n.length)break;if(o>=n.length)throw"[DELAUNAY:removePoint] No edge found"}var l,c=ol.coordinate.equal(a[0],a[a.length-1]);for(c&&a.pop();l=this.hull[o];o++)if(ol.coordinate.equal(e,l)){this.hull.splice(o,1);break}this.hull=ol.coordinate.convexHull(this.hull.concat(a));var h,u=function(t){for(var e,o=0,i=0;i<t.length;i++)o+=(t[e=(i+1)%t.length][0]-t[i][0])*(t[e][1]+t[i][1]);return o>=0?1:-1},p=a.slice();for(c?h=u(a):(p.push(e),h=u(p)),o=0;o<=a.length+1&&!(a.length<3);o++){var d=[a[o%a.length],a[(o+1)%a.length],a[(o+2)%a.length]];if(u(d)===h){for(var f=!0,g=o+3;g<o+a.length;g++)if(this.inCircle(a[g%a.length],d)){f=!1;break}f&&(this._addTriangle(d),a.splice((o+1)%a.length,1),o=-1)}}this.flipTriangles()}function m(t,e,o){return!!ol.coordinate.equal(t,a[o])&&(o?a.push(e):a.unshift(e),!0)}},ol.source.Delaunay.prototype._onAddNode=function(t){var e,o,i=t.feature;if("Point"===i.getGeometry().getType()){this.flip=[];var n=this.getNodes(),r=i.getGeometry().getCoordinates();if(this.getNodesAt(r).length>1)this._nodes.removeFeature(i);else if(n.length<=3){if(3===n.length){var a=[];for(e=0;e<3;e++)a.push(n[e].getGeometry().getCoordinates());this._addTriangle(a),this.hull=ol.coordinate.convexHull(a)}}else{var s=this.getFeaturesAtCoordinate(r)[0];if(s){this.removeFeature(s),s.set("del",!0);var l=s.getGeometry().getCoordinates()[0];for(e=0;e<3;e++)this._addTriangle([r,l[e],l[(e+1)%3]])}else{var c=this.hull.slice();for(c.push(r),c=ol.coordinate.convexHull(c),e=0;(o=c[e])&&!ol.coordinate.equal(o,r);e++);var h=c[e=0!==e?e-1:c.length-1],u=c[(e+2)%c.length];for(e=0;(o=this.hull[e])&&!ol.coordinate.equal(o,h);e++);for(;;){if(e>1e3){console.error("[DELAUNAY:addPoint] Too many iterations");break}if(e++,o=this.hull[e%this.hull.length],this._addTriangle([r,o,h]),h=o,o[0]===u[0]&&o[1]===u[1])break}this.hull=c}this.flipTriangles()}}else this._nodes.removeFeature(i)},ol.source.Delaunay.prototype.flipTriangles=function(){for(var t,e=1e3;this.flip.length;){if(e--<0){console.error("[DELAUNAY:flipTriangles] Too many iterations");break}var o=this.flip.pop();if(!o.get("del"))for(var i=o.getGeometry().getCoordinates()[0],n=0;n<3;n++){var r=[(i[(n+1)%3][0]+i[n][0])/2,(i[(n+1)%3][1]+i[n][1])/2],a=this.getTrianglesAt(r),s=null;if(a.length>1){var l=a[0].getGeometry().getCoordinates()[0],c=a[1].getGeometry().getCoordinates()[0];for(t=0;t<c.length;t++)if(!this._ptInTriangle(c[t],l)){s=c[t];break}}if(s&&this.inCircle(s,l)){var h;for(t=0;t<l.length;t++)if(!this._ptInTriangle(l[t],c)){h=l.splice(t,1)[0];break}if(this.intersectSegs([s,h],l)){for(;a.length;){var u=a.pop();u.set("del",!0),this.removeFeature(u)}this._addTriangle([s,h,l[0]]),this._addTriangle([s,h,l[1]])}}}}},ol.source.Delaunay.prototype.intersectSegs=function(t,e){var o=t[1][0]-t[0][0],i=t[1][1]-t[0][1],n=e[1][0]-e[0][0],r=o*(e[1][1]-e[0][1])-i*n;if(0!=r){var a=(o*t[0][1]-o*e[0][1]-i*t[0][0]+i*e[0][0])/r;return 0<a&&a<1}return!1},ol.source.Delaunay.prototype._ptInTriangle=function(t,e){for(var o,i=0;o=e[i];i++)if(ol.coordinate.equal(t,o))return!0;return!1},ol.source.Delaunay.prototype.listpt=function(t){for(var e,o="",i=0;e=t[i];i++){var n=this._nodes.getClosestFeatureToCoordinate(e);ol.coordinate.equal(n.getGeometry().getCoordinates(),e)||(n=null),o+=(o?", ":"")+(n?n.get("id"):"?")}return o},ol.source.Delaunay.prototype.inCircle=function(t,e){var o=this.getCircumCircle(e);return ol.coordinate.dist2d(t,o.center)<o.radius},ol.source.Delaunay.prototype.getCircumCircle=function(t){var e=t[0][0],o=t[0][1],i=t[1][0],n=t[1][1],r=t[2][0],a=t[2][1],s=(e-i)/(n-o),l=(e-r)/(a-o),c=(o+n)/2-s*(e+i)/2,h=((o+a)/2-l*(e+r)/2-c)/(s-l),u=[h,s*h+c];return{center:u,radius:ol.coordinate.dist2d(u,t[0])}},ol.source.Delaunay.prototype.getTrianglesAt=function(t){var e=ol.extent.buffer(ol.extent.boundingExtent([t]),this.get("epsilon")),o=[];return this.forEachFeatureIntersectingExtent(e,(function(t){o.push(t)})),o},ol.source.Delaunay.prototype.getNodesAt=function(t){var e=ol.extent.buffer(ol.extent.boundingExtent([t]),this.get("epsilon"));return this._nodes.getFeaturesInExtent(e)},ol.source.Delaunay.prototype.calculateVoronoi=function(t){var e=[];return this.getNodes().forEach(function(o){var i=o.getGeometry().getCoordinates(),n=!1;if(!0!==t)for(var r=0;r<this.hull.length;r++)if(ol.coordinate.equal(i,this.hull[r])){n=!0;break}if(!n){var a=this.getTrianglesAt(i),s=[];a.forEach(function(t){var e=this.getCircumCircle(t.getGeometry().getCoordinates()[0]);s.push({pt:e.center,d:Math.atan2(e.center[1]-i[1],e.center[0]-i[0])})}.bind(this)),s.sort((function(t,e){return t.d-e.d}));var l=[];s.forEach((function(t){l.push(t.pt)})),l.push(l[0]);var c=o.getProperties();c.geometry=new ol.geom.Polygon([l]),e.push(new ol.Feature(c))}}.bind(this)),e},ol.source.FeatureBin=function(t){var e;(t=t||{}).binSource?(this._sourceFeature=t.binSource,this._sourceFeature.on(["addfeature","changefeature","removefeature"],function(){e&&clearTimeout(e),e=setTimeout(function(){this.reset()}.bind(this))}.bind(this))):this._sourceFeature=new ol.source.Vector({features:t.features||[]});ol.source.BinBase.call(this,t)},ol.ext.inherits(ol.source.FeatureBin,ol.source.BinBase),ol.source.FeatureBin.prototype.setFeatures=function(t){this._sourceFeature.clear(),this._sourceFeature.addFeatures(t||[]),this.reset()},ol.source.FeatureBin.prototype.getGridGeomAt=function(t,e){var o=this._sourceFeature.getFeaturesAtCoordinate(t)[0];if(!o)return null;var i=o.getProperties();for(var n in i)"geometry"!==n&&(e[n]=i[n]);return o.getGeometry()},ol.source.GeoImage=function(t){var e={attributions:t.attributions,logo:t.logo,projection:t.projection};this.center=t.imageCenter,this.scale=t.imageScale,this.rotate=t.imageRotate?t.imageRotate:0,this.crop=t.imageCrop,this.mask=t.imageMask,this._image=t.image?t.image:new Image,this._image.crossOrigin=t.crossOrigin;var o=this;this._image.onload=function(){o.setCrop(o.crop),o.changed()},t.image||(this._image.src=t.url),e.canvasFunction=function(t,e,o,i){var n=document.createElement("canvas");n.width=i[0],n.height=i[1];var r=n.getContext("2d");if(!this._imageSize)return n;function a(e){return[(e[0]-t[0])/(t[2]-t[0])*i[0],(e[1]-t[3])/(t[1]-t[3])*i[1]]}if(this.mask){r.beginPath();var s=a(this.mask[0]);r.moveTo(s[0],s[1]);for(var l=1;l<this.mask.length;l++)s=a(this.mask[l]),r.lineTo(s[0],s[1]);r.clip()}var c=a(this.center),h=(this._image.naturalWidth/2-this.crop[0])*this.scale[0]/e*o,u=(this._image.naturalHeight/2-this.crop[1])*this.scale[1]/e*o,p=this._imageSize[0]*this.scale[0]/e*o,d=this._imageSize[1]*this.scale[1]/e*o;return r.translate(c[0],c[1]),this.rotate&&r.rotate(this.rotate),r.drawImage(this._image,this.crop[0],this.crop[1],this._imageSize[0],this._imageSize[1],-h,-u,p,d),n},ol.source.ImageCanvas.call(this,e),this.setCrop(this.crop),this.on("change",function(){this.set("extent",this.calculateExtent())}.bind(this))},ol.ext.inherits(ol.source.GeoImage,ol.source.ImageCanvas),ol.source.GeoImage.prototype.getCenter=function(){return this.center},ol.source.GeoImage.prototype.setCenter=function(t){this.center=t,this.changed()},ol.source.GeoImage.prototype.getScale=function(){return this.scale},ol.source.GeoImage.prototype.setScale=function(t){switch(o(t)){case"number":t=[t,t];break;case"object":if(2!=t.length)return;break;default:return}this.scale=t,this.changed()},ol.source.GeoImage.prototype.getRotation=function(){return this.rotate},ol.source.GeoImage.prototype.setRotation=function(t){this.rotate=t,this.changed()},ol.source.GeoImage.prototype.getGeoImage=function(){return this._image},ol.source.GeoImage.prototype.getCrop=function(){return this.crop},ol.source.GeoImage.prototype.setMask=function(t){this.mask=t,this.changed()},ol.source.GeoImage.prototype.getMask=function(){return this.mask},ol.source.GeoImage.prototype.setCrop=function(t){if(this._image.naturalWidth){if(t){switch(o(t)){case"number":t=[t,t,this._image.naturalWidth-t,this._image.naturalHeight-t];break;case"object":if(4!=t.length)return;break;default:return}t=ol.extent.boundingExtent([[t[0],t[1]],[t[2],t[3]]]),this.crop=[Math.max(0,t[0]),Math.max(0,t[1]),Math.min(this._image.naturalWidth,t[2]),Math.min(this._image.naturalHeight,t[3])]}else this.crop=[0,0,this._image.naturalWidth,this._image.naturalHeight];this.crop[2]<=this.crop[0]&&(this.crop[2]=this.crop[0]+1),this.crop[3]<=this.crop[1]&&(this.crop[3]=this.crop[1]+1),this._imageSize=[this.crop[2]-this.crop[0],this.crop[3]-this.crop[1]],this.changed()}else this.crop=t},ol.source.GeoImage.prototype.getExtent=function(t){if(t){for(var e=this.get("extent"),o=0;o<t.length;o++)t[o]=e[o];return e}return this.get("extent")},ol.source.GeoImage.prototype.calculateExtent=function(t){var e;if(!1!==t&&this.getMask())e=new ol.geom.Polygon([this.getMask()]);else{var o=this.getCenter(),i=this.getScale(),n=this.getGeoImage().width*i[0],r=this.getGeoImage().height*i[1],a=ol.extent.boundingExtent([[o[0]-n/2,o[1]-r/2],[o[0]+n/2,o[1]+r/2]]);(e=ol.geom.Polygon.fromExtent(a)).rotate(-this.getRotation(),o)}return e.getExtent()},ol.source.GeoRSS=function(t){(t=t||{}).loader=this._loaderFn,ol.source.Vector.call(this,t)},ol.ext.inherits(ol.source.GeoRSS,ol.source.Vector),ol.source.GeoRSS.prototype._loaderFn=function(t,e,o){ol.ext.Ajax.get({url:this.getUrl(),dataType:"XML",error:function(){console.log("oops")},success:function(t){var e=(new ol.format.GeoRSS).readFeatures(t,{featureProjection:o});this.addFeatures(e)}.bind(this)})},ol.source.Geoportail=function(t,e){e=e||{},t.layer&&(t=(e=t).layer);for(var o=new Array,i=new Array,n=ol.extent.getWidth(ol.proj.get("EPSG:3857").getExtent())/256,r=0;r<=(e.maxZoom?e.maxZoom:20);r++)o[r]=r,i[r]=n/Math.pow(2,r);var a=new ol.tilegrid.WMTS({origin:[-20037508,20037508],resolutions:i,matrixIds:o});a.minZoom=e.minZoom?e.minZoom:0;var s=[ol.source.Geoportail.prototype.attribution];e.attributions&&(s=e.attributions),this._server=e.server||"https://wxs.ign.fr/geoportail/wmts",this._gppKey=e.gppKey||"choisirgeoportail";var l={url:this.serviceURL(),layer:t,matrixSet:"PM",format:e.format?e.format:"image/jpeg",projection:"EPSG:3857",tileGrid:a,style:e.style?e.style:"normal",attributions:s,crossOrigin:void 0===e.crossOrigin?"anonymous":e.crossOrigin,wrapX:!(!1===e.wrapX)};ol.source.WMTS.call(this,l),e.authentication&&this.setTileLoadFunction(ol.source.Geoportail.tileLoadFunctionWithAuthentication(e.authentication,this.getFormat()))},ol.ext.inherits(ol.source.Geoportail,ol.source.WMTS),ol.source.Geoportail.prototype.attribution='<a href="http://www.geoportail.gouv.fr/">Géoportail</a> &copy; <a href="http://www.ign.fr/">IGN-France</a>',ol.source.Geoportail.prototype.serviceURL=function(){return this._server?this._server.replace(/^(https?:\/\/[^/]*)(.*)$/,"$1/"+this._gppKey+"$2"):(window.geoportailConfig?window.geoportailConfig.url:"https://wxs.ign.fr/")+this._gppKey+"/geoportail/wmts"},ol.source.Geoportail.prototype.getGPPKey=function(){return this._gppKey},ol.source.Geoportail.prototype.setGPPKey=function(t,e){this._gppKey=t;var o=this.serviceURL();this.setTileUrlFunction((function(){var t=ol.source.Geoportail.prototype.getTileUrlFunction().apply(this,arguments);if(t){var e=t.split("?");return o+"?"+e[1]}return t})),e&&this.setTileLoadFunction(ol.source.Geoportail.tileLoadFunctionWithAuthentication(e,this.getFormat()))},ol.source.Geoportail.prototype.getFeatureInfoUrl=function(t,e,o,i){i=i||{},o||(o=this.getProjection());var n=this.tileGrid.getTileCoordForCoordAndResolution(t,e),r=this.getTileUrlFunction()(n,1,o);if(!r)return r;var a=this.tileGrid.getResolution(n[0]),s=this.tileGrid.getTileCoordExtent(n),l=Math.floor((t[0]-s[0])/(a/1)),c=Math.floor((s[3]-t[1])/(a/1));return r.replace(/Request=GetTile/i,"Request=getFeatureInfo")+"&INFOFORMAT="+(i.INFO_FORMAT||"text/plain")+"&I="+l+"&J="+c},ol.source.Geoportail.prototype.getFeatureInfo=function(t,e,o){var i=this.getFeatureInfoUrl(t,e,null,o);ol.ext.Ajax.get({url:i,dataType:o.format||"text/plain",options:{encode:!1},success:function(t){o.callback&&o.callback(t)},error:o.error||function(){}})},ol.source.Geoportail.tileLoadFunctionWithAuthentication=function(t,e){if(t)return function(o,i){var n=new XMLHttpRequest;n.open("GET",i),n.setRequestHeader("Authorization","Basic "+t),n.responseType="arraybuffer",n.onload=function(){var t=new Uint8Array(this.response),i=new Blob([t],{type:e}),n=(window.URL||window.webkitURL).createObjectURL(i);o.getImage().src=n},n.onerror=function(){o.getImage().src=""},n.send()}},ol.source.GridBin=function(t){t=t||{},ol.source.BinBase.call(this,t),this.set("gridProjection",t.gridProjection||"EPSG:4326"),this.set("size",t.size||1)},ol.ext.inherits(ol.source.GridBin,ol.source.BinBase),ol.source.GridBin.prototype.setGridProjection=function(t){this.set("gridProjection",t),this.reset()},ol.source.GridBin.prototype.setSize=function(t){this.set("size",t),this.reset()},ol.source.GridBin.prototype.getGridGeomAt=function(t){t=ol.proj.transform(t,this.getProjection()||"EPSG:3857",this.get("gridProjection"));var e=this.get("size"),o=e*Math.floor(t[0]/e),i=e*Math.floor(t[1]/e);return new ol.geom.Polygon([[[o,i],[o+e,i],[o+e,i+e],[o,i+e],[o,i]]]).transform(this.get("gridProjection"),this.getProjection()||"EPSG:3857")},ol.source.HexBin=function(t){t=t||{},this._hexgrid=new ol.HexGrid(t),ol.source.BinBase.call(this,t)},ol.ext.inherits(ol.source.HexBin,ol.source.BinBase),ol.source.HexBin.prototype.getGridGeomAt=function(t){var e=this._hexgrid.coord2hex(t);return new ol.geom.Polygon([this._hexgrid.getHexagon(e)])},ol.source.HexBin.prototype.setSize=function(t,e){this._hexgrid.setSize(t),e||this.reset()},ol.source.HexBin.prototype.getSize=function(){return this._hexgrid.getSize()},ol.source.HexBin.prototype.setLayout=function(t,e){this._hexgrid.setLayout(t),e||this.reset()},ol.source.HexBin.prototype.getLayout=function(){return this._hexgrid.getLayout()},ol.source.HexBin.prototype.setOrigin=function(t,e){this._hexgrid.setOrigin(t),e||this.reset()},ol.source.HexBin.prototype.getOrigin=function(){return this._hexgrid.getOrigin()},ol.source.HexBin.prototype.getHexFeatures=function(){return ol.source.BinBase.prototype.getGridFeatures.call(this)},ol.source.InseeBin=function(t){t=t||{},this._grid=new ol.InseeGrid({size:t.size}),ol.source.BinBase.call(this,t)},ol.ext.inherits(ol.source.InseeBin,ol.source.BinBase),ol.source.InseeBin.prototype.setSize=function(t){this.getSize()!==t&&(this._grid.set("size",t),this.reset())},ol.source.InseeBin.prototype.getSize=function(){return this._grid.get("size")},ol.source.InseeBin.prototype.getGridGeomAt=function(t){return this._grid.getGridAtCoordinate(t,this.getProjection())},ol.source.InseeBin.prototype.getGridExtent=function(t){return this._grid.getExtent(t)},ol.source.Mapillary=function(t){var e=t||{};e.loader=this._loaderFn,this._maxResolution=e.maxResolution||100,this._limit=e.limit||100,e.attributions||(e.attributions=["&copy; <a href='https://www.mapillary.com/'>Mapillary</a>"]),e.strategy||(e.strategy=ol.loadingstrategy.bbox),ol.source.Vector.call(this,e)},ol.ext.inherits(ol.source.Mapillary,ol.source.Vector),ol.source.Mapillary.prototype.readFeature=function(){return!0},ol.source.Mapillary.prototype._loaderFn=function(t,e,o){if(!(e>this._maxResolution)){var i=ol.proj.transformExtent(t,o,"EPSG:4326"),n=Date.now()-15552e6,r="https://a.mapillary.com/v2/search/im?client_id="+this.get("clientId")+"&max_lat="+i[3]+"&max_lon="+i[2]+"&min_lat="+i[1]+"&min_lon="+i[0]+"&limit="+(this._limit-1)+"&start_time="+n;ol.ext.Ajax.get({url:r,dataType:"jsonp",success:function(t){console.log(t)}})}},ol.source.OilPainting=function(t){t.operation=this._operation,t.operationType="image",ol.source.Raster.call(this,t),this.set("radius",t.radius||4),this.set("intensity",t.intensity||25),this.on("beforeoperations",function(t){var e=Math.round((t.extent[2]-t.extent[0])/t.resolution),o=Math.round((t.extent[3]-t.extent[1])/t.resolution);t.data.image=new ImageData(e,o),t.data.radius=Number(this.get("radius"))||1,t.data.intensity=Number(this.get("intensity"))}.bind(this))},ol.ext.inherits(ol.source.OilPainting,ol.source.Raster),ol.source.OilPainting.prototype.set=function(t,e){if(e)switch(t){case"intensity":case"radius":(e=Number(e))<1&&(e=1),this.changed()}return ol.source.Raster.prototype.set.call(this,t,e)},ol.source.OilPainting.prototype._operation=function(t,e){for(var o=t[0].width,i=t[0].height,n=t[0].data,r=[],a=e.image,s=a.data,l=[],c=[],h=0;h<i;h++){l[h]=[],c[h]=[];for(var u=0;u<o;u++){var p=4*(h*o+u),d=n[p],f=n[p+1],g=n[p+2],m=(d+f+g)/3;l[h][u]=Math.round(m*e.intensity/255),c[h][u]={r:d,g:f,b:g}}}var y=e.radius;for(h=0;h<i;h++)for(u=0;u<o;u++){r=[];for(var v=-y;v<=y;v++)for(var b=-y;b<=y;b++)if(h+v>0&&h+v<i&&u+b>0&&u+b<o){var _=l[h+v][u+b];r[_]?(r[_].val++,r[_].r+=c[h+v][u+b].r,r[_].g+=c[h+v][u+b].g,r[_].b+=c[h+v][u+b].b):r[_]={val:1,r:c[h+v][u+b].r,g:c[h+v][u+b].g,b:c[h+v][u+b].b}}r.sort((function(t,e){return e.val-t.val}));var S=r[0].val,w=4*(h*o+u);s[w]=~~(r[0].r/S),s[w+1]=~~(r[0].g/S),s[w+2]=~~(r[0].b/S),s[w+3]=255}return a},ol.source.Overpass=function(t){(t=t||{}).loader=this._loaderFn,this._url=t.url||"https://overpass-api.de/api/interpreter",this._maxResolution=t.maxResolution||100,t.attributions||(t.attributions=ol.source.OSM.ATTRIBUTION),t.strategy||(t.strategy=ol.loadingstrategy.bbox),ol.source.Vector.call(this,t),this._types={node:!1!==t.node,way:!1!==t.way,rel:!0===t.rel},this._filter=t.filter},ol.ext.inherits(ol.source.Overpass,ol.source.Vector),ol.source.Overpass.prototype._loaderFn=function(t,e,o){if(!(e>this._maxResolution)){var i=this,n=ol.proj.transformExtent(t,o,"EPSG:4326"),r="[bbox:"+(n=n[1]+","+n[0]+","+n[3]+","+n[2])+"][out:xml][timeout:25];";for(var a in r+="(",this._types)if(this._types[a]){r+=a;for(var s,l=0;s=this._filter[l];l++)r+="["+s+"]";r+=";"}r+=");out;>;out skel qt;";var c=new XMLHttpRequest;c.open("POST",this._url,!0),c.onload=function(){for(var t,e=(new ol.format.OSMXML).readFeatures(this.responseText,{featureProjection:o}),n=[],r=0;t=e[r];r++)i.hasFeature(t)||n.push(t);i.addFeatures(n)},c.onerror=function(){console.log(arguments)},c.send("data="+r)}},ol.source.Overpass.prototype.hasFeature=function(t){for(var e,o=t.getGeometry().getFirstCoordinate(),i=t.getId(),n=this.getFeaturesInExtent([o[0]-.1,o[1]-.1,o[0]+.1,o[1]+.1]),r=0;e=n[r];r++)if(i===e.getId())return!0;return!1},n=ol.source.Vector.prototype.clear,ol.source.Vector.prototype.clear=function(t){this.dispatchEvent({type:"clearstart"}),n.call(this,t),this.dispatchEvent({type:"clearend"})},ol.layer.Vector3D=function(t){t=t||{},this._source=t.source,this.height_=this.getHfn(t.height);var e=document.createElement("canvas");ol.layer.Image.call(this,{source:new ol.source.ImageCanvas({canvasFunction:function(t,o,i,n){return e.width=n[0],e.height=n[1],e}}),center:t.center||[.5,1],defaultHeight:t.defaultHeight||0,maxResolution:t.maxResolution||1/0}),this.setStyle(t.style),this.on(["postcompose","postrender"],this.onPostcompose_.bind(this))},ol.ext.inherits(ol.layer.Vector3D,ol.layer.Image),ol.layer.Vector3D.prototype.setHeight=function(t){this.height_=this.getHfn(t),this.changed()},ol.layer.Vector3D.prototype.setStyle=function(t){if(t instanceof ol.style.Style?this._style=t:this._style=new ol.style.Style,this._style.getStroke()||this._style.setStroke(new ol.style.Stroke({width:1,color:"red"})),this._style.getFill()||this._style.setFill(new ol.style.Fill({color:"rgba(0,0,255,0.5)"})),this._style.getText()||this._style.setText(new ol.style.Fill({color:"red"})),t&&t.getGeometry()){var e=t.getGeometry();"function"==typeof e?this.set("geometry",e):this.set("geometry",(function(){return e}))}else this.set("geometry",(function(t){return t.getGeometry()}))},ol.layer.Vector3D.prototype.getStyle=function(){return this._style},ol.layer.Vector3D.prototype.onPostcompose_=function(t){var e=t.frameState.viewState.resolution;if(!(e>this.get("maxResolution"))){if(this.res_=400*e,this.animate_){var o=t.frameState.time-this.animate_;o<this.animateDuration_?(this.elapsedRatio_=this.easing_(o/this.animateDuration_),t.frameState.animate=!0):(this.animate_=!1,this.height_=this.toHeight_)}var i=t.frameState.pixelRatio,n=t.context,r=this.matrix_=t.frameState.coordinateToPixelTransform||t.frameState.Pe;r||((r=t.frameState.coordinateToPixelMatrix)[2]=r[4],r[3]=r[5],r[4]=r[12],r[5]=r[13]),this.center_=[n.canvas.width*this.get("center")[0]/i,n.canvas.height*this.get("center")[1]/i];var a=this._source.getFeaturesInExtent(t.frameState.extent);n.save(),n.scale(i,i);var s=this.getStyle();n.lineWidth=s.getStroke().getWidth(),n.lineCap=s.getStroke().getLineCap(),n.strokeStyle=ol.color.asString(s.getStroke().getColor()),n.fillStyle=ol.color.asString(s.getFill().getColor());for(var l=[],c=0;c<a.length;c++)l.push(this.getFeature3D_(a[c],this._getFeatureHeight(a[c])));this.drawFeature3D_(n,l),n.restore()}},ol.layer.Vector3D.prototype.getHfn=function(t){switch(o(t)){case"function":return t;case"string":var e=this.get("defaultHeight");return function(o){return Number(o.get(t))||e};case"number":return function(){return t};default:return function(){return 10}}},ol.layer.Vector3D.prototype.animate=function(t){t=t||{},this.toHeight_=this.getHfn(t.height),this.animate_=(new Date).getTime(),this.animateDuration_=t.duration||1e3,this.easing_=t.easing||ol.easing.easeOut,this.changed()},ol.layer.Vector3D.prototype.animating=function(){return this.animate_&&(new Date).getTime()-this.animate_>this.animateDuration_&&(this.animate_=!1),!!this.animate_},ol.layer.Vector3D.prototype._getFeatureHeight=function(t){if(this.animate_){var e=this.height_(t),o=this.toHeight_(t);return e*(1-this.elapsedRatio_)+this.elapsedRatio_*o}return this.height_(t)},ol.layer.Vector3D.prototype.hvector_=function(t,e){var o=[t[0]*this.matrix_[0]+t[1]*this.matrix_[1]+this.matrix_[4],t[0]*this.matrix_[2]+t[1]*this.matrix_[3]+this.matrix_[5]];return{p0:o,p1:[o[0]+e/this.res_*(o[0]-this.center_[0]),o[1]+e/this.res_*(o[1]-this.center_[1])]}},ol.layer.Vector3D.prototype.getFeature3D_=function(t,e){var o=this.get("geometry")(t),i=o.getCoordinates();switch(0===i.length&&(i=t.ce.geometry.getCoordinates()[0]),o.getType()){case"Polygon":i=[i];case"MultiPolygon":for(var n=[],r=0;r<i.length;r++)for(var a=0;a<i[r].length;a++){for(var s=[],l=0;l<i[r][a].length;l++)s.push(this.hvector_(i[r][a][l],e));n.push(s)}return{type:"MultiPolygon",feature:t,geom:n};case"Point":return{type:"Point",feature:t,geom:this.hvector_(i,e)};default:return{}}},ol.layer.Vector3D.prototype.drawFeature3D_=function(t,e){var o,i,n,r;for(o=0;o<e.length;o++)switch(e[o].type){case"MultiPolygon":for(i=0;i<e[o].geom.length;i++)for(n=e[o].geom[i],r=0;r<n.length;r++)t.beginPath(),t.moveTo(n[r].p0[0],n[r].p0[1]),t.lineTo(n[r].p1[0],n[r].p1[1]),t.stroke();break;case"Point":var a=e[o].geom;t.beginPath(),t.moveTo(a.p0[0],a.p0[1]),t.lineTo(a.p1[0],a.p1[1]),t.stroke()}for(o=0;o<e.length;o++)switch(e[o].type){case"MultiPolygon":for(t.beginPath(),i=0;i<e[o].geom.length;i++){if(n=e[o].geom[i],0==i)for(t.moveTo(n[0].p1[0],n[0].p1[1]),r=1;r<n.length;r++)t.lineTo(n[r].p1[0],n[r].p1[1]);else for(t.moveTo(n[0].p1[0],n[0].p1[1]),r=n.length-2;r>=0;r--)t.lineTo(n[r].p1[0],n[r].p1[1]);t.closePath()}t.fill("evenodd"),t.stroke();break;case"Point":var s=(n=e[o]).feature.get("label");if(s){var l=n.geom.p1,c=t.measureText(s),h=Number(t.font.match(/\d+(\.\d+)?/g).join([]));t.fillRect(l[0]-c.width/2-5,l[1]-h-5,c.width+10,h+10),t.strokeRect(l[0]-c.width/2-5,l[1]-h-5,c.width+10,h+10),t.save(),t.fillStyle=ol.color.asString(this._style.getText().getFill().getColor()),t.textAlign="center",t.textBaseline="bottom",t.fillText(s,l[0],l[1]),t.restore()}}},ol.source.WikiCommons=function(t){var e=t||{};e.loader=this._loaderFn,this._maxResolution=e.maxResolution||100,this._lang=e.lang||"fr",this._limit=e.limit||100,e.attributions||(e.attributions=["&copy; <a href='https://commons.wikimedia.org/'>Wikimedia Commons</a>"]),e.strategy||(e.strategy=ol.loadingstrategy.bbox),ol.source.Vector.call(this,e)},ol.ext.inherits(ol.source.WikiCommons,ol.source.Vector),ol.source.WikiCommons.prototype.readFeature=function(t,e){return t.set("descriptionurl",e.descriptionurl),t.set("url",e.url),t.set("title",e.title.replace(/^file:|.jpg$/gi,"")),t.set("thumbnail",e.url.replace(/^(.+wikipedia\/commons)\/([a-zA-Z0-9]\/[a-zA-Z0-9]{2})\/(.+)$/,"$1/thumb/$2/$3/200px-$3")),t.set("user",e.user),e.extmetadata&&e.extmetadata.LicenseShortName&&t.set("copy",e.extmetadata.LicenseShortName.value),!0},ol.source.WikiCommons.prototype._loaderFn=function(t,e,o){if(!(e>this._maxResolution)){var i=this,n=ol.proj.transformExtent(t,o,"EPSG:4326"),r="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=coordinates|imageinfo&generator=geosearch&iiprop=timestamp|user|url|extmetadata|metadata|size&iiextmetadatafilter=LicenseShortName&ggsbbox="+n[3]+"|"+n[0]+"|"+n[1]+"|"+n[2]+"&ggslimit="+this._limit+"&iilimit="+(this._limit-1)+"&ggsnamespace=6";ol.ext.Ajax.get({url:r,success:function(t){var e,n,r,a=[];if(t.query&&t.query.pages){for(var s in t.query.pages){if((e=t.query.pages[s]).coordinates&&e.coordinates.length)n=[e.coordinates[0].lon,e.coordinates[0].lat];else{var l=e.imageinfo[0].metadata;if(!l)continue;n=[];for(var c=0,h=0;h<l.length;h++)"GPSLongitude"==l[h].name&&(n[0]=l[h].value,c++),"GPSLatitude"==l[h].name&&(n[1]=l[h].value,c++);if(2!=c)continue}r=new ol.Feature(new ol.geom.Point(ol.proj.transform(n,"EPSG:4326",o))),e.imageinfo[0].title=e.title,i.readFeature(r,e.imageinfo[0])&&a.push(r)}i.addFeatures(a)}}})}},ol.layer.AnimatedCluster=function(t){var e=t||{};ol.layer.Vector.call(this,e),this.oldcluster=new ol.source.Vector,this.clusters=[],this.animation={start:!1},this.set("animationDuration","number"==typeof e.animationDuration?e.animationDuration:700),this.set("animationMethod",e.animationMethod||ol.easing.easeOut),this.getSource().on("change",this.saveCluster.bind(this)),this.on(["precompose","prerender"],this.animate.bind(this)),this.on(["postcompose","postrender"],this.postanimate.bind(this))},ol.ext.inherits(ol.layer.AnimatedCluster,ol.layer.Vector),ol.layer.AnimatedCluster.prototype.saveCluster=function(){if(this.oldcluster){if(this.oldcluster.clear(),!this.get("animationDuration"))return;var t=this.getSource().getFeatures();t.length&&t[0].get("features")&&(this.oldcluster.addFeatures(this.clusters),this.clusters=t.slice(0),this.sourceChanged=!0)}},ol.layer.AnimatedCluster.prototype.getClusterForFeature=function(t,e){for(var o,i=0;o=e[i];i++){var n=o.get("features");if(n&&n.length)for(var r,a=0;r=n[a];a++)if(t===r)return o}return!1},ol.layer.AnimatedCluster.prototype.stopAnimation=function(){this.animation.start=!1,this.animation.cA=[],this.animation.cB=[]},ol.layer.AnimatedCluster.prototype.animate=function(t){var e=this.get("animationDuration");if(e){var o,i,n=t.frameState.viewState.resolution,r=this.animation,a=t.frameState.time;if(r.resolution!=n&&this.sourceChanged){var s=t.frameState.extent;for(r.resolution<n?(s=ol.extent.buffer(s,100*n),r.cA=this.oldcluster.getFeaturesInExtent(s),r.cB=this.getSource().getFeaturesInExtent(s),r.revers=!1):(s=ol.extent.buffer(s,100*n),r.cA=this.getSource().getFeaturesInExtent(s),r.cB=this.oldcluster.getFeaturesInExtent(s),r.revers=!0),r.clusters=[],o=0;i=r.cA[o];o++){var l=i.get("features");if(l&&l.length){var c=this.getClusterForFeature(l[0],r.cB);c&&r.clusters.push({f:i,pt:c.getGeometry().getCoordinates()})}}if(r.resolution=n,this.sourceChanged=!1,!r.clusters.length||r.clusters.length>1e3)return void this.stopAnimation();a=r.start=(new Date).getTime()}if(r.start){var h=t.vectorContext||ol.render.getVectorContext(t),u=(a-r.start)/e;u>1&&(this.stopAnimation(),u=1),u=this.get("animationMethod")(u);var p=this.getStyle(),d="function"==typeof p?p:p.length?function(){return p}:function(){return[p]};for(t.context.save(),t.context.globalAlpha=this.getOpacity(),o=0;c=r.clusters[o];o++){var f=c.f.getGeometry().getCoordinates(),g=f[0]-c.pt[0],m=f[1]-c.pt[1];r.revers?(f[0]=c.pt[0]+u*g,f[1]=c.pt[1]+u*m):(f[0]=f[0]-u*g,f[1]=f[1]-u*m);var y=d(c.f,n,!0);if(y.length||(y=[y]),1!==c.f.get("features").length||g||m){var v=new ol.geom.Point(f);l=new ol.Feature(v)}else l=c.f.get("features")[0];for(var b,_=0;b=y[_];_++)if(b.getText()&&/\n/.test(b.getText().getText())){var S,w=b.getText().getOffsetX(),x=b.getText().getOffsetY(),L=b.getText().getRotation()||0,M=1.2*Number((b.getText().getFont()||"10px").match(/\d+/)),k=b.getText().getText().split("\n"),C=k.length-1,E=b.clone();k.forEach((function(t,e){switch(1==e&&(E.setImage(),E.setFill(),E.setStroke()),b.getText().getTextBaseline()){case"alphabetic":case"ideographic":case"bottom":S=C;break;case"hanging":case"top":S=0;break;default:S=C/2}E.getText().setOffsetX(w-Math.sin(L)*M*(e-S)),E.getText().setOffsetY(x+Math.cos(L)*M*(e-S)),E.getText().setText(t),h.drawFeature(l,E)}))}else h.drawFeature(l,b)}t.context.restore(),t.frameState.animate=!0,t.context.save(),t.context.beginPath(),t.context.rect(0,0,0,0),t.context.clip(),this.clip_=!0}}},ol.layer.AnimatedCluster.prototype.postanimate=function(t){this.clip_&&(t.context.restore(),this.clip_=!1)},ol.layer.GeoImage=function(t){ol.layer.Image.call(this,t)},ol.ext.inherits(ol.layer.GeoImage,ol.layer.Image),ol.layer.GeoImage.prototype.getExtent=function(){return this.getSource().getExtent()},ol.layer.Geoportail=function(t,e,o){e=e||{},o=o||{},t.layer&&(o=e,t=(e=t).layer);var i=e.maxZoom,n=window.geoportailConfig&&(window.geoportailConfig.capabilities[e.gppKey||e.key]||window.geoportailConfig.capabilities.default)||ol.layer.Geoportail.capabilities;for(var r in(n=n[t])||(n={title:t,originators:[]},console.error('ol.layer.Geoportail: no layer definition for "'+t+'"\nTry to use ol/layer/Geoportail~loadCapabilities() to get it.')),n)void 0===o[r]&&(o[r]=n[r]);this._originators=n.originators,o.gppKey||(o.gppKey=e.gppKey||e.key),e.source=new ol.source.Geoportail(t,o),e.title||(e.title=n.title),e.name||(e.name=t),e.layer=t,e.queryable||(e.queryable=n.queryable),e.desc||(e.desc=n.desc),!e.extent&&n.bbox&&n.bbox[0]>-170&&n.bbox[2]<170&&(e.extent=ol.proj.transformExtent(n.bbox,"EPSG:4326","EPSG:3857")),e.maxZoom=i,!e.maxResolution&&o.minZoom&&(e.source.getTileGrid().minZoom-=o.minZoom>1?2:1,e.maxResolution=e.source.getTileGrid().getResolution(e.source.getTileGrid().minZoom),e.source.getTileGrid().minZoom=o.minZoom),ol.layer.Tile.call(this,e)},ol.ext.inherits(ol.layer.Geoportail,ol.layer.Tile),ol.layer.Geoportail.capabilities={"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",title:"Plan IGN v2",format:"image/png",style:"normal",queryable:!1,tilematrix:"PM",minZoom:0,maxZoom:19,bbox:[-175,-85,175,85],desc:"Cartographie multi-échelles sur le territoire national, issue des bases de données vecteur de l’IGN, mis à jour régulièrement et réalisée selon un processus entièrement automatisé. Version actuellement en beta test",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:19,constraint:[{minZoom:0,maxZoom:19,bbox:[-175,-85,175,85]}]}}},"CADASTRALPARCELS.PARCELLAIRE_EXPRESS":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"CADASTRALPARCELS.PARCELLAIRE_EXPRESS",title:"PCI vecteur",format:"image/png",style:"PCI vecteur",queryable:!1,tilematrix:"PM",minZoom:0,maxZoom:19,bbox:[-63.37252,-21.475586,55.925865,51.31212],desc:"Plan cadastral informatisé vecteur de la DGFIP.",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:19,constraint:[{minZoom:0,maxZoom:19,bbox:[-63.37252,-21.475586,55.925865,51.31212]}]}}},"ORTHOIMAGERY.ORTHOPHOTOS":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",title:"Photographies aériennes",format:"image/jpeg",style:"normal",queryable:!0,tilematrix:"PM",minZoom:0,bbox:[-178.18713,-22.767689,167.94624,51.11242],desc:"Photographies aériennes",originators:{CRCORSE:{href:"http://www.corse.fr//",attribution:"CRCORSE",logo:"https://wxs.ign.fr/static/logos/CRCORSE/CRCORSE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[8.428783,41.338627,9.688606,43.08541]}]},SIGLR:{href:"http://www.siglr.org//",attribution:"SIGLR",logo:"https://wxs.ign.fr/static/logos/SIGLR/SIGLR.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[1.6784439,42.316307,4.8729386,44.978218]}]},"BOURGOGNE-FRANCHE-COMTE":{href:"https://www.bourgognefranchecomte.fr/",attribution:"Auvergne",logo:"https://wxs.ign.fr/static/logos/BOURGOGNE-FRANCHE-COMTE/BOURGOGNE-FRANCHE-COMTE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[2.837849,46.131435,7.1713247,48.408287]}]},FEDER_AUVERGNE:{href:"http://www.europe-en-auvergne.eu/",attribution:"Auvergne",logo:"https://wxs.ign.fr/static/logos/FEDER_AUVERGNE/FEDER_AUVERGNE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[2.0398402,44.60505,3.38408,45.49146]}]},FEDER_PAYSDELALOIRE:{href:"https://www.europe.paysdelaloire.fr/",attribution:"Pays-de-la-Loire",logo:"https://wxs.ign.fr/static/logos/FEDER_PAYSDELALOIRE/FEDER_PAYSDELALOIRE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-2.457367,46.19304,.951426,48.57609]}]},IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:13,maxZoom:20,constraint:[{minZoom:19,maxZoom:19,bbox:[-63.160706,-21.401262,55.84643,51.11242]},{bbox:[.035491213,43.221077,6.0235267,49.696926]},{minZoom:20,maxZoom:20,bbox:[.035491213,43.221077,6.0235267,49.696926]},{minZoom:13,maxZoom:18,bbox:[-178.18713,-21.401329,55.85611,51.11242]}]},"E-MEGALIS":{href:"http://www.e-megalisbretagne.org//",attribution:"Syndicat mixte de coopération territoriale (e-Megalis)",logo:"https://wxs.ign.fr/static/logos/E-MEGALIS/E-MEGALIS.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-3.7059498,47.971947,-1.8486879,48.99035]}]},FEDER2:{href:"http://www.europe-en-france.gouv.fr/",attribution:"Fonds européen de développement économique et régional",logo:"https://wxs.ign.fr/static/logos/FEDER2/FEDER2.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[1.3577043,48.824635,4.269964,50.37648]}]},PREFECTURE_GUADELOUPE:{href:"www.guadeloupe.pref.gouv.fr/",attribution:"guadeloupe",logo:"https://wxs.ign.fr/static/logos/PREFECTURE_GUADELOUPE/PREFECTURE_GUADELOUPE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-61.82342,14.371942,-60.787838,16.521578]}]},OCCITANIE:{href:"https://www.laregion.fr/",attribution:"La Région Occitanie; Pyrénées - Méditerranée",logo:"https://wxs.ign.fr/static/logos/OCCITANIE/OCCITANIE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[2.2086434,48.805965,2.4859917,48.915382]}]},RGD_SAVOIE:{href:"http://www.rgd.fr",attribution:"Régie de Gestion de Données des Pays de Savoie (RGD 73-74)",logo:"https://wxs.ign.fr/static/logos/RGD_SAVOIE/RGD_SAVOIE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:19,maxZoom:19,bbox:[5.7759595,45.65335,7.0887337,46.438328]},{minZoom:13,maxZoom:18,bbox:[5.5923314,45.017353,7.2323394,46.438328]}]},CG45:{href:"http://www.loiret.com",attribution:"Le conseil général du Loiret",logo:"https://wxs.ign.fr/static/logos/CG45/CG45.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[1.4883244,47.471867,3.1349874,48.354233]}]},CRAIG:{href:"http://www.craig.fr",attribution:"Centre Régional Auvergnat de l'Information Géographique (CRAIG)",logo:"https://wxs.ign.fr/static/logos/CRAIG/CRAIG.gif",minZoom:13,maxZoom:20,constraint:[{minZoom:13,maxZoom:19,bbox:[2.0398402,44.60505,6.4295278,46.8038]},{minZoom:20,maxZoom:20,bbox:[2.2243388,44.76621,2.7314367,45.11295]}]},"e-Megalis":{href:"http://www.e-megalisbretagne.org//",attribution:"Syndicat mixte de coopération territoriale (e-Megalis)",logo:"https://wxs.ign.fr/static/logos/e-Megalis/e-Megalis.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-5.1937118,47.23789,-.98568505,48.980812]}]},PPIGE:{href:"http://www.ppige-npdc.fr/",attribution:"PPIGE",logo:"https://wxs.ign.fr/static/logos/PPIGE/PPIGE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[1.5212119,49.957302,4.2673664,51.090965]}]},CG06:{href:"http://www.cg06.fr",attribution:"Département Alpes Maritimes (06) en partenariat avec : Groupement Orthophoto 06 (NCA, Ville de Cannes, CARF, CASA,CG06, CA de Grasse) ",logo:"https://wxs.ign.fr/static/logos/CG06/CG06.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[6.6093955,43.44647,7.7436337,44.377018]}]},"MEGALIS-BRETAGNE":{href:"https://www.megalisbretagne.org/",attribution:"Syndicat mixte Mégalis Bretagne",logo:"https://wxs.ign.fr/static/logos/MEGALIS-BRETAGNE/MEGALIS-BRETAGNE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-5.2086344,47.591938,-3.3396015,48.808697]}]},FEDER:{href:"http://www.europe-en-france.gouv.fr/",attribution:"Fonds européen de développement économique et régional",logo:"https://wxs.ign.fr/static/logos/FEDER/FEDER.gif",minZoom:0,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[-1.9662633,42.316307,8.25674,50.18387]},{minZoom:0,maxZoom:12,bbox:[-2.400665,41.333557,9.560094,50.366302]}]},"LANGUEDOC-ROUSSILLON":{href:"https://www.laregion.fr/",attribution:"Région Occitanie",logo:"https://wxs.ign.fr/static/logos/LANGUEDOC-ROUSSILLON/LANGUEDOC-ROUSSILLON.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[1.6784439,42.63972,4.208843,43.979004]}]},GRAND_EST:{href:"https://www.grandest.fr/",attribution:"Hauts-de-France",logo:"https://wxs.ign.fr/static/logos/GRAND_EST/GRAND_EST.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[5.362788,47.390827,7.6924667,49.58011]}]},CNES_AUVERGNE:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_AUVERGNE/CNES_AUVERGNE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[2.2656832,45.279934,4.0227704,46.8038]}]},HAUTS_DE_FRANCE:{href:"https://www.hautsdefrance.fr/",attribution:"Hauts-de-France",logo:"https://wxs.ign.fr/static/logos/HAUTS_DE_FRANCE/HAUTS_DE_FRANCE.gif",minZoom:13,maxZoom:19,constraint:[{minZoom:13,maxZoom:19,bbox:[2.0740242,48.81521,4.3390365,51.11242]}]},MPM:{href:"http://www.marseille-provence.com/",attribution:"Marseille Provence Métropole",logo:"https://wxs.ign.fr/static/logos/MPM/MPM.gif",minZoom:20,maxZoom:20,constraint:[{minZoom:20,maxZoom:20,bbox:[5.076959,43.153347,5.7168245,43.454994]}]},DITTT:{href:"http://www.dittt.gouv.nc/portal/page/portal/dittt/",attribution:"Direction des Infrastructures, de la Topographie et des Transports Terrestres",logo:"https://wxs.ign.fr/static/logos/DITTT/DITTT.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[163.47784,-22.767689,167.94624,-19.434975]}]},CNES_978:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_978/CNES_978.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[-63.160706,18.04345,-62.962185,18.133898]}]},CNES_ALSACE:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_ALSACE/CNES_ALSACE.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[6.8086324,47.39981,7.668318,48.32695]}]},CNES_974:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_974/CNES_974.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[55.205757,-21.401262,55.84643,-20.862825]}]},CNES_975:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_975/CNES_975.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[-56.410988,46.734093,-56.10308,47.149963]}]},CNES_976:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_976/CNES_976.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[44.916977,-13.089187,45.30442,-12.564543]}]},CNES_977:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_977/CNES_977.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[-62.952805,17.862621,-62.78276,17.98024]}]},CNES:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES/CNES.gif",minZoom:13,maxZoom:16,constraint:[{minZoom:13,maxZoom:16,bbox:[-55.01953,1.845384,-50.88867,6.053161]}]},ASTRIUM:{href:"http://www.geo-airbusds.com/",attribution:"Airbus Defence and Space",logo:"https://wxs.ign.fr/static/logos/ASTRIUM/ASTRIUM.gif",minZoom:13,maxZoom:16,constraint:[{minZoom:13,maxZoom:16,bbox:[-55.01953,1.845384,-50.88867,6.053161]}]},CNES_971:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_971/CNES_971.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[-61.82342,15.819616,-60.99497,16.521578]}]},CNES_972:{href:"http://www.cnes.fr/",attribution:"Centre national d'études spatiales (CNES)",logo:"https://wxs.ign.fr/static/logos/CNES_972/CNES_972.gif",minZoom:13,maxZoom:18,constraint:[{minZoom:13,maxZoom:18,bbox:[-61.247208,14.371855,-60.778458,14.899901]}]}}},"GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD",title:"Carte IGN",format:"image/jpeg",style:"normal",queryable:!1,tilematrix:"PM",minZoom:0,maxZoom:18,bbox:[-179.62723,-84.5047,179.74588,85.47958],desc:"Cartographie topographique multi-échelles du territoire français issue des bases de données vecteur de l’IGN - emprise nationale, visible du 1/200 au 1/130000000",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:18,constraint:[{minZoom:5,maxZoom:5,bbox:[-179.57285,-83.84196,178.4975,85.36646]},{minZoom:0,maxZoom:2,bbox:[-175.99709,-84.42859,175.99709,84.2865]},{minZoom:3,maxZoom:3,bbox:[-176.23093,-84.5047,179.08267,84.89126]},{minZoom:4,maxZoom:4,bbox:[-179.62723,-84.0159,-179.21112,85.47958]},{minZoom:6,maxZoom:8,bbox:[-179.49689,-84.02368,179.74588,85.30035]},{minZoom:15,maxZoom:18,bbox:[-5.6663494,41.209736,10.819784,51.175068]},{minZoom:14,maxZoom:14,bbox:[-5.713191,40.852314,11.429714,51.44377]},{minZoom:13,maxZoom:13,bbox:[-63.37252,13.428586,11.429714,51.44377]},{minZoom:11,maxZoom:12,bbox:[-63.37252,13.428586,11.496459,51.444122]},{minZoom:9,maxZoom:9,bbox:[-64.81273,13.428586,11.496459,51.444016]},{minZoom:10,maxZoom:10,bbox:[-63.37252,13.428586,11.496459,51.444016]}]}}},"GEOGRAPHICALGRIDSYSTEMS.SLOPES.MOUNTAIN":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.SLOPES.MOUNTAIN",title:"Carte des pentes",format:"image/png",style:"normal",queryable:!1,tilematrix:"PM",minZoom:0,maxZoom:17,bbox:[-63.161392,-21.544624,56.001812,51.099052],desc:"Carte des zones ayant une valeur de pente supérieure à 30°-35°-40°-45° d'après la BD ALTI au pas de 5m",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:17,constraint:[{minZoom:0,maxZoom:17,bbox:[-5.1504726,41.32521,9.570543,51.099052]}]}}},ADMINEXPRESS_COG_2018:{server:"https://wxs.ign.fr/geoportail/wmts",layer:"ADMINEXPRESS_COG_2018",title:"ADMINEXPRESS_COG (2018)",format:"image/png",style:"normal",queryable:!0,tilematrix:"PM",minZoom:6,maxZoom:16,bbox:[-63.37252,-21.475586,55.925865,51.31212],desc:"Limites administratives COG mises à jour en continu. État en Mai 2018.",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:6,maxZoom:16,constraint:[{minZoom:6,maxZoom:16,bbox:[-63.37252,-21.475586,55.925865,51.31212]}]}}},"ELEVATION.SLOPES":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"ELEVATION.SLOPES",title:"Altitude",format:"image/jpeg",style:"normal",queryable:!0,tilematrix:"PM",minZoom:6,maxZoom:14,bbox:[-178.20589,-22.595179,167.43176,50.93085],desc:"La couche altitude se compose d'un MNT (Modèle Numérique de Terrain) affiché en teintes hypsométriques et issu de la BD ALTI®.",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:6,maxZoom:14,constraint:[{minZoom:6,maxZoom:14,bbox:[55.205746,-21.392344,55.846554,-20.86271]}]}}},"GEOGRAPHICALGRIDSYSTEMS.MAPS.BDUNI.J1":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS.BDUNI.J1",title:"Plan IGN j+1",format:"image/png",style:"normal",queryable:!1,tilematrix:"PM",minZoom:0,maxZoom:18,bbox:[-179.5,-75,179.5,75],desc:"Plan IGN j+1",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:18,constraint:[{minZoom:0,maxZoom:18,bbox:[-179,-80,179,80]}]}}},ADMINEXPRESS_COG_CARTO_2018:{server:"https://wxs.ign.fr/geoportail/wmts",layer:"ADMINEXPRESS_COG_CARTO_2018",title:"ADMINEXPRESS_COG_CARTO (2018)",format:"image/png",style:"normal",queryable:!0,tilematrix:"PM",minZoom:6,maxZoom:16,bbox:[-63.37252,-21.475586,55.925865,51.31212],desc:"Limites administratives COG généralisées mises à jour en continu. État en Mai 2018.",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:6,maxZoom:16,constraint:[{minZoom:6,maxZoom:16,bbox:[-63.37252,-21.475586,55.925865,51.31212]}]}}},"GEOGRAPHICALGRIDSYSTEMS.MAPS":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS",title:"Cartes IGN",format:"image/jpeg",style:"normal",queryable:!0,tilematrix:"PM",minZoom:0,maxZoom:18,bbox:[-180,-75,180,80],desc:"Cartes IGN",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:0,maxZoom:18,constraint:[{minZoom:7,maxZoom:7,bbox:[-178.20573,-68.138855,144.84375,51.909786]},{minZoom:8,maxZoom:8,bbox:[-178.20573,-68.138855,168.24327,51.909786]},{minZoom:13,maxZoom:13,bbox:[-178.20573,-67.101425,168.24327,51.44377]},{minZoom:14,maxZoom:14,bbox:[-178.20573,-67.101425,168.23909,51.44377]},{minZoom:11,maxZoom:12,bbox:[-178.20573,-67.101425,168.24327,51.444122]},{minZoom:9,maxZoom:10,bbox:[-178.20573,-68.138855,168.24327,51.444016]},{minZoom:15,maxZoom:15,bbox:[-178.20573,-46.502903,168.23909,51.175068]},{minZoom:16,maxZoom:16,bbox:[-178.20573,-46.502903,168.29811,51.175068]},{minZoom:0,maxZoom:6,bbox:[-180,-60,180,80]},{minZoom:18,maxZoom:18,bbox:[-5.6663494,41.209736,10.819784,51.175068]},{minZoom:17,maxZoom:17,bbox:[-179.5,-75,179.5,75]}]},DITTT:{href:"http://www.dittt.gouv.nc/portal/page/portal/dittt/",attribution:"Direction des Infrastructures, de la Topographie et des Transports Terrestres",logo:"https://wxs.ign.fr/static/logos/DITTT/DITTT.gif",minZoom:8,maxZoom:16,constraint:[{minZoom:8,maxZoom:10,bbox:[163.47784,-22.972307,168.24327,-19.402702]},{minZoom:11,maxZoom:13,bbox:[163.47784,-22.972307,168.24327,-19.494438]},{minZoom:14,maxZoom:15,bbox:[163.47784,-22.764496,168.23909,-19.493542]},{minZoom:16,maxZoom:16,bbox:[163.47784,-22.809465,168.29811,-19.403923]}]}}},"TRANSPORTNETWORKS.ROADS":{server:"https://wxs.ign.fr/geoportail/wmts",layer:"TRANSPORTNETWORKS.ROADS",title:"Routes",format:"image/png",style:"normal",queryable:!1,tilematrix:"PM",minZoom:6,maxZoom:18,bbox:[-63.969162,-21.49687,55.964417,71.584076],desc:"Affichage du réseau routier français et européen.",originators:{IGN:{href:"http://www.ign.fr",attribution:"Institut national de l'information géographique et forestière",logo:"https://wxs.ign.fr/static/logos/IGN/IGN.gif",minZoom:6,maxZoom:18,constraint:[{minZoom:15,maxZoom:18,bbox:[-63.37252,-21.475586,55.925865,51.31212]},{minZoom:6,maxZoom:14,bbox:[-63.969162,-21.49687,55.964417,71.584076]}]}}}},ol.layer.Geoportail.loadCapabilities=function(t,e){var o=function(){},i=function(){},n=function(){};this.getCapabilities(t,e).then((function(t){ol.layer.Geoportail.capabilities=t,o(t)})).catch((function(t){i(t)})).finally((function(t){n(t)}));var r={then:function(t){return"function"==typeof t&&(o=t),r},catch:function(t){return"function"==typeof t&&(i=t),r},finally:function(t){return"function"==typeof t&&(n=t),r}};return r},ol.layer.Geoportail.getCapabilities=function(t){var e={},o=function(){},i=function(){},n=function(){},r=[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338];function a(t){t=281e-6*Number(t);for(var e=0;e<r.length;e++)if(t>r[e])return e}function s(t){for(var e=t.constraint.length-1;e>0;e--)for(var o=0;o<e;o++){for(var i=!0,n=0;n<4;n++)if(t.constraint[e].bbox[n]!=t.constraint[o].bbox[n]){i=!1;break}if(i&&(t.constraint[e].maxZoom==t.constraint[o].minZoom||t.constraint[o].maxZoom==t.constraint[e].minZoom||t.constraint[e].maxZoom+1==t.constraint[o].minZoom||t.constraint[o].maxZoom+1==t.constraint[e].minZoom||t.constraint[e].minZoom-1==t.constraint[o].maxZoom||t.constraint[o].minZoom-1==t.constraint[e].maxZoom)){t.constraint[o].maxZoom=Math.max(t.constraint[e].maxZoom,t.constraint[o].maxZoom),t.constraint[o].minZoom=Math.min(t.constraint[e].minZoom,t.constraint[o].minZoom),t.constraint.splice(e,1);break}}}ol.ext.Ajax.get({url:"https://wxs.ign.fr/"+t+"/autoconf/",dataType:"TEXT",error:function(t){i(t),n({})},success:function(i){for(var r,l=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("Layer"),c=0;r=l[c];c++)if(/WMTS/.test(r.getElementsByTagName("Server")[0].attributes.service.value)){for(var h,u={server:r.getElementsByTagName("gpp:Key")[0].innerHTML.replace(t+"/",""),layer:r.getElementsByTagName("Name")[0].innerHTML,title:r.getElementsByTagName("Title")[0].innerHTML,format:r.getElementsByTagName("Format")[0].innerHTML,style:r.getElementsByTagName("Style")[0].getElementsByTagName("Name")[0].innerHTML,queryable:"1"===r.attributes.queryable.value,tilematrix:"PM",minZoom:a(r.getElementsByTagName("sld:MaxScaleDenominator")[0].innerHTML),maxZoom:a(r.getElementsByTagName("sld:MinScaleDenominator")[0].innerHTML),bbox:JSON.parse("["+r.getElementsByTagName("gpp:BoundingBox")[0].innerHTML+"]"),desc:r.getElementsByTagName("Abstract")[0].innerHTML.replace(/^<!\[CDATA\[(.*)\]\]>$/,"$1"),originators:{}},p=r.getElementsByTagName("gpp:Originator"),d=0;h=p[d];d++){for(var f,g=u.originators[h.attributes.name.value]={href:h.getElementsByTagName("gpp:URL")[0].innerHTML,attribution:h.getElementsByTagName("gpp:Attribution")[0].innerHTML,logo:h.getElementsByTagName("gpp:Logo")[0].innerHTML,minZoom:20,maxZoom:0,constraint:[]},m=h.getElementsByTagName("gpp:Constraint"),y=0;f=m[y];y++){var v=a(f.getElementsByTagName("sld:MinScaleDenominator")[0].innerHTML),b=a(f.getElementsByTagName("sld:MaxScaleDenominator")[0].innerHTML);b>g.maxZoom&&(g.maxZoom=b),b<g.minZoom&&(g.minZoom=b),v>g.maxZoom&&(g.maxZoom=v),v<g.minZoom&&(g.minZoom=v),g.constraint.push({minZoom:b,maxZoom:v,bbox:JSON.parse("["+f.getElementsByTagName("gpp:BoundingBox")[0].innerHTML+"]")})}s(g)}e[u.layer]=u}o(e),n(e)}});var l={then:function(t){return"function"==typeof t&&(o=t),l},catch:function(t){return"function"==typeof t&&(i=t),l},finally:function(t){return"function"==typeof t&&(n=t),l}};return l},ol.source.Source.prototype.getPreview=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAk6QAAJOkBUCTn+AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANeSURBVHic7ZpPiE1RHMc/780MBhkik79JSUlIUbOxI+wkI2yRhYSUlJLNpJF/xcpiJBmZGBZsNM1CkmhKITGkGbH0/BuPmXnP4rxbb/TOn3fvOffeec6nfqvb/b7f93fveeec37ng8Xg8Ho/nf6Uu4d+fDswFssCvhHOJhaXAMeApMAQUyyIPPAdOAiuTStAVy4EHjDWsix5gdRLJ2mY34ulWYz6IEeA4kIk9awtkgTOEM/5vdAKT4k0/Ou3YMR/ELcbRm9AKFLBbgCJwNE4TYZkJfMG++SIwDCyLz0o4bI17WdyJz0r1TAZ+oDcxCBwAFgIzEIuhvcBbg3sLwOK4DFXLFvQGniCGSSUagS4DjUPOHESkA3XiOWCORqMR6Nfo9DjI3QqPUSd+ylBnv0Zn0GrWFvmIOvGNhjqrNDp/EAutyFgRKUM2tgO+Gur81FxvAKYZaimxXYBvmuuLDHWWaK4X0RfJCNsF6NdcbzXU2a65PohYFKWOc+jn8PUajbWIXaBKp9NB7lZYh34OzwFbFfd/NtDYYSth27urLGIm0M31AL3APWAAmIooymaDnPIl/Vz4NN1yHrd7gcvxWQnHAuA3bsyPop8hUsE13BSgK04TUViBeFo2zedJ8S6wElexW4D2eNOPTjNi6WvD/DtEr8E6tk6GGoAmxFY2iFHE9NZiQf8gogiB9gTEH23izAZuE77vHyU+ANucO1QwD3hD/MbLowAcdm20EmkwXx4n3NodS9rMB2HabYpEWs0HcRqHp0fNwAvJD+eBTZr7p6BvmQVxUaEzEbiruNfJekH15L8jtrEm7JJolEcOmKXRqQOuKDQuY7HZY8s8iNfzkSLxIuI43FTrkkLnOlBfRW4VsWk+oAX5weknxFAxJQNckGgVgZuIRVoomoGXEmGTMa+iQ6K7M4SW7k24QYgiuDQPYinbhugiF4H3RGtzZYCzyIvQXfpNI1ybLyeLpf5+iTbkRbiP2EcocTHm4+YI8iI8RFHwWjAfsA95Q+YZFU6wasl8wB7kReijtNbIILa0vcg/PRlGfPQwHmlCviDqAzaA+OREtzqr1ejOIDorxlNEjTGUBV4nnUWCvAJxGDlA8q9j3DEArAn2zvXAfOwfl6eVAmJrPpJ0Ih6Px+PxeJLjLwPul3vj5d0eAAAAAElFTkSuQmCC"},ol.source.Tile.prototype.getPreview=function(t,e){t||(t=[21020,6355964]),e||(e=150);var o=this.getTileGrid().getTileCoordForCoordAndResolution(t,e);return this.getTileUrlFunction().call(this,o,this.getProjection())},ol.source.TileWMS.prototype.getPreview=function(t,e){t||(t=[21020,6355964]),e||(e=150);var o=this.getTileUrlFunction();if(o){var i=(this.getTileGrid()||this.getTileGridForProjection(this.getProjection())).getTileCoordForCoordAndResolution(t,e);return o.call(this,i,1,this.getProjection())}var n=this.getGetFeatureInfoUrl?this.getGetFeatureInfoUrl(t,e,this.getProjection()||"EPSG:3857",{}):this.getFeatureInfoUrl(t,e,this.getProjection()||"EPSG:3857",{});return n=n.replace(/getfeatureinfo/i,"GetMap")},ol.layer.Base.prototype.getPreview=function(t,e,o){if(this.get("preview"))return[this.get("preview")];if(e||(e=150),e<this.getMinResolution()||e>this.getMaxResolution()){var i=this.getMinResolution(),n=this.getMaxResolution();for(n>1e5&&(n=156543),i<.15&&(i=.15),e=n;n>i;)n/=2,e=i*=2}var r=this.getExtent();return t||(t=[21020,6355964]),r&&!ol.extent.containsCoordinate(r,t)&&(t=[(r[0]+r[2])/2,(r[1]+r[3])/2]),o&&(t=ol.proj.transform(t,o,this.getSource().getProjection())),this.getSource&&this.getSource()?[this.getSource().getPreview(t,e)]:[]},ol.layer.Group.prototype.getPreview=function(t,e){if(this.get("preview"))return[this.get("preview")];var o=[];if(this.getLayers)for(var i=this.getLayers().getArray(),n=0;n<i.length;n++)o=o.concat(i[n].getPreview(t,e));return o},ol.layer.Maplibre=function(t){ol.layer.Layer||console.error("[ol/layer/MapLibre] bad ol version (need ol@6+)"),(t=t||{}).render=function(e){this._container||this._create(t.style);this._container.style.width=1*e.size[0]+"px",this._container.style.height=1*e.size[1]+"px";var o=this.glMap;if(!o)return null;var i=o.getCanvas();i.style.transform="scale(1)",e.size[0]===i.width&&e.size[1]===i.height||o.resize(),i.style.opacity=this.getOpacity();var n=e.viewState;return o.jumpTo({center:ol.proj.toLonLat(n.center),zoom:n.zoom-1,bearing:180*-n.rotation/Math.PI,animate:!1}),o._frame&&(o._frame.cancel(),o._frame=null),o._render(),this._container},ol.layer.Layer.call(this,t)},ol.layer.Layer||(ol.layer.Layer=function(){}),ol.ext.inherits(ol.layer.Maplibre,ol.layer.Layer),ol.layer.Maplibre.prototype.getMapGL=function(){return this.glMap},ol.layer.Maplibre.prototype.setStyle=function(t){this.set("style",t),this.getMapGL()&&this.getMapGL().setStyle(t),this.changed()},ol.layer.Maplibre.prototype.getStyle=function(){return this.getMapGL().get("style")},ol.layer.Maplibre.prototype._create=function(t){this._container=ol.ext.element.create("DIV",{className:"ol-maplibre-gl",style:{position:"absolute",top:0,left:0},parent:document.body}),this.glMap=new mapboxgl.Map({container:this._container,style:t,center:[3,47],zoom:5,pitch:0,antialias:!0,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1})},ol.layer.Vector.prototype.setRender3D=function(t){t.setLayer(this)},ol.render3D=function(t){(t=t||{}).maxResolution=t.maxResolution||100,t.defaultHeight=t.defaultHeight||0,ol.Object.call(this,t),this.setStyle(t.style),this.set("ghost",t.ghost),this.setActive(t.active||!1!==t.active),this.height_=t.height=this.getHfn(t.height),t.layer&&this.setLayer(t.layer)},ol.ext.inherits(ol.render3D,ol.Object),ol.render3D.prototype.setStyle=function(t){if(t instanceof ol.style.Style?this._style=t:this._style=new ol.style.Style,this._style.getStroke()||this._style.setStroke(new ol.style.Stroke({width:1,color:"red"})),this._style.getFill()||this._style.setFill(new ol.style.Fill({color:"rgba(0,0,255,0.5)"})),t&&t.getGeometry()){var e=t.getGeometry();"function"==typeof e?this.set("geometry",e):this.set("geometry",(function(){return e}))}else this.set("geometry",(function(t){return t.getGeometry()}))},ol.render3D.prototype.getStyle=function(){return this._style},ol.render3D.prototype.setActive=function(t){this._active="function"==typeof t?t:function(){return t},this.layer_&&this.layer_.changed()},ol.render3D.prototype.getActive=function(){return this._active()},ol.render3D.prototype.onPostcompose_=function(t){if(this.getActive()){var e=t.frameState.viewState.resolution;if(!(e>this.get("maxResolution"))){if(this.res_=400*e,this.animate_){var o=t.frameState.time-this.animate_;o<this.animateDuration_?(this.elapsedRatio_=this.easing_(o/this.animateDuration_),t.frameState.animate=!0):(this.animate_=!1,this.height_=this.toHeight_)}var i=t.frameState.pixelRatio,n=t.context,r=this.matrix_=t.frameState.coordinateToPixelTransform||t.frameState.Pe;r||((r=t.frameState.coordinateToPixelMatrix)[2]=r[4],r[3]=r[5],r[4]=r[12],r[5]=r[13]),this.center_=[n.canvas.width/2/i,n.canvas.height/i];var a=this.layer_.getSource().getFeaturesInExtent(t.frameState.extent);n.save(),n.scale(i,i);var s=this.getStyle();n.lineWidth=s.getStroke().getWidth(),n.strokeStyle=ol.color.asString(s.getStroke().getColor()),n.fillStyle=ol.color.asString(s.getFill().getColor());for(var l=[],c=0;c<a.length;c++){var h=this.getFeatureHeight(a[c]);h&&l.push(this.getFeature3D_(a[c],h))}this.get("ghost")?this.drawGhost3D_(n,l):this.drawFeature3D_(n,l),n.restore()}}},ol.render3D.prototype.setLayer=function(t){null!=t&&(this._listener&&this._listener.forEach((function(t){ol.Observable.unByKey(t)})),this.layer_=t,this._listener=t.on(["postcompose","postrender"],this.onPostcompose_.bind(this)))},ol.render3D.prototype.getHfn=function(t){switch(o(t)){case"function":return t;case"string":var e=this.get("defaultHeight");return function(o){return Number(o.get(t))||e};case"number":return function(){return t};default:return function(){return 10}}},ol.render3D.prototype.animate=function(t){t=t||{},this.toHeight_=this.getHfn(t.height),this.animate_=(new Date).getTime(),this.animateDuration_=t.duration||1e3,this.easing_=t.easing||ol.easing.easeOut,this.layer_.changed()},ol.render3D.prototype.animating=function(){return this.animate_&&(new Date).getTime()-this.animate_>this.animateDuration_&&(this.animate_=!1),!!this.animate_},ol.render3D.prototype.getFeatureHeight=function(t){if(this.animate_){var e=this.height_(t),o=this.toHeight_(t);return e*(1-this.elapsedRatio_)+this.elapsedRatio_*o}return this.height_(t)},ol.render3D.prototype.hvector_=function(t,e){var o=[t[0]*this.matrix_[0]+t[1]*this.matrix_[1]+this.matrix_[4],t[0]*this.matrix_[2]+t[1]*this.matrix_[3]+this.matrix_[5]];return{p0:o,p1:[o[0]+e/this.res_*(o[0]-this.center_[0]),o[1]+e/this.res_*(o[1]-this.center_[1])]}},ol.render3D.prototype.getFeature3D_=function(t,e){var o=this.get("geometry")(t),i=o.getCoordinates();switch(o.getType()){case"Polygon":i=[i];case"MultiPolygon":for(var n=[],r=0;r<i.length;r++)for(var a=0;a<i[r].length;a++){for(var s=[],l=0;l<i[r][a].length;l++)s.push(this.hvector_(i[r][a][l],e));n.push(s)}return{type:"MultiPolygon",feature:t,geom:n,height:e};case"MultiLineString":for(n=[],r=0;r<i.length;r++)for(a=0;a<i[r].length;a++)n.push(this.hvector_(i[r][a],e));return{type:"MultiLineString",feature:t,geom:n,height:e};case"Point":return{type:"Point",feature:t,geom:this.hvector_(i,e),height:e};case"MultiPoint":if(1===i.length)return{type:"Point",feature:t,geom:this.hvector_(i[0],e),height:e};default:return{}}},ol.render3D.prototype.drawFeature3D_=function(t,e){var o,i,n,r;for(o=0;o<e.length;o++)switch(e[o].type){case"MultiPolygon":for(null!==e[o].feature.getStyle()&&(null===e[o].feature.getStyle()()[0].getStroke()?e[o].feature.getStyle()()[0].f?t.strokeStyle=ol.color.asString(e[o].feature.getStyle()()[0].f.L.Y):t.strokeStyle=ol.color.asString(e[o].feature.getStyle()()[0].getImage().getStroke().getColor()):t.strokeStyle=ol.color.asString(e[o].feature.getStyle()()[0].getStroke().getColor())),i=0;i<e[o].geom.length;i++)for(n=e[o].geom[i],r=0;r<n.length;r++)t.beginPath(),t.moveTo(n[r].p0[0],n[r].p0[1]),t.lineTo(n[r].p1[0],n[r].p1[1]),t.stroke();break;case"Point":var a=e[o].geom;t.beginPath(),t.moveTo(a.p0[0],a.p0[1]),t.lineTo(a.p1[0],a.p1[1]),t.stroke();break;case"MultiLineString":for(i=0;i<e[o].geom.length;i++)n=e[o].geom[i],t.beginPath(),t.moveTo(n.p0[0],n.p0[1]),t.lineTo(n.p1[0],n.p1[1]),t.stroke()}for(o=0;o<e.length;o++)switch(e[o].type){case"MultiPolygon":for(t.beginPath(),null!==e[o].feature.getStyle()&&(null===e[o].feature.getStyle()()[0].getFill()?e[o].feature.getStyle()()[0].f?t.fillStyle=ol.color.asString(e[o].feature.getStyle()()[0].f.ga.Y):t.fillStyle=ol.color.asString(e[o].feature.getStyle()()[0].getImage().getFill().getColor()):(t.strokeStyle=ol.color.asString(e[o].feature.getStyle()()[0].getStroke().getColor()),t.fillStyle=ol.color.asString(e[o].feature.getStyle()()[0].getFill().getColor()))),i=0;i<e[o].geom.length;i++){if(n=e[o].geom[i],0==i)for(t.moveTo(n[0].p1[0],n[0].p1[1]),r=1;r<n.length;r++)t.lineTo(n[r].p1[0],n[r].p1[1]);else for(t.moveTo(n[0].p1[0],n[0].p1[1]),r=n.length-2;r>=0;r--)t.lineTo(n[r].p1[0],n[r].p1[1]);t.closePath()}t.fill("evenodd"),t.stroke();break;case"Point":var s=(n=e[o]).feature.get("label");if(s){var l=n.geom.p1,c=t.fillStyle;t.fillStyle=t.strokeStyle,t.textAlign="center",t.textBaseline="bottom",t.fillText(s,l[0],l[1]);var h=t.measureText(s),u=Number(t.font.match(/\d+(\.\d+)?/g).join([]));t.fillStyle="rgba(255,255,255,0.5)",t.fillRect(l[0]-h.width/2-5,l[1]-u-5,h.width+10,u+10),t.strokeRect(l[0]-h.width/2-5,l[1]-u-5,h.width+10,u+10),t.fillStyle=c}break;case"MultiLineString":for(t.beginPath(),i=0;i<e[o].geom.length;i++)if(n=e[o].geom[i],t.moveTo(n.p1[0],n.p1[1]),0==i)for(r=i;r<e[o].geom.length;r++)t.lineTo(e[o].geom[r].p1[0],e[o].geom[r].p1[1]);t.stroke()}},ol.render3D.prototype.drawGhost3D_=function(t,e){var o,i,n,r;for(o=0;o<e.length;o++)switch(e[o].type){case"MultiPolygon":for(i=0;i<e[o].geom.length;i++)for(n=e[o].geom[i],r=0;r<n.length-1;r++){t.beginPath(),t.moveTo(n[r].p0[0],n[r].p0[1]),t.lineTo(n[r].p1[0],n[r].p1[1]),t.lineTo(n[r+1].p1[0],n[r+1].p1[1]),t.lineTo(n[r+1].p0[0],n[r+1].p0[1]),t.lineTo(n[r].p0[0],n[r].p0[1]);var a=[(n[r].p0[0]+n[r+1].p0[0])/2,(n[r].p0[1]+n[r+1].p0[1])/2],s=[n[r].p0[1]-n[r+1].p0[1],-n[r].p0[0]+n[r+1].p0[0]],l=ol.coordinate.getIntersectionPoint([a,[a[0]+s[0],a[1]+s[1]]],[n[r].p1,n[r+1].p1]),c=t.createLinearGradient(a[0],a[1],l[0],l[1]);c.addColorStop(0,"rgba(255,255,255,.2)"),c.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=c,t.fill()}break;case"Point":var h=e[o].geom;t.beginPath(),t.moveTo(h.p0[0],h.p0[1]),t.lineTo(h.p1[0],h.p1[1]),t.stroke()}},ol.layer.SketchOverlay=function(t){var e=(t=t||{}).style||ol.style.Style.defaultStyle(!0),o=t.sketchStyle;o||(o=ol.style.Style.defaultStyle(),(o=[new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:10,radius2:0,stroke:new ol.style.Stroke({color:[255,255,255,.5],width:3})})}),o[0].clone()])[1].setImage(new ol.style.RegularShape({points:4,radius:10,radius2:0,stroke:new ol.style.Stroke({color:[0,153,255,1],width:1.25})}))),this._geom=[],ol.layer.Vector.call(this,{name:"sketch",source:new ol.source.Vector({useSpatialIndex:!1}),style:function(t){return t.get("sketch")?o:e},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.getSource().addFeatures([new ol.Feature({sketch:!0,geometry:new ol.geom.Point([])}),new ol.Feature({sketch:!0,geometry:new ol.geom.LineString([])}),new ol.Feature,new ol.Feature(new ol.geom.Point([]))]),this.setGeometryType(t.type)},ol.ext.inherits(ol.layer.SketchOverlay,ol.layer.Vector),ol.layer.SketchOverlay.prototype.setGeometryType=function(t){var e=/^Point$|^LineString$|^Polygon$|^Circle$/.test(t)?t:"LineString";return e!==this._type&&(this.abortDrawing(),this._type=e),this._type},ol.layer.SketchOverlay.prototype.getGeometryType=function(){return this._type},ol.layer.SketchOverlay.prototype.addPoint=function(t){return this._lastCoord!==this._position&&(this._geom.length||this.startDrawing(),this._geom.push(t),this._lastCoord=t,this._position=t,this.drawSketch(),"Point"===this.getGeometryType()&&this.finishDrawing(),"Circle"===this.getGeometryType()&&this._geom.length>=2&&this.finishDrawing(),!0)},ol.layer.SketchOverlay.prototype.removeLastPoint=function(){this._geom.pop(),this._lastCoord=this._geom[this._geom.length-1],this.drawSketch()},ol.layer.SketchOverlay.prototype.startDrawing=function(t){t=t||{},this._geom=[],t.type&&this.setGeometryType(t.type),this.drawSketch(),this._drawing||this.dispatchEvent({type:"drawstart",feature:this.getFeature()}),this._drawing=!0},ol.layer.SketchOverlay.prototype.finishDrawing=function(t){var e=this.getSource().getFeatures()[2].clone(),o=!!e;switch(this.getGeometryType()){case"Circle":case"LineString":o=this._geom.length>1;break;case"Polygon":o=this._geom.length>2}return!(t&&!o)&&(this._geom=[],this._lastCoord=null,this.drawSketch(),this._drawing&&this.dispatchEvent({type:"drawend",valid:o,feature:e}),this._drawing=!1,e)},ol.layer.SketchOverlay.prototype.abortDrawing=function(){this._drawing&&this.dispatchEvent({type:"drawabort",feature:this.getFeature()}),this._drawing=!1,this._geom=[],this._lastCoord=null,this.drawSketch()},ol.layer.SketchOverlay.prototype.setPosition=function(t){this._position=t,this.drawLink()},ol.layer.SketchOverlay.prototype.getPosition=function(){return this._position},ol.layer.SketchOverlay.prototype.drawLink=function(){var t=this.getSource().getFeatures();this._position?(this._lastCoord&&this._lastCoord===this._position?t[0].getGeometry().setCoordinates([]):t[0].getGeometry().setCoordinates(this._position),this._geom.length?"Circle"===this.getGeometryType()?t[1].setGeometry(new ol.geom.Circle(this._geom[0],ol.coordinate.dist2d(this._geom[0],this._position))):"Polygon"===this.getGeometryType()?t[1].setGeometry(new ol.geom.LineString([this._lastCoord,this._position,this._geom[0]])):t[1].setGeometry(new ol.geom.LineString([this._lastCoord,this._position])):t[1].setGeometry(new ol.geom.LineString([]))):(t[0].getGeometry().setCoordinates([]),t[1].setGeometry(new ol.geom.LineString([])))},ol.layer.SketchOverlay.prototype.getFeature=function(){return this.getSource().getFeatures()[2]},ol.layer.SketchOverlay.prototype.drawSketch=function(){this.drawLink();var t=this.getSource().getFeatures();if(this._geom.length)switch(this._lastCoord||(this._lastCoord=this._geom[this._geom.length-1]),t[3].getGeometry().setCoordinates(this._lastCoord),this._type){case"Point":t[2].setGeometry(new ol.geom.Point(this._lastCoord));break;case"Circle":t[2].getGeometry()?t[2].getGeometry().setRadius(ol.coordinate.dist2d(this._geom[0],this._geom[this._geom.length-1])):t[2].setGeometry(new ol.geom.Circle(this._geom[0],ol.coordinate.dist2d(this._geom[0],this._geom[this._geom.length-1])));break;case"LineString":t[2].getGeometry()?t[2].getGeometry().setCoordinates(this._geom):t[2].setGeometry(new ol.geom.LineString(this._geom));break;case"Polygon":this._geom.push(this._geom[0]),t[2].getGeometry()?t[2].getGeometry().setCoordinates([this._geom]):t[2].setGeometry(new ol.geom.Polygon([this._geom])),this._geom.pop();break;default:console.error("[ol/layer/SketchOverlay~drawSketch] geometry type not supported ("+this._type+")")}else t[2].setGeometry(null),t[3].setGeometry(new ol.geom.Point([]))},ol.PerspectiveMap=function(t){var e=t.target instanceof Element?t.target:document.getElementById(t.target);"absolute"!==window.getComputedStyle(e).position&&(e.style.position="relative"),e.style.overflow="hidden";var o=ol.ext.element.create("DIV",{className:"ol-perspective-map",parent:e}),i={};Object.assign(i,t),i.target=o,ol.Map.call(this,i),this._tiltCondition=t.tiltCondition||ol.events.condition.altKeyOnly},ol.ext.inherits(ol.PerspectiveMap,ol.Map),ol.PerspectiveMap.prototype.getPixelRatio=function(){return window.devicePixelRatio},ol.PerspectiveMap.prototype.setPerspective=function(t,e){e=e||{},t>30?t=30:t<0&&(t=0);var o=this._angle||0,i=Math.round(10*t)/10,n=this.getTarget().querySelector(".ol-layers").style;cancelAnimationFrame(this._animatedPerspective),requestAnimationFrame(function(t){this._animatePerpective(t,t,n,o,i,e.duration,e.easing||ol.easing.inAndOut)}.bind(this))},ol.PerspectiveMap.prototype._animatePerpective=function(t,e,o,i,n,r,a){var s,l,c;0===r?(s=1,l=!0):l=(s=(e-t)/(r||500))>=1,s=a(s);var h=(c=this._angle=l?n:i+(n-i)*s)/30;o.transform="translateY(-"+17*h+"%) perspective(200px) rotateX("+c+"deg) scaleY("+(1-h/2)+")",this.getMatrix3D(!0),this.render(),l||requestAnimationFrame(function(e){this._animatePerpective(t,e,o,i,n,r||500,a||ol.easing.inAndOut)}.bind(this)),this.dispatchEvent({type:"change:perspective",angle:c,animating:!l})},ol.PerspectiveMap.prototype.handleMapBrowserEvent=function(t){if(t.pixel=[t.originalEvent.offsetX/this.getPixelRatio(),t.originalEvent.offsetY/this.getPixelRatio()],t.coordinate=this.getCoordinateFromPixel(t.pixel),ol.Map.prototype.handleMapBrowserEvent.call(this,t),this._tiltCondition(t))switch(t.type){case"pointerdown":this._dragging=t.originalEvent.offsetY;break;case"pointerup":this._dragging=!1;break;case"pointerdrag":if(!1!==this._dragging){var e=t.originalEvent.offsetY>this._dragging?.5:-.5;e&&this.setPerspective((this._angle||0)+e,{duration:0}),this._dragging=t.originalEvent.offsetY}}else this._dragging=!1},ol.PerspectiveMap.prototype.getMatrix3D=function(t){if(t){var e=this.getTarget().querySelector(".ol-layers"),o=ol.matrix3D.getTransform(e),i=ol.matrix3D.getTransformOrigin(e);this._matrixTransform=ol.matrix3D.computeTransformMatrix(o,i)}return this._matrixTransform||(this._matrixTransform=ol.matrix3D.identity()),this._matrixTransform},ol.PerspectiveMap.prototype.getPixelScreenFromCoordinate=function(t){var e=this.getPixelFromCoordinate(t),o=this.getMatrix3D(),i=ol.matrix3D.transformVertex(o,e);return[(i=ol.matrix3D.projectVertex(i))[0],i[1]]},ol.PerspectiveMap.prototype.getPixelFromPixelScreen=function(t){var e=ol.matrix3D.inverse(this.getMatrix3D()),o=ol.matrix3D.transformVertex(e,t);return[(o=ol.matrix3D.projectVertex(o))[0],o[1]]},r=ol.Overlay.prototype.updatePixelPosition,ol.Overlay.prototype.updatePixelPosition=function(){var t=this.getMap();if(t&&t instanceof ol.PerspectiveMap){var e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);var o=t.getPixelScreenFromCoordinate(e),i=t.getSize();o[0]-=i[0]/4,o[1]-=i[1]/4,this.updateRenderedPosition(o,i)}else r.call(this)},window.ol&&!ol.particule&&(ol.particule={}),ol.particule.Base=function(t){t||(t={}),ol.Object.call(this),this.setOverlay(t.overlay),this.coordinate=t.coordinate||[0,0]},ol.ext.inherits(ol.particule.Base,ol.Object),ol.particule.Base.prototype.setOverlay=function(t){this._overlay=t},ol.particule.Base.prototype.getOverlay=function(){return this._overlay},ol.particule.Base.prototype.draw=function(){},ol.particule.Base.prototype.update=function(){},ol.particule.Base.prototype.getRandomCoord=function(t){return this.getOverlay().randomCoord?this.getOverlay().randomCoord():[t,0]},ol.particule.Bird=function(t){t||(t={}),ol.particule.Base.call(this,t),this.bird=new Image,this.bird.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABDCAQAAAD+S8VaAAAAAnNCSVQICFXsRgQAAAAJcEhZcwAAAvMAAALzAdLpCioAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAG90lEQVR42uWaaVRTRxTHJ4AUUIoIiqISOArIDiIhBBfccCMoR0vVUpXjTqun4Fr1tO5i3YuodaFqRMECKm4VUHEhUvWgBYuilgpiRVZpCARI3r8fWA4hYY9AXu77+ObNzO/O8u787xDSyeYSTzSICpu+DjV0ogrze84PBneByuJv3JpbBlx6MEBbJfG/8S2RAACFXXtU0gERN1BjCc9UEN/e7I2w1gFPinv3UDkHbFiGOqOwJVjlHMALRT3LLJ7trGIOuHwFUsY7q2IOuJ0u7YB//pswWFn6/vnUcbOCAn7ctfnUrsijl85dv5pw786fd9OTsvg5/JykN3fTb6ZcTDgVvefIkqXmVvKr0NN/IUQDO7C1qwJrOwyftIZ7cmIiN21eZlB+SOUtFKNl9kF0hb9ujmyVM73FMmWv3m+2J4zxw74NDN5/5vT1qzeT7j3n5/Bz7mcmPk24cy32Ai8i9Pj2nwIX+jo4kc8UMMqeXr5bfC6N/2tUHrdsCQ4gAR/QNhNRJ8+6GklXH7xStlxW+ViLxrpjqBswJ/z4rYyCFrQnwJPCxGe/x53i+fO+XOth2xpsvQm+PkfGP3YuYIo1oInTyIJiLDFtoZfUP+AXeaW2rZHXKZ8xJ35NeU+1odVSbIIBbEQeb70Tffd6ckmj0QbDy9/zOufdILE6SN0TBkVafnn0ka/NatrrditDXpmYKw36pREwPyr+Y0V72n0CsxoedTDFrMJJyRMDZJYIx8+yYICQKbDJtcjtL9IGAcEMKN7efIy+snnTYv/tR8Ry3+eWRUYFzavRB9SWL7icXKWAVrPRr96wEqjBTjg5bop03GGi77XF85FdqVZNIQ1konOsEvx35yOCN1xMFimszjNSDqh+ektGfVG3xjyTzaqkX3uDTiaCdh0ZA/qSgWXWWfb7CYMQQsiUUANK1j8hoJf1lSFUg0u+z1xCiFuMUYWsAy7QCj9ZzhIgIDCkpi4nhBCGsafNGx2peXCQRvhlcGrEAQSOhYQQQtyTG74YCglN8CswrVF8goEVhBBCrMzdozi33OOHJmvUvQqghQtKMEUu+GDB0Cj2Q/vsUdJn0JH8+oXG4rWS46djSD0ePcr2lUuafbZlIbN0UAnngpyA0I3FumeZxxQYVlZ/ooWleKm0+FHQbTDuWnAp5F6cbNfskcDtcg9J9aMGNUxDIiglgy+CPxhypj4Ddu/cfFpxOrIqrv7QAsH4V2nwYxoEvwQEOpRlAeeG07hWnopH7FMHgTr6VmhAA1xEQNjF4bMxQwpcj2I9duVZLiVtTb7YT7T2I30JccyqrrA7ZuESRF0SvhQ/QKfByDu/VZAs5O6rXS9U6onZ+A2CLgQvwWn0l5n4TAFnjOKksR5En6i73q6/q3IRhvwugB8LBylwi6IhixxX9Wd/CoWQwTrJTuaEOSwzENcKDR7Yj4xOg4+Hq3SEXzX8fIfcObAZPizV+bGxqLZhMyxBWgdP+xi4ScGbCNnhhrodqxnrso65pLidNxMQENihqoPgS3AY5rU7krh35eCPbon2c4hap2nnxob2GQQE+zpAM4qFb53EoUWxE3t93jXyBwyXcG1KD+8/IXwBAmFYg26Vx37oHjnIlnQlGzbJvMCX+lQrPgT6dat9yAcT/S6aSOIs2rjjxLaQ9SsX83gv8uShiNuAn4mR9fZ5dizpphRpREvj1YvOhiU84OdmoghFyKH47y/GHohtLf45ITvVuLyfyKLI5RlntyJSXx2+P+gaejt5O7FNCSEkcFHTuAmPom6/qqxJqFRee33wHGc6rVLjXtym8C8nTTcnDNMh/n5BfnN8mFY18jWdbPlceeBViEsPi16xxFSL7ncjukVelTvxUzsxjOlAUzsULv8/GfdEJa7G7D7YWLCcUzbNkfb42zaXNaG2h4XTHH/n9x+bjIHKqeAdNMZf55fbrKBYLNq+lqb433lkFrUk5hNKdu6mIf5XA1KetzibR+09TLcfonrMtVYlNKk9h2gV//FCW3tCFmMXT0nOe83bxpklbdDJqrD+BC1mwUzTtOw2Sl/UFjpsh8ci2pHirFgxV8nxV/oJxO2RwR6+HNFbmfkZ15PaqwQe/VmJ+R18Aql37XTAsQ9EefUBW6NeEk34IaWN8HkIQk+Jva0SzwGXP6p1XDeEoqB1qx/L0B3dKY+VSr0JDurDFNaK2ZoYg5142sx1m3LEYxUsq+Vv8ejVSv8bdJ/UXySds9eDB4JwEnFIRS6KUIi/8RJxCEEARte74GBR6DycFpGgtZNFPkHrHgOx61miSaPDEOtEn8qWwvepZMc5Mel3ItZmHbbM12wSXV/snMHZQ6eRlzEzI9d9rnftskwERhXVNxF7ik1Krd87pbLCbWYR9Y7v0f/htaJHbsoDhwAAAABJRU5ErkJggg==",this.set("size",[this.bird.width||50,this.bird.height||50])},ol.ext.inherits(ol.particule.Bird,ol.particule.Base),ol.particule.Bird.prototype.draw=function(t){var e=this.getOverlay().get("angle");t.save(),t.translate(this.coordinate[0],this.coordinate[1]),t.rotate(e+Math.PI/2),t.scale(.5,.5),t.drawImage(this.bird,-this.bird.width/2,-this.bird.height/2),t.restore()},ol.particule.Bird.prototype.update=function(t){var e=this.getOverlay().get("speed")*t/this.getOverlay()._fps,o=this.getOverlay().get("angle");this.coordinate[0]+=e*Math.cos(o),this.coordinate[1]+=e*Math.sin(o)},ol.particule.Cloud=function(t){t||(t={}),ol.particule.Base.call(this,t),this.set("size",[100,100]);var e=document.createElement("CANVAS");e.width=200,e.height=200;var o=e.getContext("2d"),i=this.gradient=o.createRadialGradient(50,50,0,50,50,50);i.addColorStop(0,"rgba(255,255,255,.2"),i.addColorStop(1,"rgba(255,255,255,0"),this.image=e;for(var n=0;n<7;n++){o.save();var r=100*Math.random(),a=100*Math.random();o.translate(r,a),o.fillStyle=i,o.fillRect(0,0,e.width,e.height),o.restore()}},ol.ext.inherits(ol.particule.Cloud,ol.particule.Base),ol.particule.Cloud.prototype.draw=function(t){t.save(),t.translate(this.coordinate[0],this.coordinate[1]),t.drawImage(this.image,-this.image.width/2,-this.image.width/2),t.restore()},ol.particule.Cloud.prototype.update=function(t){var e=this.getOverlay().get("speed")*t/this.getOverlay()._fps,o=this.getOverlay().get("angle");this.coordinate[0]+=e*Math.cos(o),this.coordinate[1]+=e*Math.sin(o)},ol.particule.Rain=function(t){t||(t={}),ol.particule.Base.call(this,t),this.z=Math.floor(5*Math.random())+1;var e=document.createElement("CANVAS");e.width=50,e.height=50;var o=e.getContext("2d");this.gradient=o.createRadialGradient(0,0,0,0,0,25),this.gradient.addColorStop(0,"rgba(0,0,80,0)"),this.gradient.addColorStop(1,"rgba(0,0,80,.3)")},ol.ext.inherits(ol.particule.Rain,ol.particule.Base),ol.particule.Rain.prototype.draw=function(t){t.save();var e=this.getOverlay().get("angle");t.beginPath();var o=10*Math.cos(e)*(1+this.z/2),i=10*Math.sin(e)*(1+this.z/2);t.lineWidth=Math.round(this.z/2),t.strokeStyle=this.gradient,t.translate(this.coordinate[0],this.coordinate[1]),t.moveTo(0,0),t.lineTo(o,i),t.stroke(),t.restore()},ol.particule.Rain.prototype.update=function(t){var e=this.getOverlay().get("speed")*t/this.getOverlay()._fps*this.z,o=this.getOverlay().get("angle");this.coordinate[0]+=e*Math.cos(o),this.coordinate[1]+=e*Math.sin(o)},ol.particule.RainDrop=function(t){t||(t={}),ol.particule.Base.call(this,t),this.size=0;var e=document.createElement("CANVAS");e.width=100,e.height=100;var o=e.getContext("2d"),i=o.createRadialGradient(50,50,0,50,50,50);i.addColorStop(0,"rgba(128,128,192,.8"),i.addColorStop(1,"rgba(128,128,192,0"),this.image=e,o.fillStyle=i,o.fillRect(0,0,e.width,e.height)},ol.ext.inherits(ol.particule.RainDrop,ol.particule.Base),ol.particule.RainDrop.prototype.draw=function(t){this.size>0&&(t.save(),t.translate(this.coordinate[0],this.coordinate[1]),t.globalAlpha=this.size/50,t.scale(1-this.size/50,1-this.size/50),t.drawImage(this.image,-50,-50),t.restore())},ol.particule.RainDrop.prototype.update=function(t){(this.size>0||Math.random()<.01)&&(this.size<=0&&(this.size=50,this.coordinates=this.getRandomCoord()),this.size=this.size-Math.round(t/20))},ol.particule.Snow=function(t){t||(t={}),ol.particule.Base.call(this,t),this.z=(Math.floor(5*Math.random())+1)/5,this.angle=Math.random()*Math.PI;var e=document.createElement("CANVAS");e.width=20,e.height=20;var o=e.getContext("2d"),i=o.createRadialGradient(10,10,0,10,10,10);i.addColorStop(0,"rgba(255, 255, 255,1)"),i.addColorStop(.8,"rgba(210, 236, 242,.8)"),i.addColorStop(1,"rgba(237, 247, 249,0)"),this.image=e,o.fillStyle=i,o.fillRect(0,0,e.width,e.height)},ol.ext.inherits(ol.particule.Snow,ol.particule.Base),ol.particule.Snow.prototype.draw=function(t){t.save(),t.translate(this.coordinate[0],this.coordinate[1]),t.globalAlpha=.4+this.z/2,t.scale(this.z,this.z),t.drawImage(this.image,-10,-10),t.restore()},ol.particule.Snow.prototype.update=function(t){var e=this.getOverlay().get("speed")*t/this.getOverlay()._fps*this.z*5,o=this.getOverlay().get("angle");this.angle=this.angle+t/this.getOverlay()._fps/100,this.coordinate[0]+=2*Math.sin(this.angle+this.z)+e*Math.cos(o),this.coordinate[1]+=Math.cos(this.angle)+e*Math.sin(o)},ol.Overlay.Popup=function(t){"number"==typeof(t=t||{}).offsetBox?this.offsetBox=[t.offsetBox,t.offsetBox,t.offsetBox,t.offsetBox]:this.offsetBox=t.offsetBox;var e=document.createElement("div");t.element=e,this.closeBox=t.closeBox,this.onclose=t.onclose,this.onshow=t.onshow,ol.ext.element.create("BUTTON",{className:"closeBox"+(t.closeBox?" hasclosebox":""),type:"button",click:function(){this.hide()}.bind(this),parent:e}),!1!==t.anchor&&ol.ext.element.create("DIV",{className:"anchor",parent:e}),this.content=ol.ext.element.create("div",{html:t.html||"",className:"ol-popup-content",parent:e}),t.stopEvent&&(e.addEventListener("mousedown",(function(t){t.stopPropagation()})),e.addEventListener("touchstart",(function(t){t.stopPropagation()}))),ol.Overlay.call(this,t),this._elt=e,this.setPositioning(t.positioning||"auto"),this.setPopupClass(t.popupClass||t.className||"default"),t.anim&&this.addPopupClass("anim"),t.position&&setTimeout(function(){this.show(t.position)}.bind(this))},ol.ext.inherits(ol.Overlay.Popup,ol.Overlay),ol.Overlay.Popup.prototype.getClassPositioning=function(){var t="",e=this.getPositioning();return/bottom/.test(e)&&(t+="ol-popup-bottom "),/top/.test(e)&&(t+="ol-popup-top "),/left/.test(e)&&(t+="ol-popup-left "),/right/.test(e)&&(t+="ol-popup-right "),/^center/.test(e)&&(t+="ol-popup-middle "),/center$/.test(e)&&(t+="ol-popup-center "),t},ol.Overlay.Popup.prototype.setClosebox=function(t){this.closeBox=t,t?this.element.classList.add("hasclosebox"):this.element.classList.remove("hasclosebox")},ol.Overlay.Popup.prototype.setPopupClass=function(t){var e=["ol-popup"];this.getVisible()&&e.push("visible"),this.element.className="";var o=this.getClassPositioning().split(" ").filter((function(t){return t.length>0}));t?t.split(" ").filter((function(t){return t.length>0})).forEach((function(t){e.push(t)})):e.push("default"),o.forEach((function(t){e.push(t)})),this.closeBox&&e.push("hasclosebox"),this.element.classList.add.apply(this.element.classList,e)},ol.Overlay.Popup.prototype.addPopupClass=function(t){this.element.classList.add(t)},ol.Overlay.Popup.prototype.removePopupClass=function(t){this.element.classList.remove(t)},ol.Overlay.Popup.prototype.setPositioning=function(t){void 0!==t&&(/auto/.test(t)?(this.autoPositioning=t.split("-"),1==this.autoPositioning.length&&(this.autoPositioning[1]="auto")):this.autoPositioning=!1,"center"==(t=t.replace(/auto/g,"center"))&&(t="bottom-center"),this.setPositioning_(t))},ol.Overlay.Popup.prototype.setPositioning_=function(t){if(this.element){ol.Overlay.prototype.setPositioning.call(this,t),this.element.classList.remove("ol-popup-top","ol-popup-bottom","ol-popup-left","ol-popup-right","ol-popup-center","ol-popup-middle");var e=this.getClassPositioning().split(" ").filter((function(t){return t.length>0}));this.element.classList.add.apply(this.element.classList,e)}},ol.Overlay.Popup.prototype.getVisible=function(){return this.element.classList.contains("visible")},ol.Overlay.Popup.prototype.show=function(t,e){e||"string"!=typeof t||(e=t,t=null),!0===t&&(t=this.getPosition());var o=this,i=this.getMap();if(i&&(e&&e!==this.prevHTML&&(this.prevHTML=e,this.content.innerHTML="",e instanceof Element?this.content.appendChild(e):this.content.insertAdjacentHTML("beforeend",e),Array.prototype.slice.call(this.content.querySelectorAll("img")).forEach((function(t){t.addEventListener("load",(function(){i.renderSync()}))}))),t)){if(this.autoPositioning){var n=i.getPixelFromCoordinate(t),r=i.getSize(),a=[];"auto"==this.autoPositioning[0]?a[0]=n[1]<r[1]/3?"top":"bottom":a[0]=this.autoPositioning[0],a[1]=n[0]<2*r[0]/3?"left":"right",this.setPositioning_(a[0]+"-"+a[1]),this.offsetBox&&this.setOffset([this.offsetBox["left"==a[1]?2:0],this.offsetBox["top"==a[0]?3:1]])}else this.offsetBox&&this.setOffset(this.offsetBox);this.setPosition(t),this.element.parentElement.style.display="","function"==typeof this.onshow&&this.onshow(),this.dispatchEvent({type:"show"}),this._tout=setTimeout((function(){o.element.classList.add("visible")}),0)}},ol.Overlay.Popup.prototype.hide=function(){null!=this.getPosition()&&("function"==typeof this.onclose&&this.onclose(),this.setPosition(void 0),this._tout&&clearTimeout(this._tout),this.element.classList.remove("visible"),this.dispatchEvent({type:"hide"}))},ol.Overlay.AnimatedCanvas=function(t){t||(t={}),this._canvas=ol.ext.element.create("CANVAS",{className:((t.className||"")+" ol-animated-overlay").trim()}),this._ctx=this._canvas.getContext("2d"),ol.Overlay.call(this,{element:this._canvas,stopEvent:!1}),this._listener=[],this._time=0,this._particuleClass=t.particule||ol.particule.Base,t.createParticule&&(this._createParticule=t.createParticule),this._fps=1e3/(t.fps||25);var e=this._createParticule();this._psize=e.get("size")||[50,50],this.set("density",t.density||.5),this.set("speed",t.speed||4),this.set("angle","number"==typeof t.angle?t.angle:Math.PI/4),!1!==t.animate&&this.setAnimation(!0),document.addEventListener("visibilitychange",function(){this._pause=!0}.bind(this))},ol.ext.inherits(ol.Overlay.AnimatedCanvas,ol.Overlay),ol.Overlay.AnimatedCanvas.prototype.setVisible=function(t){this.element.style.display=t?"block":"none",t&&this.setAnimation(this.get("animation"))},ol.Overlay.AnimatedCanvas.prototype.getVisible=function(){return"none"!=this.element.style.display},ol.Overlay.AnimatedCanvas.prototype.updatePixelPosition=function(){},ol.Overlay.AnimatedCanvas.prototype.setMap=function(t){if(this.getMap()&&this.getMap().getViewport().querySelector(".ol-overlaycontainer").removeChild(this._canvas),this._listener.forEach((function(t){ol.Observable.unByKey(t)})),this._listener=[],ol.Overlay.prototype.setMap.call(this,t),t){var e=t.getSize();this._canvas.width=e[0],this._canvas.height=e[1],this.draw(),this._listener.push(t.on("change:size",function(){var e=t.getSize();this._canvas.width===e[0]&&this._canvas.height===e[1]||(this._canvas.width=e[0],this._canvas.height=e[1],this.draw())}.bind(this)))}},ol.Overlay.AnimatedCanvas.prototype.getParticules=function(){var t=this._psize[0],e=this._psize[1],o=this.get("density")*this._canvas.width*this._canvas.height/t/e<<0;if(this._particules||(this._particules=[]),o>this._particules.length)for(var i=this._particules.length;i<o;i++)this._particules.push(this._createParticule(this,this.randomCoord()));else this._particules.length=o;return this._particules},ol.Overlay.AnimatedCanvas.prototype._createParticule=function(t,e){return new this._particuleClass({overlay:t,coordinate:e})},ol.Overlay.AnimatedCanvas.prototype.randomCoord=function(){return[Math.random()*(this._canvas.width+this._psize[0])-this._psize[0]/2,Math.random()*(this._canvas.height+this._psize[1])-this._psize[1]/2]},ol.Overlay.AnimatedCanvas.prototype.draw=function(t){var e=this._ctx;this.clear(),e.beginPath(),this.getParticules().forEach(function(e){t&&(e.update(t),this.testExit(e)),e.draw(this._ctx)}.bind(this))},ol.Overlay.AnimatedCanvas.prototype.testExit=function(t){var e=this._psize;t.coordinate[0]<-e[0]?(t.coordinate[0]=this._canvas.width+e[0],t.coordinate[1]=Math.random()*(this._canvas.height+e[1])-e[1]/2):t.coordinate[0]>this._canvas.width+e[0]?(t.coordinate[0]=-e[0],t.coordinate[1]=Math.random()*(this._canvas.height+e[1])-e[1]/2):t.coordinate[1]<-e[1]?(t.coordinate[0]=Math.random()*(this._canvas.width+e[0])-e[0]/2,t.coordinate[1]=this._canvas.height+e[1]):t.coordinate[1]>this._canvas.height+e[1]&&(t.coordinate[0]=Math.random()*(this._canvas.width+e[0])-e[0]/2,t.coordinate[1]=-e[1])},ol.Overlay.AnimatedCanvas.prototype.clear=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},ol.Overlay.AnimatedCanvas.prototype.getCanvas=function(){return this._canvas},ol.Overlay.AnimatedCanvas.prototype.setAnimation=function(t){t=!1!==t,this.set("animation",t),t?(this._pause=!0,requestAnimationFrame(this._animate.bind(this))):this.dispatchEvent({type:"animation:stop",time:this._time})},ol.Overlay.AnimatedCanvas.prototype._animate=function(t){this.getVisible()&&this.get("animation")&&(this._pause?requestAnimationFrame(function(t){this._time=t,requestAnimationFrame(this._animate.bind(this))}.bind(this)):(t-this._time>this._fps&&(this.draw(t-this._time),this._time=t),requestAnimationFrame(this._animate.bind(this)))),this._pause=!1},ol.Overlay.Fixed=function(t){ol.Overlay.call(this,t)},ol.ext.inherits(ol.Overlay.Fixed,ol.Overlay),ol.Overlay.Fixed.prototype.setPosition=function(t,e){this.getMap()&&t&&(this._pixel=this.getMap().getPixelFromCoordinate(t)),ol.Overlay.prototype.setPosition.call(this,t),e&&ol.Overlay.prototype.updatePixelPosition.call(this)},ol.Overlay.Fixed.prototype.updatePixelPosition=function(){if(this.getMap()&&this._pixel&&this.getPosition()){var t=this.getMap().getPixelFromCoordinate(this.getPosition());Math.round(1e3*t[0])===Math.round(1e3*this._pixel[0])&&Math.round(1e3*t[0])===Math.round(1e3*this._pixel[0])||this.setPosition(this.getMap().getCoordinateFromPixel(this._pixel))}},ol.Overlay.FixedPopup=function(t){t.anchor=!1,t.positioning=t.positioning||"center-center",t.className=(t.className||"")+" ol-fixPopup",ol.Overlay.Popup.call(this,t),this.set("minScale",t.minScale||.5),this.set("maxScale",t.maxScale||2);var e=document.createElement("canvas");this._overlay=new ol.layer.Image({source:new ol.source.ImageCanvas({canvasFunction:function(t,o,i,n){return e.width=n[0],e.height=n[1],e}})}),this._style=t.style||new ol.style.Style({fill:new ol.style.Fill({color:[102,153,255]})}),this._overlay.on(["postcompose","postrender"],function(t){if(this.getVisible()&&this._pixel){var e=this.getMap(),o=this.getPosition(),i=e.getPixelFromCoordinate(o),n=this.element.getBoundingClientRect(),r=this.getMap().getTargetElement().getBoundingClientRect(),a=[n.left-r.left+n.width/2,n.top-r.top+n.height/2];t.context.save();var s=t.inversePixelTransform;s?t.context.transform(s[0],s[1],s[2],s[3],s[4],s[5]):t.context.scale(t.frameState.pixelRatio,t.frameState.pixelRatio),t.context.beginPath(),t.context.moveTo(i[0],i[1]),Math.abs(a[0]-i[0])>Math.abs(a[1]-i[1])?(t.context.lineTo(a[0],a[1]-8),t.context.lineTo(a[0],a[1]+8)):(t.context.lineTo(a[0]-8,a[1]),t.context.lineTo(a[0]+8,a[1])),t.context.moveTo(i[0],i[1]),this._style.getFill()&&(t.context.fillStyle=ol.color.asString(this._style.getFill().getColor()),t.context.fill()),this._style.getStroke()&&(t.context.strokeStyle=ol.color.asString(this._style.getStroke().getColor()),t.context.lineWidth=this._style.getStroke().width(),t.context.stroke()),t.context.restore()}}.bind(this));var o=function(){this.setPixelPosition()}.bind(this);function i(t){var e=0,o=0,i=0;for(var n in t)e+=t[n].clientX,o+=t[n].clientY,i++;return[e/i,o/i]}function n(t){var e=Object.keys(t);return!(e.length<2)&&ol.coordinate.dist2d([t[e[0]].clientX,t[e[0]].clientY],[t[e[1]].clientX,t[e[1]].clientY])}this.on(["hide","show"],function(){setTimeout(o)}.bind(this));var r,a,s,l,c={},h={},u=[];this.element.addEventListener("pointerdown",function(t){for(var e in t.preventDefault(),t.stopPropagation(),c)h[e]&&(c[e]=h[e]);c[t.pointerId]=t,u=this._pixel,a=this.get("rotation")||0,s=this.get("scale")||1,r=n(c),l=!1}.bind(this)),this.element.addEventListener("click",(function(t){l&&(t.preventDefault(),t.stopPropagation())}),!0);var p=function(t){c[t.pointerId]&&(delete c[t.pointerId],t.preventDefault()),h[t.pointerId]&&delete h[t.pointerId]}.bind(this);document.addEventListener("pointerup",p),document.addEventListener("pointercancel",p),document.addEventListener("pointermove",function(t){if(c[t.pointerId]){t.preventDefault(),h[t.pointerId]=t;var e=i(c),o=i(h),p=o[0]-e[0],d=o[1]-e[1];l=l||Math.abs(p)>3||Math.abs(d)>3;var f=function(){var t,e,o=Object.keys(c);if(o.length<2)return!1;t=c[o[0]];var i=[(e=c[o[1]]).clientX-t.clientX,e.clientY-t.clientY];t=h[o[0]];var n=[(e=h[o[1]]).clientX-t.clientX,e.clientY-t.clientY],r=Math.sqrt(i[0]*i[0]+i[1]*i[1]),a=Math.sqrt(n[0]*n[0]+n[1]*n[1]),s=360*Math.acos((i[0]*n[0]+i[1]*n[1])/(r*a))/Math.PI;return i[0]*n[1]-i[1]*n[0]<0?-s:s}();f&&this.setRotation(a+1.5*f,!1);var g=n(h);!1!==g&&r&&(this.setScale(s*g/r,!1),r=s*g/this.get("scale")),this.setPixelPosition([u[0]+p,u[1]+d])}}.bind(this))},ol.ext.inherits(ol.Overlay.FixedPopup,ol.Overlay.Popup),ol.Overlay.FixedPopup.prototype.setMap=function(t){ol.Overlay.Popup.prototype.setMap.call(this,t),this._overlay.setMap(this.getMap()),this._listener&&ol.Observable.unByKey(this._listener),t&&(this._listener=t.on("change:size",function(){this.setPixelPosition()}.bind(this)))},ol.Overlay.FixedPopup.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e)if(this._pixel)this.setVisible(!0);else{this._pixel=t.getPixelFromCoordinate(e);var o=t.getSize();this.updateRenderedPosition(this._pixel,o)}else this.setVisible(!1)},ol.Overlay.FixedPopup.prototype.updateRenderedPosition=function(t,e){ol.Overlay.Popup.prototype.updateRenderedPosition.call(this,t,e),this.setRotation(),this.setScale()},ol.Overlay.FixedPopup.prototype.setPixelPosition=function(t,e){var o,i=this.getMap(),n=i?i.getSize():[0,0];if(e&&(this.setPositioning(e),(o=ol.ext.element.offsetRect(this.element)).width=o.height=0,/top/.test(e)?t[1]+=o.height/2:/bottom/.test(e)?t[1]=n[1]-o.height/2-t[1]:t[1]=n[1]/2+t[1],/left/.test(e)?t[0]+=o.width/2:/right/.test(e)?t[0]=n[0]-o.width/2-t[0]:t[0]=n[0]/2+t[0]),t&&(this._pixel=t),i&&this._pixel){this.updateRenderedPosition(this._pixel,n);var r=!1;o=ol.ext.element.offsetRect(this.element);var a=ol.ext.element.offsetRect(i.getTargetElement());o.left<a.left?(this._pixel[0]=this._pixel[0]+a.left-o.left,r=!0):o.left+o.width>a.left+a.width&&(this._pixel[0]=this._pixel[0]+a.left-o.left+a.width-o.width,r=!0),o.top<a.top?(this._pixel[1]=this._pixel[1]+a.top-o.top,r=!0):o.top+o.height>a.top+a.height&&(this._pixel[1]=this._pixel[1]+a.top-o.top+a.height-o.height,r=!0),r&&this.updateRenderedPosition(this._pixel,n),this._overlay.changed()}},ol.Overlay.FixedPopup.prototype.getPixelPosition=function(){return this._pixel},ol.Overlay.FixedPopup.prototype.setPopupClass=function(t){ol.Overlay.Popup.prototype.setPopupClass.call(this,t),this.addPopupClass("ol-fixPopup")},ol.Overlay.FixedPopup.prototype.setRotation=function(t,e){"number"==typeof t&&this.set("rotation",t),!1!==e&&(/rotate/.test(this.element.style.transform)?this.element.style.transform=this.element.style.transform.replace(/rotate\((-?[\d,.]+)deg\)/,"rotate("+(this.get("rotation")||0)+"deg)"):this.element.style.transform=this.element.style.transform+" rotate("+(this.get("rotation")||0)+"deg)")},ol.Overlay.FixedPopup.prototype.setScale=function(t,e){"number"==typeof t&&this.set("scale",t),t=Math.min(Math.max(this.get("minScale")||0,this.get("scale")||1),this.get("maxScale")||2),this.set("scale",t),!1!==e&&(/scale/.test(this.element.style.transform)?this.element.style.transform=this.element.style.transform.replace(/scale\(([\d,.]+)\)/,"scale("+t+")"):this.element.style.transform=this.element.style.transform+" scale("+t+")")},ol.Overlay.FixedPopup.prototype.setLinkStyle=function(t){this._style=t,this._overlay.changed()},ol.Overlay.FixedPopup.prototype.getLinkStyle=function(){return this._style},ol.Overlay.Magnify=function(t){var e=document.createElement("div");e.className="ol-magnify",this._elt=e,ol.Overlay.call(this,{positioning:t.positioning||"center-center",element:this._elt,stopEvent:!1}),this.mgmap_=new ol.Map({controls:new ol.Collection,interactions:new ol.Collection,target:t.target||this._elt,view:new ol.View({projection:t.projection}),layers:t.layers}),this.mgview_=this.mgmap_.getView(),this.external_=!!t.target,this.set("zoomOffset",t.zoomOffset||1),this.set("active",!0),this.on("propertychange",this.setView_.bind(this))},ol.ext.inherits(ol.Overlay.Magnify,ol.Overlay),ol.Overlay.Magnify.prototype.setMap=function(t){this.getMap()&&this.getMap().getViewport().removeEventListener("mousemove",this.onMouseMove_),this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.Overlay.prototype.setMap.call(this,t),t.getViewport().addEventListener("mousemove",this.onMouseMove_.bind(this)),this._listener=t.getView().on("propertychange",this.setView_.bind(this)),this.setView_()},ol.Overlay.Magnify.prototype.getMagMap=function(){return this.mgmap_},ol.Overlay.Magnify.prototype.getActive=function(){return this.get("active")},ol.Overlay.Magnify.prototype.setActive=function(t){return this.set("active",t)},ol.Overlay.Magnify.prototype.onMouseMove_=function(t){if(this.get("active")){var e=this.getMap().getEventCoordinate(t);this.external_||this.setPosition(e),this.mgview_.setCenter(e),this._elt.querySelector("canvas")&&"none"!=this._elt.querySelector("canvas").style.display||this.mgmap_.updateSize()}else this.setPosition()},ol.Overlay.Magnify.prototype.setView_=function(t){if(this.get("active")){if(!t)return this.setView_({key:"rotation"}),void this.setView_({key:"resolution"});switch(t.key){case"rotation":this.mgview_.setRotation(this.getMap().getView().getRotation());break;case"zoomOffset":case"resolution":var e=Math.max(0,this.getMap().getView().getZoom()+Number(this.get("zoomOffset")));this.mgview_.setZoom(e)}}else this.setPosition()},ol.Overlay.Placemark=function(t){(t=t||{}).popupClass=(t.popupClass||"")+" placemark anim",t.positioning="bottom-center",ol.Overlay.Popup.call(this,t),this.setPositioning=function(){},t.color&&(this.element.style.color=t.color),t.backgroundColor&&(this.element.style.backgroundColor=t.backgroundColor),t.contentColor&&this.setContentColor(t.contentColor),t.size&&this.setRadius(t.size)},ol.ext.inherits(ol.Overlay.Placemark,ol.Overlay.Popup),ol.Overlay.Placemark.prototype.show=function(t,e){!0===t&&(t=this.getPosition()),this.hide(),ol.Overlay.Popup.prototype.show.apply(this,[t,e])},ol.Overlay.Placemark.prototype.setColor=function(t){this.element.style.color=t},ol.Overlay.Placemark.prototype.setBackgroundColor=function(t){this._elt.style.backgroundColor=t},ol.Overlay.Placemark.prototype.setContentColor=function(t){var e=this.element.getElementsByClassName("ol-popup-content")[0];e&&(e.style.color=t)},ol.Overlay.Placemark.prototype.setClassName=function(t){var e=this.element.className;this.element.className="ol-popup placemark ol-popup-bottom ol-popup-center "+(/visible/.test(e)?"visible ":"")+(/anim/.test(e)?"anim ":"")+t},ol.Overlay.Placemark.prototype.setRadius=function(t){this.element.style.fontSize=t+"px"},ol.Overlay.PopupFeature=function(t){t=t||{},ol.Overlay.Popup.call(this,t),this.setTemplate(t.template),this.set("canFix",t.canFix),this.set("showImage",t.showImage),this.set("maxChar",t.maxChar||200),this.set("keepSelection",t.keepSelection),t.select&&"function"==typeof t.select.on&&(this._select=t.select,t.select.on("select",function(e){this._noselect||(e.selected[0]?this.show(e.mapBrowserEvent.coordinate,t.select.getFeatures().getArray(),e.selected[0]):this.hide())}.bind(this)))},ol.ext.inherits(ol.Overlay.PopupFeature,ol.Overlay.Popup),ol.Overlay.PopupFeature.prototype.setTemplate=function(t){if(this._template=t,this._template&&this._template.attributes instanceof Array){var e={};this._template.attributes.forEach((function(t){e[t]=!0})),this._template.attributes=e}},ol.Overlay.PopupFeature.prototype.show=function(t,e,o){(t instanceof ol.Feature||t instanceof Array&&t[0]instanceof ol.Feature)&&(e=t,t=null),e instanceof Array||(e=[e]),this._features=e.slice(),this._count||(this._count=1),this._count=1;var i=this.get("keepSelection")&&o||e[0],n=this._getHtml(i);n?(this.element.classList.contains("ol-fixed")||this.hide(),t&&"Point"!==e[0].getGeometry().getType()||(t=e[0].getGeometry().getFirstCoordinate()),ol.Overlay.Popup.prototype.show.call(this,t,n)):this.hide()},ol.Overlay.PopupFeature.prototype._getHtml=function(t){if(!t)return"";var e=ol.ext.element.create("DIV",{className:"ol-popupfeature"});this.get("canFix")&&ol.ext.element.create("I",{className:"ol-fix",parent:e}).addEventListener("click",function(){this.element.classList.toggle("ol-fixed")}.bind(this));var o,i=this._template;if("function"==typeof i)i=i(t,this._count,this._features.length);else if(!i||!i.attributes)for(var n in(i=i||{}).attributes={},t.getProperties())"geometry"!=n&&(i.attributes[n]=n);i.title&&(o="function"==typeof i.title?i.title(t):t.get(i.title),ol.ext.element.create("H1",{html:o,parent:e}));if(i.attributes){var r,a=ol.ext.element.create("TABLE",{parent:e}),s=i.attributes,l=t.getProperties();for(var c in s)if(l.hasOwnProperty(c)){var h,u=s[c],p=l[c];"function"==typeof u.format&&(p=u.format(p,t));var d=!0;if("boolean"==typeof u.visible?d=u.visible:"function"==typeof u.visible&&(d=u.visible(t,p)),d){if(r=ol.ext.element.create("TR",{parent:a}),ol.ext.element.create("TD",{html:u.title||c,parent:r}),this.get("showImage")&&/(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|gif|png)/.test(p))h=ol.ext.element.create("IMG",{src:p});else{h=(u.before||"")+p+(u.after||"");var f=this.get("maxChar")||200;"string"==typeof h&&h.length>f&&(h=h.substr(0,f)+"[...]")}ol.ext.element.create("TD",{html:h,parent:r})}}}if(ol.ext.element.create("BUTTON",{className:"ol-zoombt",parent:e}).addEventListener("click",function(){if("Point"===t.getGeometry().getType())this.getMap().getView().animate({center:t.getGeometry().getFirstCoordinate(),zoom:Math.max(this.getMap().getView().getZoom(),18)});else{var e=t.getGeometry().getExtent();this.getMap().getView().fit(e,{duration:1e3})}}.bind(this)),!this.get("keepSelection")&&this._features.length>1){var g=ol.ext.element.create("DIV",{className:"ol-count",parent:e});ol.ext.element.create("DIV",{className:"ol-prev",parent:g,click:function(){this._count--,this._count<1&&(this._count=this._features.length),e=this._getHtml(this._features[this._count-1]),setTimeout(function(){ol.Overlay.Popup.prototype.show.call(this,this.getPosition(),e)}.bind(this),350)}.bind(this)}),ol.ext.element.create("TEXT",{html:this._count+"/"+this._features.length,parent:g}),ol.ext.element.create("DIV",{className:"ol-next",parent:g,click:function(){this._count++,this._count>this._features.length&&(this._count=1),e=this._getHtml(this._features[this._count-1]),setTimeout(function(){ol.Overlay.Popup.prototype.show.call(this,this.getPosition(),e)}.bind(this),350)}.bind(this)})}return this._select&&!this.get("keepSelection")&&(this._noselect=!0,this._select.getFeatures().clear(),this._select.getFeatures().push(t),this._noselect=!1),this.dispatchEvent({type:"select",feature:t,index:this._count}),e},ol.Overlay.PopupFeature.prototype.setFix=function(t){t?this.element.classList.add("ol-fixed"):this.element.classList.remove("ol-fixed")},ol.Overlay.PopupFeature.prototype.getFix=function(){return this.element.classList.contains("ol-fixed")},ol.Overlay.PopupFeature.localString=function(t,e){return function(o){if(o&&o.toLocaleString)return o.toLocaleString(t,e);var i=new Date(o);return isNaN(i)?o:i.toLocaleString(t,e)}},ol.Overlay.Tooltip=function(t){(t=t||{}).popupClass=t.popupClass||t.className||"tooltips black",t.positioning=t.positioning||"center-left",t.stopEvent=!!t.stopEvent,ol.Overlay.Popup.call(this,t),this.set("maximumFractionDigits",t.maximumFractionDigits||2),"function"==typeof t.formatLength&&(this.formatLength=t.formatLength),"function"==typeof t.formatArea&&(this.formatArea=t.formatArea),"function"==typeof t.getHTML&&(this.getHTML=t.getHTML),this._interaction=new ol.interaction.Interaction({handleEvent:function(t){if("pointermove"===t.type||"click"===t.type){var e=this.getHTML(this._feature,this.get("info"));e?this.show(t.coordinate,e):this.hide(),this._coord=t.coordinate}return!0}.bind(this)})},ol.ext.inherits(ol.Overlay.Tooltip,ol.Overlay.Popup),ol.Overlay.Tooltip.prototype.setMap=function(t){this.getMap()&&this.getMap().removeInteraction(this._interaction),ol.Overlay.Popup.prototype.setMap.call(this,t),this.getMap()&&this.getMap().addInteraction(this._interaction)},ol.Overlay.Tooltip.prototype.getHTML=function(t,e){return this.get("measure")?this.get("measure")+(e?"<br/>"+e:""):e||""},ol.Overlay.Tooltip.prototype.setInfo=function(t){t?setTimeout(function(){this.set("info",t),this.show(this._coord,this.get("info"))}.bind(this)):(this.set("info",""),this.hide())},ol.Overlay.Tooltip.prototype.removeFeature=function(){this.setFeature()},ol.Overlay.Tooltip.prototype.formatArea=function(t){return t>Math.pow(10,-1*this.get("maximumFractionDigits"))?t>1e4?(t/1e6).toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits)")})+" km²":t.toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" m²":""},ol.Overlay.Tooltip.prototype.formatLength=function(t){return t>Math.pow(10,-1*this.get("maximumFractionDigits"))?t>100?(t/1e3).toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" km":t.toLocaleString(void 0,{maximumFractionDigits:this.get("maximumFractionDigits")})+" m":""},ol.Overlay.Tooltip.prototype.setFeature=function(t){t&&t.feature&&(t=t.feature),this._feature=t,this._listener&&this._listener.forEach((function(t){ol.Observable.unByKey(t)})),this._listener=[],this.set("measure",""),t&&this._listener.push(t.getGeometry().on("change",function(t){var e,o=t.target;o.getArea?e=this.formatArea(ol.sphere.getArea(o,{projection:this.getMap().getView().getProjection()})):o.getLength&&(e=this.formatLength(ol.sphere.getLength(o,{projection:this.getMap().getView().getProjection()}))),this.set("measure",e)}.bind(this)))},ol.coordinate.convexHull,function(){var t=function(t,e,o){return(t[0]-o[0])*(e[1]-o[1])-(t[1]-o[1])*(e[0]-o[0])<=0};ol.coordinate.convexHull=function(e){var o;e.sort((function(t,e){return t[0]==e[0]?t[1]-e[1]:t[0]-e[0]}));var i=[];for(o=0;o<e.length;o++){for(;i.length>=2&&t(i[i.length-2],i[i.length-1],e[o]);)i.pop();i.push(e[o])}var n=[];for(o=e.length-1;o>=0;o--){for(;n.length>=2&&t(n[n.length-2],n[n.length-1],e[o]);)n.pop();n.push(e[o])}return n.pop(),i.pop(),i.concat(n)};ol.geom.Geometry.prototype.convexHull=function(){return ol.coordinate.convexHull(function t(e){var o,i,n=[];switch(e.getType()){case"Point":n.push(e.getCoordinates());break;case"LineString":case"LinearRing":case"MultiPoint":n=e.getCoordinates();break;case"MultiLineString":for(i=e.getLineStrings(),o=0;o<i.length;o++)n.concat(t(i[o]));break;case"Polygon":n=t(e.getLinearRing(0));break;case"MultiPolygon":for(i=e.getPolygons(),o=0;o<i.length;o++)n.concat(t(i[o]));break;case"GeometryCollection":for(i=e.getGeometries(),o=0;o<i.length;o++)n.concat(t(i[o]))}return n}(this))}}(),ol.coordinate.toDFCI=function(t,e,o){e||0===e||(e=3),o&&(ol.proj.get("EPSG:27572")||(proj4.defs["EPSG:27572"]||proj4.defs("EPSG:27572","+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"),ol.proj.proj4.register(proj4)),t=ol.proj.transform(t,o,"EPSG:27572"));var i=t[0],n=t[1],r="";if(r+=String.fromCharCode(65+Math.floor((i<8e5?i:i+2e5)/1e5))+String.fromCharCode(65+Math.floor((n<23e5?n:n+2e5)/1e5)-15),0===e)return r;if(r+=2*Math.floor(i%1e5/2e4),r+=2*Math.floor(n%1e5/2e4),1===e)return r;var a=Math.floor(i%2e4/2e3);if(r+=String.fromCharCode(65+(a<8?a:a+2)),r+=Math.floor(n%2e4/2e3),2===e)return r;var s=Math.floor(i%2e3/500),l=Math.floor(n%2e3/500);return r+=s<1?l>1?".1":".4":s>2?l>1?".2":".3":l>2?s<2?".1":".2":l<1?s<2?".4":".3":".5"},ol.coordinate.fromDFCI=function(t,e){var o,i=1e5,n=t.charCodeAt(0)-65;n=(n<8?n:n-2)*i;var r=t.charCodeAt(1)-65;if(r=(r<8?r:r-2)*i+15e5,2===t.length)o=[n+i/2,r+i/2];else if(i/=5,n+=Number(t.charAt(2))/2*i,r+=Number(t.charAt(3))/2*i,4===t.length)o=[n+i/2,r+i/2];else{i/=10;var a=t.charCodeAt(4)-65;if(n+=(a<8?a:a-2)*i,r+=Number(t.charAt(5))*i,6===t.length)o=[n+i/2,r+i/2];else switch(t.charAt(7)){case"1":o=[n+i/4,r+3*i/4];break;case"2":o=[n+3*i/4,r+3*i/4];break;case"3":o=[n+3*i/4,r+i/4];break;case"4":o=[n+i/4,r+i/4];break;default:o=[n+i/2,r+i/2]}}return e&&(ol.proj.get("EPSG:27572")||(proj4.defs["EPSG:27572"]||proj4.defs("EPSG:27572","+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"),ol.proj.proj4.register(proj4)),o=ol.proj.transform(o,"EPSG:27572",e)),o},ol.coordinate.validDFCI=function(t){if(t.length<2||t.length>8)return!1;if(/[^A-H|^K-N]/.test(t.substr(0,1)))return!1;if(/[^B-H|^K-N]/.test(t.substr(1,1)))return!1;if(t.length>2){if(t.length<4)return!1;if(/[^0,^2,^4,^6,^8]/.test(t.substr(2,1)))return!1;if(/[^0,^2,^4,^6,^8]/.test(t.substr(3,1)))return!1}if(t.length>4){if(t.length<6)return!1;if(/[^A-H|^K-L]/.test(t.substr(4,1)))return!1;if(/[^0-9]/.test(t.substr(5,1)))return!1}if(t.length>6){if(t.length<8)return!1;if("."!==t.substr(6,1))return!1;if(/[^1-5]/.test(t.substr(7,1)))return!1}return!0},ol.coordinate.validDFCICoord=function(t,e){return e&&(ol.proj.get("EPSG:27572")||(proj4.defs["EPSG:27572"]||proj4.defs("EPSG:27572","+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"),ol.proj.proj4.register(proj4)),t=ol.proj.transform(t,e,"EPSG:27572")),!(0>t[0]||t[0]>12e5)&&!(16e5>t[1]||t[1]>27e5)},ol.graph={},ol.graph.Dijskra=function(t){t=t||{},this.source=t.source,this.nodes=new ol.source.Vector,this.maxIteration=t.maxIteration||2e4,this.stepIteration=t.stepIteration||2e3,this.astar=!0,this.candidat=[],ol.Object.call(this),this.set("epsilon",t.epsilon||1e-6)},ol.ext.inherits(ol.graph.Dijskra,ol.Object),ol.graph.Dijskra.prototype.weight=function(){return 1},ol.graph.Dijskra.prototype.direction=function(){return 2},ol.graph.Dijskra.prototype.getLength=function(t){return t.getGeometry&&(t=t.getGeometry()),t.getLength()},ol.graph.Dijskra.prototype.getNodeSource=function(){return this.nodes},ol.graph.Dijskra.prototype.getEdges=function(t){var e=ol.extent.buffer(ol.extent.boundingExtent([t]),this.get("epsilon")),o=[];return this.source.forEachFeatureIntersectingExtent(e,(function(t){o.push(t)})),o},ol.graph.Dijskra.prototype.getNode=function(t){var e=ol.extent.buffer(ol.extent.boundingExtent([t]),this.get("epsilon")),o=[];return this.nodes.forEachFeatureIntersectingExtent(e,(function(t){o.push(t)})),o[0]},ol.graph.Dijskra.prototype.addNode=function(t,e,o,i,n){if(this.wdist&&e>this.wdist)return!1;var r=this.getNode(t),a=e+this.getLength(new ol.geom.LineString([this.end,t]))*this.weight();if(this.astar&&this.wdist&&a>this.wdist)return!1;if(r){if(r!==this.arrival&&r.get("wdist")<=e)return r;r.set("dist",o),r.set("wdist",e),r.set("dtotal",a),r.set("from",i),r.set("prev",n),r===this.arrival&&(this.wdist=e),this.candidat.push(r)}else r=new ol.Feature({geometry:new ol.geom.Point(t),from:i,prev:n,dist:o||0,wdist:e,dtotal:a}),e<0?r.set("wdist",!1):this.candidat.push(r),this.nodes.addFeature(r);return r},ol.graph.Dijskra.prototype.closestCoordinate=function(t){var e=this.source.getClosestFeatureToCoordinate(t),o=e.getGeometry().getFirstCoordinate(),i=e.getGeometry().getLastCoordinate();return ol.coordinate.dist2d(t,o)<ol.coordinate.dist2d(t,i)?o:i},ol.graph.Dijskra.prototype.path=function(t,e){if(this.running)return!1;if(t=this.closestCoordinate(t),this.end=this.closestCoordinate(e),t[0]===this.end[0]&&t[1]===this.end[1])return this.dispatchEvent({type:"finish",route:[],wDistance:-1,distance:this.wdist}),!1;var o=this;return this.nodes.clear(),this.candidat=[],this.wdist=0,this.running=!0,this.addNode(t,0),this.arrival=this.addNode(this.end,-1),this.nb=0,this.dispatchEvent({type:"start"}),setTimeout((function(){o._resume()})),[t,this.end]},ol.graph.Dijskra.prototype.resume=function(){this.running||this.candidat.length&&(this.running=!0,this.nb=0,this._resume())},ol.graph.Dijskra.prototype.pause=function(){this.running&&(this.nb=-1)},ol.graph.Dijskra.prototype.getBestWay=function(){for(var t,e,o=-1,i=0;e=this.candidat[i];i++)e.get("wdist")>o&&(t=e,o=e.get("wdist"));return this.getRoute(t)},ol.graph.Dijskra.prototype._resume=function(){if(this.running){for(;this.candidat.length;){this.candidat.sort((function(t,e){return t.get("dtotal")<e.get("dtotal")?1:t.get("dtotal")===e.get("dtotal")?0:-1}));for(var t,e=this.candidat.pop(),o=e.getGeometry().getCoordinates(),i=this.getEdges(o),n=0;t=i[n];n++){if(e.get("from")!==t){var r=this.getLength(t);r<0&&console.log("distance < 0!");var a=e.get("wdist")+r*this.weight(t);r=e.get("dist")+r;var s=t.getGeometry().getFirstCoordinate(),l=t.getGeometry().getLastCoordinate(),c=this.direction(t);0!==c&&(o[0]===s[0]&&o[1]===s[1]&&-1!==c&&this.addNode(l,a,r,t,e),o[0]===l[0]&&o[0]===l[0]&&1!==c&&this.addNode(s,a,r,t,e))}if(-1===this.nb||this.nb++>this.maxIteration)return this.running=!1,void this.dispatchEvent({type:"pause",overflow:-1!==this.nb});if(!(this.nb%this.stepIteration)){var h=this;return window.setTimeout((function(){h._resume()}),5),void this.dispatchEvent({type:"calculating"})}}}this.nodes.clear(),this.running=!1,this.dispatchEvent({type:"finish",route:this.getRoute(this.arrival),wDistance:this.wdist,distance:this.arrival.get("dist")})}},ol.graph.Dijskra.prototype.getRoute=function(t){for(var e=[];t;)e.unshift(t.get("from")),t=t.get("prev");return e.shift(),e},ol.coordinate.dist2d=function(t,e){var o=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(o*o+i*i)},ol.coordinate.equal=function(t,e){return t[0]==e[0]&&t[1]==e[1]},ol.coordinate.getFeatureCenter=function(t){return ol.coordinate.getGeomCenter(t.getGeometry())},ol.coordinate.getGeomCenter=function(t){switch(t.getType()){case"Point":return t.getCoordinates();case"MultiPolygon":t=t.getPolygon(0);case"Polygon":return t.getInteriorPoint().getCoordinates();default:return t.getClosestPoint(ol.extent.getCenter(t.getExtent()))}},ol.coordinate.offsetCoords=function(t,e){var o,i,n,r,a,s,l,c,h,u,p,d,f,g=[],m=t.length-1,y=m,v=ol.coordinate.equal(t[0],t[m]);v||(p=t[0],d=t[1],f=[p[0]+(d[1]-p[1])/ol.coordinate.dist2d(p,d)*e,p[1]-(d[0]-p[0])/ol.coordinate.dist2d(p,d)*e],g.push(f),t.push(t[m]),m++,y--);for(var b=0;b<y;b++)p=t[b],d=t[(b+1)%m],f=t[(b+2)%m],o=(d[1]-p[1])/(d[0]-p[0]),i=(f[1]-d[1])/(f[0]-d[0]),Math.abs(o-i)>1e-10&&(n=Math.sqrt((d[0]-p[0])*(d[0]-p[0])+(d[1]-p[1])*(d[1]-p[1])),r=Math.sqrt((f[0]-d[0])*(f[0]-d[0])+(f[1]-d[1])*(f[1]-d[1])),a=p[0]+e*(d[1]-p[1])/n,h=(i*(s=d[0]+e*(f[1]-d[1])/r)-o*a+(l=p[1]-e*(d[0]-p[0])/n)-(c=d[1]-e*(f[0]-d[0])/r))/(i-o),u=(o*i*(s-a)+i*l-o*c)/(i-o),d[0]-p[0]==0&&(u=i*(h=d[0]+e*(d[1]-p[1])/Math.abs(d[1]-p[1]))-i*s+c),f[0]-d[0]==0&&(u=o*(h=f[0]+e*(f[1]-d[1])/Math.abs(f[1]-d[1]))-o*a+l),g.push([h,u]));return v?g.push(g[0]):(t.pop(),p=t[t.length-1],d=t[t.length-2],f=[p[0]-(d[1]-p[1])/ol.coordinate.dist2d(p,d)*e,p[1]+(d[0]-p[0])/ol.coordinate.dist2d(p,d)*e],g.push(f)),g},ol.coordinate.findSegment=function(t,e){for(var o=0;o<e.length-1;o++){var i=e[o],n=e[o+1];if(ol.coordinate.equal(t,i)||ol.coordinate.equal(t,n))return{index:1,segment:[i,n]};var r=ol.coordinate.dist2d(i,n),a=[(n[0]-i[0])/r,(n[1]-i[1])/r],s=ol.coordinate.dist2d(i,t),l=[(t[0]-i[0])/s,(t[1]-i[1])/s];if(Math.abs(a[0]*l[1]-a[1]*l[0])<1e-10)return{index:1,segment:[i,n]}}return{index:-1}},ol.coordinate.splitH=function(t,e,o){for(var i,n,r=[],a=0;a<t.length-1;a++)t[a].length&&t[a+1].length&&(t[a][1]<=e&&t[a+1][1]>e||t[a][1]>=e&&t[a+1][1]<e)&&(i=(n=(e-t[a][1])/(t[a+1][1]-t[a][1]))*(t[a+1][0]-t[a][0])+t[a][0],r.push({contour:o,index:a,pt:[i,e],abs:n}));r.sort((function(t,e){return t.pt[0]-e.pt[0]}));for(var s=[],l=0;l<r.length-1;l+=2)s.push([r[l],r[l+1]]);return s},ol.geom.createFromType=function(t,e){switch(t){case"LineString":return new ol.geom.LineString(e);case"LinearRing":return new ol.geom.LinearRing(e);case"MultiLineString":return new ol.geom.MultiLineString(e);case"MultiPoint":return new ol.geom.MultiPoint(e);case"MultiPolygon":return new ol.geom.MultiPolygon(e);case"Point":return new ol.geom.Point(e);case"Polygon":return new ol.geom.Polygon(e);default:return console.error("[createFromType] Unsupported type: "+t),null}},ol.coordinate.getIntersectionPoint=function(t,e){var o=t[1][0]-t[0][0],i=t[1][1]-t[0][1],n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=o*r-i*n;if(0!=a){var s=(o*t[0][1]-o*e[0][1]-i*t[0][0]+i*e[0][0])/a;return[e[0][0]+s*n,e[0][1]+s*r]}return!1},ol.extent.intersection,function(){function t(t,e){for(var o,i=t.length-1;i>0;i--)(t[i][0]>e&&t[i-1][0]<e||t[i][0]<e&&t[i-1][0]>e)&&(o=[e,(e-t[i][0])/(t[i-1][0]-t[i][0])*(t[i-1][1]-t[i][1])+t[i][1]],t.splice(i,0,o))}function e(t,e){for(var o,i=t.length-1;i>0;i--)(t[i][1]>e&&t[i-1][1]<e||t[i][1]<e&&t[i-1][1]>e)&&(o=[(e-t[i][1])/(t[i-1][1]-t[i][1])*(t[i-1][0]-t[i][0])+t[i][0],e],t.splice(i,0,o))}ol.extent.intersection=function(o,i){var n="Polygon"===i.getType();if(!n&&"MultiPolygon"!==i.getType())return null;var r=i.getCoordinates();return n&&(r=[r]),r.forEach((function(i){i.forEach((function(i){t(i,o[0]),t(i,o[2]),e(i,o[1]),e(i,o[3])}))})),r.forEach((function(t){t.forEach((function(t){t.forEach((function(t){t[0]<o[0]?t[0]=o[0]:t[0]>o[2]&&(t[0]=o[2]),t[1]<o[1]?t[1]=o[1]:t[1]>o[3]&&(t[1]=o[3])}))}))})),n?new ol.geom.Polygon(r[0]):new ol.geom.MultiPolygon(r)}}(),ol.coordinate.sampleAt=function(t,e,o,i){var n=[];!1!==i&&n.push(t);var r=ol.coordinate.dist2d(t,e);if(r){var a=Math.round(r/o);if(a>1)for(var s=(e[0]-t[0])/a,l=(e[1]-t[1])/a,c=1;c<a;c++)n.push([t[0]+s*c,t[1]+l*c])}return n.push(e),n},ol.geom.Polygon.prototype.sampleAt=function(t){var e=this.getCoordinates(),o=[];return e.forEach((function(e){for(var i=[],n=1;n<e.length;n++)i=i.concat(ol.coordinate.sampleAt(e[n-1],e[n],t,1===n));o.push(i)})),new ol.geom.Polygon(o)},ol.geom.MultiPolygon.prototype.sampleAt=function(t){var e=this.getCoordinates(),o=[];return e.forEach((function(e){var i=[];o.push(i),e.forEach((function(e){for(var o=[],n=1;n<e.length;n++)o=o.concat(ol.coordinate.sampleAt(e[n-1],e[n],t,1===n));i.push(o)}))})),new ol.geom.MultiPolygon(o)},ol.geom.Circle.prototype.intersection=function(t,e){if(t.sampleAt){var o=ol.extent.buffer(this.getCenter().concat(this.getCenter()),this.getRadius());t=(t=ol.extent.intersection(o,t)).simplify(e);var i=this.getCenter(),n=this.getRadius(),r=t.sampleAt(e).getCoordinates();switch(t.getType()){case"Polygon":r=[r];case"MultiPolygon":var a=!1,s=[];return r.forEach((function(t){var e=[];s.push(e),t.forEach((function(t){var o=[];e.push(o),t.forEach((function(t){var e=ol.coordinate.dist2d(i,t);e>n?(a=!0,o.push([i[0]+n/e*(t[0]-i[0]),i[1]+n/e*(t[1]-i[1])])):o.push(t)}))}))})),a?"Polygon"===t.getType()?new ol.geom.Polygon(s[0]):new ol.geom.MultiPolygon(s):t}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+t.getType());return t},ol.geom.LineString.prototype.splitAt=function(t,e){var o;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var i=[this];for(o=0;o<t.length;o++){for(var n=[],r=0;r<i.length;r++){var a=i[r].splitAt(t[o],e);n=n.concat(a)}i=n}return i}if(ol.coordinate.equal(t,this.getFirstCoordinate())||ol.coordinate.equal(t,this.getLastCoordinate()))return[this];var s=this.getCoordinates(),l=[s[0]],c=[];for(o=0;o<s.length-1;o++)if(!ol.coordinate.equal(s[o],s[o+1])){if(ol.coordinate.equal(t,s[o+1]))l.push(s[o+1]),c.push(new ol.geom.LineString(l)),l=[];else if(!ol.coordinate.equal(t,s[o])){var h,u,p=!1;s[o][0]==s[o+1][0]?(h=(s[o][1]-t[1])/(s[o][1]-s[o+1][1]),p=s[o][0]==t[0]&&0<h&&h<=1):s[o][1]==s[o+1][1]?(h=(s[o][0]-t[0])/(s[o][0]-s[o+1][0]),p=s[o][1]==t[1]&&0<h&&h<=1):(h=(s[o][0]-t[0])/(s[o][0]-s[o+1][0]),u=(s[o][1]-t[1])/(s[o][1]-s[o+1][1]),p=Math.abs(h-u)<=e&&0<h&&h<=1),p&&(l.push(t),c.push(new ol.geom.LineString(l)),l=[t])}l.push(s[o+1])}return l.length>1&&c.push(new ol.geom.LineString(l)),c.length?c:[this]},ol.geom.MultiPolygon.prototype.scribbleFill=function(t){var e,o,i,n=[],r=this.getPolygons();for(e=0;o=r[e];e++){var a=o.scribbleFill(t);a&&n.push(a)}if(!n.length)return null;var s,l=n[0];for(e=0;i=n[e];e++){s=i.getLineStrings();for(var c=0;c<s.length;c++)l.appendLineString(s[c])}return l},ol.geom.Polygon.prototype.scribbleFill=function(t){var e,o,i,n=t.interval,r=t.angle||Math.PI/2,a=this.clone();a.rotate(r,[0,0]);var s=a.getCoordinates(),l=s[0];for(e=1;e<s.length;e++)l.push([]),l=l.concat(s[e]);for(var c=a.getExtent(),h=[],u=(Math.floor(c[1]/n)+1)*n;u<c[3];u+=n)i=ol.coordinate.splitH(l,u,e),h=h.concat(i);if(!h.length)return null;var p=l.length-1,d=h[0][0].index;for(o=0;i=h[o];o++)h[o][0].index=(h[o][0].index-d+p)%p,h[o][1].index=(h[o][1].index-d+p)%p;for(var f=[];;){for(o=0;(i=h[o])&&i[0].done;o++);if(!i)break;for(var g=[];i;){i[0].done=!0,g.push(i[0].pt),g.push(i[1].pt);for(var m=i[0].pt[1]+n,y=1/0,v=null;h[o]&&!(h[o][0].pt[1]>m);){if(h[o][0].pt[1]===m){var b=Math.min((h[o][0].index-i[0].index+p)%p,(i[0].index-h[o][0].index+p)%p),_=Math.min((i[1].index-i[0].index+p)%p,(i[0].index-i[1].index+p)%p);b<y&&b<_&&(y=b,v=h[o][0].done?null:h[o])}o++}i=v}g.length&&f.push(g)}if(!f.length)return null;var S=new ol.geom.MultiLineString(f);return S.rotate(-r,[0,0]),S.cspline({pointsPerSeg:8,tension:.9})},ol.geohash={base32:"0123456789bcdefghjkmnpqrstuvwxyz"},ol.geohash.fromLonLat=function(t,e){var o=t[0],i=t[1];if(!e){for(var n=1;n<=12;n++){var r=ol.geohash.fromLonLat([o,i],n),a=ol.geohash.toLonLat(r);if(a.lat==i&&a.lon==o)return r}e=12}(e<1||e>12)&&(e=12);for(var s=0,l=0,c=!0,h="",u=-90,p=90,d=-180,f=180;h.length<e;){if(c){var g=(d+f)/2;o>=g?(s=2*s+1,d=g):(s*=2,f=g)}else{var m=(u+p)/2;i>=m?(s=2*s+1,u=m):(s*=2,p=m)}c=!c,5==++l&&(h+=ol.geohash.base32.charAt(s),l=0,s=0)}return h},ol.geohash.toLonLat=function(t){var e=ol.geohash.getExtent(t),o=e[1],i=e[0],n=e[3],r=e[2],a=(o+n)/2,s=(i+r)/2;return a=a.toFixed(Math.floor(2-Math.log(n-o)/Math.LN10)),s=s.toFixed(Math.floor(2-Math.log(r-i)/Math.LN10)),[Number(s),Number(a)]},ol.geohash.getExtent=function(t){if(!t)return!1;t=t.toLowerCase();for(var e=!0,o=-90,i=90,n=-180,r=180,a=0;a<t.length;a++){var s=t.charAt(a),l=ol.geohash.base32.indexOf(s);if(-1==l)return!1;for(var c=4;c>=0;c--){var h=l>>c&1;if(e){var u=(n+r)/2;1==h?n=u:r=u}else{var p=(o+i)/2;1==h?o=p:i=p}e=!e}}return[n,o,r,i]},ol.geohash.getAdjacent=function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),!t)return!1;if(-1=="nsew".indexOf(e))return!1;var o=t.slice(-1),i=t.slice(0,-1),n=t.length%2;return-1!={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]}[e][n].indexOf(o)&&""!=i&&(i=ol.geohash.getAdjacent(i,e)),i+ol.geohash.base32.charAt({n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]}[e][n].indexOf(o))},ol.geohash.getNeighbours=function(t){return{n:ol.geohash.getAdjacent(t,"n"),ne:ol.geohash.getAdjacent(ol.geohash.getAdjacent(t,"n"),"e"),e:ol.geohash.getAdjacent(t,"e"),se:ol.geohash.getAdjacent(ol.geohash.getAdjacent(t,"s"),"e"),s:ol.geohash.getAdjacent(t,"s"),sw:ol.geohash.getAdjacent(ol.geohash.getAdjacent(t,"s"),"w"),w:ol.geohash.getAdjacent(t,"w"),nw:ol.geohash.getAdjacent(ol.geohash.getAdjacent(t,"n"),"w")}},ol.sphere.greatCircleBearing=function(t,e){var o=Math.PI/180,i=[t[0]*o,t[1]*o],n=[e[0]*o,e[1]*o];return Math.atan2(Math.sin(n[0]-i[0])*Math.cos(n[1]),Math.cos(i[1])*Math.sin(n[1])-Math.sin(i[1])*Math.cos(n[1])*Math.cos(n[0]-i[0]))},ol.sphere.computeDestinationPoint=function(t,e,o,i){i=i||{};var n=Math.PI/180,r=i.radius||6371008.8,a=t[1]*n,s=t[0]*n,l=e/r,c=Math.asin(Math.sin(a)*Math.cos(l)+Math.cos(a)*Math.sin(l)*Math.cos(o)),h=(s+Math.atan2(Math.sin(o)*Math.sin(l)*Math.cos(a),Math.cos(l)-Math.sin(a)*Math.sin(c)))/n;return!1!==i.normalize&&(h<-180||h>180)&&(h=540*h%360-180),[h,c/n]},ol.sphere.greatCircleTrack=function(t,e,o){o=o||{};for(var i=ol.sphere.greatCircleBearing(t,e),n=ol.sphere.getDistance(t,e,o.radius),r=o.distance||1e3,a=r,s=[t];a<n;)s.push(ol.sphere.computeDestinationPoint(t,a,i,{radius:o.radius,normalize:!1})),a+=r;var l=ol.sphere.computeDestinationPoint(t,n,i,{radius:o.radius,normalize:!1});return Math.abs(l[0]-e[0])>1&&(l[0]>e[0]?e[0]+=360:e[0]-=360),s.push(e),s},ol.Map.prototype.animExtent=function(t,e){var o;(e=e||{}).projection&&(t=ol.proj.transformExtent(t,e.projection,this.getView().getProjection()));var i=(new Date).getTime(),n=e.duration||1e3,r=e.easing||ol.easing.upAndDown,a=e.style&&e.style.getWidth()||2,s=e.style&&e.style.getColr()||"red";o=this.on("postcompose",function(e){var l=e.frameState,c=l.pixelRatio,h=l.time-i;if(h>n)ol.Observable.unByKey(o);else{var u=h/n,p=this.getPixelFromCoordinate([t[0],t[1]]),d=this.getPixelFromCoordinate([t[2],t[3]]),f=e.context;f.save(),f.scale(c,c),f.beginPath(),f.globalAlpha=r(1-u),f.lineWidth=a,f.strokeStyle=s,f.rect(p[0],p[1],d[0]-p[0],d[1]-p[1]),f.stroke(),f.restore(),l.animate=!0}}.bind(this)),this.renderSync()},ol.geom.Geometry.prototype.cspline=function(t){return this.calcCSpline_?(this.csplineGeometryRevision==this.getRevision()&&this.csplineOption==JSON.stringify(t)||(this.csplineGeometry_=this.calcCSpline_(t),this.csplineGeometryRevision=this.getRevision(),this.csplineOption=JSON.stringify(t)),this.csplineGeometry_):this},ol.geom.GeometryCollection.prototype.calcCSpline_=function(t){for(var e=[],o=this.getGeometries(),i=0;i<o.length;i++)e.push(o[i].cspline(t));return new ol.geom.GeometryCollection(e)},ol.geom.MultiLineString.prototype.calcCSpline_=function(t){for(var e=[],o=this.getLineStrings(),i=0;i<o.length;i++)e.push(o[i].cspline(t).getCoordinates());return new ol.geom.MultiLineString(e)},ol.geom.Polygon.prototype.calcCSpline_=function(t){for(var e=[],o=this.getCoordinates(),i=0;i<o.length;i++)e.push(new ol.geom.LineString(o[i]).cspline(t).getCoordinates());return new ol.geom.Polygon(e)},ol.geom.MultiPolygon.prototype.calcCSpline_=function(t){for(var e=[],o=this.getPolygons(),i=0;i<o.length;i++)e.push(o[i].cspline(t).getCoordinates());return new ol.geom.MultiPolygon(e)},ol.coordinate.cspline=function(t,e){e||(e={});var o="number"==typeof e.tension?e.tension:.5,i=0,n=t[0];t.forEach((function(t){i+=ol.coordinate.dist2d(n,t),n=t}));var r,a,s,l,c,h,u,p,d,f,g,m,y,v,b=e.resolution||i/t.length/(e.pointsPerSeg||10),_=[];function S(t,e,o,i){var n=o-t,r=i-e;return Math.sqrt(n*n+r*r)}for(r=t.slice(0),t.length>2&&t[0][0]==t[t.length-1][0]&&t[0][1]==t[t.length-1][1]?(r.unshift(t[t.length-2]),r.push(t[1])):(r.unshift(t[0]),r.push(t[t.length-1])),v=1;v<r.length-2;v++){var w=S(r[v][0],r[v][1],r[v+1][0],r[v+1][1]),x=Math.round(w/b),L=1;if(e.normalize){w=S(r[v+1][0],r[v+1][1],r[v-1][0],r[v-1][1]);var M=S(r[v+2][0],r[v+2][1],r[v][0],r[v][1]);L=w<M?w/M:M/w}for(l=(r[v+1][0]-r[v-1][0])*o*L,c=(r[v+2][0]-r[v][0])*o*L,h=(r[v+1][1]-r[v-1][1])*o*L,u=(r[v+2][1]-r[v][1])*o*L,y=0;y<=x;y++)m=y/x,p=2*Math.pow(m,3)-3*Math.pow(m,2)+1,d=-2*Math.pow(m,3)+3*Math.pow(m,2),f=Math.pow(m,3)-2*Math.pow(m,2)+m,g=Math.pow(m,3)-Math.pow(m,2),a=p*r[v][0]+d*r[v+1][0]+f*l+g*c,s=p*r[v][1]+d*r[v+1][1]+f*h+g*u,a&&s&&_.push([a,s])}return _},ol.geom.LineString.prototype.calcCSpline_=function(t){var e=this.getCoordinates(),o=ol.coordinate.cspline(e,t);return new ol.geom.LineString(o)},ol.HexGrid=function(t){t=t||{},ol.Object.call(this,t),this.size_=t.size||8e4,this.origin_=t.origin||[0,0],this.layout_=this.layout[t.layout]||this.layout.pointy},ol.ext.inherits(ol.HexGrid,ol.Object),ol.HexGrid.prototype.layout={pointy:[Math.sqrt(3),Math.sqrt(3)/2,0,1.5,Math.sqrt(3)/3,-1/3,0,2/3,Math.cos(Math.PI/180*30),Math.sin(Math.PI/180*30),Math.cos(Math.PI/180*90),Math.sin(Math.PI/180*90),Math.cos(Math.PI/180*150),Math.sin(Math.PI/180*150),Math.cos(Math.PI/180*210),Math.sin(Math.PI/180*210),Math.cos(Math.PI/180*270),Math.sin(Math.PI/180*270),Math.cos(Math.PI/180*330),Math.sin(Math.PI/180*330)],flat:[1.5,0,Math.sqrt(3)/2,Math.sqrt(3),2/3,0,-1/3,Math.sqrt(3)/3,Math.cos(Math.PI/180*0),Math.sin(Math.PI/180*0),Math.cos(Math.PI/180*60),Math.sin(Math.PI/180*60),Math.cos(Math.PI/180*120),Math.sin(Math.PI/180*120),Math.cos(Math.PI/180*180),Math.sin(Math.PI/180*180),Math.cos(Math.PI/180*240),Math.sin(Math.PI/180*240),Math.cos(Math.PI/180*300),Math.sin(Math.PI/180*300)]},ol.HexGrid.prototype.setLayout=function(t){this.layout_=this.layout[t]||this.layout.pointy,this.changed()},ol.HexGrid.prototype.getLayout=function(){return 0!=this.layout_[9]?"pointy":"flat"},ol.HexGrid.prototype.setOrigin=function(t){this.origin_=t,this.changed()},ol.HexGrid.prototype.getOrigin=function(){return this.origin_},ol.HexGrid.prototype.setSize=function(t){this.size_=t||8e4,this.changed()},ol.HexGrid.prototype.getSize=function(){return this.size_},ol.HexGrid.prototype.cube2hex=function(t){return[t[0],t[2]]},ol.HexGrid.prototype.hex2cube=function(t){return[t[0],-t[0]-t[1],t[1]]},ol.HexGrid.prototype.hex2offset=function(t){return this.layout_[9]?[t[0]+(t[1]-(1&t[1]))/2,t[1]]:[t[0],t[1]+(t[0]+(1&t[0]))/2]},ol.HexGrid.prototype.offset2hex=function(t){return this.layout_[9]?[t[0]-(t[1]-(1&t[1]))/2,t[1]]:[t[0],t[1]-(t[0]+(1&t[0]))/2]},ol.HexGrid.prototype.cube_round=function(t){var e=Math.round(t[0]),o=Math.round(t[1]),i=Math.round(t[2]),n=Math.abs(e-t[0]),r=Math.abs(o-t[1]),a=Math.abs(i-t[2]);return n>r&&n>a?e=-o-i:r>a?o=-e-i:i=-e-o,[e,o,i]},ol.HexGrid.prototype.hex_round=function(t){return this.cube2hex(this.cube_round(this.hex2cube(t)))},ol.HexGrid.prototype.hex_corner=function(t,e,o){return[t[0]+e*this.layout_[8+o%6*2],t[1]+e*this.layout_[9+o%6*2]]},ol.HexGrid.prototype.getHexagonAtCoord=function(t){return this.getHexagon(this.coord2hex(t))},ol.HexGrid.prototype.getHexagon=function(t){for(var e=[],o=this.hex2coord(t),i=0;i<=7;i++)e.push(this.hex_corner(o,this.size_,i,this.layout_[8]));return e},ol.HexGrid.prototype.hex2coord=function(t){return[this.origin_[0]+this.size_*(this.layout_[0]*t[0]+this.layout_[1]*t[1]),this.origin_[1]+this.size_*(this.layout_[2]*t[0]+this.layout_[3]*t[1])]},ol.HexGrid.prototype.coord2hex=function(t){var e=[(t[0]-this.origin_[0])/this.size_,(t[1]-this.origin_[1])/this.size_],o=this.layout_[4]*e[0]+this.layout_[5]*e[1],i=this.layout_[6]*e[0]+this.layout_[7]*e[1];return this.hex_round([o,i])},ol.HexGrid.prototype.cube_distance=function(t,e){return Math.max(Math.abs(t[0]-e[0]),Math.abs(t[1]-e[1]),Math.abs(t[2]-e[2]))},function(){function t(t,e,o){return t+(e-t)*o}function e(e,o,i){return[t(e[0]+1e-6,o[0],i),t(e[1]+1e-6,o[1],i),t(e[2]+1e-6,o[2],i)]}ol.HexGrid.prototype.cube_line=function(t,o){var i=this.cube_distance(t,o);if(!i)return[t];for(var n=[],r=0;r<=i;r++)n.push(this.cube_round(e(t,o,r/i)));return n}}(),ol.HexGrid.prototype.neighbors={cube:[[1,-1,0],[1,0,-1],[0,1,-1],[-1,1,0],[-1,0,1],[0,-1,1]],hex:[[1,0],[1,-1],[0,-1],[-1,0],[-1,1],[0,1]]},ol.HexGrid.prototype.hex_neighbors=function(t,e){if(void 0!==e)return[t[0]+this.neighbors.hex[e%6][0],t[1]+this.neighbors.hex[e%6][1]];var o=[];for(e=0;e<6;e++)o.push([t[0]+this.neighbors.hex[e][0],t[1]+this.neighbors.hex[e][1]]);return o},ol.HexGrid.prototype.cube_neighbors=function(t,e){if(void 0!==e)return[t[0]+this.neighbors.cube[e%6][0],t[1]+this.neighbors.cube[e%6][1],t[2]+this.neighbors.cube[e%6][2]];var o=[];for(e=0;e<6;e++)o.push([t[0]+this.neighbors.cube[e][0],t[1]+this.neighbors.cube[e][1],t[2]+this.neighbors.cube[e][2]]);for(e=0;e<6;e++)o[e]=this.cube2hex(o[e]);return o},ol.InseeGrid=function(t){t=t||{},proj4.defs["EPSG:3035"]||(proj4.defs("EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"),ol.proj.proj4.register(proj4)),ol.Object.call(this,t);var e=Math.max(200,200*Math.round((t.size||0)/200));this.set("size",e)},ol.ext.inherits(ol.InseeGrid,ol.Object),ol.InseeGrid.extent=[32e5,2e6,43e5,314e4],ol.InseeGrid.prototype.getExtent=function(t){return ol.proj.transformExtent(ol.InseeGrid.extent,t||"EPSG:3035","EPSG:3857")},ol.InseeGrid.prototype.getGridAtCoordinate=function(t,e){var o=ol.proj.transform(t,e||"EPSG:3857","EPSG:3035"),i=this.get("size"),n=Math.floor(o[0]/i)*i,r=Math.floor(o[1]/i)*i,a=new ol.geom.Polygon([[[n,r],[n+i,r],[n+i,r+i],[n,r+i],[n,r]]]);return a.transform("EPSG:3035",e||"EPSG:3857"),a},ol.Map.prototype.markup=function(t,e){var o,i=this;(e=e||{}).projection&&(t=ol.proj.transform(t,e.projection,this.getView().getProjection()));var n=(new Date).getTime(),r=e.delay||3e3,a=1e3,s=e.maxZoom||100,l=ol.easing.easeOut,c=e.style;return c||(c=new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:"red",width:2})})),c instanceof ol.style.Image&&(c=new ol.style.Style({image:c})),c instanceof Array||(c=[c]),setTimeout((function(){o&&i.renderSync()}),r),o=this.on("postcompose",function(e){var i=e.frameState,h=i.time-n;if(h>r+a)ol.Observable.unByKey(o),o=null;else{r>h&&this.getView().getZoom()>s&&(r=h);var u=i.pixelRatio,p=0;h>r&&(p=(h-r)/a);var d=e.context;d.save(),d.beginPath(),d.globalAlpha=l(1-p);for(var f=0;f<c.length;f++){var g=c[f].getImage(),m=g.getScale();g.setScale(m*u),e.vectorContext.setStyle(c[f]),e.vectorContext.drawGeometry(new ol.geom.Point(t)),g.setScale(m)}d.restore(),h>=r&&(i.animate=!0)}}.bind(this)),this.renderSync(),o.stop=function(){r=a=0,this.target.renderSync()},o},ol.ordering={},ol.ordering.yOrdering=function(){return function(t,e){return e.getGeometry().getExtent()[1]-t.getGeometry().getExtent()[1]}},ol.ordering.zIndex=function(t){t||(t={});var e=t.attribute||"zIndex";return t.equalFn?function(o,i){return o.get(e)==i.get(e)?t.equalFn(o,i):o.get(e)<i.get(e)?1:-1}:function(t,o){return t.get(e)==o.get(e)?0:t.get(e)<o.get(e)?1:-1}},ol.Map.prototype.pulse=function(t,e){var o;(e=e||{}).projection&&(t=ol.proj.transform(t,e.projection,this.getView().getProjection()));var i=(new Date).getTime(),n=e.duration||3e3,r=e.easing||ol.easing.easeOut,a=e.style;a||(a=new ol.style.Circle({radius:30,stroke:new ol.style.Stroke({color:"red",width:2})})),a instanceof ol.style.Image&&(a=new ol.style.Style({image:a})),a instanceof Array||(a=[a]);var s=e.amplitude||1;s<0&&(s=0);var l=e.radius||15;l<0&&(l=5),o=this.on("postcompose",function(e){var l=e.frameState,c=l.pixelRatio,h=l.time-i;if(h>n)ol.Observable.unByKey(o);else{var u=h/n,p=e.context;p.save(),p.beginPath();var d=r(u);p.globalAlpha=r(1-u),console.log("anim");for(var f=0;f<a.length;f++){var g=a[f].getImage(),m=g.getScale();g.setScale(c*m*(1+s*(d-1))),e.vectorContext.setStyle(a[f]),e.vectorContext.drawGeometry(new ol.geom.Point(t)),g.setScale(m)}p.restore(),l.animate=!0}}.bind(this)),this.renderSync()},ol.style.Chart=function(t){var e=t||{},o=0;t.stroke&&(o=t.stroke.getWidth()),ol.style.RegularShape.call(this,{radius:e.radius+o,fill:new ol.style.Fill({color:[0,0,0]}),rotation:e.rotation,snapToPixel:e.snapToPixel}),e.scale&&this.setScale(e.scale),this._stroke=e.stroke,this._radius=e.radius||20,this._donutratio=e.donutRatio||.5,this._type=e.type,this._offset=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this._animation="number"==typeof e.animation?{animate:!0,step:e.animation}:this._animation={animate:!1,step:1},this._max=e.max,this._data=e.data,e.colors instanceof Array?this._colors=e.colors:(this._colors=ol.style.Chart.colors[e.colors],this._colors||(this._colors=ol.style.Chart.colors.classic)),this.renderChart_()},ol.ext.inherits(ol.style.Chart,ol.style.RegularShape),ol.style.Chart.colors={classic:["#ffa500","blue","red","green","cyan","magenta","yellow","#0f0"],dark:["#960","#003","#900","#060","#099","#909","#990","#090"],pale:["#fd0","#369","#f64","#3b7","#880","#b5d","#666"],pastel:["#fb4","#79c","#f66","#7d7","#acc","#fdd","#ff9","#b9b"],neon:["#ff0","#0ff","#0f0","#f0f","#f00","#00f"]},ol.style.Chart.prototype.clone=function(){var t=new ol.style.Chart({type:this._type,radius:this._radius,rotation:this.getRotation(),scale:this.getScale(),data:this.getData(),snapToPixel:!!this.getSnapToPixel&&this.getSnapToPixel(),stroke:this._stroke,colors:this._colors,offsetX:this._offset[0],offsetY:this._offset[1],animation:this._animation});return t.setScale(this.getScale()),t.setOpacity(this.getOpacity()),t},ol.style.Chart.prototype.getData=function(){return this._data},ol.style.Chart.prototype.setData=function(t){this._data=t,this.renderChart_()},ol.style.Chart.prototype.getRadius=function(){return this._radius},ol.style.Chart.prototype.setRadius=function(t,e){this._radius=t,this.donuratio_=e||this.donuratio_,this.renderChart_()},ol.style.Chart.prototype.setAnimation=function(t){if(!1===t){if(0==this._animation.animate)return;this._animation.animate=!1}else{if(this._animation.step==t)return;this._animation.animate=!0,this._animation.step=t}this.renderChart_()},ol.style.Chart.prototype.renderChart_=function(t){if(t){var e,o=0;this._stroke&&(e=ol.color.asString(this._stroke.getColor()),o=this._stroke.getWidth());var i=this.getImage(t),n=i.getContext("2d");n.clearRect(0,0,i.width,i.height),n.lineJoin="round";var r,a,s=0;for(r=0;r<this._data.length;r++)s+=this._data[r];n.save(),n.setTransform(t,0,0,t,0,0),n.translate(0,0);var l=this._animation.animate?this._animation.step:1;switch(this._type){case"donut":case"pie3D":case"pie":var c,h=Math.PI*(l-1.5);for(a=i.width/2/t,n.strokeStyle=e,n.lineWidth=o,n.save(),"pie3D"==this._type&&(n.translate(0,.3*a),n.scale(1,.7),n.beginPath(),n.fillStyle="#369",n.arc(a,1.4*a,this._radius*l,0,2*Math.PI),n.fill(),n.stroke()),"donut"==this._type&&(n.save(),n.beginPath(),n.rect(0,0,2*a,2*a),n.arc(a,a,this._radius*l*this._donutratio,0,2*Math.PI),n.clip("evenodd")),r=0;r<this._data.length;r++)n.beginPath(),n.moveTo(a,a),n.fillStyle=this._colors[r%this._colors.length],c=h+2*Math.PI*this._data[r]/s*l,n.arc(a,a,this._radius*l,h,c),n.closePath(),n.fill(),n.stroke(),h=c;"donut"==this._type&&(n.restore(),n.beginPath(),n.strokeStyle=e,n.lineWidth=o,n.arc(a,a,this._radius*l*this._donutratio,Math.PI*(l-1.5),h),n.stroke()),n.restore();break;case"bar":default:var u=0;if(this._max)u=this._max;else for(r=0;r<this._data.length;r++)u<this._data[r]&&(u=this._data[r]);var p=Math.min(5,2*this._radius/this._data.length);a=i.width/2/t;var d,f=i.width/t-o,g=a-this._data.length*p/2;for(n.strokeStyle=e,n.lineWidth=o,r=0;r<this._data.length;r++){n.beginPath(),n.fillStyle=this._colors[r%this._colors.length],d=g+p;var m=this._data[r]/u*2*this._radius*l;n.rect(g,f-m,p,m),n.closePath(),n.fill(),n.stroke(),g=d}}n.restore();var y=this.getAnchor();y[0]=a-this._offset[0],y[1]=a-this._offset[1]}else this.getPixelRatio?(t=window.devicePixelRatio,this.renderChart_(t),this.getPixelRatio&&1!==t&&this.renderChart_(1)):this.renderChart_(1)},ol.style.FillPattern=function(t){var e;t||(t={});var o=this.canvas_=document.createElement("canvas"),i=(Number(t.scale)>0?Number(t.scale):1)*ol.has.DEVICE_PIXEL_RATIO||ol.has.DEVICE_PIXEL_RATIO,n=o.getContext("2d");if(t.image){var r;t.image.load();var a=t.image.getImage();if(a.width)o.width=Math.round(a.width*i),o.height=Math.round(a.height*i),n.globalAlpha="number"==typeof t.opacity?t.opacity:1,n.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),e=n.createPattern(o,"repeat");else{var s=this;e=[0,0,0,0],a.onload=function(){o.width=Math.round(a.width*i),o.height=Math.round(a.height*i),n.globalAlpha="number"==typeof t.opacity?t.opacity:1,n.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),e=n.createPattern(o,"repeat"),s.setColor(e)}}}else{var l=this.getPattern_(t);if(o.width=Math.round(l.width*i),o.height=Math.round(l.height*i),n.beginPath(),t.fill&&(n.fillStyle=ol.color.asString(t.fill.getColor()),n.fillRect(0,0,o.width,o.height)),n.scale(i,i),n.lineCap="round",n.lineWidth=l.stroke||1,n.fillStyle=ol.color.asString(t.color||"#000"),n.strokeStyle=ol.color.asString(t.color||"#000"),l.circles)for(r=0;r<l.circles.length;r++){var c=l.circles[r];n.beginPath(),n.arc(c[0],c[1],c[2],0,2*Math.PI),l.fill&&n.fill(),l.stroke&&n.stroke()}if(l.repeat||(l.repeat=[[0,0]]),l.char&&(n.font=l.font||l.width+"px Arial",n.textAlign="center",n.textBaseline="middle",l.angle?(n.fillText(l.char,l.width/4,l.height/4),n.fillText(l.char,5*l.width/4,5*l.height/4),n.fillText(l.char,l.width/4,5*l.height/4),n.fillText(l.char,5*l.width/4,l.height/4),n.fillText(l.char,3*l.width/4,3*l.height/4),n.fillText(l.char,-l.width/4,-l.height/4),n.fillText(l.char,3*l.width/4,-l.height/4),n.fillText(l.char,-l.width/4,3*l.height/4)):n.fillText(l.char,l.width/2,l.height/2)),l.lines)for(r=0;r<l.lines.length;r++)for(var h=0;h<l.repeat.length;h++){var u=l.lines[r];n.beginPath(),n.moveTo(u[0]+l.repeat[h][0],u[1]+l.repeat[h][1]);for(var p=2;p<u.length;p+=2)n.lineTo(u[p]+l.repeat[h][0],u[p+1]+l.repeat[h][1]);l.fill&&n.fill(),l.stroke&&n.stroke(),n.save(),n.strokeStyle="red",n.strokeWidth=.1,n.restore()}if(e=n.createPattern(o,"repeat"),t.offset){var d=t.offset;if("number"==typeof d&&(d=[d,d]),d instanceof Array){var f=Math.round(d[0]*i),g=Math.round(d[1]*i);n.scale(1/i,1/i),n.clearRect(0,0,o.width,o.height),n.translate(f,g),n.fillStyle=e,n.fillRect(-f,-g,o.width,o.height),e=n.createPattern(o,"repeat")}}}ol.style.Fill.call(this,{color:e})},ol.ext.inherits(ol.style.FillPattern,ol.style.Fill),ol.style.FillPattern.prototype.clone=function(){var t=ol.style.Fill.prototype.clone.call(this);return t.canvas_=this.canvas_,t},ol.style.FillPattern.prototype.getImage=function(){return this.canvas_},ol.style.FillPattern.prototype.getPattern_=function(t){var e,o=ol.style.FillPattern.prototype.patterns[t.pattern]||ol.style.FillPattern.prototype.patterns.dot,i=Math.round(t.spacing)||10;switch(t.pattern){case"dot":case"circle":e=0===t.size?0:t.size/2||2,t.angle?(i=o.width=o.height=Math.round(1.4*i),o.circles=[[i/4,i/4,e],[3*i/4,3*i/4,e]],"circle"==t.pattern&&(o.circles=o.circles.concat([[i/4+i,i/4,e],[i/4,i/4+i,e],[3*i/4-i,3*i/4,e],[3*i/4,3*i/4-i,e],[i/4+i,i/4+i,e],[3*i/4-i,3*i/4-i,e]]))):(o.width=o.height=i,o.circles=[[i/2,i/2,e]],"circle"==t.pattern&&(o.circles=o.circles.concat([[i/2+i,i/2,e],[i/2-i,i/2,e],[i/2,i/2+i,e],[i/2,i/2-i,e],[i/2+i,i/2+i,e],[i/2+i,i/2-i,e],[i/2-i,i/2+i,e],[i/2-i,i/2-i,e]])));break;case"tile":case"square":e=0===t.size?0:t.size/2||2,t.angle?(o.width=o.height=i,o.lines=[[i/2-e,i/2,i/2,i/2-e,i/2+e,i/2,i/2,i/2+e,i/2-e,i/2]]):(o.width=o.height=i,o.lines=[[i/2-e,i/2-e,i/2+e,i/2-e,i/2+e,i/2+e,i/2-e,i/2+e,i/2-e,i/2-e]]),"square"==t.pattern&&(o.repeat=[[0,0],[0,i],[i,0],[0,-i],[-i,0],[-i,-i],[i,i],[-i,i],[i,-i]]);break;case"cross":t.angle&&(t.angle=45);case"hatch":var n=Math.round(((t.angle||0)-90)%360);n>180&&(n-=360),n*=Math.PI/180;var r=Math.cos(n),a=Math.sin(n);if(Math.abs(a)<1e-4)o.width=o.height=i,o.lines=[[0,.5,i,.5]],o.repeat=[[0,0],[0,i]];else if(Math.abs(r)<1e-4)o.width=o.height=i,o.lines=[[.5,0,.5,i]],o.repeat=[[0,0],[i,0]],"cross"==t.pattern&&(o.lines.push([0,.5,i,.5]),o.repeat.push([0,i]));else{var s=o.width=Math.round(Math.abs(i/a))||1,l=o.height=Math.round(Math.abs(i/r))||1;"cross"==t.pattern?(o.lines=[[-s,-l,2*s,2*l],[2*s,-l,-s,2*l]],o.repeat=[[0,0]]):r*a>0?(o.lines=[[-s,-l,2*s,2*l]],o.repeat=[[0,0],[s,0],[0,l]]):(o.lines=[[2*s,-l,-s,2*l]],o.repeat=[[0,0],[-s,0],[0,l]])}o.stroke=0===t.size?0:t.size||4}return o},ol.style.FillPattern.addPattern=function(t,e){e||(e={}),ol.style.FillPattern.prototype.patterns[t||e.char]={width:e.width||e.size||10,height:e.height||e.size||10,font:e.font,char:e.char,circles:e.circles,lines:e.lines,repeat:e.repeat,stroke:e.stroke,angle:e.angle,fill:e.fill}},ol.style.FillPattern.prototype.patterns={hatch:{width:5,height:5,lines:[[0,2.5,5,2.5]],stroke:1},cross:{width:7,height:7,lines:[[0,3,10,3],[3,0,3,10]],stroke:1},dot:{width:8,height:8,circles:[[5,5,2]],stroke:!1,fill:!0},circle:{width:10,height:10,circles:[[5,5,2]],stroke:1,fill:!1},square:{width:10,height:10,lines:[[3,3,3,8,8,8,8,3,3,3]],stroke:1,fill:!1},tile:{width:10,height:10,lines:[[3,3,3,8,8,8,8,3,3,3]],fill:!0},woven:{width:12,height:12,lines:[[3,3,9,9],[0,12,3,9],[9,3,12,0],[-1,1,1,-1],[13,11,11,13]],stroke:1},crosses:{width:8,height:8,lines:[[2,2,6,6],[2,6,6,2]],stroke:1},caps:{width:8,height:8,lines:[[2,6,4,2,6,6]],stroke:1},nylon:{width:20,height:20,lines:[[1,6,1,1,6,1],[6,11,11,11,11,6],[11,16,11,21,16,21],[16,11,21,11,21,16]],repeat:[[0,0],[-20,0],[0,-20]],stroke:1},hexagon:{width:20,height:12,lines:[[0,10,4,4,10,4,14,10,10,16,4,16,0,10]],stroke:1,repeat:[[0,0],[10,6],[10,-6],[-10,-6]]},cemetry:{width:15,height:19,lines:[[0,3.5,7,3.5],[3.5,0,3.5,10]],stroke:1,repeat:[[0,0],[7,9]]},sand:{width:20,height:20,circles:[[1,2,1],[9,3,1],[2,16,1],[7,8,1],[6,14,1],[4,19,1],[14,2,1],[12,10,1],[14,18,1],[18,8,1],[18,14,1]],fill:1},conglomerate:{width:30,height:20,circles:[[2,4,1],[17,3,1],[26,18,1],[12,17,1],[5,17,2],[28,11,2]],lines:[[7,5,6,7,9,9,11,8,11,6,9,5,7,5],[16,10,15,13,16,14,19,15,21,13,22,9,20,8,19,8,16,10],[24,6,26,7,27,5,26,4,24,4,24,6]],stroke:1},gravel:{width:15,height:10,circles:[[4,2,1],[5,9,1],[1,7,1]],lines:[[7,5,6,6,7,7,8,7,9,7,10,5,9,4,7,5],[11,2,14,4,14,1,12,1,11,2]],stroke:1},brick:{width:18,height:16,lines:[[0,1,18,1],[0,10,18,10],[6,1,6,10],[12,10,12,18],[12,0,12,1]],stroke:1},dolomite:{width:20,height:16,lines:[[0,1,20,1],[0,9,20,9],[1,9,6,1],[11,9,14,16],[14,0,14.4,1]],stroke:1},coal:{width:20,height:16,lines:[[1,5,7,1,7,7],[11,10,12,5,18,9],[5,10,2,15,9,15],[15,16,15,13,20,16],[15,0,15,2,20,0]],fill:1},breccia:{width:20,height:16,lines:[[1,5,7,1,7,7,1,5],[11,10,12,5,18,9,11,10],[5,10,2,15,9,15,5,10],[15,16,15,13,22,18],[15,0,15,2,20,0]],stroke:1},clay:{width:20,height:20,lines:[[0,0,3,11,0,20],[11,0,10,3,13,13,11,20],[0,0,10,3,20,0],[0,12,3,11,13,13,20,12]],stroke:1},flooded:{width:15,height:10,lines:[[0,1,10,1],[0,6,5,6],[10,6,15,6]],stroke:1},chaos:{width:40,height:40,lines:[[40,2,40,0,38,0,40,2],[4,0,3,2,2,5,0,0,0,3,2,7,5,6,7,7,8,10,9,12,9,13,9,14,8,14,6,15,2,15,0,20,0,22,2,20,5,19,8,15,10,14,11,12.25,10,12,10,10,12,9,13,7,12,6,13,4,16,7,17,4,20,0,18,0,15,3,14,2,14,0,12,1,11,0,10,1,11,4,10,7,9,8,8,5,6,4,5,3,5,1,5,0,4,0],[7,1,7,3,8,3,8,2,7,1],[4,3,5,5,4,5,4,3],[34,5,33,7,38,10,38,8,36,5,34,5],[27,0,23,2,21,8,30,0,27,0],[25,8,26,12,26,16,22.71875,15.375,20,13,18,15,17,18,13,22,17,21,19,22,21,20,19,18,22,17,30,25,26,26,24,28,21.75,33.34375,20,36,18,40,20,40,24,37,25,32,27,31,26,38,27,37,30,32,32,35,36,37,38,40,38,39,40,40,37,36,34,32,37,31,36,29,33,27,34,24,39,21,40,21,40,16,37,20,31,22,32,25,27,20,29,15,30,20,32,20,34,18,33,12,31,11,29,14,26,9,25,8],[39,24,37,26,40,28,39,24],[13,15,9,19,14,18,13,15],[18,23,14,27,16,27,17,25,20,26,18,23],[6,24,2,26,1,28,2,30,5,28,12,30,16,32,18,30,15,30,12,28,9,25,7,27,6,24],[29,27,32,28,33,31,30,29,27,28,29,27],[5,35,1,33,3,36,13,38,15,35,10,36,5,35]],fill:1},grass:{width:27,height:22,lines:[[0,10.5,13,10.5],[2.5,10,1.5,7],[4.5,10,4.5,5,3.5,4],[7,10,7.5,6,8.5,3],[10,10,11,6]],repeat:[[0,0],[14,10]],stroke:1},swamp:{width:24,height:23,lines:[[0,10.5,9.5,10.5],[2.5,10,2.5,7],[4.5,10,4.5,4],[6.5,10,6.5,6],[3,12.5,7,12.5]],repeat:[[0,0],[14,10]],stroke:1},wave:{width:10,height:8,lines:[[0,0,5,4,10,0]],stroke:1},vine:{width:13,height:13,lines:[[3,0,3,6],[9,7,9,13]],stroke:1},forest:{width:55,height:30,circles:[[7,7,3.5],[20,20,1.5],[42,22,3.5],[35,5,1.5]],stroke:1},scrub:{width:26,height:20,lines:[[1,4,4,8,6,4]],circles:[[20,13,1.5]],stroke:1},tree:{width:30,height:30,lines:[[7.78,10.61,4.95,10.61,4.95,7.78,3.54,7.78,2.12,6.36,.71,6.36,0,4.24,.71,2.12,4.24,0,7.78,.71,9.19,3.54,7.78,4.95,7.07,7.07,4.95,7.78]],repeat:[[3,1],[18,16]],stroke:1},pine:{width:30,height:30,lines:[[5.66,11.31,2.83,11.31,2.83,8.49,0,8.49,2.83,0,5.66,8.49,2.83,8.49]],repeat:[[3,1],[18,16]],stroke:1},pines:{width:22,height:20,lines:[[1,4,3.5,1,6,4],[1,8,3.5,5,6,8],[3.5,1,3.5,11],[12,14.5,14.5,14,17,14.5],[12,18,17,18],[14.5,12,14.5,18]],repeat:[[2,1]],stroke:1},rock:{width:20,height:20,lines:[[1,0,1,9],[4,0,4,9],[7,0,7,9],[10,1,19,1],[10,4,19,4],[10,7,19,7],[0,11,9,11],[0,14,9,14],[0,17,9,17],[12,10,12,19],[15,10,15,19],[18,10,18,19]],repeat:[[.5,.5]],stroke:1},rocks:{width:20,height:20,lines:[[5,0,3,0,5,4,4,6,0,3,0,5,3,6,5,9,3.75,10,2.5,10,0,9,0,10,4,11,5,14,4,15,0,13,0,13,0,13,0,14,0,14,5,16,5,18,3,19,0,19,-.25,19.9375,5,20,10,19,10,20,11,20,12,19,14,20,15,20,17,19,20,20,20,19,19,16,20,15,20,11,20,10,19,8,20,5,20,0,19,0,20,2,19,4,17,4,16,3,15,0,14,0,15,4,11,5,10,4,11,0,10,0,9,4,6,5,5,0],[18,5,19,6,18,10,16,10,14,9,16,5,18,5],[5,6,9,5,10,6,10,9,6,10,5,6],[14,5,14,8,13,9,12,9,11,7,12,5,14,5],[5,11,8,10,9,11,10,14,6,15,6,15,5,11],[13,10,14,11,15,14,15,14,15,14,11,15,10,11,11,10,13,10],[15,12,16,11,19,11,19,15,16,14,16,14,15,12],[6,16,9,15,10,18,5,19,6,16],[10,16,14,16,14,18,13,19,11,18,10,16],[15,15,18,16,18,18,16,19,15,18,15,15]],stroke:1}},ol.style.FlowLine=function(t){t||(t={}),ol.style.Style.call(this,{renderer:this._render.bind(this),stroke:t.stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this._visible=!1!==t.visible,"function"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),"function"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1)},ol.ext.inherits(ol.style.FlowLine,ol.style.Style),ol.style.FlowLine.prototype.setWidth=function(t){this._width=t||0},ol.style.FlowLine.prototype.setWidth2=function(t){this._width2=t},ol.style.FlowLine.prototype.getOffset=function(t){return this._offset[t]},ol.style.FlowLine.prototype.setOffset=function(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}},ol.style.FlowLine.prototype.setLineCap=function(t){this._lineCap="round"===t?"round":"butt"},ol.style.FlowLine.prototype.getWidth=function(t,e){if(this._widthFn)return this._widthFn(t,e);var o="number"==typeof this._width2?this._width2:this._width;return this._width+(o-this._width)*e},ol.style.FlowLine.prototype.setColor=function(t){try{this._color=ol.color.asArray(t)}catch(t){this._color=[0,0,0,1]}},ol.style.FlowLine.prototype.setColor2=function(t){try{this._color2=ol.color.asArray(t)}catch(t){this._color2=null}},ol.style.FlowLine.prototype.setArrowColor=function(t){try{this._acolor=ol.color.asString(t)}catch(t){this._acolor=null}},ol.style.FlowLine.prototype.getColor=function(t,e){if(this._colorFn)return ol.color.asString(this._colorFn(t,e));var o=this._color,i=this._color2||this._color;return"rgba("+ +Math.round(o[0]+(i[0]-o[0])*e)+","+Math.round(o[1]+(i[1]-o[1])*e)+","+Math.round(o[2]+(i[2]-o[2])*e)+","+(o[3]+(i[3]-o[3])*e)+")"},ol.style.FlowLine.prototype.getArrow=function(){return this._arrow},ol.style.FlowLine.prototype.setArrow=function(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)},ol.style.FlowLine.prototype.getArrowSize=function(){return this._arrowSize||[16,16]},ol.style.FlowLine.prototype.setArrowSize=function(t){Array.isArray(t)?this._arrowSize=t:"number"==typeof t&&(this._arrowSize=[t,t])},ol.style.FlowLine.prototype.drawArrow=function(t,e,o,i,n){var r=this.getArrowSize()[0]*n,a=ol.coordinate.dist2d(e,o),s=(e[0]-o[0])/a,l=(e[1]-o[1])/a;i=Math.max(this.getArrowSize()[1]/2,i/2)*n,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-r*s+i*l,e[1]-r*l-i*s),t.lineTo(e[0]-r*s-i*l,e[1]-r*l+i*s),t.lineTo(e[0],e[1]),t.fill()},ol.style.FlowLine.prototype._render=function(t,e){if("LineString"===e.geometry.getType()){var o,i,n,r=e.context;if(!this._visible){var a=e.pixelRatio/e.resolution,s=Math.cos(e.rotation),l=Math.sin(e.rotation);i=e.geometry.getCoordinates();var c=t[0][0]-i[0][0]*a*s-i[0][1]*a*l,h=t[0][1]-i[0][0]*a*l+i[0][1]*a*s;for(t=[],o=0;n=i[o];o++)t[o]=[c+n[0]*a*s+n[1]*a*l,h+n[0]*a*l-n[1]*a*s,n[2]]}var u=this.getArrowSize()[0]*e.pixelRatio;r.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(n=this._splitAsize(t,u),this._acolor?r.fillStyle=this._acolor:r.fillStyle=this.getColor(e.feature,0),this.drawArrow(r,n[0],n[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(n=this._splitAsize(t,u,!0),this._acolor?r.fillStyle=this._acolor:r.fillStyle=this.getColor(e.feature,1),this.drawArrow(r,n[0],n[1],this.getWidth(e.feature,1),e.pixelRatio));var p=this._splitInto(t,255,2),d=0,f=p.length;if(r.lineJoin="round",r.lineCap=this._lineCap||"butt",p.length>1)for(d=0;d<p.length;d++){var g=d/f;for(i=p[d],r.lineWidth=this.getWidth(e.feature,g)*e.pixelRatio,r.strokeStyle=this.getColor(e.feature,g),r.beginPath(),r.moveTo(i[0][0],i[0][1]),o=1;n=i[o];o++)r.lineTo(n[0],n[1]);r.stroke()}r.restore()}},ol.style.FlowLine.prototype._splitAsize=function(t,e,o){var i,n,r,a,s=0;for(i=r=o?t.pop():t.shift();t.length;){if(n=o?t.pop():t.shift(),s+(a=ol.coordinate.dist2d(i,n))>e){i=[i[0]+(n[0]-i[0])*(e-s)/a,i[1]+(n[1]-i[1])*(e-s)/a],a=ol.coordinate.dist2d(i,r),o?(t.push(n),t.push(i),t.push([i[0]+(r[0]-i[0])/a,i[1]+(r[1]-i[1])/a])):(t.unshift(n),t.unshift(i),t.unshift([i[0]+(r[0]-i[0])/a,i[1]+(r[1]-i[1])/a]));break}s+=a,i=n}return[r,i]},ol.style.FlowLine.prototype._splitInto=function(t,e,o){var i,n,r,a=[],s=0;for(i=1;n=t[i];i++)s+=ol.coordinate.dist2d(t[i-1],n);var l=Math.max(o||2,s/(e||255)),c=t[0];s=0;var h=[c];for(i=1,n=t[1];i<t.length;){var u=n[0]-c[0],p=n[1]-c[1];if(s+(r=Math.sqrt(u*u+p*p))>l){var d=(l-s)/r;h.push([c[0]+u*d,c[1]+p*d]),a.push(h),h=[c=[c[0]+u*d*.9,c[1]+p*d*.9]],s=0}else s+=r,c=n,h.push(c),n=t[++i]}return a.push(h),a},ol.style.FontSymbol=function(t){var e=0;(t=t||{}).stroke&&(e=t.stroke.getWidth()),ol.style.RegularShape.call(this,{radius:t.radius,fill:t.fill,rotation:t.rotation,rotateWithView:t.rotateWithView}),"number"==typeof t.opacity&&this.setOpacity(t.opacity),this.color_=t.color,this.fontSize_=t.fontSize||1,this.fontStyle_=t.fontStyle||"",this.stroke_=t.stroke,this.fill_=t.fill,this.radius_=t.radius-e,this.form_=t.form||"none",this.gradient_=t.gradient,this.offset_=[t.offsetX?t.offsetX:0,t.offsetY?t.offsetY:0],this.glyph_=this.getGlyph(t.glyph)||"",this.renderMarker_()},ol.ext.inherits(ol.style.FontSymbol,ol.style.RegularShape),ol.style.Image.prototype.getImagePNG=function(){var t=this.getImage();if(!t)return!1;try{return t.toDataURL("image/png")}catch(t){return!1}},ol.style.FontSymbol.prototype.defs={fonts:{},glyphs:{}},ol.style.FontSymbol.addDefs=function(t,e){var o=t;if("string"==typeof t&&(o={font:t,name:t,copyright:""}),o.font&&"string"==typeof o.font){var i=o.font;for(var n in ol.style.FontSymbol.prototype.defs.fonts[i]=o,e){var r=e[n];"string"==typeof r&&1==r.length&&(r={char:r}),ol.style.FontSymbol.prototype.defs.glyphs[n]={font:o.font,char:r.char||""+String.fromCharCode(r.code)||"",theme:r.theme||o.name,name:r.name||n,search:r.search||""}}}else console.log("bad font def")},ol.style.FontSymbol.prototype.clone=function(){var t=new ol.style.FontSymbol({glyph:"",color:this.color_,fontSize:this.fontSize_,fontStyle:this.fontStyle_,stroke:this.stroke_,fill:this.fill_,radius:this.radius_+(this.stroke_?this.stroke_.getWidth():0),form:this.form_,gradient:this.gradient_,offsetX:this.offset_[0],offsetY:this.offset_[1],opacity:this.getOpacity(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()});return t.setScale(this.getScale()),t.glyph_=this.glyph_,t.renderMarker_(),t},ol.style.FontSymbol.prototype.getFill=function(){return this.fill_},ol.style.FontSymbol.prototype.getStroke=function(){return this.stroke_},ol.style.FontSymbol.prototype.getGlyph=function(t){return t?ol.style.FontSymbol.prototype.defs.glyphs[t]||{font:"none",char:t.charAt(0),theme:"none",name:"none",search:""}:this.glyph_},ol.style.FontSymbol.prototype.getGlyphName=function(){for(var t in ol.style.FontSymbol.prototype.defs.glyphs)if(ol.style.FontSymbol.prototype.defs.glyphs[t]===this.glyph_)return t;return""},ol.style.FontSymbol.prototype.getFontInfo=function(t){return ol.style.FontSymbol.prototype.defs.fonts[t.font]},ol.style.FontSymbol.prototype.renderMarker_=function(t){if(t){var e,o=0;this.stroke_&&(e=ol.color.asString(this.stroke_.getColor()),o=this.stroke_.getWidth());var i=this.getImage(t),n={strokeStyle:e,strokeWidth:o,size:i.width/t},r=i.getContext("2d");r.clearRect(0,0,i.width,i.height),this.drawMarker_(n,r,0,0,t);var a=this.getAnchor();a[0]=i.width/2-this.offset_[0],a[1]=i.width/2-this.offset_[1]}else this.getPixelRatio?(t=window.devicePixelRatio,this.renderMarker_(t),this.getPixelRatio&&1!==t&&this.renderMarker_(1)):this.renderMarker_(1)},ol.style.FontSymbol.prototype.drawPath_=function(t,e){var o=2*this.radius_+t.strokeWidth+1,i=t.strokeWidth/2,n=t.size/2,r={fac:1,posX:t.size/2,posY:t.size/2};switch(e.lineJoin="round",e.beginPath(),this.form_){case"none":r.fac=1;break;case"circle":case"ban":e.arc(n,n,o/2,0,2*Math.PI,!0);break;case"poi":e.arc(n,n-.4*this.radius_,.6*this.radius_,.15*Math.PI,.85*Math.PI,!0),e.lineTo(n-.89*.05*o,(.95+.45*.05)*o+i),e.arc(n,.95*o+i,.05*o,.85*Math.PI,.15*Math.PI,!0),r={fac:.45,posX:n,posY:n-.35*this.radius_};break;case"bubble":e.arc(n,n-.2*this.radius_,.8*this.radius_,.4*Math.PI,.6*Math.PI,!0),e.lineTo(.5*o+i,o+i),r={fac:.7,posX:n,posY:n-.2*this.radius_};break;case"marker":e.arc(n,n-.2*this.radius_,.8*this.radius_,.25*Math.PI,.75*Math.PI,!0),e.lineTo(.5*o+i,o+i),r={fac:.7,posX:n,posY:n-.2*this.radius_};break;case"coma":e.moveTo(n+.8*this.radius_,n-.2*this.radius_),e.quadraticCurveTo(.95*o+i,.75*o+i,.5*o+i,o+i),e.arc(n,n-.2*this.radius_,.8*this.radius_,.45*Math.PI,0,!1),r={fac:.7,posX:n,posY:n-.2*this.radius_};break;default:var a;switch(this.form_){case"shield":a=[.05,0,.95,0,.95,.8,.5,1,.05,.8,.05,0],r.posY=.45*o+i;break;case"blazon":a=[.1,0,.9,0,.9,.8,.6,.8,.5,1,.4,.8,.1,.8,.1,0],r.fac=.8,r.posY=.4*o+i;break;case"bookmark":a=[.05,0,.95,0,.95,1,.5,.8,.05,1,.05,0],r.fac=.9,r.posY=.4*o+i;break;case"hexagon":a=[.05,.2,.5,0,.95,.2,.95,.8,.5,1,.05,.8,.05,.2],r.fac=.9,r.posY=.5*o+i;break;case"diamond":a=[.25,0,.75,0,1,.2,1,.4,.5,1,0,.4,0,.2,.25,0],r.fac=.75,r.posY=.35*o+i;break;case"triangle":a=[0,0,1,0,.5,1,0,0],r.fac=.6,r.posY=.3*o+i;break;case"sign":a=[.5,.05,1,.95,0,.95,.5,.05],r.fac=.7,r.posY=.65*o+i;break;case"lozenge":a=[.5,0,1,.5,.5,1,0,.5,.5,0],r.fac=.7;break;case"square":default:a=[0,0,1,0,1,1,0,1,0,0]}for(var s=0;s<a.length;s+=2)e.lineTo(a[s]*o+i,a[s+1]*o+i)}return e.closePath(),r},ol.style.FontSymbol.prototype.drawMarker_=function(t,e,o,i,n){var r=this.fill_?this.fill_.getColor():"#000",a=this.stroke_?this.stroke_.getColor():"#000";"none"==this.form_&&this.stroke_&&this.fill_&&(a=this.fill_.getColor(),r=this.stroke_.getColor()),e.setTransform(n,0,0,n,0,0),e.translate(o,i);var s=this.drawPath_(t,e,n);if(this.fill_){if(this.gradient_&&"none"!=this.form_){var l=e.createLinearGradient(0,0,t.size/2,t.size);l.addColorStop(1,ol.color.asString(r)),l.addColorStop(0,ol.color.asString(a)),e.fillStyle=l}else e.fillStyle=ol.color.asString(r);e.fill()}if(this.stroke_&&t.strokeWidth&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.stroke()),this.glyph_.char){e.font=this.fontStyle_+" "+2*s.fac*this.radius_*this.fontSize_+"px "+this.glyph_.font,e.strokeStyle=e.fillStyle,e.lineWidth=t.strokeWidth*("none"==this.form_?2:1),e.fillStyle=ol.color.asString(this.color_||a),e.textAlign="center",e.textBaseline="middle";var c=this.glyph_.char;t.strokeWidth&&"transparent"!=a&&e.strokeText(c,s.posX,s.posY),e.fillText(c,s.posX,s.posY)}if("ban"==this.form_&&this.stroke_&&t.strokeWidth){e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth;var h=this.radius_+t.strokeWidth,u=this.radius_*Math.cos(Math.PI/4);e.moveTo(h+u,h-u),e.lineTo(h-u,h+u),e.stroke()}},ol.style.FontSymbol.prototype.getChecksum=function(){var t=null!==this.stroke_?this.stroke_.getChecksum():"-",e=null!==this.fill_?this.fill_.getChecksum():"-";if(null===this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.form_+"-"+this.glyphs_!=this.checksums_[4]){var o="c"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+this.form_+"-"+this.glyphs_;this.checksums_=[o,t,e,this.radius_,this.form_+"-"+this.glyphs_]}return this.checksums_[0]},ol.style.Photo=function(t){t=t||{},this.sanchor_="anchored"==t.kind?8:0,this._shadow=Number(t.shadow)||0,t.stroke||(t.stroke=new ol.style.Stroke({width:0,color:"#000"}));var e=t.stroke.getWidth();e<0&&(e=0),"folio"==t.kind&&(e+=6),t.stroke.setWidth(e),ol.style.RegularShape.call(this,{radius:t.radius+e+this.sanchor_/2+this._shadow/2,points:0});var o=this.getImage();if(!this.hitDetectionCanvas_)for(var i in this)if(this[i]&&this[i].getContext&&this[i]!==o){this.hitDetectionCanvas_=this[i];break}this.hitDetectionCanvas_=document.createElement("canvas"),this.hitDetectionCanvas_.width=o.width,this.hitDetectionCanvas_.height=o.height,this._stroke=t.stroke,this._fill=t.fill,this._crop=t.crop,this._crossOrigin=t.crossOrigin,this._kind=t.kind||"default",this._radius=t.radius,this._src=t.src,this._offset=[t.offsetX?t.offsetX:0,t.offsetY?t.offsetY:0],this._onload=t.onload,"number"==typeof t.opacity&&this.setOpacity(t.opacity),"number"==typeof t.rotation&&this.setRotation(t.rotation),this.renderPhoto_()},ol.ext.inherits(ol.style.Photo,ol.style.RegularShape),ol.style.Photo.prototype.setOffset=function(t){this._offset=[t[0]||0,t[1]||0],this.renderPhoto_()},ol.style.Photo.prototype.clone=function(){var t=new ol.style.Photo({stroke:this._stroke,fill:this._fill,shadow:this._shadow,crop:this._crop,crossOrigin:this._crossOrigin,kind:this._kind,radius:this._radius,src:this._src,offsetX:this._offset[0],offsetY:this._offset[1],opacity:this.getOpacity(),rotation:this.getRotation()});return t.renderPhoto_(),t},CanvasRenderingContext2D.prototype.roundRect=function(t,e,o,i,n){return n?(o<2*n&&(n=o/2),i<2*n&&(n=i/2),this.beginPath(),this.moveTo(t+n,e),this.arcTo(t+o,e,t+o,e+i,n),this.arcTo(t+o,e+i,t,e+i,n),this.arcTo(t,e+i,t,e,n),this.arcTo(t,e,t+o,e,n),this.closePath()):this.rect(t,e,o,i),this},ol.style.Photo.prototype.drawBack_=function(t,e,o,i){var n=this._shadow,r=t.canvas;t.beginPath(),t.fillStyle=e,t.clearRect(0,0,r.width,r.height);var a=r.width/i,s=r.height/i;switch(this._kind){case"square":t.rect(0,0,a-n,s-n);break;case"circle":t.arc(this._radius+o,this._radius+o,this._radius+o,0,2*Math.PI,!1);break;case"folio":o-=6,t.strokeStyle="rgba(0,0,0,0.5)",t.lineWidth=1;var l=a-n-12,c=Math.atan(6/l);t.save(),t.rotate(-c),t.translate(-6,2),t.beginPath(),t.rect(6,6,l,l),t.stroke(),t.fill(),t.restore(),t.save(),t.translate(6,-1),t.rotate(c),t.beginPath(),t.rect(6,6,l,l),t.stroke(),t.fill(),t.restore(),t.beginPath(),t.rect(6,6,l,l),t.stroke();break;case"anchored":t.roundRect(this.sanchor_/2,0,a-this.sanchor_-n,s-this.sanchor_-n,o),t.moveTo(a/2-this.sanchor_-n/2,s-this.sanchor_-n),t.lineTo(a/2+this.sanchor_-n/2,s-this.sanchor_-n),t.lineTo(a/2-n/2,s-n);break;default:t.roundRect(0,0,a-n,s-n,o)}t.closePath()},ol.style.Photo.prototype.renderPhoto_=function(t){if(t){var e,o=0;this._stroke&&(e=ol.color.asString(this._stroke.getColor()),o=this._stroke.getWidth());var i=this.getImage(t),n=this.hitDetectionCanvas_.getContext("2d");this.drawBack_(n,"#000",o,1),n.fill(),(n=i.getContext("2d")).save(),n.setTransform(t,0,0,t,0,0),this.drawBack_(n,e,o,t),this._shadow&&(n.shadowColor="rgba(0,0,0,0.5)",n.shadowBlur=t*this._shadow/2,n.shadowOffsetX=t*this._shadow/2,n.shadowOffsetY=t*this._shadow/2),n.fill(),n.restore();var r=this,a=this.img_=new Image;this._crossOrigin&&(a.crossOrigin=this._crossOrigin),a.src=this._src,a.width?r.drawImage_(a):a.onload=function(){r.drawImage_(a),r._onload&&r._onload()};var s=this.getAnchor();s[0]=(i.width/t-this._shadow)/2-this._offset[0],this.sanchor_?s[1]=i.height/t-this._shadow-this._offset[1]:s[1]=(i.height/t-this._shadow)/2-this._offset[1]}else this.getPixelRatio?(t=window.devicePixelRatio,this.renderPhoto_(t)):this.renderPhoto_(1)},ol.style.Photo.prototype.drawImage_=function(t){var e=window.devicePixelRatio,o=this.getImage(e).getContext("2d"),i=0;this._stroke&&(i=this._stroke.getWidth());var n,r,a,s,l,c,h,u,p,d=2*this._radius;o.save(),"circle"==this._kind&&(o.beginPath(),o.arc(this._radius+i,this._radius+i,this._radius,0,2*Math.PI,!1),o.clip()),this._crop?(u=p=(n=Math.min(t.width/d,t.height/d))*d,c=(t.width-u)/2,h=(t.height-p)/2,r=a=0,s=l=d+1):(c=h=0,r=(d-(s=(n=Math.min(d/t.width,d/t.height))*(u=t.width)))/2,a=(d-(l=n*(p=t.height)))/2),r+=i+this.sanchor_/2,a+=i,o.drawImage(t,c,h,u,p,r,a,s,l),o.restore(),"circle"==this._kind&&i&&(o.beginPath(),o.strokeStyle=ol.color.asString(this._stroke.getColor()),o.lineWidth=i/4,o.arc(this._radius+i,this._radius+i,this._radius,0,2*Math.PI,!1),o.stroke())},ol.style.Profile=function(t){t||(t={}),ol.style.Style.call(this,{renderer:this._render.bind(this),zIndex:t.zIndex,geometry:t.geometry}),this.setStroke(t.stroke),this.setFill(t.fill),this.setScale(t.scale)},ol.ext.inherits(ol.style.Profile,ol.style.Style),ol.style.Profile.prototype.setStroke=function(t){this._stroke=t||new ol.style.Stroke({color:"#fff",width:1})},ol.style.Profile.prototype.getStroke=function(){return this._stroke},ol.style.Profile.prototype.setFill=function(t){this._fill=t||new ol.style.Fill({color:"rgba(255,255,255,.3"})},ol.style.Profile.prototype.getFill=function(){return this._fill},ol.style.Profile.prototype.setScale=function(t){this._scale=t||.2},ol.style.Profile.prototype.getScale=function(){return this._scale},ol.style.Profile.prototype._render=function(t,e){if(/Z/.test(e.feature.getGeometry().getLayout())){var o=e.geometry.getCoordinates();switch(e.geometry.getType()){case"LineString":this._renderLine(t,o,e.feature.getGeometry(),e);break;case"MultiLineString":e.feature.getGeometry().getLineStrings().forEach(function(i,n){this._renderLine(t[n],o[n],i,e)}.bind(this))}}},ol.style.Profile.prototype._renderLine=function(t,e,o,i){var n,r,a=i.context,s=Math.cos(i.rotation),l=Math.sin(i.rotation),c=ol.coordinate.dist2d(t[0],t[1])/ol.coordinate.dist2d(e[0],e[1]),h=t[0][0]-e[0][0]*c*s-e[0][1]*c*l,u=t[0][1]-e[0][0]*c*l+e[0][1]*c*s;t=o.getCoordinates();var p=1/0;for(n=0;r=t[n];n++){var d=h+r[0]*c*s+r[1]*c*l,f=u+r[0]*c*l-r[1]*c*s;p=Math.min(p,r[2]),t[n]=[d,f,r[2]]}a.save(),a.fillStyle=ol.color.asString(this.getFill().getColor()),a.strokeStyle=ol.color.asString(this.getStroke().getColor()),a.strokeWidth=this.getStroke().getWidth();var g=t[0],m=this.getScale()*i.pixelRatio;for(n=1;r=t[n];n++)a.beginPath(),a.moveTo(g[0],g[1]),a.lineTo(r[0],r[1]),a.lineTo(r[0],r[1]-(r[2]-p)*m),a.lineTo(g[0],g[1]-(g[2]-p)*m),a.lineTo(g[0],g[1]),a.fill(),g=r;for(g=t[0],a.beginPath(),a.moveTo(g[0],g[1]-(g[2]-p)*m),n=1;r=t[n];n++)a.lineTo(r[0],r[1]-(r[2]-p)*m);a.stroke(),a.restore()},function(){function t(t){if(!(t.frameState.viewState.resolution>this.textPathMaxResolution_)){var e,o=t.frameState.extent,i=t.frameState.coordinateToPixelTransform,n=t.context;n.save(),n.scale(t.frameState.pixelRatio,t.frameState.pixelRatio);for(var r,a=this.getSource().getFeaturesInExtent(o),s=0;r=a[s];s++)for(var l,c=this.textPathStyle_(r,t.frameState.viewState.resolution),h=0;l=c[h];h++){var u,p=l.getGeometry()||r.getGeometry();switch(p.getType()){case"LineString":u=p.getCoordinates();break;case"MultiLineString":u=p.getLineString(0).getCoordinates();break;default:continue}var d=l.getText(),f=g(u,d.getRotateWithView());n.font=d.getFont(),n.textBaseline=d.getTextBaseline(),n.textAlign=d.getTextAlign(),n.lineWidth=d.getStroke()&&d.getStroke().getWidth()||0,n.strokeStyle=d.getStroke()&&d.getStroke().getColor()||"#fff",n.fillStyle=d.getFill()&&d.getFill().getColor()||"#000",n.textJustify="justify"==d.getTextAlign(),n.textOverflow=d.getTextOverflow?d.getTextOverflow():"",n.minWidth=d.getMinWidth?d.getMinWidth():0,n.textPath(d.getText()||r.get("name"),f)}n.restore()}function g(t,o){var n=[];for(e=0;e<t.length;e++)n.push(i[0]*t[e][0]+i[1]*t[e][1]+i[4]),n.push(i[2]*t[e][0]+i[3]*t[e][1]+i[5]);if(o&&n[0]>n[n.length-2]){var r=[];for(e=n.length-2;e>=0;e-=2)r.push(n[e]),r.push(n[e+1]);return r}return n}}ol.layer.Vector.prototype.setTextPathStyle=function(e,o){if(null===e)return this.textPath_&&this.unByKey(this.textPath_),this.textPath_=null,void this.changed();this.textPath_||(this.textPath_=this.on(["postcompose","postrender"],t.bind(this))),void 0===e&&(e=[new ol.style.Style({text:new ol.style.Text})]),this.textPathStyle_="function"==typeof e?e:function(){return e},this.textPathMaxResolution_=Number(o)||Number.MAX_VALUE,this.changed()},ol.style.TextPath=function(t){t||(t={}),ol.style.Text.call(this,t),this.textOverflow_=void 0!==t.textOverflow?t.textOverflow:"visible",this.minWidth_=t.minWidth||0},ol.ext.inherits(ol.style.TextPath,ol.style.Text),ol.style.TextPath.prototype.getTextOverflow=function(){return this.textOverflow_},ol.style.TextPath.prototype.getMinWidth=function(){return this.minWidth_}}(),CanvasRenderingContext2D.prototype.textPath=function(t,e){var o=this;function i(t,e,o,i){var n=o-t,r=i-e;return Math.sqrt(n*n+r*r)}var n,r=0,a=2;function s(t,e){if(!n||r+n<e)for(;a<t.length&&(n=i(t[a-2],t[a-1],t[a],t[a+1]),!(r+n>e))&&!((a+=2)>=t.length);)r+=n;var o,s,l,c=e-r;return a>=t.length&&(a=t.length-2),c?(o=t[a-2]+(t[a]-t[a-2])*c/n,s=t[a-1]+(t[a+1]-t[a-1])*c/n,l=Math.atan2(t[a+1]-t[a-1],t[a]-t[a-2])):(o=t[a-2],s=t[a-1],l=Math.atan2(t[a+1]-t[a-1],t[a]-t[a-2])),[o,s,l]}for(var l=.25*o.measureText(" ").width,c=0,h=0,u=2;u<e.length;u+=2)h+=i(e[u-2],e[u-1],e[u],e[u+1]);if(!(h<o.minWidth)){var p=t.split(" ").length-1;if("visible"!=o.textOverflow&&h<o.measureText(t).width+(t.length-1+p)*l){var d="ellipsis"==o.textOverflow?"…":o.textOverflow;do{p=t.split(" ").length-1,t=t.slice(0,t.length-1)}while(t&&h<o.measureText(t+d).width+(t.length+d.length-1+p)*l);t+=d}switch(o.textJustify||o.textAlign){case!0:case"center":case"end":case"right":o.textJustify?(c=0,l=(h-o.measureText(t).width)/(t.length-1+p)):(c=h-o.measureText(t).width-(t.length+p)*l,"center"==o.textAlign&&(c/=2))}for(var f=0;f<t.length;f++){var g=t[f],m=o.measureText(g).width,y=s(e,c+m/2);o.save(),o.textAlign="center",o.translate(y[0],y[1]),o.rotate(y[2]),o.lineWidth&&o.strokeText(g,0,0),o.fillText(g,0,0),o.restore(),c+=m+l*(" "==g?2:1)}}},ol.style.Shadow=function(t){(t=t||{}).fill||(t.fill=new ol.style.Fill({color:"rgba(0,0,0,0.5)"})),ol.style.RegularShape.call(this,{radius:t.radius,fill:t.fill}),this._fill=t.fill,this._radius=t.radius,this._blur=0===t.blur?0:t.blur||t.radius/3,this._offset=[t.offsetX?t.offsetX:0,t.offsetY?t.offsetY:0],this.renderShadow_()},ol.ext.inherits(ol.style.Shadow,ol.style.RegularShape),ol.style.Shadow.prototype.clone=function(){var t=new ol.style.Shadow({fill:this._fill,radius:this._radius,blur:this._blur,offsetX:this._offset[0],offsetY:this._offset[1]});return t.setScale(this.getScale()),t.setOpacity(this.getOpacity()),t},ol.style.Shadow.prototype.renderShadow_=function(t){if(t){var e=this._radius,o=this.getImage(t),i=o.getContext("2d");i.clearRect(0,0,o.width,o.height),i.save(),i.beginPath(),i.setTransform(t,0,0,t,0,0),i.scale(1,.5),i.arc(e,-e,e-this._blur,0,2*Math.PI,!1),i.fillStyle="#000",i.shadowColor=this._fill.getColor(),i.shadowBlur=.7*this._blur*t,i.shadowOffsetX=0,i.shadowOffsetY=1.5*e*t,i.closePath(),i.fill(),i.shadowColor="transparent",i.restore();var n=this.getAnchor();n[0]=o.width/2-this._offset[0],n[1]=o.height/2-this._offset[1]}else this.getPixelRatio?(t=window.devicePixelRatio,this.renderShadow_(t),this.getPixelRatio&&1!==t&&this.renderShadow_(1)):this.renderShadow_(1)},ol.style.StrokePattern=function(t){var e,o;t||(t={});var i=this.canvas_=document.createElement("canvas"),n=(Number(t.scale)>0?Number(t.scale):1)*ol.has.DEVICE_PIXEL_RATIO||ol.has.DEVICE_PIXEL_RATIO,r=i.getContext("2d");if(t.image){t.image.load();var a=t.image.getImage();if(a.width)i.width=Math.round(a.width*n),i.height=Math.round(a.height*n),r.globalAlpha="number"==typeof t.opacity?t.opacity:1,r.drawImage(a,0,0,a.width,a.height,0,0,i.width,i.height),e=r.createPattern(i,"repeat");else{var s=this;e=[0,0,0,0],a.onload=function(){i.width=Math.round(a.width*n),i.height=Math.round(a.height*n),r.globalAlpha="number"==typeof t.opacity?t.opacity:1,r.drawImage(a,0,0,a.width,a.height,0,0,i.width,i.height),e=r.createPattern(i,"repeat"),s.setColor(e)}}}else{var l=this.getPattern_(t);if(i.width=Math.round(l.width*n),i.height=Math.round(l.height*n),r.beginPath(),t.fill&&(r.fillStyle=ol.color.asString(t.fill.getColor()),r.fillRect(0,0,i.width,i.height)),r.scale(n,n),r.lineCap="round",r.lineWidth=l.stroke||1,r.fillStyle=ol.color.asString(t.color||"#000"),r.strokeStyle=ol.color.asString(t.color||"#000"),l.circles)for(o=0;o<l.circles.length;o++){var c=l.circles[o];r.beginPath(),r.arc(c[0],c[1],c[2],0,2*Math.PI),l.fill&&r.fill(),l.stroke&&r.stroke()}if(l.repeat||(l.repeat=[[0,0]]),l.char&&(r.font=l.font||l.width+"px Arial",r.textAlign="center",r.textBaseline="middle",l.angle?(r.fillText(l.char,l.width/4,l.height/4),r.fillText(l.char,5*l.width/4,5*l.height/4),r.fillText(l.char,l.width/4,5*l.height/4),r.fillText(l.char,5*l.width/4,l.height/4),r.fillText(l.char,3*l.width/4,3*l.height/4),r.fillText(l.char,-l.width/4,-l.height/4),r.fillText(l.char,3*l.width/4,-l.height/4),r.fillText(l.char,-l.width/4,3*l.height/4)):r.fillText(l.char,l.width/2,l.height/2)),l.lines)for(o=0;o<l.lines.length;o++)for(var h=0;h<l.repeat.length;h++){var u=l.lines[o];r.beginPath(),r.moveTo(u[0]+l.repeat[h][0],u[1]+l.repeat[h][1]);for(var p=2;p<u.length;p+=2)r.lineTo(u[p]+l.repeat[h][0],u[p+1]+l.repeat[h][1]);l.fill&&r.fill(),l.stroke&&r.stroke(),r.save(),r.strokeStyle="red",r.strokeWidth=.1,r.restore()}if(e=r.createPattern(i,"repeat"),t.offset){var d=t.offset;if("number"==typeof d&&(d=[d,d]),d instanceof Array){var f=Math.round(d[0]*n),g=Math.round(d[1]*n);r.scale(1/n,1/n),r.clearRect(0,0,i.width,i.height),r.translate(f,g),r.fillStyle=e,r.fillRect(-f,-g,i.width,i.height),e=r.createPattern(i,"repeat")}}}t.color=e,ol.style.Stroke.call(this,t)},ol.ext.inherits(ol.style.StrokePattern,ol.style.Stroke),ol.style.StrokePattern.prototype.clone=function(){var t=ol.style.Fill.prototype.clone.call(this);return t.canvas_=this.canvas_,t},ol.style.StrokePattern.prototype.getImage=function(){return this.canvas_},ol.style.StrokePattern.prototype.getPattern_=function(t){var e,o=ol.style.FillPattern.prototype.patterns[t.pattern]||ol.style.FillPattern.prototype.patterns.dot,i=Math.round(t.spacing)||10;switch(t.pattern){case"dot":case"circle":e=0===t.size?0:t.size/2||2,t.angle?(i=o.width=o.height=Math.round(1.4*i),o.circles=[[i/4,i/4,e],[3*i/4,3*i/4,e]],"circle"==t.pattern&&(o.circles=o.circles.concat([[i/4+i,i/4,e],[i/4,i/4+i,e],[3*i/4-i,3*i/4,e],[3*i/4,3*i/4-i,e],[i/4+i,i/4+i,e],[3*i/4-i,3*i/4-i,e]]))):(o.width=o.height=i,o.circles=[[i/2,i/2,e]],"circle"==t.pattern&&(o.circles=o.circles.concat([[i/2+i,i/2,e],[i/2-i,i/2,e],[i/2,i/2+i,e],[i/2,i/2-i,e],[i/2+i,i/2+i,e],[i/2+i,i/2-i,e],[i/2-i,i/2+i,e],[i/2-i,i/2-i,e]])));break;case"tile":case"square":e=0===t.size?0:t.size/2||2,t.angle?(o.width=o.height=i,o.lines=[[i/2-e,i/2,i/2,i/2-e,i/2+e,i/2,i/2,i/2+e,i/2-e,i/2]]):(o.width=o.height=i,o.lines=[[i/2-e,i/2-e,i/2+e,i/2-e,i/2+e,i/2+e,i/2-e,i/2+e,i/2-e,i/2-e]]),"square"==t.pattern&&(o.repeat=[[0,0],[0,i],[i,0],[0,-i],[-i,0],[-i,-i],[i,i],[-i,i],[i,-i]]);break;case"cross":t.angle&&(t.angle=45);case"hatch":var n=Math.round(((t.angle||0)-90)%360);n>180&&(n-=360),n*=Math.PI/180;var r=Math.cos(n),a=Math.sin(n);if(Math.abs(a)<1e-4)o.width=o.height=i,o.lines=[[0,.5,i,.5]],o.repeat=[[0,0],[0,i]];else if(Math.abs(r)<1e-4)o.width=o.height=i,o.lines=[[.5,0,.5,i]],o.repeat=[[0,0],[i,0]],"cross"==t.pattern&&(o.lines.push([0,.5,i,.5]),o.repeat.push([0,i]));else{var s=o.width=Math.round(Math.abs(i/a))||1,l=o.height=Math.round(Math.abs(i/r))||1;"cross"==t.pattern?(o.lines=[[-s,-l,2*s,2*l],[2*s,-l,-s,2*l]],o.repeat=[[0,0]]):r*a>0?(o.lines=[[-s,-l,2*s,2*l]],o.repeat=[[0,0],[s,0],[0,l]]):(o.lines=[[2*s,-l,-s,2*l]],o.repeat=[[0,0],[-s,0],[0,l]])}o.stroke=0===t.size?0:t.size||4}return o},ol.style.Style.defaultStyle,a=[255,255,255,1],s=[0,153,255,1],l=[new ol.style.Style({stroke:new ol.style.Stroke({color:a,width:5})}),new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:s}),stroke:new ol.style.Stroke({color:a,width:1.5})}),stroke:new ol.style.Stroke({color:s,width:3}),fill:new ol.style.Fill({color:[255,255,255,.5]})})],ol.style.Style.defaultStyle=function(t){if(!0===t)return l;t=t||{};var e=new ol.style.Fill({color:t.fillColor||"rgba(255,255,255,0.4)"}),o=new ol.style.Stroke({color:t.color||"#3399CC",width:1.25});return[new ol.style.Style({image:new ol.style.Circle({fill:e,stroke:o,radius:5}),fill:e,stroke:o})]},ol.style.geoportailStyle,function(){var t={},e=0;function o(o){var i=function(t){if(o.vert&&t.get("itineraire_vert"))return t.get("position_par_rapport_au_sol")<0?[0,128,0,.7]:t.get("position_par_rapport_au_sol")>0?[0,100,0,1]:[0,128,0,1];if(!t.get("importance"))return"magenta";if("Piste cyclable"===t.get("nature"))return[27,177,27,.5];if("0"!=t.get("position_par_rapport_au_sol")){var e;switch(t.get("importance")){case"1":e=[177,27,177,1];break;case"2":e=[177,27,27,1];break;case"3":e=[217,119,0,1];break;case"4":e=[255,225,0,1];break;case"5":e=[204,204,204,1];break;default:e=[211,211,211,1]}return t.get("position_par_rapport_au_sol")<0&&(e[3]=.7),e}switch(t.get("importance")){case"1":return[255,0,255,1];case"2":return[255,0,0,1];case"3":return[255,165,0,1];case"4":return[255,255,0,1];case"5":return[255,255,255,1];default:return[211,211,211,1]}},n=function(t){return Math.max(t.get("largeur_de_chaussee")||2,2)},r=function(t){if(!t.get("position_par_rapport_au_sol"))return 100;var e=Number(t.get("position_par_rapport_au_sol"));return e>0?10+10*e-(Number(t.get("importance"))||10):e<0?Math.max(4+e,0):10-(Number(t.get("importance"))||10)},a=function(t){return o.sens&&!/double|sans/i.test(t.get("sens_de_circulation"))?new ol.style.Text({text:"Sens direct"==t.get("sens_de_circulation")?"→":"←",font:"bold 12px sans-serif",placement:"point",textAlign:"center",fill:new ol.style.Fill({color:[0,0,0,.3]}),stroke:new ol.style.Stroke({color:[0,0,0,.3],width:1.5}),rotateWithView:!0}):null},s=function(t){switch(t.get("nature")){case"Escalier":return[1,4];case"Sentier":return[8,10]}},l="ROUT-"+e+++"-";return function(e,c){var h=!0===o.sens||c<o.sens,u=l+e.get("nature")+"-"+e.get("position_par_rapport_au_sol")+"-"+(h?e.get("sens_de_circulation"):"Sans objet")+"-"+e.get("position_par_rapport_au_sol")+"-"+e.get("importance")+"-"+e.get("largeur_de_chaussee")+"-"+e.get("itineraire_vert"),p=t[u];return p||(p=t[u]=[new ol.style.Style({text:h?a(e):null,stroke:new ol.style.Stroke({color:i(e),width:n(e),lineDash:s(e)}),zIndex:r(e)-100})]),p[0].getText()&&p[0].getText().setRotation(function(t){for(var e,o,i=t.getCoordinates(),n=0,r=t.getLength(),a=0;a<i.length-1&&(e=i[a+1][0]-i[a][0],o=i[a+1][1]-i[a][1],!((n+=Math.sqrt(e*e+o*o))>=r/2));a++);return-Math.atan2(o,e)}(e.getGeometry())),p}}var i={111:{color:[230,0,77,255],title:"Continuous urban fabric"},112:{color:[255,0,0,255],title:"Discontinuous urban fabric"},121:{color:[204,77,242,255],title:"Industrial or commercial units"},122:{color:[204,0,0,255],title:"Road and rail networks and associated land"},123:{color:[230,204,204,255],title:"Port areas"},124:{color:[230,204,230,255],title:"Airports"},131:{color:[166,0,204,255],title:"Mineral extraction sites"},132:{color:[166,77,0,255],title:"Dump sites"},133:{color:[255,77,255,255],title:"Construction sites"},141:{color:[255,166,255,255],title:"Green urban areas"},142:{color:[255,230,255,255],title:"Sport and leisure facilities"},211:{color:[255,255,168,255],title:"Non-irrigated arable land"},212:{color:[255,255,0,255],title:"Permanently irrigated land"},213:{color:[230,230,0,255],title:"Rice fields"},221:{color:[230,128,0,255],title:"Vineyards"},222:{color:[242,166,77,255],title:"Fruit trees and berry plantations"},223:{color:[230,166,0,255],title:"Olive groves"},231:{color:[230,230,77,255],title:"Pastures"},241:{color:[255,230,166,255],title:"Annual crops associated with permanent crops"},242:{color:[255,230,77,255],title:"Complex cultivation patterns"},243:{color:[230,204,77,255],title:"Land principally occupied by agriculture with significant areas of natural vegetation"},244:{color:[242,204,166,255],title:"Agro-forestry areas"},311:{color:[128,255,0,255],title:"Broad-leaved forest"},312:{color:[0,166,0,255],title:"Coniferous forest"},313:{color:[77,255,0,255],title:"Mixed forest"},321:{color:[204,242,77,255],title:"Natural grasslands"},322:{color:[166,255,128,255],title:"Moors and heathland"},323:{color:[166,230,77,255],title:"Sclerophyllous vegetation"},324:{color:[166,242,0,255],title:"Transitional woodland-shrub"},331:{color:[230,230,230,255],title:"Beaches dunes sands"},332:{color:[204,204,204,255],title:"Bare rocks"},333:{color:[204,255,204,255],title:"Sparsely vegetated areas"},334:{color:[0,0,0,255],title:"Burnt areas"},335:{color:[166,230,204,255],title:"Glaciers and perpetual snow"},411:{color:[166,166,255,255],title:"Inland marshes"},412:{color:[77,77,255,255],title:"Peat bogs"},421:{color:[204,204,255,255],title:"Salt marshes"},422:{color:[230,230,255,255],title:"Salines"},423:{color:[166,166,230,255],title:"Intertidal flats"},511:{color:[0,204,242,255],title:"Water courses"},512:{color:[128,242,230,255],title:"Water bodies"},521:{color:[0,255,166,255],title:"Coastal lagoons"},522:{color:[166,255,230,255],title:"Estuaries"},523:{color:[230,242,255,255],title:"Sea and ocean"}};ol.style.geoportailStyle=function(n,r){switch(r=r||{},n){case"BDTOPO_V3:troncon_de_route":return o(r);case"BDTOPO_V3:batiment":return function(o){var i="BATI-"+e+++"-";return function(e){if(e.get("detruit"))return[];var n=i+e.get("usage_1")+"-"+e.get("nature")+"-"+e.get("etat_de_l_objet"),r=t[n];if(!r){var a=function(t){switch(t.get("nature")){case"Industriel, agricole ou commercial":return[51,102,153,1];case"Remarquable":return[0,192,0,1];default:switch(t.get("usage_1")){case"Résidentiel":case"Indifférencié":return[128,128,128,1];case"Industriel":case"Commercial et services":return[51,102,153,1];case"Sportif":return[51,153,102,1];case"Religieux":return[153,102,51,1];default:return[153,51,51,1]}}}(e),s=[a[0],a[1],a[1],.5],l=!/en service/i.test(e.get("etat_de_l_objet"));l&&(s[3]=.1);var c=o.symbol?function(t){switch(t.get("usage_1")){case"Commercial et services":return"";case"Sportif":return"";default:return null}}(e):null;return[new ol.style.Style({text:c?new ol.style.Text({text:c,font:"12px FontAwesome",fill:new ol.style.Fill({color:[0,0,0,.6]})}):null,fill:new ol.style.Fill({color:s}),stroke:new ol.style.Stroke({color:a,width:1.5,lineDash:l?[5,5]:null})})]}return r}}(r);case"CADASTRALPARCELS.PARCELLAIRE_EXPRESS:parcelle":return function(t){var e=new ol.style.Style({text:new ol.style.Text({text:"0000",font:"bold 12px sans-serif",fill:new ol.style.Fill({color:[100,0,255,1]}),stroke:new ol.style.Stroke({color:[255,255,255,.8],width:3})}),stroke:new ol.style.Stroke({color:[255,165,0,1],width:1.5}),fill:new ol.style.Fill({color:[100,0,255,.1]})});return function(o,i){return i<.8?e.getText().setFont("bold 12px sans-serif"):e.getText().setFont("bold 10px sans-serif"),t.section?e.getText().setText(o.get("section")+"-"+(o.get("numero")||"").replace(/^0*/,"")):e.getText().setText((o.get("numero")||"").replace(/^0*/,"")),e}}(r);default:return/LANDCOVER/.test(n)?(r.date=n.replace(/[^\d]*(\d*).*/,"$1"),function(e){return function(o){var n=o.get("code_"+e.date),r=t["CLC-"+n];if(!r){var a=i[n].color.slice();a[3]=e.opacity||1,r=t["CLC-"+n]=new ol.style.Style({fill:new ol.style.Fill({color:a||[255,255,255,.5]})})}return r}}(r)):(console.warn("[ol/style/geoportailStyle] no style defined for type: "+n),ol.style.Style.defaultStyle())}},ol.style.geoportailStyle.clcColors=JSON.parse(JSON.stringify(i))}()},function(t,e,o){},function(t,e,o){},function(t,e,o){},function(t,e){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==o(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e,o){
/**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2018, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   */
t.exports=function(){"use strict";for(var t=function(t,e,o){return void 0===e&&(e=0),void 0===o&&(o=1),t<e?e:t>o?o:t},e={},o=0,i=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];o<i.length;o+=1){var n=i[o];e["[object "+n+"]"]=n.toLowerCase()}var r=function(t){return e[Object.prototype.toString.call(t)]||"object"},a=Math.PI,s={clip_rgb:function(e){e._clipped=!1,e._unclipped=e.slice(0);for(var o=0;o<=3;o++)o<3?((e[o]<0||e[o]>255)&&(e._clipped=!0),e[o]=t(e[o],0,255)):3===o&&(e[o]=t(e[o],0,1));return e},limit:t,type:r,unpack:function(t,e){return void 0===e&&(e=null),t.length>=3?Array.prototype.slice.call(t):"object"==r(t[0])&&e?e.split("").filter((function(e){return void 0!==t[0][e]})).map((function(e){return t[0][e]})):t[0]},last:function(t){if(t.length<2)return null;var e=t.length-1;return"string"==r(t[e])?t[e].toLowerCase():null},PI:a,TWOPI:2*a,PITHIRD:a/3,DEG2RAD:a/180,RAD2DEG:180/a},l={format:{},autodetect:[]},c=s.last,h=s.clip_rgb,u=s.type,p=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if("object"===u(t[0])&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];var o=c(t),i=!1;if(!o){i=!0,l.sorted||(l.autodetect=l.autodetect.sort((function(t,e){return e.p-t.p})),l.sorted=!0);for(var n=0,r=l.autodetect;n<r.length;n+=1){var a=r[n];if(o=a.test.apply(a,t))break}}if(!l.format[o])throw new Error("unknown format: "+t);var s=l.format[o].apply(null,i?t:t.slice(0,-1));this._rgb=h(s),3===this._rgb.length&&this._rgb.push(1)};p.prototype.toString=function(){return"function"==u(this.hex)?this.hex():"["+this._rgb.join(",")+"]"};var d=p,f=function t(){for(var e=[],o=arguments.length;o--;)e[o]=arguments[o];return new(Function.prototype.bind.apply(t.Color,[null].concat(e)))};f.Color=d,f.version="2.0.3";var g=f,m=s.unpack,y=Math.max,v=s.unpack,b=s.unpack,_=s.type;d.prototype.cmyk=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=m(t,"rgb"),i=o[0],n=o[1],r=o[2],a=1-y(i/=255,y(n/=255,r/=255)),s=a<1?1/(1-a):0,l=(1-i-a)*s,c=(1-n-a)*s,h=(1-r-a)*s;return[l,c,h,a]}(this._rgb)},g.cmyk=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["cmyk"])))},l.format.cmyk=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=(t=v(t,"cmyk"))[0],i=t[1],n=t[2],r=t[3],a=t.length>4?t[4]:1;return 1===r?[0,0,0,a]:[o>=1?0:255*(1-o)*(1-r),i>=1?0:255*(1-i)*(1-r),n>=1?0:255*(1-n)*(1-r),a]},l.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=b(t,"cmyk"),"array"===_(t)&&4===t.length)return"cmyk"}});var S=s.unpack,w=s.last,x=function(t){return Math.round(100*t)/100},L=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=S(t,"hsla"),i=w(t)||"lsa";return o[0]=x(o[0]||0),o[1]=x(100*o[1])+"%",o[2]=x(100*o[2])+"%","hsla"===i||o.length>3&&o[3]<1?(o[3]=o.length>3?o[3]:1,i="hsla"):o.length=3,i+"("+o.join(",")+")"},M=s.unpack,k=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=(t=M(t,"rgba"))[0],i=t[1],n=t[2];o/=255,i/=255,n/=255;var r,a,s=Math.min(o,i,n),l=Math.max(o,i,n),c=(l+s)/2;return l===s?(r=0,a=Number.NaN):r=c<.5?(l-s)/(l+s):(l-s)/(2-l-s),o==l?a=(i-n)/(l-s):i==l?a=2+(n-o)/(l-s):n==l&&(a=4+(o-i)/(l-s)),(a*=60)<0&&(a+=360),t.length>3&&void 0!==t[3]?[a,r,c,t[3]]:[a,r,c]},C=s.unpack,E=s.last,T=Math.round,P=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,O=/^#?([A-Fa-f0-9]{8})$/,A=function(t){if(t.match(P)){4!==t.length&&7!==t.length||(t=t.substr(1)),3===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t,16);return[e>>16,e>>8&255,255&e,1]}if(t.match(O)){9===t.length&&(t=t.substr(1));var o=parseInt(t,16);return[o>>24&255,o>>16&255,o>>8&255,Math.round((255&o)/255*100)/100]}throw new Error("unknown hex color: "+t)},I=s.unpack,N=Math.round,F=function(){for(var t,e=[],o=arguments.length;o--;)e[o]=arguments[o];var i,n,r,a=(e=I(e,"hsl"))[0],s=e[1],l=e[2];if(0===s)i=n=r=255*l;else{var c=[0,0,0],h=[0,0,0],u=l<.5?l*(1+s):l+s-l*s,p=2*l-u,d=a/360;c[0]=d+1/3,c[1]=d,c[2]=d-1/3;for(var f=0;f<3;f++)c[f]<0&&(c[f]+=1),c[f]>1&&(c[f]-=1),6*c[f]<1?h[f]=p+6*(u-p)*c[f]:2*c[f]<1?h[f]=u:3*c[f]<2?h[f]=p+(u-p)*(2/3-c[f])*6:h[f]=p;i=(t=[N(255*h[0]),N(255*h[1]),N(255*h[2])])[0],n=t[1],r=t[2]}return e.length>3?[i,n,r,e[3]]:[i,n,r,1]},D={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},R=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,G=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,B=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,j=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,q=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,V=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,z=Math.round,Z=function(t){if(t=t.toLowerCase().trim(),D[t])return A(D[t]);var e;if(e=t.match(R)){for(var o=e.slice(1,4),i=0;i<3;i++)o[i]=+o[i];return o[3]=1,o}if(e=t.match(G)){for(var n=e.slice(1,5),r=0;r<4;r++)n[r]=+n[r];return n}if(e=t.match(B)){for(var a=e.slice(1,4),s=0;s<3;s++)a[s]=z(2.55*a[s]);return a[3]=1,a}if(e=t.match(j)){for(var l=e.slice(1,5),c=0;c<3;c++)l[c]=z(2.55*l[c]);return l[3]=+l[3],l}if(e=t.match(q)){var h=e.slice(1,4);h[1]*=.01,h[2]*=.01;var u=F(h);return u[3]=1,u}if(e=t.match(V)){var p=e.slice(1,4);p[1]*=.01,p[2]*=.01;var d=F(p);return d[3]=+e[4],d}};Z.test=function(t){return R.test(t)||G.test(t)||B.test(t)||j.test(t)||q.test(t)||V.test(t)};var U=Z,H=s.type;d.prototype.css=function(t){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=C(t,"rgba"),i=E(t)||"rgb";return"hsl"==i.substr(0,3)?L(k(o),i):(o[0]=T(o[0]),o[1]=T(o[1]),o[2]=T(o[2]),("rgba"===i||o.length>3&&o[3]<1)&&(o[3]=o.length>3?o[3]:1,i="rgba"),i+"("+o.slice(0,"rgb"===i?3:4).join(",")+")")}(this._rgb,t)},g.css=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["css"])))},l.format.css=U,l.autodetect.push({p:5,test:function(t){for(var e=[],o=arguments.length-1;o-- >0;)e[o]=arguments[o+1];if(!e.length&&"string"===H(t)&&U.test(t))return"css"}});var W=s.unpack;l.format.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=W(t,"rgba");return o[0]*=255,o[1]*=255,o[2]*=255,o},g.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["gl"])))},d.prototype.gl=function(){var t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};var Y=s.unpack,X=s.unpack,J=Math.floor,K=s.unpack,Q=s.type;d.prototype.hcg=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o,i=Y(t,"rgb"),n=i[0],r=i[1],a=i[2],s=Math.min(n,r,a),l=Math.max(n,r,a),c=l-s,h=100*c/255,u=s/(255-c)*100;return 0===c?o=Number.NaN:(n===l&&(o=(r-a)/c),r===l&&(o=2+(a-n)/c),a===l&&(o=4+(n-r)/c),(o*=60)<0&&(o+=360)),[o,h,u]}(this._rgb)},g.hcg=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hcg"])))},l.format.hcg=function(){for(var t,e,o,i,n,r,a=[],s=arguments.length;s--;)a[s]=arguments[s];var l,c,h,u=(a=X(a,"hcg"))[0],p=a[1],d=a[2];d*=255;var f=255*p;if(0===p)l=c=h=d;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var g=J(u/=60),m=u-g,y=d*(1-p),v=y+f*(1-m),b=y+f*m,_=y+f;switch(g){case 0:l=(t=[_,b,y])[0],c=t[1],h=t[2];break;case 1:l=(e=[v,_,y])[0],c=e[1],h=e[2];break;case 2:l=(o=[y,_,b])[0],c=o[1],h=o[2];break;case 3:l=(i=[y,v,_])[0],c=i[1],h=i[2];break;case 4:l=(n=[b,y,_])[0],c=n[1],h=n[2];break;case 5:l=(r=[_,y,v])[0],c=r[1],h=r[2]}}return[l,c,h,a.length>3?a[3]:1]},l.autodetect.push({p:1,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=K(t,"hcg"),"array"===Q(t)&&3===t.length)return"hcg"}});var $=s.unpack,tt=s.last,et=Math.round,ot=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=$(t,"rgba"),i=o[0],n=o[1],r=o[2],a=o[3],s=tt(t)||"auto";void 0===a&&(a=1),"auto"===s&&(s=a<1?"rgba":"rgb");var l=(i=et(i))<<16|(n=et(n))<<8|(r=et(r)),c="000000"+l.toString(16);c=c.substr(c.length-6);var h="0"+et(255*a).toString(16);switch(h=h.substr(h.length-2),s.toLowerCase()){case"rgba":return"#"+c+h;case"argb":return"#"+h+c;default:return"#"+c}},it=s.type;d.prototype.hex=function(t){return ot(this._rgb,t)},g.hex=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hex"])))},l.format.hex=A,l.autodetect.push({p:4,test:function(t){for(var e=[],o=arguments.length-1;o-- >0;)e[o]=arguments[o+1];if(!e.length&&"string"===it(t)&&[3,4,6,7,8,9].includes(t.length))return"hex"}});var nt=s.unpack,rt=s.TWOPI,at=Math.min,st=Math.sqrt,lt=Math.acos,ct=s.unpack,ht=s.limit,ut=s.TWOPI,pt=s.PITHIRD,dt=Math.cos,ft=s.unpack,gt=s.type;d.prototype.hsi=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o,i=nt(t,"rgb"),n=i[0],r=i[1],a=i[2],s=at(n/=255,r/=255,a/=255),l=(n+r+a)/3,c=l>0?1-s/l:0;return 0===c?o=NaN:(o=(n-r+(n-a))/2,o/=st((n-r)*(n-r)+(n-a)*(r-a)),o=lt(o),a>r&&(o=rt-o),o/=rt),[360*o,c,l]}(this._rgb)},g.hsi=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsi"])))},l.format.hsi=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o,i,n,r=(t=ct(t,"hsi"))[0],a=t[1],s=t[2];return isNaN(r)&&(r=0),isNaN(a)&&(a=0),r>360&&(r-=360),r<0&&(r+=360),(r/=360)<1/3?i=1-((n=(1-a)/3)+(o=(1+a*dt(ut*r)/dt(pt-ut*r))/3)):r<2/3?n=1-((o=(1-a)/3)+(i=(1+a*dt(ut*(r-=1/3))/dt(pt-ut*r))/3)):o=1-((i=(1-a)/3)+(n=(1+a*dt(ut*(r-=2/3))/dt(pt-ut*r))/3)),[255*(o=ht(s*o*3)),255*(i=ht(s*i*3)),255*(n=ht(s*n*3)),t.length>3?t[3]:1]},l.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=ft(t,"hsi"),"array"===gt(t)&&3===t.length)return"hsi"}});var mt=s.unpack,yt=s.type;d.prototype.hsl=function(){return k(this._rgb)},g.hsl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsl"])))},l.format.hsl=F,l.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=mt(t,"hsl"),"array"===yt(t)&&3===t.length)return"hsl"}});var vt=s.unpack,bt=Math.min,_t=Math.max,St=s.unpack,wt=Math.floor,xt=s.unpack,Lt=s.type;d.prototype.hsv=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o,i,n,r=(t=vt(t,"rgb"))[0],a=t[1],s=t[2],l=bt(r,a,s),c=_t(r,a,s),h=c-l;return n=c/255,0===c?(o=Number.NaN,i=0):(i=h/c,r===c&&(o=(a-s)/h),a===c&&(o=2+(s-r)/h),s===c&&(o=4+(r-a)/h),(o*=60)<0&&(o+=360)),[o,i,n]}(this._rgb)},g.hsv=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hsv"])))},l.format.hsv=function(){for(var t,e,o,i,n,r,a=[],s=arguments.length;s--;)a[s]=arguments[s];var l,c,h,u=(a=St(a,"hsv"))[0],p=a[1],d=a[2];if(d*=255,0===p)l=c=h=d;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var f=wt(u/=60),g=u-f,m=d*(1-p),y=d*(1-p*g),v=d*(1-p*(1-g));switch(f){case 0:l=(t=[d,v,m])[0],c=t[1],h=t[2];break;case 1:l=(e=[y,d,m])[0],c=e[1],h=e[2];break;case 2:l=(o=[m,d,v])[0],c=o[1],h=o[2];break;case 3:l=(i=[m,y,d])[0],c=i[1],h=i[2];break;case 4:l=(n=[v,m,d])[0],c=n[1],h=n[2];break;case 5:l=(r=[d,m,y])[0],c=r[1],h=r[2]}}return[l,c,h,a.length>3?a[3]:1]},l.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=xt(t,"hsv"),"array"===Lt(t)&&3===t.length)return"hsv"}});var Mt=18,kt=.95047,Ct=1,Et=1.08883,Tt=.137931034,Pt=.206896552,Ot=.12841855,At=.008856452,It=s.unpack,Nt=Math.pow,Ft=function(t){return(t/=255)<=.04045?t/12.92:Nt((t+.055)/1.055,2.4)},Dt=function(t){return t>At?Nt(t,1/3):t/Ot+Tt},Rt=function(t,e,o){return t=Ft(t),e=Ft(e),o=Ft(o),[Dt((.4124564*t+.3575761*e+.1804375*o)/kt),Dt((.2126729*t+.7151522*e+.072175*o)/Ct),Dt((.0193339*t+.119192*e+.9503041*o)/Et)]},Gt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=It(t,"rgb"),i=o[0],n=o[1],r=o[2],a=Rt(i,n,r),s=a[0],l=a[1],c=a[2],h=116*l-16;return[h<0?0:h,500*(s-l),200*(l-c)]},Bt=s.unpack,jt=Math.pow,qt=function(t){return 255*(t<=.00304?12.92*t:1.055*jt(t,1/2.4)-.055)},Vt=function(t){return t>Pt?t*t*t:Ot*(t-Tt)},zt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o,i,n,r=(t=Bt(t,"lab"))[0],a=t[1],s=t[2];return i=(r+16)/116,o=isNaN(a)?i:i+a/500,n=isNaN(s)?i:i-s/200,i=Ct*Vt(i),o=kt*Vt(o),n=Et*Vt(n),[qt(3.2404542*o-1.5371385*i-.4985314*n),qt(-.969266*o+1.8760108*i+.041556*n),qt(.0556434*o-.2040259*i+1.0572252*n),t.length>3?t[3]:1]},Zt=s.unpack,Ut=s.type;d.prototype.lab=function(){return Gt(this._rgb)},g.lab=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["lab"])))},l.format.lab=zt,l.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Zt(t,"lab"),"array"===Ut(t)&&3===t.length)return"lab"}});var Ht=s.unpack,Wt=s.RAD2DEG,Yt=Math.sqrt,Xt=Math.atan2,Jt=Math.round,Kt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=Ht(t,"lab"),i=o[0],n=o[1],r=o[2],a=Yt(n*n+r*r),s=(Xt(r,n)*Wt+360)%360;return 0===Jt(1e4*a)&&(s=Number.NaN),[i,a,s]},Qt=s.unpack,$t=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=Qt(t,"rgb"),i=o[0],n=o[1],r=o[2],a=Gt(i,n,r),s=a[0],l=a[1],c=a[2];return Kt(s,l,c)},te=s.unpack,ee=s.DEG2RAD,oe=Math.sin,ie=Math.cos,ne=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=te(t,"lch"),i=o[0],n=o[1],r=o[2];return isNaN(r)&&(r=0),[i,ie(r*=ee)*n,oe(r)*n]},re=s.unpack,ae=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=(t=re(t,"lch"))[0],i=t[1],n=t[2],r=ne(o,i,n),a=r[0],s=r[1],l=r[2],c=zt(a,s,l),h=c[0],u=c[1],p=c[2];return[h,u,p,t.length>3?t[3]:1]},se=s.unpack,le=s.unpack,ce=s.type;d.prototype.lch=function(){return $t(this._rgb)},d.prototype.hcl=function(){return $t(this._rgb).reverse()},g.lch=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["lch"])))},g.hcl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["hcl"])))},l.format.lch=ae,l.format.hcl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=se(t,"hcl").reverse();return ae.apply(void 0,o)},["lch","hcl"].forEach((function(t){return l.autodetect.push({p:2,test:function(){for(var e=[],o=arguments.length;o--;)e[o]=arguments[o];if(e=le(e,t),"array"===ce(e)&&3===e.length)return t}})}));var he=s.type;d.prototype.name=function(){for(var t=ot(this._rgb,"rgb"),e=0,o=Object.keys(D);e<o.length;e+=1){var i=o[e];if(D[i]===t)return i.toLowerCase()}return t},l.format.named=function(t){if(t=t.toLowerCase(),D[t])return A(D[t]);throw new Error("unknown color name: "+t)},l.autodetect.push({p:5,test:function(t){for(var e=[],o=arguments.length-1;o-- >0;)e[o]=arguments[o+1];if(!e.length&&"string"===he(t)&&D[t.toLowerCase()])return"named"}});var ue=s.unpack,pe=s.type,de=s.type;d.prototype.num=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=ue(t,"rgb"),i=o[0],n=o[1],r=o[2];return(i<<16)+(n<<8)+r}(this._rgb)},g.num=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["num"])))},l.format.num=function(t){if("number"==pe(t)&&t>=0&&t<=16777215)return[t>>16,t>>8&255,255&t,1];throw new Error("unknown num color: "+t)},l.autodetect.push({p:5,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(1===t.length&&"number"===de(t[0])&&t[0]>=0&&t[0]<=16777215)return"num"}});var fe=s.unpack,ge=s.type,me=Math.round;d.prototype.rgb=function(t){return void 0===t&&(t=!0),!1===t?this._rgb.slice(0,3):this._rgb.slice(0,3).map(me)},d.prototype.rgba=function(t){return void 0===t&&(t=!0),this._rgb.slice(0,4).map((function(e,o){return o<3?!1===t?e:me(e):e}))},g.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["rgb"])))},l.format.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=fe(t,"rgba");return void 0===o[3]&&(o[3]=1),o},l.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=fe(t,"rgba"),"array"===ge(t)&&(3===t.length||4===t.length&&"number"==ge(t[3])&&t[3]>=0&&t[3]<=1))return"rgb"}});var ye=Math.log,ve=function(t){var e,o,i,n=t/100;return n<66?(e=255,o=-155.25485562709179-.44596950469579133*(o=n-2)+104.49216199393888*ye(o),i=n<20?0:.8274096064007395*(i=n-10)-254.76935184120902+115.67994401066147*ye(i)):(e=351.97690566805693+.114206453784165*(e=n-55)-40.25366309332127*ye(e),o=325.4494125711974+.07943456536662342*(o=n-50)-28.0852963507957*ye(o),i=255),[e,o,i,1]},be=s.unpack,_e=Math.round;d.prototype.temp=d.prototype.kelvin=d.prototype.temperature=function(){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var o,i=be(t,"rgb"),n=i[0],r=i[2],a=1e3,s=4e4;s-a>.4;){var l=ve(o=.5*(s+a));l[2]/l[0]>=r/n?s=o:a=o}return _e(o)}(this._rgb)},g.temp=g.kelvin=g.temperature=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(d,[null].concat(t,["temp"])))},l.format.temp=l.format.kelvin=l.format.temperature=ve;var Se=s.type;d.prototype.alpha=function(t,e){return void 0===e&&(e=!1),void 0!==t&&"number"===Se(t)?e?(this._rgb[3]=t,this):new d([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]},d.prototype.clipped=function(){return this._rgb._clipped||!1},d.prototype.darken=function(t){void 0===t&&(t=1);var e=this.lab();return e[0]-=Mt*t,new d(e,"lab").alpha(this.alpha(),!0)},d.prototype.brighten=function(t){return void 0===t&&(t=1),this.darken(-t)},d.prototype.darker=d.prototype.darken,d.prototype.brighter=d.prototype.brighten,d.prototype.get=function(t){var e=t.split("."),o=e[0],i=e[1],n=this[o]();if(i){var r=o.indexOf(i);if(r>-1)return n[r];throw new Error("unknown channel "+i+" in mode "+o)}return n};var we=s.type,xe=Math.pow;d.prototype.luminance=function(t){if(void 0!==t&&"number"===we(t)){if(0===t)return new d([0,0,0,this._rgb[3]],"rgb");if(1===t)return new d([255,255,255,this._rgb[3]],"rgb");var e=this.luminance(),o=20,i=function e(i,n){var r=i.interpolate(n,.5,"rgb"),a=r.luminance();return Math.abs(t-a)<1e-7||!o--?r:a>t?e(i,r):e(r,n)},n=(e>t?i(new d([0,0,0]),this):i(this,new d([255,255,255]))).rgb();return new d(n.concat([this._rgb[3]]))}return Le.apply(void 0,this._rgb.slice(0,3))};var Le=function(t,e,o){return.2126*(t=Me(t))+.7152*(e=Me(e))+.0722*(o=Me(o))},Me=function(t){return(t/=255)<=.03928?t/12.92:xe((t+.055)/1.055,2.4)},ke={},Ce=s.type,Ee=function(t,e,o){void 0===o&&(o=.5);for(var i=[],n=arguments.length-3;n-- >0;)i[n]=arguments[n+3];var r=i[0]||"lrgb";if(ke[r]||i.length||(r=Object.keys(ke)[0]),!ke[r])throw new Error("interpolation mode "+r+" is not defined");return"object"!==Ce(t)&&(t=new d(t)),"object"!==Ce(e)&&(e=new d(e)),ke[r](t,e,o).alpha(t.alpha()+o*(e.alpha()-t.alpha()))};d.prototype.mix=d.prototype.interpolate=function(t,e){void 0===e&&(e=.5);for(var o=[],i=arguments.length-2;i-- >0;)o[i]=arguments[i+2];return Ee.apply(void 0,[this,t,e].concat(o))},d.prototype.premultiply=function(t){void 0===t&&(t=!1);var e=this._rgb,o=e[3];return t?(this._rgb=[e[0]*o,e[1]*o,e[2]*o,o],this):new d([e[0]*o,e[1]*o,e[2]*o,o],"rgb")},d.prototype.saturate=function(t){void 0===t&&(t=1);var e=this.lch();return e[1]+=Mt*t,e[1]<0&&(e[1]=0),new d(e,"lch").alpha(this.alpha(),!0)},d.prototype.desaturate=function(t){return void 0===t&&(t=1),this.saturate(-t)};var Te=s.type;d.prototype.set=function(t,e,o){void 0===o&&(o=!1);var i=t.split("."),n=i[0],r=i[1],a=this[n]();if(r){var s=n.indexOf(r);if(s>-1){if("string"==Te(e))switch(e.charAt(0)){case"+":case"-":a[s]+=+e;break;case"*":a[s]*=+e.substr(1);break;case"/":a[s]/=+e.substr(1);break;default:a[s]=+e}else{if("number"!==Te(e))throw new Error("unsupported value for Color.set");a[s]=e}var l=new d(a,n);return o?(this._rgb=l._rgb,this):l}throw new Error("unknown channel "+r+" in mode "+n)}return a},ke.rgb=function(t,e,o){var i=t._rgb,n=e._rgb;return new d(i[0]+o*(n[0]-i[0]),i[1]+o*(n[1]-i[1]),i[2]+o*(n[2]-i[2]),"rgb")};var Pe=Math.sqrt,Oe=Math.pow;ke.lrgb=function(t,e,o){var i=t._rgb,n=i[0],r=i[1],a=i[2],s=e._rgb,l=s[0],c=s[1],h=s[2];return new d(Pe(Oe(n,2)*(1-o)+Oe(l,2)*o),Pe(Oe(r,2)*(1-o)+Oe(c,2)*o),Pe(Oe(a,2)*(1-o)+Oe(h,2)*o),"rgb")},ke.lab=function(t,e,o){var i=t.lab(),n=e.lab();return new d(i[0]+o*(n[0]-i[0]),i[1]+o*(n[1]-i[1]),i[2]+o*(n[2]-i[2]),"lab")};var Ae=function(t,e,o,i){var n,r,a,s,l,c,h,u,p,f,g,m;return"hsl"===i?(a=t.hsl(),s=e.hsl()):"hsv"===i?(a=t.hsv(),s=e.hsv()):"hcg"===i?(a=t.hcg(),s=e.hcg()):"hsi"===i?(a=t.hsi(),s=e.hsi()):"lch"!==i&&"hcl"!==i||(i="hcl",a=t.hcl(),s=e.hcl()),"h"===i.substr(0,1)&&(l=(n=a)[0],h=n[1],p=n[2],c=(r=s)[0],u=r[1],f=r[2]),isNaN(l)||isNaN(c)?isNaN(l)?isNaN(c)?m=Number.NaN:(m=c,1!=p&&0!=p||"hsv"==i||(g=u)):(m=l,1!=f&&0!=f||"hsv"==i||(g=h)):m=l+o*(c>l&&c-l>180?c-(l+360):c<l&&l-c>180?c+360-l:c-l),void 0===g&&(g=h+o*(u-h)),new d([m,g,p+o*(f-p)],i)},Ie=function(t,e,o){return Ae(t,e,o,"lch")};ke.lch=Ie,ke.hcl=Ie,ke.num=function(t,e,o){var i=t.num(),n=e.num();return new d(i+o*(n-i),"num")},ke.hcg=function(t,e,o){return Ae(t,e,o,"hcg")},ke.hsi=function(t,e,o){return Ae(t,e,o,"hsi")},ke.hsl=function(t,e,o){return Ae(t,e,o,"hsl")},ke.hsv=function(t,e,o){return Ae(t,e,o,"hsv")};var Ne=s.clip_rgb,Fe=Math.pow,De=Math.sqrt,Re=Math.PI,Ge=Math.cos,Be=Math.sin,je=Math.atan2,qe=s.type,Ve=Math.pow,ze=function(t){var e="rgb",o=g("#ccc"),i=0,n=[0,1],r=[],a=[0,0],s=!1,l=[],c=!1,h=0,u=1,p=!1,d={},f=!0,m=1,y=function(t){if((t=t||["#fff","#000"])&&"string"===qe(t)&&g.brewer&&g.brewer[t.toLowerCase()]&&(t=g.brewer[t.toLowerCase()]),"array"===qe(t)){1===t.length&&(t=[t[0],t[0]]),t=t.slice(0);for(var e=0;e<t.length;e++)t[e]=g(t[e]);r.length=0;for(var o=0;o<t.length;o++)r.push(o/(t.length-1))}return _(),l=t},v=function(t){return t},b=function(t,i){var n,c;if(null==i&&(i=!1),isNaN(t)||null===t)return o;if(i)c=t;else if(s&&s.length>2){c=function(t){if(null!=s){for(var e=s.length-1,o=0;o<e&&t>=s[o];)o++;return o-1}return 0}(t)/(s.length-2)}else c=u!==h?(t-h)/(u-h):1;i||(c=v(c)),1!==m&&(c=Ve(c,m)),c=a[0]+c*(1-a[0]-a[1]),c=Math.min(1,Math.max(0,c));var p=Math.floor(1e4*c);if(f&&d[p])n=d[p];else{if("array"===qe(l))for(var y=0;y<r.length;y++){var b=r[y];if(c<=b){n=l[y];break}if(c>=b&&y===r.length-1){n=l[y];break}if(c>b&&c<r[y+1]){c=(c-b)/(r[y+1]-b),n=g.interpolate(l[y],l[y+1],c,e);break}}else"function"===qe(l)&&(n=l(c));f&&(d[p]=n)}return n},_=function(){return d={}};y(t);var S=function(t){var e=g(b(t));return c&&e[c]?e[c]():e};return S.classes=function(t){if(null!=t){if("array"===qe(t))s=t,n=[t[0],t[t.length-1]];else{var e=g.analyze(n);s=0===t?[e.min,e.max]:g.limits(e,"e",t)}return S}return s},S.domain=function(t){if(!arguments.length)return n;h=t[0],u=t[t.length-1],r=[];var e=l.length;if(t.length===e&&h!==u)for(var o=0,i=Array.from(t);o<i.length;o+=1){var a=i[o];r.push((a-h)/(u-h))}else for(var s=0;s<e;s++)r.push(s/(e-1));return n=[h,u],S},S.mode=function(t){return arguments.length?(e=t,_(),S):e},S.range=function(t,e){return y(t),S},S.out=function(t){return c=t,S},S.spread=function(t){return arguments.length?(i=t,S):i},S.correctLightness=function(t){return null==t&&(t=!0),p=t,_(),v=p?function(t){for(var e=b(0,!0).lab()[0],o=b(1,!0).lab()[0],i=e>o,n=b(t,!0).lab()[0],r=e+(o-e)*t,a=n-r,s=0,l=1,c=20;Math.abs(a)>.01&&c-- >0;)i&&(a*=-1),a<0?(s=t,t+=.5*(l-t)):(l=t,t+=.5*(s-t)),a=(n=b(t,!0).lab()[0])-r;return t}:function(t){return t},S},S.padding=function(t){return null!=t?("number"===qe(t)&&(t=[t,t]),a=t,S):a},S.colors=function(e,o){arguments.length<2&&(o="hex");var i=[];if(0===arguments.length)i=l.slice(0);else if(1===e)i=[S(.5)];else if(e>1){var r=n[0],a=n[1]-r;i=function(t,e,o){for(var i=[],n=0<e,r=e,a=0;n?a<r:a>r;n?a++:a--)i.push(a);return i}(0,e).map((function(t){return S(r+t/(e-1)*a)}))}else{t=[];var c=[];if(s&&s.length>2)for(var h=1,u=s.length,p=1<=u;p?h<u:h>u;p?h++:h--)c.push(.5*(s[h-1]+s[h]));else c=n;i=c.map((function(t){return S(t)}))}return g[o]&&(i=i.map((function(t){return t[o]()}))),i},S.cache=function(t){return null!=t?(f=t,S):f},S.gamma=function(t){return null!=t?(m=t,S):m},S.nodata=function(t){return null!=t?(o=g(t),S):o},S},Ze=function t(e,o,i){if(!t[i])throw new Error("unknown blend mode "+i);return t[i](e,o)},Ue=function(t){return function(e,o){var i=g(o).rgb(),n=g(e).rgb();return g.rgb(t(i,n))}},He=function(t){return function(e,o){var i=[];return i[0]=t(e[0],o[0]),i[1]=t(e[1],o[1]),i[2]=t(e[2],o[2]),i}};Ze.normal=Ue(He((function(t){return t}))),Ze.multiply=Ue(He((function(t,e){return t*e/255}))),Ze.screen=Ue(He((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),Ze.overlay=Ue(He((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),Ze.darken=Ue(He((function(t,e){return t>e?e:t}))),Ze.lighten=Ue(He((function(t,e){return t>e?t:e}))),Ze.dodge=Ue(He((function(t,e){return 255===t||(t=e/255*255/(1-t/255))>255?255:t}))),Ze.burn=Ue(He((function(t,e){return 255*(1-(1-e/255)/(t/255))})));for(var We=Ze,Ye=s.type,Xe=s.clip_rgb,Je=s.TWOPI,Ke=Math.pow,Qe=Math.sin,$e=Math.cos,to=Math.floor,eo=Math.random,oo=Math.log,io=Math.pow,no=Math.floor,ro=Math.abs,ao=function(t,e){void 0===e&&(e=null);var o={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};return"object"===r(t)&&(t=Object.values(t)),t.forEach((function(t){e&&"object"===r(t)&&(t=t[e]),null==t||isNaN(t)||(o.values.push(t),o.sum+=t,t<o.min&&(o.min=t),t>o.max&&(o.max=t),o.count+=1)})),o.domain=[o.min,o.max],o.limits=function(t,e){return so(o,t,e)},o},so=function(t,e,o){void 0===e&&(e="equal"),void 0===o&&(o=7),"array"==r(t)&&(t=ao(t));var i=t.min,n=t.max,a=t.values.sort((function(t,e){return t-e}));if(1===o)return[i,n];var s=[];if("c"===e.substr(0,1)&&(s.push(i),s.push(n)),"e"===e.substr(0,1)){s.push(i);for(var l=1;l<o;l++)s.push(i+l/o*(n-i));s.push(n)}else if("l"===e.substr(0,1)){if(i<=0)throw new Error("Logarithmic scales are only possible for values > 0");var c=Math.LOG10E*oo(i),h=Math.LOG10E*oo(n);s.push(i);for(var u=1;u<o;u++)s.push(io(10,c+u/o*(h-c)));s.push(n)}else if("q"===e.substr(0,1)){s.push(i);for(var p=1;p<o;p++){var d=(a.length-1)*p/o,f=no(d);if(f===d)s.push(a[f]);else{var g=d-f;s.push(a[f]*(1-g)+a[f+1]*g)}}s.push(n)}else if("k"===e.substr(0,1)){var m,y=a.length,v=new Array(y),b=new Array(o),_=!0,S=0,w=null;(w=[]).push(i);for(var x=1;x<o;x++)w.push(i+x/o*(n-i));for(w.push(n);_;){for(var L=0;L<o;L++)b[L]=0;for(var M=0;M<y;M++)for(var k=a[M],C=Number.MAX_VALUE,E=void 0,T=0;T<o;T++){var P=ro(w[T]-k);P<C&&(C=P,E=T),b[E]++,v[M]=E}for(var O=new Array(o),A=0;A<o;A++)O[A]=null;for(var I=0;I<y;I++)null===O[m=v[I]]?O[m]=a[I]:O[m]+=a[I];for(var N=0;N<o;N++)O[N]*=1/b[N];_=!1;for(var F=0;F<o;F++)if(O[F]!==w[F]){_=!0;break}w=O,++S>200&&(_=!1)}for(var D={},R=0;R<o;R++)D[R]=[];for(var G=0;G<y;G++)D[m=v[G]].push(a[G]);for(var B=[],j=0;j<o;j++)B.push(D[j][0]),B.push(D[j][D[j].length-1]);B=B.sort((function(t,e){return t-e})),s.push(B[0]);for(var q=1;q<B.length;q+=2){var V=B[q];isNaN(V)||-1!==s.indexOf(V)||s.push(V)}}return s},lo={analyze:ao,limits:so},co=Math.sqrt,ho=Math.atan2,uo=Math.abs,po=Math.cos,fo=Math.PI,go={cool:function(){return ze([g.hsl(180,1,.9),g.hsl(250,.7,.4)])},hot:function(){return ze(["#000","#f00","#ff0","#fff"]).mode("rgb")}},mo={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},yo=0,vo=Object.keys(mo);yo<vo.length;yo+=1){var bo=vo[yo];mo[bo.toLowerCase()]=mo[bo]}var _o=mo;return g.average=function(t,e){void 0===e&&(e="lrgb");var o=t.length;if(t=t.map((function(t){return new d(t)})),"lrgb"===e)return function(t){for(var e=1/t.length,o=[0,0,0,0],i=0,n=t;i<n.length;i+=1){var r=n[i]._rgb;o[0]+=Fe(r[0],2)*e,o[1]+=Fe(r[1],2)*e,o[2]+=Fe(r[2],2)*e,o[3]+=r[3]*e}return o[0]=De(o[0]),o[1]=De(o[1]),o[2]=De(o[2]),o[3]>.9999999&&(o[3]=1),new d(Ne(o))}(t);for(var i=t.shift(),n=i.get(e),r=[],a=0,s=0,l=0;l<n.length;l++)if(n[l]=n[l]||0,r.push(isNaN(n[l])?0:1),"h"===e.charAt(l)&&!isNaN(n[l])){var c=n[l]/180*Re;a+=Ge(c),s+=Be(c)}var h=i.alpha();t.forEach((function(t){var o=t.get(e);h+=t.alpha();for(var i=0;i<n.length;i++)if(!isNaN(o[i]))if(r[i]++,"h"===e.charAt(i)){var l=o[i]/180*Re;a+=Ge(l),s+=Be(l)}else n[i]+=o[i]}));for(var u=0;u<n.length;u++)if("h"===e.charAt(u)){for(var p=je(s/r[u],a/r[u])/Re*180;p<0;)p+=360;for(;p>=360;)p-=360;n[u]=p}else n[u]=n[u]/r[u];return h/=o,new d(n,e).alpha(h>.99999?1:h,!0)},g.bezier=function(t){var e=function t(e){var o,i,n,r,a,s,l;if(2===(e=e.map((function(t){return new d(t)}))).length)o=e.map((function(t){return t.lab()})),a=o[0],s=o[1],r=function(t){var e=[0,1,2].map((function(e){return a[e]+t*(s[e]-a[e])}));return new d(e,"lab")};else if(3===e.length)i=e.map((function(t){return t.lab()})),a=i[0],s=i[1],l=i[2],r=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*a[e]+2*(1-t)*t*s[e]+t*t*l[e]}));return new d(e,"lab")};else if(4===e.length){var c;n=e.map((function(t){return t.lab()})),a=n[0],s=n[1],l=n[2],c=n[3],r=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*(1-t)*a[e]+3*(1-t)*(1-t)*t*s[e]+3*(1-t)*t*t*l[e]+t*t*t*c[e]}));return new d(e,"lab")}}else if(5===e.length){var h=t(e.slice(0,3)),u=t(e.slice(2,5));r=function(t){return t<.5?h(2*t):u(2*(t-.5))}}return r}(t);return e.scale=function(){return ze(e)},e},g.blend=We,g.cubehelix=function(t,e,o,i,n){void 0===t&&(t=300),void 0===e&&(e=-1.5),void 0===o&&(o=1),void 0===i&&(i=1),void 0===n&&(n=[0,1]);var r,a=0;"array"===Ye(n)?r=n[1]-n[0]:(r=0,n=[n,n]);var s=function(s){var l=Je*((t+120)/360+e*s),c=Ke(n[0]+r*s,i),h=(0!==a?o[0]+s*a:o)*c*(1-c)/2,u=$e(l),p=Qe(l);return g(Xe([255*(c+h*(-.14861*u+1.78277*p)),255*(c+h*(-.29227*u-.90649*p)),255*(c+h*(1.97294*u)),1]))};return s.start=function(e){return null==e?t:(t=e,s)},s.rotations=function(t){return null==t?e:(e=t,s)},s.gamma=function(t){return null==t?i:(i=t,s)},s.hue=function(t){return null==t?o:("array"===Ye(o=t)?0==(a=o[1]-o[0])&&(o=o[1]):a=0,s)},s.lightness=function(t){return null==t?n:("array"===Ye(t)?(n=t,r=t[1]-t[0]):(n=[t,t],r=0),s)},s.scale=function(){return g.scale(s)},s.hue(o),s},g.mix=g.interpolate=Ee,g.random=function(){for(var t="#",e=0;e<6;e++)t+="0123456789abcdef".charAt(to(16*eo()));return new d(t,"hex")},g.scale=ze,g.analyze=lo.analyze,g.contrast=function(t,e){t=new d(t),e=new d(e);var o=t.luminance(),i=e.luminance();return o>i?(o+.05)/(i+.05):(i+.05)/(o+.05)},g.deltaE=function(t,e,o,i){void 0===o&&(o=1),void 0===i&&(i=1),t=new d(t),e=new d(e);for(var n=Array.from(t.lab()),r=n[0],a=n[1],s=n[2],l=Array.from(e.lab()),c=l[0],h=l[1],u=l[2],p=co(a*a+s*s),f=co(h*h+u*u),g=r<16?.511:.040975*r/(1+.01765*r),m=.0638*p/(1+.0131*p)+.638,y=p<1e-6?0:180*ho(s,a)/fo;y<0;)y+=360;for(;y>=360;)y-=360;var v=y>=164&&y<=345?.56+uo(.2*po(fo*(y+168)/180)):.36+uo(.4*po(fo*(y+35)/180)),b=p*p*p*p,_=co(b/(b+1900)),S=m*(_*v+1-_),w=p-f,x=a-h,L=s-u,M=(r-c)/(o*g),k=w/(i*m);return co(M*M+k*k+(x*x+L*L-w*w)/(S*S))},g.distance=function(t,e,o){void 0===o&&(o="lab"),t=new d(t),e=new d(e);var i=t.get(o),n=e.get(o),r=0;for(var a in i){var s=(i[a]||0)-(n[a]||0);r+=s*s}return Math.sqrt(r)},g.limits=lo.limits,g.valid=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];try{return new(Function.prototype.bind.apply(d,[null].concat(t))),!0}catch(t){return!1}},g.scales=go,g.colors=D,g.brewer=_o,g}()},function(t,e){t.exports='<div data-role="m-simple" class="m-stylemanager-simple-section">\n  \x3c!-- Fill options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="fill">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input data-style-options="fill.color" type="color" value="{{fill.color}}">\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input data-style-options="fill.opacity" type="number" value="{{fill.opacity}}" min="0" step="0.1" max="1">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="point">\n        <div class="style-col-1">\n          <span>Radio:</span>\n          <input data-style-options="radius" type="number" value="{{radius}}" min="1" max="60">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="line">\n        <div class="style-col-1">\n          <span>Ancho:</span>\n          <input value="{{fill.width}}" min="1" type="number" data-style-options="fill.width">\n        </div>\n      </div>\n      \x3c!-- Polygon Pattern --\x3e\n      <div class="subtitle" data-geometry="polygon">Opciones de patrón</div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1 input-reverse">\n          <span>Patrón</span>\n          <input data-apply="fill.pattern" type="checkbox" {{#if patternflag }}checked{{/if}}>\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Tipo:</span>\n          <select data-style-options="fill.pattern.name">\n            {{#each patternlist}}\n            <option value="{{#lowercase this.name}}{{/lowercase}}" {{#eq this.name this.selected}} selected {{/eq}}>\n              {{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Color:</span>\n          <input value="{{fill.pattern.color}}" type="color" data-style-options="fill.pattern.color">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Tamaño:</span>\n          <input value="{{fill.pattern.size}}" type="number" min="1" max="100" data-style-options="fill.pattern.size">\n        </div>\n\n        <div class="style-col-2">\n          <span>Espacio:</span>\n          <input value="{{fill.pattern.spacing}}" type="number" min="1" max="100"\n            data-style-options="fill.pattern.spacing">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Rotación:</span>\n          <input value="{{fill.pattern.rotation}}" type="number" data-style-options="fill.pattern.rotation">\n        </div>\n\n        <div class="style-col-2">\n          <span>Escala:</span>\n          <input value="{{fill.pattern.scale}}" type="number" min="1" max="30" data-style-options="fill.pattern.scale">\n        </div>\n      </div>\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{fill.pattern.offset}}" type="number" data-style-options="fill.pattern.offset">\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Stroke options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="stroke">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input value="{{stroke.color}}" type="color" data-style-options="stroke.color">\n        </div>\n        <div class="style-col-2">\n          <span>Ancho:</span>\n          <input value="{{stroke.width}}" type="number" value="2" min="1" data-style-options="stroke.width">\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Linedash:</span>\n          <input value="{{#get 0 stroke.linedash}}{{/get}}" type="number" data-target="stroke.linedash"\n            data-style-options="stroke.linedash">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 stroke.linedash}}{{/get}}" type="number" data-id="stroke.linedash">\n        </div>\n\n        <div class="style-col-2">\n          <span>Linedash Offset:</span>\n          <input type="number" value="{{stroke.linedashoffset}}" data-style-options="stroke.linedashoffset">\n        </div>\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Cap</span>\n          <select data-style-options="stroke.linecap">\n            <option value="">Ninguno</option>\n            {{#each linecapstroke}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Line Join:</span>\n          <select data-style-options="stroke.linejoin">\n            <option value="">Ninguno</option>\n            {{#each linejoinstroke}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}> {{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Label options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="label">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Color</span>\n          <input value="{{label.fill.color}}" type="color" data-style-options="label.color" value="#0d5cdc">\n        </div>\n        <div class="style-col-2">\n          <span>Texto:</span>\n          <select data-style-options="label.text">\n            {{#each featuresAttr}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Fuente:</span>\n          <select data-font-family>\n            <option value="serif">Serif</option>\n            <option value="sans-serif">Sans-Serif</option>\n            <option value="mono">Mono</option>\n          </select>\n        </div>\n        <div class="style-col-2">\n          <span>Tamaño:</span>\n          <input data-font-size type="number" min="1" max="40" value="12">\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Alineación horizontal:</span>\n          <select data-style-options="label.align">\n            {{#each alignlist}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Alineación vertical:</span>\n          <select data-style-options="label.baseline">\n            {{#each baselinelist}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if label.rotate}}checked{{/if}} type="checkbox" data-style-options="label.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación</span>\n          <input value="{{label.rotation}}" type="number" step="0.1" data-style-options="label.rotation">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Escala:</span>\n          <input value="{{label.scale}}" type="number" max="3" min="0" step="0.1" value="2"\n            data-style-options="label.scale">\n        </div>\n\n        <div class="style-col-2">\n          <span>Offset:</span>\n          <input value="{{#get 0 label.offset}}{{/get}}" type="number" data-target="label.offset"\n            data-style-options="label.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 label.offset}}{{/get}}" type="number" data-id="label.offset">\n        </div>\n\n      </div>\n\n      \x3c!-- TextPath Options --\x3e\n\n      <div class="group-row" data-geometry="line">\n\n        <div class="style-col-1 input-reverse">\n          <span>Ajustar a geometría</span>\n          <input {{#if label.path}}checked{{/if}} type="checkbox" data-style-options="label.path">\n        </div>\n\n        <div class="style-col-2">\n          <span>Ancho Mínimo:</span>\n          <input value="{{label.minwidth}}" type="number" min="1" max="200" value="10"\n            data-style-options="label.minwidth" data-textpath {{#unless label.path}}disabled{{/unless}}>\n        </div>\n\n      </div>\n\n      <div class="group-row" data-geometry="line">\n\n        <div class="style-col-1 input-reverse">\n          <span>Suavizar</span>\n          <input {{#if label.smooth}}checked{{/if}} type="checkbox" data-style-options="label.smooth" data-textpath\n            {{#unless label.path}}disabled{{/unless}}>\n        </div>\n\n        <div class=style-col-2>\n          <span>Desbordar:</span>\n          <select data-style-options="label.textoverflow" data-textpath {{#unless label.path}}disabled{{/unless}}>\n            <option value="hidden">Oculto</option>\n            <option value="visible">Visible</option>\n            <option value="ellipsis">Puntos suspensivos</option>\n          </select>\n        </div>\n\n      </div>\n\n      \x3c!-- Stroke Label --\x3e\n      <div class="subtitle">Trazo de etiqueta:</div>\n      <div class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Trazo</span>\n          <input type="checkbox" data-apply="label.stroke" {{#neq label.stroke.color \'no-color\' }}checked{{/neq}}>\n        </div>\n\n      </div>\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input type="color" data-style-options="label.stroke.color" {{#neq label.stroke.color \'no-color\'\n            }}value="{{label.stroke.color}}" {{/neq}}>\n        </div>\n\n        <div class="style-col-2">\n          <span>Ancho:</span>\n          <input value="{{label.stroke.width}}" type="number" value="2" max="15" min="1"\n            data-style-options="label.stroke.width">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Dash:</span>\n          <input value="{{#get 0 label.stroke.linedash}}{{/get}}" type="number" data-target="label.stroke.linedash"\n            data-style-options="label.stroke.linedash" data-format="array">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 label.stroke.linedash}}{{/get}}" type="number" data-id="label.stroke.linedash">\n        </div>\n\n        <div class="style-col-2">\n          <span>Offset:</span>\n          <input type="number" value="{{label.stroke.linedashoffset}}" data-style-options="label.stroke.linedashoffset">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Cap:</span>\n          <select data-style-options="label.stroke.linecap">\n            {{#each linecaplabelstroke}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Line Join:</span>\n          <select data-style-options="label.stroke.linejoin">\n            {{#each linejoinlabelstroke}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  \x3c!-- Icon Options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="icon">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      \x3c!-- Point Icon --\x3e\n      <div data-pointicon class="group-row">\n        <div class="style-col-1">\n          <span>URL:</span>\n          <input value="{{icon.src}}" type="url" data-style-options="src.src">\n        </div>\n        <div class="style-col-2">\n          <span>Tamaño:</span>\n          <input {{#if icon.size}}value="{{#get 0 icon.size}}{{/get}}" {{/if}} type="number" min="1" data-undefined\n            data-target="size" data-style-options="src.size">\n          <span class="empty">&nbsp;</span>\n          <input {{#if icon.size}}value="{{#get 1 icon.size}}{{/get}}" {{/if}} type="number" min="1" data-undefined\n            data-id="size">\n        </div>\n      </div>\n\n      <div data-pointicon class="group-row">\n        <div class="style-col-2 input-reverse m-hidden">\n          <span>Snap to pixel</span>\n          <input {{#if icon.snaptopixel}}checked{{/if}} type="checkbox" data-style-options="src.snaptopixel">\n        </div>\n      </div>\n\n      <div data-pointicon class="group-row">\n        <div class="style-col-1">\n          <span>Anclaje:</span>\n          <input value="{{#get 0 icon.anchor}}{{/get}}" type="number" data-target="anchor"\n            data-style-options="src.anchor" step="0.1">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.anchor}}{{/get}}" type="number" data-id="anchor" step="0.1">\n        </div>\n        <div class="style-col-2">\n          <span>Escala:</span>\n          <input value="{{icon.scale}}" type="number" data-style-options="src.scale" max="3" min="0" step="0.1">\n        </div>\n      </div>\n\n      \x3c!-- Common --\x3e\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{#get 0 icon.offset}}{{/get}}" type="number" data-target="icon-offset"\n            data-style-options="src.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.offset}}{{/get}}" type="number" data-id="icon-offset" />\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input value="{{icon.opacity}}" type="number" step="0.1" min=0 max=1 data-style-options="src.opacity">\n        </div>\n      </div>\n\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if icon.rotate}}checked {{/if}} type="checkbox" data-style-options="src.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación:</span>\n          <input value="{{icon.rotation}}" type="number" min=0 max=360 data-style-options="src.rotation">\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n\n  \x3c!-- Form Options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="form">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      \x3c!-- Point Font --\x3e\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>bkColor:</span>\n          <input type="color" data-style-options="form.fill" value="{{icon.fill}}">\n        </div>\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>Forma:</span>\n          <select data-style-options="form.form">\n            {{#each formlist}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Familia:</span>\n          <select data-style-options="form.class" data-icon="{{icon.class}}">\n            <option value="" selected>None</option>\n            <option value="g-cartografia">G-Cartografía</option>\n            <option value="fa">Font Awesome</option>\n          </select>\n          <button id="select-icon" class="g-cartografia-info"></button>\n          <div class="style-grid-container">\n            <div class="style-grid-item g-cartografia-alerta"></div>\n            <div class="style-grid-item g-cartografia-ayuda"></div>\n            <div class="style-grid-item g-cartografia-bandera"></div>\n            <div class="style-grid-item g-cartografia-brujula"></div>\n            <div class="style-grid-item g-cartografia-cancelar"></div>\n            <div class="style-grid-item g-cartografia-cancelar2"></div>\n            <div class="style-grid-item g-cartografia-capas"></div>\n            <div class="style-grid-item g-cartografia-capas2"></div>\n            <div class="style-grid-item g-cartografia-check"></div>\n            <div class="style-grid-item g-cartografia-check2"></div>\n            <div class="style-grid-item g-cartografia-check3"></div>\n            <div class="style-grid-item g-cartografia-check4"></div>\n            <div class="style-grid-item g-cartografia-check5"></div>\n            <div class="style-grid-item g-cartografia-comentarios"></div>\n            <div class="style-grid-item g-cartografia-descargar"></div>\n            <div class="style-grid-item g-cartografia-editar"></div>\n            <div class="style-grid-item g-cartografia-editar2"></div>\n            <div class="style-grid-item g-cartografia-escala"></div>\n            <div class="style-grid-item g-cartografia-escala2"></div>\n            <div class="style-grid-item g-cartografia-escala3"></div>\n            <div class="style-grid-item g-cartografia-flecha"></div>\n            <div class="style-grid-item g-cartografia-flecha-abajo"></div>\n            <div class="style-grid-item g-cartografia-flecha-abajo2"></div>\n            <div class="style-grid-item g-cartografia-flecha-arriba"></div>\n            <div class="style-grid-item g-cartografia-flecha-arriba2"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha2"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha3"></div>\n            <div class="style-grid-item g-cartografia-flecha-deshacer"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda2"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda3"></div>\n            <div class="style-grid-item g-cartografia-flecha-link"></div>\n            <div class="style-grid-item g-cartografia-flechas-mover"></div>\n            <div class="style-grid-item g-cartografia-gps"></div>\n            <div class="style-grid-item g-cartografia-gps2"></div>\n            <div class="style-grid-item g-cartografia-gps3"></div>\n            <div class="style-grid-item g-cartografia-gps4"></div>\n            <div class="style-grid-item g-cartografia-guardar"></div>\n            <div class="style-grid-item g-cartografia-herramienta"></div>\n            <div class="style-grid-item g-cartografia-impresora"></div>\n            <div class="style-grid-item g-cartografia-info"></div>\n            <div class="style-grid-item g-cartografia-linea"></div>\n            <div class="style-grid-item g-cartografia-lineas"></div>\n            <div class="style-grid-item g-cartografia-lista"></div>\n            <div class="style-grid-item g-cartografia-localizacion"></div>\n            <div class="style-grid-item g-cartografia-localizacion2"></div>\n            <div class="style-grid-item g-cartografia-localizacion3"></div>\n            <div class="style-grid-item g-cartografia-localizacion4"></div>\n            <div class="style-grid-item g-cartografia-mano"></div>\n            <div class="style-grid-item g-cartografia-mano2"></div>\n            <div class="style-grid-item g-cartografia-mapa"></div>\n            <div class="style-grid-item g-cartografia-mas"></div>\n            <div class="style-grid-item g-cartografia-mas2"></div>\n            <div class="style-grid-item g-cartografia-medir-area"></div>\n            <div class="style-grid-item g-cartografia-medir-linea"></div>\n            <div class="style-grid-item g-cartografia-menos"></div>\n            <div class="style-grid-item g-cartografia-menos2"></div>\n            <div class="style-grid-item g-cartografia-menu"></div>\n            <div class="style-grid-item g-cartografia-mundo"></div>\n            <div class="style-grid-item g-cartografia-mundo2"></div>\n            <div class="style-grid-item g-cartografia-opciones"></div>\n            <div class="style-grid-item g-cartografia-papelera"></div>\n            <div class="style-grid-item g-cartografia-pin"></div>\n            <div class="style-grid-item g-cartografia-pin-nuevo"></div>\n            <div class="style-grid-item g-cartografia-pin2"></div>\n            <div class="style-grid-item g-cartografia-pin3"></div>\n            <div class="style-grid-item g-cartografia-pin4"></div>\n            <div class="style-grid-item g-cartografia-poligono"></div>\n            <div class="style-grid-item g-cartografia-posicion"></div>\n            <div class="style-grid-item g-cartografia-posicion2"></div>\n            <div class="style-grid-item g-cartografia-posicion3"></div>\n            <div class="style-grid-item g-cartografia-posicion4"></div>\n            <div class="style-grid-item g-cartografia-posicion5"></div>\n            <div class="style-grid-item g-cartografia-posicion6"></div>\n            <div class="style-grid-item g-cartografia-posicion7"></div>\n            <div class="style-grid-item g-cartografia-prismaticos"></div>\n            <div class="style-grid-item g-cartografia-regla"></div>\n            <div class="style-grid-item g-cartografia-reglas"></div>\n            <div class="style-grid-item g-cartografia-ruta"></div>\n            <div class="style-grid-item g-cartografia-spinner"></div>\n            <div class="style-grid-item g-cartografia-subir"></div>\n            <div class="style-grid-item g-cartografia-tamano"></div>\n            <div class="style-grid-item g-cartografia-temperatura"></div>\n            <div class="style-grid-item g-cartografia-texto"></div>\n            <div class="style-grid-item g-cartografia-usuario"></div>\n            <div class="style-grid-item g-cartografia-usuario2"></div>\n            <div class="style-grid-item g-cartografia-zoom"></div>\n            <div class="style-grid-item g-cartografia-zoom-extension"></div>\n            <div class="style-grid-item g-cartografia-zoom-mas"></div>\n            <div class="style-grid-item g-cartografia-zoom-menos"></div>\n            <div class="style-grid-item g-cartografia-pin5"></div>\n            <div class="style-grid-item g-cartografia-pin-nuevo2"></div>\n            <div class="style-grid-item g-cartografia-pin-seleccionado"></div>\n            <div class="style-grid-item g-cartografia-brujula-norte"></div>\n            <div class="style-grid-item fa fa-glass"></div>\n            <div class="style-grid-item fa fa-music"></div>\n            <div class="style-grid-item fa fa-search"></div>\n            <div class="style-grid-item fa fa-envelope-o"></div>\n            <div class="style-grid-item fa fa-heart"></div>\n            <div class="style-grid-item fa fa-star"></div>\n            <div class="style-grid-item fa fa-star-o"></div>\n            <div class="style-grid-item fa fa-user"></div>\n            <div class="style-grid-item fa fa-film"></div>\n            <div class="style-grid-item fa fa-th-large"></div>\n            <div class="style-grid-item fa fa-th"></div>\n            <div class="style-grid-item fa fa-th-list"></div>\n            <div class="style-grid-item fa fa-check"></div>\n            <div class="style-grid-item fa fa-remove"></div>\n            <div class="style-grid-item fa fa-close"></div>\n            <div class="style-grid-item fa fa-times"></div>\n            <div class="style-grid-item fa fa-search-plus"></div>\n            <div class="style-grid-item fa fa-search-minus"></div>\n            <div class="style-grid-item fa fa-power-off"></div>\n            <div class="style-grid-item fa fa-signal"></div>\n            <div class="style-grid-item fa fa-gear"></div>\n            <div class="style-grid-item fa fa-cog"></div>\n            <div class="style-grid-item fa fa-trash-o"></div>\n            <div class="style-grid-item fa fa-home"></div>\n            <div class="style-grid-item fa fa-file-o"></div>\n            <div class="style-grid-item fa fa-clock-o"></div>\n            <div class="style-grid-item fa fa-road"></div>\n            <div class="style-grid-item fa fa-download"></div>\n            <div class="style-grid-item fa fa-arrow-circle-o-down"></div>\n            <div class="style-grid-item fa fa-arrow-circle-o-up"></div>\n            <div class="style-grid-item fa fa-inbox"></div>\n            <div class="style-grid-item fa fa-play-circle-o"></div>\n            <div class="style-grid-item fa fa-rotate-right"></div>\n            <div class="style-grid-item fa fa-repeat"></div>\n            <div class="style-grid-item fa fa-refresh"></div>\n            <div class="style-grid-item fa fa-list-alt"></div>\n            <div class="style-grid-item fa fa-lock"></div>\n            <div class="style-grid-item fa fa-flag"></div>\n            <div class="style-grid-item fa fa-headphones"></div>\n            <div class="style-grid-item fa fa-volume-off"></div>\n            <div class="style-grid-item fa fa-volume-down"></div>\n            <div class="style-grid-item fa fa-volume-up"></div>\n            <div class="style-grid-item fa fa-qrcode"></div>\n            <div class="style-grid-item fa fa-barcode"></div>\n            <div class="style-grid-item fa fa-tag"></div>\n            <div class="style-grid-item fa fa-tags"></div>\n            <div class="style-grid-item fa fa-book"></div>\n            <div class="style-grid-item fa fa-bookmark"></div>\n            <div class="style-grid-item fa fa-print"></div>\n            <div class="style-grid-item fa fa-camera"></div>\n            <div class="style-grid-item fa fa-font"></div>\n            <div class="style-grid-item fa fa-bold"></div>\n            <div class="style-grid-item fa fa-italic"></div>\n            <div class="style-grid-item fa fa-text-height"></div>\n            <div class="style-grid-item fa fa-text-width"></div>\n            <div class="style-grid-item fa fa-align-left"></div>\n            <div class="style-grid-item fa fa-align-center"></div>\n            <div class="style-grid-item fa fa-align-right"></div>\n            <div class="style-grid-item fa fa-align-justify"></div>\n            <div class="style-grid-item fa fa-list"></div>\n            <div class="style-grid-item fa fa-dedent"></div>\n            <div class="style-grid-item fa fa-outdent"></div>\n            <div class="style-grid-item fa fa-indent"></div>\n            <div class="style-grid-item fa fa-video-camera"></div>\n            <div class="style-grid-item fa fa-photo"></div>\n            <div class="style-grid-item fa fa-image"></div>\n            <div class="style-grid-item fa fa-picture-o"></div>\n            <div class="style-grid-item fa fa-pencil"></div>\n            <div class="style-grid-item fa fa-map-marker"></div>\n            <div class="style-grid-item fa fa-adjust"></div>\n            <div class="style-grid-item fa fa-tint"></div>\n            <div class="style-grid-item fa fa-edit"></div>\n            <div class="style-grid-item fa fa-pencil-square-o"></div>\n            <div class="style-grid-item fa fa-share-square-o"></div>\n            <div class="style-grid-item fa fa-check-square-o"></div>\n            <div class="style-grid-item fa fa-arrows"></div>\n            <div class="style-grid-item fa fa-step-backward"></div>\n            <div class="style-grid-item fa fa-fast-backward"></div>\n            <div class="style-grid-item fa fa-backward"></div>\n            <div class="style-grid-item fa fa-play"></div>\n            <div class="style-grid-item fa fa-pause"></div>\n            <div class="style-grid-item fa fa-stop"></div>\n            <div class="style-grid-item fa fa-forward"></div>\n            <div class="style-grid-item fa fa-fast-forward"></div>\n            <div class="style-grid-item fa fa-step-forward"></div>\n            <div class="style-grid-item fa fa-eject"></div>\n            <div class="style-grid-item fa fa-chevron-left"></div>\n            <div class="style-grid-item fa fa-chevron-right"></div>\n            <div class="style-grid-item fa fa-plus-circle"></div>\n            <div class="style-grid-item fa fa-minus-circle"></div>\n            <div class="style-grid-item fa fa-times-circle"></div>\n            <div class="style-grid-item fa fa-check-circle"></div>\n            <div class="style-grid-item fa fa-question-circle"></div>\n            <div class="style-grid-item fa fa-info-circle"></div>\n            <div class="style-grid-item fa fa-crosshairs"></div>\n            <div class="style-grid-item fa fa-times-circle-o"></div>\n            <div class="style-grid-item fa fa-check-circle-o"></div>\n            <div class="style-grid-item fa fa-ban"></div>\n            <div class="style-grid-item fa fa-arrow-left"></div>\n            <div class="style-grid-item fa fa-arrow-right"></div>\n            <div class="style-grid-item fa fa-arrow-up"></div>\n            <div class="style-grid-item fa fa-arrow-down"></div>\n            <div class="style-grid-item fa fa-mail-forward"></div>\n            <div class="style-grid-item fa fa-share"></div>\n            <div class="style-grid-item fa fa-expand"></div>\n            <div class="style-grid-item fa fa-compress"></div>\n            <div class="style-grid-item fa fa-plus"></div>\n            <div class="style-grid-item fa fa-minus"></div>\n            <div class="style-grid-item fa fa-asterisk"></div>\n            <div class="style-grid-item fa fa-exclamation-circle"></div>\n            <div class="style-grid-item fa fa-gift"></div>\n            <div class="style-grid-item fa fa-leaf"></div>\n            <div class="style-grid-item fa fa-fire"></div>\n            <div class="style-grid-item fa fa-eye"></div>\n            <div class="style-grid-item fa fa-eye-slash"></div>\n            <div class="style-grid-item fa fa-warning"></div>\n            <div class="style-grid-item fa fa-exclamation-triangle"></div>\n            <div class="style-grid-item fa fa-plane"></div>\n            <div class="style-grid-item fa fa-calendar"></div>\n            <div class="style-grid-item fa fa-random"></div>\n            <div class="style-grid-item fa fa-comment"></div>\n            <div class="style-grid-item fa fa-magnet"></div>\n            <div class="style-grid-item fa fa-chevron-up"></div>\n            <div class="style-grid-item fa fa-chevron-down"></div>\n            <div class="style-grid-item fa fa-retweet"></div>\n            <div class="style-grid-item fa fa-shopping-cart"></div>\n            <div class="style-grid-item fa fa-folder"></div>\n            <div class="style-grid-item fa fa-folder-open"></div>\n            <div class="style-grid-item fa fa-arrows-v"></div>\n            <div class="style-grid-item fa fa-arrows-h"></div>\n            <div class="style-grid-item fa fa-bar-t-o"></div>\n            <div class="style-grid-item fa fa-bar-t"></div>\n            <div class="style-grid-item fa fa-twitter-square"></div>\n            <div class="style-grid-item fa fa-facebook-square"></div>\n            <div class="style-grid-item fa fa-camera-retro"></div>\n            <div class="style-grid-item fa fa-key"></div>\n            <div class="style-grid-item fa fa-gears"></div>\n            <div class="style-grid-item fa fa-cogs"></div>\n            <div class="style-grid-item fa fa-comments"></div>\n          </div>\n        </div>\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>Radio:</span>\n          <input type="number" min="1" max="100" value="20" data-style-options="form.radius" value="{{icon.radius}}">\n        </div>\n\n        <div class="style-col-2">\n          <span>Tamaño icono:</span>\n          <input type="number" step="0.1" min=0 max=100 data-style-options="form.fontsize" value="{{icon.fontsize}}">\n        </div>\n\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Gradiente</span>\n          <input type="checkbox" data-style-options="form.gradient" {{#if icon.gradient}}checked{{/if}}>\n        </div>\n\n        <div class="style-col-2">\n          <span>Color de icono:</span>\n          <input type="color" data-style-options="form.color" value="{{icon.color}}">\n        </div>\n      </div>\n\n      \x3c!-- Common --\x3e\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{#get 0 icon.offset}}{{/get}}" type="number" data-target="form-offset"\n            data-style-options="form.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.offset}}{{/get}}" type="number" data-id="form-offset" />\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input value="{{icon.opacity}}" type="number" step="0.1" min=0 max=1 data-style-options="form.opacity">\n        </div>\n      </div>\n\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if icon.rotate}}checked {{/if}} type="checkbox" data-style-options="form.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación:</span>\n          <input value="{{icon.rotation}}" type="number" min=0 max=360 data-style-options="form.rotation">\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n</div>\n\n</div>'},function(t,e){t.exports='<div>\n  {{#each attributes}}\n  <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n  {{/each}}\n</div>\n'},function(t,e){t.exports='<div class="">\n  <table class="m-table-category">\n    <tr>\n      <th>Valor de atributo</th>\n      <th>Previsualización</th>\n    </tr>\n    {{#each values}}\n    <tr>\n      <td id="{{this.name}}">{{this.name}}</td>\n      <td><img id="img-{{this.name}}" src="xxxHTMLLINKxxx0.30858044455981170.20615833796869776xxx" alt=""></td>\n    </tr>\n    {{/each}} {{#if attributeExists}}\n    <tr>\n      <td id="other">Otros</td>\n      <td><img id="img-other" src="xxxHTMLLINKxxx0.6917496583879630.5836323833257642xxx" alt=""></td>\n    </tr>\n    {{/if}}\n  </table>\n</div>\n'},function(t,e){t.exports='<div class="m-stylemanager-control styles-panel">\n  <div class="m-stylemanager-container-select">\n    <ul>\n      <li class="group">\n        <div class="m-stylemanager-buttons-wrap">\n          <select class="" id="m-stylemanager-select">\n            <option disabled="disabled" selected="selected">Seleccione una capa...</option>\n          {{#each layers}}\n               <option name={{this.name}}>{{this.name}}</option>\n          {{/each}}\n          </select>\n          <button title="Aplicar estilo" class="m-button-styles" data-apply-style><i class="gi-1x g-sigc-apply"></i></button>\n          <button title="Limpiar estilo" class="m-button-styles" data-clear-style><i class="gi-1x g-sigc-reset"></i></button>\n        </div>\n      </li>\n    </ul>\n\n    <div class="m-boxes m-hidden m-boxes-botonera" data-role="botonera">\n      <input data-checkbox="stylesimple" type="checkbox" class="m-input" id="box-4">\n      <label data-flap="stylesimple" for="box-4" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-simple"></i> Simple</label>\n\n      \x3c!-- submenu --\x3e\n      <div data-buttons-option class="m-submenu-simple">\n      </div>\n\n      \x3c!-- fin submenu --\x3e\n\n      <input data-checkbox="stylecluster" type="checkbox" class="m-input" id="box-1">\n      <label data-flap="stylecluster" for="box-1" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-cluster"></i> Cluster</label>\n\n      <input data-checkbox="styleheatmap" type="checkbox" class="m-input" id="box-2">\n      <label data-flap="styleheatmap" for="box-2" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-heatmap"></i> Mapa de calor</label>\n\n      <input data-checkbox="stylecategory" type="checkbox" class="m-input" id="box-3">\n      <label data-flap="stylecategory" for="box-3" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-category"></i>Categoría</label>\n\n      <div data-buttons-option-category class="m-hidden m-submenu-simple">\n      </div>\n\n      <input data-checkbox="stylechoropleth" type="checkbox" class="m-input" id="box-5">\n      <label data-flap="stylechoropleth" for="box-5" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-choro"></i>Coropletas</label>\n\n      <input data-checkbox="styleproportional" type="checkbox" class="m-input" id="box-6">\n      <label data-flap="styleproportional" for="box-6" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-proportional"></i> Proporcional</label>\n\n      <input data-checkbox="stylechart" type="checkbox" class="m-input" id="box-7">\n      <label data-flap="stylechart" for="box-7" class="check-selected check-inactive"></label>\n      <label><i class="gi-1x g-sigc-chart"></i>Estadísticos</label>\n    </div>\n\n\n  </div>\n</div>\n'},function(t,e){t.exports='<div data-role="m-proportional" class="m-stylemanager-simple-section m-proportional m-hidden">\n  <div class="styles-row">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Atributos:</span>\n          <select data-options="attributeName">\n        {{#each attributes}}\n          <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n        {{/each}}\n      </select>\n        </div>\n      </div>\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Radio mínimo:</span>\n          <input type="number" min="1" data-options="minRadius" value="{{this.minRadius}}">\n        </div>\n        <div class="style-col-2">\n          <span for="">Radio máximo:</span>\n          <input type="number" min="1" data-options="maxRadius" value="{{this.maxRadius}}">\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div data-role="m-cluster" class="m-stylemanager-simple-section m-hidden">\n  \x3c!-- Ranges Options --\x3e\n  <div class="styles-row" data-id="ranges">\n    <div class="title">Rangos</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Número de rangos:</span>\n          <input type="number" data-number-ranges value="{{ranges.length}}" min="1" max="12">\n        </div>\n      </div>\n      <div data-parent="ranges">\n        {{#each ranges}}\n        <div {{#neq @index 0}} class="m-hidden" {{/neq}} data-page="{{#sum @index 1}}{{/sum}}">\n          <div class="subtitle">Rango {{#sum @index 1}}{{/sum}}</div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Desde:</span>\n              <input data-apply-range type="number" min="0" data-ranges-options="minRange" data-ranges-id="{{#sum @index 1}}{{/sum}}" value="{{min}}">\n            </div>\n            <div class="style-col-2">\n              <span>Hasta:</span>\n              <input data-apply-range type="number" min="0" data-ranges-options="maxRange" data-ranges-id="{{#sum @index 1}}{{/sum}}" value="{{max}}">\n            </div>\n          </div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Relleno:</span>\n              <input data-apply-range value="{{fill}}" type="color" data-ranges-options="style.fill.color" data-ranges-id="{{#sum @index 1}}{{/sum}}">\n            </div>\n            <div class="style-col-2">\n              <span>Opacidad:</span>\n              <input data-apply-range value="{{opacity}}" min="0" step="0.1" type="number" data-ranges-options="style.fill.opacity" data-ranges-id="{{#sum @index 1}}{{/sum}}">\n            </div>\n          </div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Borde:</span>\n              <input data-apply-range type="color" value="{{stroke}}" data-ranges-options="style.stroke.color" data-ranges-id="{{#sum @index 1}}{{/sum}}">\n            </div>\n            <div class="style-col-2">\n              <span>Ancho:</span>\n              <input data-apply-range value="{{width}}" type="number" min="1" data-ranges-options="style.stroke.width" data-ranges-id="{{#sum @index 1}}{{/sum}}">\n            </div>\n          </div>\n\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Radio:</span>\n              <input data-apply-range value="{{#if radius}}{{radius}}{{/if}}{{#unless radius}}10{{/unless}}" type="number" min="1" data-ranges-options="style.radius" data-ranges-id="{{#sum @index 1}}{{/sum}}">\n            </div>\n          </div>\n        </div>\n        {{/each}} {{#pages}}\n        <div class="m-hidden" data-page="{{id}}">\n          <div class="subtitle">Rango {{id}}</div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Desde:</span>\n              <input value="{{min}}" type="number" min="0" data-ranges-options="minRange" data-ranges-id="{{id}}">\n            </div>\n            <div class="style-col-2">\n              <span>Hasta:</span>\n              <input value="{{max}}" type="number" min="0" data-ranges-options="maxRange" data-ranges-id="{{id}}">\n            </div>\n          </div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Relleno:</span>\n              <input type="color" value="{{fill}}" data-ranges-options="style.fill.color" data-ranges-id="{{id}}">\n            </div>\n            <div class="style-col-2">\n              <span>Opacidad:</span>\n              <input value="1" step="0.1" type="number" min="0" data-ranges-options="style.fill.opacity" data-ranges-id="{{id}}">\n            </div>\n          </div>\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Borde:</span>\n              <input type="color" value="{{stroke}}" data-ranges-options="style.stroke.color" data-ranges-id="{{id}}">\n            </div>\n            <div class="style-col-2">\n              <span>Ancho:</span>\n              <input value="2" type="number" min="1" data-ranges-options="style.stroke.width" data-ranges-id="{{id}}">\n            </div>\n          </div>\n\n          <div class="group-row">\n            <div class="style-col-1">\n              <span>Radio:</span>\n              <input value="10" type="number" min="1" data-ranges-options="style.radius" data-ranges-id="{{id}}">\n            </div>\n          </div>\n        </div>\n        {{/pages}}\n      </div>\n\n      <div class="m-pagination" data-parent-pagination>\n        <ul>\n          {{#each ranges}}\n          <li data-page-selector="{{#sum @index 1}}{{/sum}}" {{#eq @index 0}} data-page-active class="m-page-active" {{/eq}}>{{#sum @index 1}}{{/sum}}</li>\n          {{/each}} {{#each pages}}\n          <li data-page-selector="{{id}}" class="m-hidden">{{id}}</li>\n          {{/each}}\n\n        </ul>\n      </div>\n\n    </div>\n  </div>\n  \x3c!-- Vendor Options --\x3e\n  <div class="styles-row" data-id="options">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n        <div class="style-col-1 input-reverse">\n          <span>Envoltura</span>\n          <input type="checkbox" data-style-options="hoveInteraction" {{#if hoverInteraction}}checked{{/if}}>\n        </div>\n        <div class="style-col-2 input-reverse">\n          <span>Cantidad</span>\n          <input type="checkbox" data-style-options="displayAmount" {{#if displayAmount}}checked{{/if}}>\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1 input-reverse">\n          <span>Seleccionable</span>\n          <input type="checkbox" data-style-options="selectInteraction" {{#if selectInteraction}}checked{{/if}}>\n        </div>\n        <div class="style-col-2 input-reverse">\n          <span>Animado</span>\n          <input type="checkbox" data-style-options="animated" {{#if animated}}checked{{/if}}>\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Distancia:</span>\n          <input type="number" min="1" data-style-options="distance" value="{{distance}}">\n        </div>\n        <div class="style-col-2">\n          <span>Puntos:</span>\n          <input type="number" min="1" data-style-options="maxFeaturesToSelect" value="{{maxFeaturesToSelect}}">\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Distancia de abanico:</span>\n          <input type="number" min="1" data-style-options="distanceSelectFeatures" value="{{distanceSelectFeatures}}">\n        </div>\n        <div class="style-col-2">\n          <span>Color de texto:</span>\n          <input type="color" data-style-options="label.color" value="{{label.color}}">\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>'},function(t,e){t.exports='<div data-role="m-choropleth" class="m-stylemanager-simple-section m-hidden m-choropleth">\n  <div class="styles-row">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Atributos:</span>\n          <select data-options="attributeName">\n            {{#each attributes}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}} selected {{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n      </div>\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Algoritmo:</span>\n          <select data-options="quantification">\n            <option value="JENKS" {{#eq quantification "jenks"}}selected{{/eq}}>Jenks</option>\n            <option value="QUANTILE" {{#eq quantification "quantile"}}selected{{/eq}}>Quantile</option>\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Rangos:</span>\n          <input type="number" min="2" data-number-ranges data-options="ranges" value="{{ranges}}">\n        </div>\n      </div>\n      <div class="subtitle">Rampa de color</div>\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Inicial:</span>\n          <input type="color" data-array-options="colors" value="{{startColor}}">\n        </div>\n        <div class="style-col-2">\n          <span>Final:</span>\n          <input type="color" data-array-options="colors" value="{{endColor}}">\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div data-role="m-category" class="m-stylemanager-simple-section m-category m-hidden">\n  <div class="styles-row">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Atributo:</span>\n          <select data-options="attributeName">\n          {{#each attributes}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n          {{/each}}\n        </select>\n        </div>\n      </div>\n\n      <div class="container-table" data-options="values">\n\n      </div>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div data-role="m-heatmap" class="m-stylemanager-simple-section m-hidden m-heatmap">\n  <div class="styles-row">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Atributo:</span>\n          <select data-options="attributeName">\n        {{#each attributes}}\n          <option value="{{this.name}}"{{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n        {{/each}}\n      </select>\n        </div>\n      </div>\n      <div class="group-row">\n        <div class="style-col-1" >\n          <span>Gradiente:</span>\n          <div class="m-grid" data-parent="gradient">\n          {{#each gradient}}\n          <div class="m-removable-input-color">\n            <input type="color" data-array-options="gradient" value="{{this}}">\n            <span class="m-close"></span>\n          </div>\n          {{/each}}\n        </div>\n        </div>\n        <div class="style-col-2">\n          <span></span>\n          <button data-add class="m-add-gradient m-button-styles">Añadir color</button>\n        </div>\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span for="">Difuminado:</span>\n          <input type="number" data-style-options="blur" min="1" value="{{blur}}">\n        </div>\n\n        <div class="style-col-2">\n          <span for="">Radio:</span>\n          <input type="number" data-style-options="radius" min="1" value="{{radius}}">\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div data-role="m-chart" class="m-stylemanager-simple-section m-chart m-hidden">\n  <div class="styles-row m-stylechart">\n    <div class="title">Opciones</div>\n\n    <div class="group-row">\n      <div class="style-col-1">\n        <span>Tipo:</span>\n        <select data-style-options="type">\n          <option value="pie" {{#eq type "pie"}}selected {{/eq}}>Tarta</option>\n          <option value="pie3D" {{#eq type "pie3D"}}selected {{/eq}}>Tarta 3D</option>\n          <option value="donut" {{#eq type "donut"}}selected {{/eq}}>Donut</option>\n          <option value="bar" {{#eq type "bar"}}selected {{/eq}}>Gráfico</option>\n        </select>\n      </div>\n\n      <div class="style-col-2">\n        <span>Color:</span>\n        <select data-style-options="scheme">\n          <option value="Classic" {{#eq scheme "Classic"}}selected {{/eq}}>Clásico</option>\n          <option value="Dark" {{#eq scheme "Dark"}}selected {{/eq}}>Oscuro</option>\n          <option value="Pale" {{#eq scheme "Pale"}}selected {{/eq}}>Pálido</option>\n          <option value="Pastel" {{#eq scheme "Pastel"}}selected {{/eq}}>Neón</option>\n          <option value="Neon" {{#eq scheme "Neon"}}selected {{/eq}}>Pastel</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="group-row">\n      <div class="style-col-1">\n        <span>Eje X:</span>\n        <input type="number" value="{{offsetX}}" data-style-options="offsetX">\n      </div>\n\n      <div class="style-col-2">\n        <span>Eje Y:</span>\n        <input type="number" value="{{offsetY}}" data-style-options="offsetY">\n      </div>\n    </div>\n\n    <div class="group-row">\n      <div class="style-col-1 {{#eq type \'bar\'}}m-hidden{{/eq}}" data-type="donut,pie,pie3D">\n        <span>Radio:</span>\n        <input type="number" min="1" value="{{radius}}" data-style-options="radius">\n      </div>\n\n      <div class="style-col-2 {{#neq type \'donut\'}}m-hidden{{/neq}}" data-type="donut">\n        <span>Radio de donut:</span>\n        <input type="number" min="0" value="6" data-style-options="donutRadio">\n      </div>\n    </div>\n\n    <div class="group-row">\n      <div class="style-col-1 {{#neq type \'pie3D\'}}m-hidden{{/neq}}" data-type="pie3D">\n        <span>Color 3D:</span>\n        <input type="color" value="#ff00f0" data-style-options="fill3DColor">\n      </div>\n    </div>\n\n  </div>\n  <div class="styles-row m-stylechart">\n    <div class="title">Atributos</div>\n    <div class="group-row">\n\n      <div class="style-col-1">\n        <span>Atributo:</span>\n        <select data-attribute>\n\n        </select>\n      </div>\n\n      <div class="style-col-2">\n        <span></span>\n        <button data-add class="m-add-gradient m-button-styles">Añadir atributo</button>\n      </div>\n    </div>\n    <div class="m-chart-variables" data-variables>\n    </div>\n\n    <div class="m-pagination" data-pagination>\n    </div>\n\n  </div>\n</div>\n'},function(t,e){t.exports='<div>\n  {{#each buttonsParams}}\n  <input data-apply="{{id}}" type="checkbox" class="m-input" id="{{id}}">\n  <label data-selector="{{id}}" for="{{id}}" class="submenu-check check-selected"></label>\n  <label data-label="{{id}}" class="submenu-label">{{name}}</label>\n  {{/each}}\n</div>\n'},function(t,e){t.exports='<div>\n  {{#each buttonsParams}}\n  <input data-apply="{{id}}" type="checkbox" class="m-input" id="cat-{{id}}">\n  <label data-selector="{{id}}" for="cat-{{id}}" class="submenu-check check-selected"></label>\n  <label data-label="{{id}}" class="submenu-label">{{name}}</label> {{/each}}\n</div>\n'},function(t,e){t.exports='<div data-category-section>\n  <div class="styles-row m-hidden m-simple-category" data-id="fill">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input data-style-options="fill.color" type="color" value="{{fill.color}}">\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input data-style-options="fill.opacity" type="number" value="{{fill.opacity}}" min="0" step="0.1" max="1">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="point">\n        <div class="style-col-1">\n          <span>Radio:</span>\n          <input data-style-options="radius" type="number" value="{{radius}}" min="1" max="60">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="line">\n        <div class="style-col-1">\n          <span>Ancho:</span>\n          <input value="{{fill.width}}" type="number" data-style-options="fill.width">\n        </div>\n      </div>\n      \x3c!-- Polygon Pattern --\x3e\n      <div class="subtitle" data-geometry="polygon">Opciones de patrón</div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1 input-reverse">\n          <span>Patrón</span>\n          <input data-apply="fill.pattern" type="checkbox" {{#if patternflag }}checked{{/if}}>\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Tipo:</span>\n          <select data-style-options="fill.pattern.name">\n            {{#each patternlist}}\n            <option value="{{#lowercase this.name}}{{/lowercase}}" {{#eq this.name this.selected}} selected {{/eq}}>\n              {{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Color:</span>\n          <input value="{{fill.pattern.color}}" type="color" data-style-options="fill.pattern.color">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Tamaño:</span>\n          <input value="{{fill.pattern.size}}" type="number" min="1" max="100" data-style-options="fill.pattern.size">\n        </div>\n\n        <div class="style-col-2">\n          <span>Espacio:</span>\n          <input value="{{fill.pattern.spacing}}" type="number" min="1" max="100"\n            data-style-options="fill.pattern.spacing">\n        </div>\n      </div>\n\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Rotación:</span>\n          <input value="{{fill.pattern.rotation}}" type="number" min="0" max="360" step="1"\n            data-style-options="fill.pattern.rotation">\n        </div>\n\n        <div class="style-col-2">\n          <span>Escala:</span>\n          <input value="{{fill.pattern.scale}}" type="number" min="1" max="30" data-style-options="fill.pattern.scale">\n        </div>\n      </div>\n      <div class="group-row" data-geometry="polygon">\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{fill.pattern.offset}}" type="number" min="1" data-style-options="fill.pattern.offset">\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Stroke options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="stroke">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input value="{{stroke.color}}" type="color" data-style-options="stroke.color">\n        </div>\n\n        <div class="style-col-2">\n          <span>Ancho:</span>\n          <input value="{{stroke.width}}" type="number" value="2" min="1" data-style-options="stroke.width">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n        <div class="style-col-1">\n          <span>Linedash:</span>\n          <input value="{{#get 0 stroke.linedash}}{{/get}}" type="number" data-target="stroke.linedash"\n            data-style-options="stroke.linedash">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 stroke.linedash}}{{/get}}" type="number" data-id="stroke.linedash">\n        </div>\n\n        <div class="style-col-2">\n          <span>Linedash Offset:</span>\n          <input type="number" value="{{stroke.linedashoffset}}" data-style-options="stroke.linedashoffset">\n        </div>\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Cap</span>\n          <select data-style-options="stroke.linecap">\n            <option value="">Ninguno</option>\n            {{#each linecapstroke}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Line Join</span>\n          <select data-style-options="stroke.linejoin">\n            <option value="">Ninguno</option>\n            {{#each linejoinstroke}}\n            <option value="{{this.name}}" {{#eq this.name this.selected}}selected{{/eq}}> {{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Label options --\x3e\n  <div class="styles-row m-hidden m-simple-category m-label-option" data-id="label">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Color</span>\n          <input value="{{label.fill.color}}" type="color" data-style-options="label.color" value="#0d5cdc">\n        </div>\n\n        <div class="style-col-2">\n          <span>Texto:</span>\n          <select data-style-options="label.text">\n            {{#each featuresAttr}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Fuente:</span>\n          <select data-font-family>\n            <option value="serif">Serif</option>\n            <option value="sans-serif">Sans-Serif</option>\n            <option value="mono">Mono</option>\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Tamaño:</span>\n          <input data-font-size type="number" min="1" value="12">\n        </div>\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Alineación horizontal:</span>\n          <select data-style-options="label.align">\n            {{#each alignlist}}\n            <option value="{{this.name}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Alineación vertical:</span>\n          <select data-style-options="label.baseline">\n            {{#each baselinelist}}\n            <option value="{{this.name}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if label.rotate}}checked{{/if}} type="checkbox" data-style-options="label.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación:</span>\n          <input value="{{label.rotation}}" type="number" step="0.1" data-style-options="label.rotation">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Escala:</span>\n          <input value="{{label.scale}}" type="number" max="3" min="0" step="0.1" value="2"\n            data-style-options="label.scale">\n        </div>\n\n        <div class="style-col-2">\n          <span>Offset:</span>\n          <input value="{{#get 0 label.offset}}{{/get}}" type="number" data-target="label.offset"\n            data-style-options="label.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 label.offset}}{{/get}}" type="number" data-id="label.offset">\n        </div>\n\n      </div>\n\n      \x3c!-- TextPath Options --\x3e\n\n      <div class="group-row" data-geometry="line">\n\n        <div class="style-col-1 input-reverse">\n          <span>Ajustar</span>\n          <input {{#if label.path}}checked{{/if}} type="checkbox" data-style-options="label.path">\n        </div>\n\n        <div class="style-col-2">\n          <span>Ancho Mínimo:</span>\n          <input value="{{label.minwidth}}" type="number" min="1" max="200" value="10"\n            data-style-options="label.minwidth" data-textpath {{#unless label.path}}disabled{{/unless}}>\n        </div>\n\n      </div>\n\n      <div class="group-row" data-geometry="line">\n\n        <div class="style-col-1 input-reverse">\n          <span>Suavizar</span>\n          <input {{#if label.smooth}}checked{{/if}} type="checkbox" data-style-options="label.smooth" data-textpath\n            {{#unless label.path}}disabled{{/unless}}>\n        </div>\n\n        <div class=style-col-2>\n          <span>Desbordar:</span>\n          <select data-style-options="label.textoverflow" data-textpath {{#unless label.path}}disabled{{/unless}}>\n            <option value="hidden">Oculto</option>\n            <option value="visible">Visible</option>\n            <option value="ellipsis">Puntos suspensivos</option>\n          </select>\n        </div>\n\n      </div>\n\n      \x3c!-- Stroke Label --\x3e\n      <div class="subtitle">Trazo de etiqueta:</div>\n      <div class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Trazo</span>\n          <input type="checkbox" data-apply="label.stroke" {{#neq label.stroke.color \'no-color\' }}checked{{/neq}}>\n        </div>\n\n      </div>\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Color:</span>\n          <input type="color" data-style-options="label.stroke.color" {{#neq label.stroke.color \'no-color\'\n            }}value="{{label.stroke.color}}" {{/neq}}>\n        </div>\n\n        <div class="style-col-2">\n          <span>Ancho:</span>\n          <input value="{{label.stroke.width}}" type="number" value="2" max="15" min="1"\n            data-style-options="label.stroke.width">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Dash:</span>\n          <input value="{{#get 0 label.stroke.linedash}}{{/get}}" type="number" data-target="label.stroke.linedash"\n            data-style-options="label.stroke.linedash" data-format="array">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 label.stroke.linedash}}{{/get}}" type="number" data-id="label.stroke.linedash">\n        </div>\n\n        <div class="style-col-2">\n          <span>Line Dash Offset:</span>\n          <input type="number" value="{{label.stroke.linedashoffset}}" data-style-options="label.stroke.linedashoffset">\n        </div>\n\n      </div>\n\n      <div class="group-row">\n\n        <div class="style-col-1">\n          <span>Line Cap:</span>\n          <select data-style-options="label.stroke.linecap">\n            {{#each linecaplabelstroke}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Line Join:</span>\n          <select data-style-options="label.stroke.linejoin">\n            {{#each linejoinlabelstroke}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  \x3c!-- Icon Options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="icon">\n    <div class="title">Opciones</div>\n\n    <div class="m-styles-body">\n\n\n      \x3c!-- Point Icon --\x3e\n      <div data-pointicon class="group-row">\n\n        <div class="style-col-1">\n          <span>URL</span>\n          <input value="{{icon.src}}" type="url" data-style-options="src.src">\n        </div>\n        <div class="style-col-2">\n          <span>Tamaño:</span>\n          <input {{#if icon.size}}value="{{#get 0 icon.size}}{{/get}}" {{/if}} type="number" data-undefined\n            data-target="size" data-style-options="src.size">\n          <span class="empty">&nbsp;</span>\n          <input {{#if icon.size}}value="{{#get 1 icon.size}}{{/get}}" {{/if}} type="number" data-undefined\n            data-id="size">\n        </div>\n\n\n      </div>\n\n      <div data-pointicon class="group-row">\n\n\n        <div class="style-col-2 input-reverse m-hidden">\n          <span>Snap to pixel</span>\n          <input {{#if icon.snaptopixel}}checked{{/if}} type="checkbox" data-style-options="src.snaptopixel">\n        </div>\n\n      </div>\n\n      <div data-pointicon class="group-row">\n\n        <div class="style-col-1">\n          <span>Anclaje:</span>\n          <input value="{{#get 0 icon.anchor}}{{/get}}" type="number" data-target="anchor"\n            data-style-options="src.anchor">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.anchor}}{{/get}}" type="number" data-id="anchor">\n        </div>\n\n        <div class="style-col-2">\n          <span>Escala:</span>\n          <input value="{{icon.scale}}" type="number" data-style-options="src.scale" max="3" min="0" step="0.1">\n        </div>\n      </div>\n\n\n\n      \x3c!-- Common --\x3e\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{#get 0 icon.offset}}{{/get}}" type="number" data-target="icon-offset"\n            data-style-options="src.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.offset}}{{/get}}" type="number" data-id="icon-offset" />\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input value="{{icon.opacity}}" type="number" step="0.1" min=0 max=1 data-style-options="src.opacity">\n        </div>\n      </div>\n\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if icon.rotate}}checked {{/if}} type="checkbox" data-style-options="src.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación:</span>\n          <input value="{{icon.rotation}}" type="number" min=0 max=360 data-style-options="src.rotation">\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n\n  \x3c!-- Form Options --\x3e\n  <div class="styles-row m-hidden m-simple-category" data-id="form">\n    <div class="title">Opciones</div>\n    <div class="m-styles-body">\n\n      \x3c!-- Point Font --\x3e\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>bkColor:</span>\n          <input type="color" data-style-options="form.fill" value="{{icon.fill}}">\n        </div>\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>Forma:</span>\n          <select data-style-options="form.form">\n            {{#each formlist}}\n            <option value="{{this.id}}" {{#eq this.id this.selected}}selected{{/eq}}>{{this.name}}</option>\n            {{/each}}\n          </select>\n        </div>\n\n        <div class="style-col-2">\n          <span>Familia:</span>\n          <select data-style-options="form.class" data-icon="{{icon.class}}">\n            <option value="" selected>None</option>\n            <option value="g-cartografia">G-Cartografía</option>\n            <option value="fa">Font Awesome</option>\n          </select>\n          <button id="select-icon" class="g-cartografia-info"></button>\n          <div class="style-grid-container">\n            <div class="style-grid-item g-cartografia-alerta"></div>\n            <div class="style-grid-item g-cartografia-ayuda"></div>\n            <div class="style-grid-item g-cartografia-bandera"></div>\n            <div class="style-grid-item g-cartografia-brujula"></div>\n            <div class="style-grid-item g-cartografia-cancelar"></div>\n            <div class="style-grid-item g-cartografia-cancelar2"></div>\n            <div class="style-grid-item g-cartografia-capas"></div>\n            <div class="style-grid-item g-cartografia-capas2"></div>\n            <div class="style-grid-item g-cartografia-check"></div>\n            <div class="style-grid-item g-cartografia-check2"></div>\n            <div class="style-grid-item g-cartografia-check3"></div>\n            <div class="style-grid-item g-cartografia-check4"></div>\n            <div class="style-grid-item g-cartografia-check5"></div>\n            <div class="style-grid-item g-cartografia-comentarios"></div>\n            <div class="style-grid-item g-cartografia-descargar"></div>\n            <div class="style-grid-item g-cartografia-editar"></div>\n            <div class="style-grid-item g-cartografia-editar2"></div>\n            <div class="style-grid-item g-cartografia-escala"></div>\n            <div class="style-grid-item g-cartografia-escala2"></div>\n            <div class="style-grid-item g-cartografia-escala3"></div>\n            <div class="style-grid-item g-cartografia-flecha"></div>\n            <div class="style-grid-item g-cartografia-flecha-abajo"></div>\n            <div class="style-grid-item g-cartografia-flecha-abajo2"></div>\n            <div class="style-grid-item g-cartografia-flecha-arriba"></div>\n            <div class="style-grid-item g-cartografia-flecha-arriba2"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha2"></div>\n            <div class="style-grid-item g-cartografia-flecha-derecha3"></div>\n            <div class="style-grid-item g-cartografia-flecha-deshacer"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda2"></div>\n            <div class="style-grid-item g-cartografia-flecha-izquierda3"></div>\n            <div class="style-grid-item g-cartografia-flecha-link"></div>\n            <div class="style-grid-item g-cartografia-flechas-mover"></div>\n            <div class="style-grid-item g-cartografia-gps"></div>\n            <div class="style-grid-item g-cartografia-gps2"></div>\n            <div class="style-grid-item g-cartografia-gps3"></div>\n            <div class="style-grid-item g-cartografia-gps4"></div>\n            <div class="style-grid-item g-cartografia-guardar"></div>\n            <div class="style-grid-item g-cartografia-herramienta"></div>\n            <div class="style-grid-item g-cartografia-impresora"></div>\n            <div class="style-grid-item g-cartografia-info"></div>\n            <div class="style-grid-item g-cartografia-linea"></div>\n            <div class="style-grid-item g-cartografia-lineas"></div>\n            <div class="style-grid-item g-cartografia-lista"></div>\n            <div class="style-grid-item g-cartografia-localizacion"></div>\n            <div class="style-grid-item g-cartografia-localizacion2"></div>\n            <div class="style-grid-item g-cartografia-localizacion3"></div>\n            <div class="style-grid-item g-cartografia-localizacion4"></div>\n            <div class="style-grid-item g-cartografia-mano"></div>\n            <div class="style-grid-item g-cartografia-mano2"></div>\n            <div class="style-grid-item g-cartografia-mapa"></div>\n            <div class="style-grid-item g-cartografia-mas"></div>\n            <div class="style-grid-item g-cartografia-mas2"></div>\n            <div class="style-grid-item g-cartografia-medir-area"></div>\n            <div class="style-grid-item g-cartografia-medir-linea"></div>\n            <div class="style-grid-item g-cartografia-menos"></div>\n            <div class="style-grid-item g-cartografia-menos2"></div>\n            <div class="style-grid-item g-cartografia-menu"></div>\n            <div class="style-grid-item g-cartografia-mundo"></div>\n            <div class="style-grid-item g-cartografia-mundo2"></div>\n            <div class="style-grid-item g-cartografia-opciones"></div>\n            <div class="style-grid-item g-cartografia-papelera"></div>\n            <div class="style-grid-item g-cartografia-pin"></div>\n            <div class="style-grid-item g-cartografia-pin-nuevo"></div>\n            <div class="style-grid-item g-cartografia-pin2"></div>\n            <div class="style-grid-item g-cartografia-pin3"></div>\n            <div class="style-grid-item g-cartografia-pin4"></div>\n            <div class="style-grid-item g-cartografia-poligono"></div>\n            <div class="style-grid-item g-cartografia-posicion"></div>\n            <div class="style-grid-item g-cartografia-posicion2"></div>\n            <div class="style-grid-item g-cartografia-posicion3"></div>\n            <div class="style-grid-item g-cartografia-posicion4"></div>\n            <div class="style-grid-item g-cartografia-posicion5"></div>\n            <div class="style-grid-item g-cartografia-posicion6"></div>\n            <div class="style-grid-item g-cartografia-posicion7"></div>\n            <div class="style-grid-item g-cartografia-prismaticos"></div>\n            <div class="style-grid-item g-cartografia-regla"></div>\n            <div class="style-grid-item g-cartografia-reglas"></div>\n            <div class="style-grid-item g-cartografia-ruta"></div>\n            <div class="style-grid-item g-cartografia-spinner"></div>\n            <div class="style-grid-item g-cartografia-subir"></div>\n            <div class="style-grid-item g-cartografia-tamano"></div>\n            <div class="style-grid-item g-cartografia-temperatura"></div>\n            <div class="style-grid-item g-cartografia-texto"></div>\n            <div class="style-grid-item g-cartografia-usuario"></div>\n            <div class="style-grid-item g-cartografia-usuario2"></div>\n            <div class="style-grid-item g-cartografia-zoom"></div>\n            <div class="style-grid-item g-cartografia-zoom-extension"></div>\n            <div class="style-grid-item g-cartografia-zoom-mas"></div>\n            <div class="style-grid-item g-cartografia-zoom-menos"></div>\n            <div class="style-grid-item g-cartografia-pin5"></div>\n            <div class="style-grid-item g-cartografia-pin-nuevo2"></div>\n            <div class="style-grid-item g-cartografia-pin-seleccionado"></div>\n            <div class="style-grid-item g-cartografia-brujula-norte"></div>\n            <div class="style-grid-item fa fa-glass"></div>\n            <div class="style-grid-item fa fa-music"></div>\n            <div class="style-grid-item fa fa-search"></div>\n            <div class="style-grid-item fa fa-envelope-o"></div>\n            <div class="style-grid-item fa fa-heart"></div>\n            <div class="style-grid-item fa fa-star"></div>\n            <div class="style-grid-item fa fa-star-o"></div>\n            <div class="style-grid-item fa fa-user"></div>\n            <div class="style-grid-item fa fa-film"></div>\n            <div class="style-grid-item fa fa-th-large"></div>\n            <div class="style-grid-item fa fa-th"></div>\n            <div class="style-grid-item fa fa-th-list"></div>\n            <div class="style-grid-item fa fa-check"></div>\n            <div class="style-grid-item fa fa-remove"></div>\n            <div class="style-grid-item fa fa-close"></div>\n            <div class="style-grid-item fa fa-times"></div>\n            <div class="style-grid-item fa fa-search-plus"></div>\n            <div class="style-grid-item fa fa-search-minus"></div>\n            <div class="style-grid-item fa fa-power-off"></div>\n            <div class="style-grid-item fa fa-signal"></div>\n            <div class="style-grid-item fa fa-gear"></div>\n            <div class="style-grid-item fa fa-cog"></div>\n            <div class="style-grid-item fa fa-trash-o"></div>\n            <div class="style-grid-item fa fa-home"></div>\n            <div class="style-grid-item fa fa-file-o"></div>\n            <div class="style-grid-item fa fa-clock-o"></div>\n            <div class="style-grid-item fa fa-road"></div>\n            <div class="style-grid-item fa fa-download"></div>\n            <div class="style-grid-item fa fa-arrow-circle-o-down"></div>\n            <div class="style-grid-item fa fa-arrow-circle-o-up"></div>\n            <div class="style-grid-item fa fa-inbox"></div>\n            <div class="style-grid-item fa fa-play-circle-o"></div>\n            <div class="style-grid-item fa fa-rotate-right"></div>\n            <div class="style-grid-item fa fa-repeat"></div>\n            <div class="style-grid-item fa fa-refresh"></div>\n            <div class="style-grid-item fa fa-list-alt"></div>\n            <div class="style-grid-item fa fa-lock"></div>\n            <div class="style-grid-item fa fa-flag"></div>\n            <div class="style-grid-item fa fa-headphones"></div>\n            <div class="style-grid-item fa fa-volume-off"></div>\n            <div class="style-grid-item fa fa-volume-down"></div>\n            <div class="style-grid-item fa fa-volume-up"></div>\n            <div class="style-grid-item fa fa-qrcode"></div>\n            <div class="style-grid-item fa fa-barcode"></div>\n            <div class="style-grid-item fa fa-tag"></div>\n            <div class="style-grid-item fa fa-tags"></div>\n            <div class="style-grid-item fa fa-book"></div>\n            <div class="style-grid-item fa fa-bookmark"></div>\n            <div class="style-grid-item fa fa-print"></div>\n            <div class="style-grid-item fa fa-camera"></div>\n            <div class="style-grid-item fa fa-font"></div>\n            <div class="style-grid-item fa fa-bold"></div>\n            <div class="style-grid-item fa fa-italic"></div>\n            <div class="style-grid-item fa fa-text-height"></div>\n            <div class="style-grid-item fa fa-text-width"></div>\n            <div class="style-grid-item fa fa-align-left"></div>\n            <div class="style-grid-item fa fa-align-center"></div>\n            <div class="style-grid-item fa fa-align-right"></div>\n            <div class="style-grid-item fa fa-align-justify"></div>\n            <div class="style-grid-item fa fa-list"></div>\n            <div class="style-grid-item fa fa-dedent"></div>\n            <div class="style-grid-item fa fa-outdent"></div>\n            <div class="style-grid-item fa fa-indent"></div>\n            <div class="style-grid-item fa fa-video-camera"></div>\n            <div class="style-grid-item fa fa-photo"></div>\n            <div class="style-grid-item fa fa-image"></div>\n            <div class="style-grid-item fa fa-picture-o"></div>\n            <div class="style-grid-item fa fa-pencil"></div>\n            <div class="style-grid-item fa fa-map-marker"></div>\n            <div class="style-grid-item fa fa-adjust"></div>\n            <div class="style-grid-item fa fa-tint"></div>\n            <div class="style-grid-item fa fa-edit"></div>\n            <div class="style-grid-item fa fa-pencil-square-o"></div>\n            <div class="style-grid-item fa fa-share-square-o"></div>\n            <div class="style-grid-item fa fa-check-square-o"></div>\n            <div class="style-grid-item fa fa-arrows"></div>\n            <div class="style-grid-item fa fa-step-backward"></div>\n            <div class="style-grid-item fa fa-fast-backward"></div>\n            <div class="style-grid-item fa fa-backward"></div>\n            <div class="style-grid-item fa fa-play"></div>\n            <div class="style-grid-item fa fa-pause"></div>\n            <div class="style-grid-item fa fa-stop"></div>\n            <div class="style-grid-item fa fa-forward"></div>\n            <div class="style-grid-item fa fa-fast-forward"></div>\n            <div class="style-grid-item fa fa-step-forward"></div>\n            <div class="style-grid-item fa fa-eject"></div>\n            <div class="style-grid-item fa fa-chevron-left"></div>\n            <div class="style-grid-item fa fa-chevron-right"></div>\n            <div class="style-grid-item fa fa-plus-circle"></div>\n            <div class="style-grid-item fa fa-minus-circle"></div>\n            <div class="style-grid-item fa fa-times-circle"></div>\n            <div class="style-grid-item fa fa-check-circle"></div>\n            <div class="style-grid-item fa fa-question-circle"></div>\n            <div class="style-grid-item fa fa-info-circle"></div>\n            <div class="style-grid-item fa fa-crosshairs"></div>\n            <div class="style-grid-item fa fa-times-circle-o"></div>\n            <div class="style-grid-item fa fa-check-circle-o"></div>\n            <div class="style-grid-item fa fa-ban"></div>\n            <div class="style-grid-item fa fa-arrow-left"></div>\n            <div class="style-grid-item fa fa-arrow-right"></div>\n            <div class="style-grid-item fa fa-arrow-up"></div>\n            <div class="style-grid-item fa fa-arrow-down"></div>\n            <div class="style-grid-item fa fa-mail-forward"></div>\n            <div class="style-grid-item fa fa-share"></div>\n            <div class="style-grid-item fa fa-expand"></div>\n            <div class="style-grid-item fa fa-compress"></div>\n            <div class="style-grid-item fa fa-plus"></div>\n            <div class="style-grid-item fa fa-minus"></div>\n            <div class="style-grid-item fa fa-asterisk"></div>\n            <div class="style-grid-item fa fa-exclamation-circle"></div>\n            <div class="style-grid-item fa fa-gift"></div>\n            <div class="style-grid-item fa fa-leaf"></div>\n            <div class="style-grid-item fa fa-fire"></div>\n            <div class="style-grid-item fa fa-eye"></div>\n            <div class="style-grid-item fa fa-eye-slash"></div>\n            <div class="style-grid-item fa fa-warning"></div>\n            <div class="style-grid-item fa fa-exclamation-triangle"></div>\n            <div class="style-grid-item fa fa-plane"></div>\n            <div class="style-grid-item fa fa-calendar"></div>\n            <div class="style-grid-item fa fa-random"></div>\n            <div class="style-grid-item fa fa-comment"></div>\n            <div class="style-grid-item fa fa-magnet"></div>\n            <div class="style-grid-item fa fa-chevron-up"></div>\n            <div class="style-grid-item fa fa-chevron-down"></div>\n            <div class="style-grid-item fa fa-retweet"></div>\n            <div class="style-grid-item fa fa-shopping-cart"></div>\n            <div class="style-grid-item fa fa-folder"></div>\n            <div class="style-grid-item fa fa-folder-open"></div>\n            <div class="style-grid-item fa fa-arrows-v"></div>\n            <div class="style-grid-item fa fa-arrows-h"></div>\n            <div class="style-grid-item fa fa-bar-t-o"></div>\n            <div class="style-grid-item fa fa-bar-t"></div>\n            <div class="style-grid-item fa fa-twitter-square"></div>\n            <div class="style-grid-item fa fa-facebook-square"></div>\n            <div class="style-grid-item fa fa-camera-retro"></div>\n            <div class="style-grid-item fa fa-key"></div>\n            <div class="style-grid-item fa fa-gears"></div>\n            <div class="style-grid-item fa fa-cogs"></div>\n            <div class="style-grid-item fa fa-comments"></div>\n          </div>\n        </div>\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1">\n          <span>Radio:</span>\n          <input type="number" min="1" max="100" value="20" data-style-options="form.radius" value="{{icon.radius}}">\n        </div>\n\n        <div class="style-col-2">\n          <span>Tamaño icono:</span>\n          <input type="number" step="0.1" min=0 max=100 data-style-options="form.fontsize" value="{{icon.fontsize}}">\n        </div>\n\n\n      </div>\n\n      <div data-pointfont class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Gradiente</span>\n          <input type="checkbox" data-style-options="form.gradient" {{#if icon.gradient}}checked{{/if}}>\n        </div>\n\n        <div class="style-col-2">\n          <span>Color de icono:</span>\n          <input type="color" data-style-options="form.color" value="{{icon.color}}">\n        </div>\n      </div>\n\n      \x3c!-- Common --\x3e\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1">\n          <span>Offset:</span>\n          <input value="{{#get 0 icon.offset}}{{/get}}" type="number" data-target="form-offset"\n            data-style-options="form.offset">\n          <span class="empty">&nbsp;</span>\n          <input value="{{#get 1 icon.offset}}{{/get}}" type="number" data-id="form-offset" />\n        </div>\n\n        <div class="style-col-2">\n          <span>Opacidad:</span>\n          <input value="{{icon.opacity}}" type="number" step="0.1" min=0 max=1 data-style-options="form.opacity">\n        </div>\n      </div>\n\n      <div data-common-icon class="group-row">\n\n        <div class="style-col-1 input-reverse">\n          <span>Habilitar rotación con el mapa</span>\n          <input {{#if icon.rotate}}checked {{/if}} type="checkbox" data-style-options="form.rotate">\n        </div>\n\n        <div class="style-col-2">\n          <span>Rotación:</span>\n          <input value="{{icon.rotation}}" type="number" min=0 max=360 data-style-options="form.rotation">\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n</div>\n</div>'},function(t,e){t.exports='<div>\n\n  <div class="subtitle m-hidden" data-target="{{attribute}}" data-delete="{{attribute}}">Variable: {{attribute}} <span data-remove="{{attribute}}" class="m-icon-remove"><i class="g-cartografia-papelera 2x"></i></span></div>\n  <div class="group-row m-hidden" data-target="{{attribute}}" data-delete="{{attribute}}">\n\n    <div class="style-col-1">\n      <span>Leyenda:</span>\n      <input data-variable-option="{{attribute}}.legend" type="text" value="{{legend}}">\n    </div>\n\n    <div class="style-col-2 input-reverse">\n      <span>Mostrar etiqueta</span>\n      <input type="checkbox" data-variable-option="{{attribute}}.labelshow" {{#if label}} checked {{/if}}>\n    </div>\n\n  </div>\n\n  <div data-label-target="{{attribute}}" data-delete="{{attribute}}" class="{{#unless label}}m-hidden{{/unless}}">\n\n    <div class="group-row m-hidden" data-target="{{attribute}}">\n\n      <div class="style-col-1">\n        <span>Relleno:</span>\n        <input data-variable-option="{{attribute}}.label.fill" type="color" value="{{label.fill}}">\n      </div>\n\n      <div class="style-col-2">\n        <span>Tamaño:</span>\n        <input data-variable-option="{{attribute}}.label.scale" type="number" min="1" value="{{label.scale}}">\n      </div>\n\n    </div>\n\n    <div class="group-row m-hidden" data-target="{{attribute}}">\n\n      <div class="style-col-1">\n        <span>Borde:</span>\n        <input type="color" data-variable-option="{{attribute}}.label.stroke.color" value="{{label.stroke.color}}">\n      </div>\n\n      <div class="style-col-2">\n        <span>Grosor:</span>\n        <input type="number" data-variable-option="{{attribute}}.label.stroke.width" min="1" value="{{label.stroke.width}}">\n      </div>\n    </div>\n\n    <div class="group-row m-hidden" data-target="{{attribute}}">\n\n      <div class="style-col-1">\n        <span>Espacio:</span>\n        <input data-variable-option="{{attribute}}.label.radiusIncrement" type="number" value="{{label.radiusIncrement}}">\n      </div>\n    </div>\n  </div>\n  <div class="group-row m-hidden" data-target="{{attribute}}">\n  </div>\n</div>\n'},function(t,e){t.exports='<div>\n  <ul>\n    {{#each ranges}}\n    <li data-page-selector="{{this.attribute}}">{{this.number}}</li>\n    {{/each}}\n  </ul>\n</div>\n'},function(t,e){t.exports='<div>\n  {{#each attributes}}\n  <option value="{{this}}">{{this}}</option>\n  {{/each}}\n</div>\n'},function(t){t.exports={url:{name:"stylemanager",separator:"*"},constructor:"M.plugin.StyleManager",parameters:[{type:"object",properties:[{type:"simple",name:"layer",position:0}]}],files:{ol:{scripts:["stylemanager.ol.min.js"],styles:["stylemanager.ol.min.css"]}},metadata:{name:"stylemanager",description:"Gestión del estilo de la simbología de las capas vectoriales del mapa",text:"Plugin de Mapea para la gestión de la simbología de las capas vectoriales del mapa.",version:"2.0.5",date:"Marzo, 2021",author:"",org:"Consejería de Hacienda, Industria y Energía. Junta de Andalucía",tags:"mapea,plugin",icon:"./facade/assets/icons/icons.svg"}}},function(t,e,o){},function(t,e,o){},function(t,e,i){"use strict";i.r(e),i(18),i(19);var n=i(4),r=i.n(n);function a(t){return(a="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function s(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,o){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,c(e).call(this))}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,M.impl.Control),o=e,(i=[{key:"addTo",value:function(t,o){l(c(e.prototype),"addTo",this).call(this,t,o)}},{key:"activate",value:function(){M.dialog.info("Hello World!")}},{key:"deactivate",value:function(){M.dialog.info("Bye World!")}}])&&s(o.prototype,i),e}(),p=i(1),d=i.n(p),f=i(5),g=i.n(f),m=i(6),y=i.n(m),v=i(7),b=i.n(v),_=i(8),S=i.n(_),w=i(9),x=i.n(w),L=i(10),k=i.n(L),C=i(0),E=i(11),T=i.n(E),P=i(2),O=i.n(P);function A(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var I=function(){function t(e,o,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.htmlParent_=o,this.htmlTemplate_=null,this.html_=e,this.activated_=!0,this.selected_=!1,this.disabled_=!1,this.layer_=r,this.activateButton_=o.querySelector('[data-role="botonera"] [data-flap="'.concat(i,'"]')),this.selectButton_=o.querySelector('[data-role="botonera"] [data-checkbox="'.concat(i,'"]')),this.style_=n,this.styleType_=i,this.compilePromise_=this.initializeView(this.html_,this.htmlParent_)}var e,o,i;return e=t,i=[{key:"createObj",value:function(e,o,i){var n=M.utils.isArray(o)?o:o.split("."),r=n.length,a=n[0];1===r?(M.utils.isArray(i)?i=function(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(i):M.utils.isObject(i)&&(i=Object.assign({},i)),e[a]=i):r>1&&(M.utils.isNullOrEmpty(e[a])&&(e[a]={}),t.createObj(e[a],n.slice(1,r),i))}}],(o=[{key:"compileTemplate",value:function(t,e){return new Promise((function(o){o(M.template.compileSync(t,{vars:e}))}))}},{key:"getCompilePromise",value:function(){return this.compilePromise_}},{key:"initializeView",value:function(t,e){var o=this,i=this.getOptionsTemplate();return this.compileTemplate(t,i).then((function(t){e.appendChild(t),o.htmlTemplate_=t}))}},{key:"getOptionsTemplate",value:function(){}},{key:"addTemplate",value:function(t,e,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.compileTemplate(t,o).then((function(t){e.innerHTML=t.innerHTML,"function"==typeof i&&i()}))}},{key:"appendTemplate",value:function(t,e,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.compileTemplate(t,o).then((function(t){e.appendChild(t),"function"==typeof i&&i()}))}},{key:"generateOptions",value:function(){var e={options:{},ranges:{}};return this.querySelectorAllForEach("[data-options]",(function(t){var o=t.dataset.options,i=t.value;"checkbox"===t.type&&(i=t.checked),"number"===t.type&&(i=parseFloat(i)),e[o]=i})),this.querySelectorAllForEach("[data-style-options]",(function(t){var o=t.dataset.styleOptions,i=t.value;"checkbox"===t.type&&(i=t.checked),"number"===t.type&&(i=parseFloat(i)),e.options[o]=i})),this.querySelectorAllForEach("[data-array-options]",(function(t){var o=t.dataset.arrayOptions,i=t.value;M.utils.isArray(e.options[o])||(e.options[o]=[]),e.options[o].push(i)})),this.querySelectorAllForEach("[data-ranges-id]",(function(o){var i=o.dataset.rangesId;null==e.ranges[i]&&(e.ranges[i]={});var n=o.dataset.rangesOptions,r=o.value;"number"===o.type&&(r=parseFloat(r)),t.createObj(e.ranges[i],n,r)})),e}},{key:"setActivated",value:function(t){this.activated_=t,!0===t&&(this.activateButton_.classList.replace("check-selected","check-active"),this.unhide()),!1===t&&(this.activateButton_.classList.replace("check-active","check-selected"),this.hide())}},{key:"setSelected",value:function(t){this.selected_=t,this.selectButton_.checked=t}},{key:"setDisabled",value:function(t){this.disabled_=t,this.selectButton_.disabled=t,!0===t&&(this.activateButton_.classList.add("check-inactive"),this.setSelected(!t),this.setActivated(!t),this.hide()),!1===t&&this.activateButton_.classList.remove("check-inactive")}},{key:"hide",value:function(){return this.getTemplate().classList.add("m-hidden"),this}},{key:"unhide",value:function(){return this.getTemplate().classList.remove("m-hidden"),this}},{key:"getTemplate",value:function(){return this.htmlTemplate_}},{key:"getParentTemplate",value:function(){return this.htmlParent_}},{key:"querySelector",value:function(t){return this.getTemplate().querySelector(t)}},{key:"querySelectorAll",value:function(t){return this.getTemplate().querySelectorAll(t)}},{key:"querySelectorAllForEach",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Array.prototype.forEach.apply(this.querySelectorAll(t),[e,o])}},{key:"querySelectorAllMap",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Array.prototype.map.apply(this.querySelectorAll(t),[e,o])}},{key:"querySelectorParent",value:function(t){return this.getParentTemplate().querySelector(t)}},{key:"querySelectorAllParent",value:function(t){return this.getParentTemplate().querySelectorAll(t)}},{key:"querySelectorAllForEachParent",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Array.prototype.forEach.apply(this.querySelectorAllParent(t),[e,o])}},{key:"querySelectorAllMapParent",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Array.prototype.map.apply(this.querySelectorAllParent(t),[e,o])}},{key:"setLayer",value:function(t){return this.layer_=t,this}},{key:"getActivateButton",value:function(){return this.activateButton_}},{key:"getSelectButton",value:function(){return this.selectButton_}},{key:"setIntegerAttributes",value:function(){var t=this;if(this.layer_ instanceof M.layer.Vector){var e=this.filterAttributesFeature("number").map((function(t){return{name:t}})),o=this.getTemplate().querySelector("[data-options='attributeName']");this.compileTemplate(O.a,{attributes:e}).then((function(i){o.innerHTML=i.innerHTML,0===e.length?t.deactivateBinding():t.activateBinding()}))}}},{key:"filterAttributesFeature",value:function(t){var e=this.getAllFeaturesAttributes(),o=Object.keys(e);switch(t){case"string":o=o.filter((function(t){return isNaN(parseFloat(e[t]))}));break;case"number":o=o.filter((function(t){return!isNaN(parseFloat(e[t]))}))}return o}},{key:"getFeaturesAttributes",value:function(){return this.layer_.getFeatures()[0].getAttributes()}},{key:"getAllFeaturesAttributes",value:function(){var t=this.getFeaturesAttributes();return this.layer_.getFeatures().reverse().forEach((function(e){Object.keys(e.getAttributes()).forEach((function(e,o){null!=o&&null==t[e]&&(t[e]=o)}))})),t}},{key:"hideAllOptionsSections",value:function(){this.querySelectorAllForEach(".styles-row",(function(t){t.classList.add("m-hidden")}))}},{key:"hideOptionSection",value:function(t){this.querySelector("[data-id=".concat(t,"]")).classList.add("m-hidden")}},{key:"showOptionSection",value:function(t){this.querySelector("[data-id=".concat(t,"]")).classList.remove("m-hidden")}},{key:"addInputListener",value:function(t){this.querySelectorAllForEach("input",(function(e){e.addEventListener("change",t)})),this.querySelectorAllForEach("select",(function(e){e.addEventListener("change",t)}))}},{key:"deactivateBinding",value:function(){this.querySelectorAllForEach("input,select:not([data-options='attributeName']),label,span,.subtitle",(function(t){t.classList.add("m-hidden")})),this.querySelector("[data-options='attributeName']").disabled=!0;var t=document.createElement("option");t.value="",t.innerText="No existen atributos",this.querySelector("[data-options='attributeName']").add(t),this.querySelector("span").classList.remove("m-hidden")}},{key:"activateBinding",value:function(){this.querySelectorAllForEach("input,select:not([data-options='attributeName']),label,span,.subtitle",(function(t){t.classList.remove("m-hidden")})),this.querySelector("[data-options='attributeName']").disabled=!1}},{key:"destroy",value:function(){this.htmlParent_.removeChild(this.htmlTemplate_)}}])&&A(e.prototype,o),i&&A(e,i),t}();function N(t){return(N="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function F(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function D(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var B=function(t){function e(t,o,i,n,r,a){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=function(t,e){return!e||"object"!==N(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,R(e).call(this,t,o,i,n,r))).controller_=a,s}var o,i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(e,I),o=e,n=[{key:"arrayDataToTemplate",value:function(t,e,o){return e.map((function(e,i){return{id:e,name:o[i],selected:t}}))}},{key:"RADIUS_OPTION",get:function(){return 10}},{key:"ICON_RADIUS_OPTION",get:function(){return 10}},{key:"OPTIONS_POINT_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"},{id:"icon",name:"Icono"},{id:"form",name:"Fuente"}]}},{key:"OPTIONS_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"}]}},{key:"GEOMETRIES",get:function(){return["point","line","polygon"]}},{key:"DEFAULT_OPTIONS_STYLE",get:function(){var t;return{radius:10,fill:{color:"#e5008a",opacity:1,width:2,pattern:{color:"red",name:"HATCH",size:1,spacing:2,scale:3,offset:5,rotation:0}},stroke:{color:"#000000",width:2,linedash:[0,0],linedashoffset:0,linecap:"none",linejoin:"none"},label:{fill:{color:"#ff0000"},stroke:{color:"no-color",width:2,linedash:[0,0],linedashoffset:0,linecap:"none",linejoin:"none"},scale:2,text:"Texto de prueba",font:"14px serif",align:"center",baseline:"top",rotate:!1,rotation:0,offset:[0,0]},icon:(t={src:"",form:"",size:[40,40],anchor:[0,0],scale:1,offset:[0,0],rotate:!1,rotation:0,opacity:1},F(t,"form","CIRCLE"),F(t,"class","g-cartografia-info"),F(t,"fill","#ffffff"),F(t,"color","#e07e18"),t)}}}],(i=[{key:"setLayer",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.layer_=t,!0===e&&this.refreshTemplate(),this}},{key:"setGeometry",value:function(t){return e.GEOMETRIES.includes(t)?this.geometry_=t:this.geometry_="point",this}},{key:"getGeometry",value:function(){return this.geometry_}},{key:"refreshTemplate",value:function(){var t=this,o=this.getGeometry();e.GEOMETRIES.filter((function(t){return t!==o})).forEach((function(e){t.querySelectorAllForEach('[data-geometry="'.concat(e,'"]'),(function(t){return t.classList.add("m-hidden")}))})),this.querySelectorAllForEach('[data-geometry="'.concat(o,'"]'),(function(t){return t.classList.remove("m-hidden")})),this.refreshOptionsButtons(),this.addLabelPathListener()}},{key:"refreshOptionsButtons",value:function(){var t=this,o=e.OPTIONS_POINT_SUBMENU;"point"!==this.getGeometry()&&(o=e.OPTIONS_SUBMENU),this.addOptionsButtons(o,(function(){t.compatibleSectionListener("icon","form"),t.compatibleSectionListener("form","icon")}))}},{key:"addOptionsButtons",value:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.getParentTemplate().querySelector("[data-buttons-option]");this.hideAllOptionsSections(),this.addTemplate(T.a,i,{buttonsParams:t},(function(){t.forEach((function(t){e.toggleCheckOptionSection(t.id),e.activateOptionSection(t.id),"function"==typeof o&&o()})),e.activateOptionsStyle(),e.addEventCheckFromSubmenu()}))}},{key:"addEventCheckFromSubmenu",value:function(){var t=this;this.querySelectorAllForEachParent("[data-buttons-option] input",(function(e){e.addEventListener("change",(function(){t.controller_.selectPanel("stylesimple")}))}))}},{key:"activateOptionsStyle",value:function(){var t=this.style_,e=this.querySelector("#select-icon");e.replaceWith(e.cloneNode(!0)),(e=this.querySelector("#select-icon")).addEventListener("click",this.eventOpenIconSelector),document.querySelector(".style-grid-container").addEventListener("click",this.eventSelectIcon);var o=this.querySelector("[data-style-options='form.class']");o.addEventListener("change",this.changeFamilyFont);var i=this.querySelector(".style-col-2 > select[data-style-options = 'form.class']"),n=i.dataset.icon;if(""!==n){var r=n.split("-"),a="g"==r[0]?"g-cartografia":"fa"==r[0]?"fa":"";i.querySelector('option[value="'.concat(a,'"]')).selected=!0,i.dispatchEvent(new Event("change")),document.querySelector("#select-icon").classList=("fa"==a?"fa ":"")+n,document.querySelector(".style-grid-item".concat("fa"==a?".fa":"",".").concat(n)).classList.add("selected")}if(null!=t){var s=t.getOptions();null!=s.fill&&Object.values(s.fill).filter((function(t){return null!=t})).length>0&&this.checkOptionSection("fill"),null!=s.stroke&&this.checkOptionSection("stroke"),null!=s.label&&this.checkOptionSection("label"),null!=s.icon&&(s.icon.hasOwnProperty("src")&&(this.checkOptionSection("icon"),this.disableOption("form")),s.icon.hasOwnProperty("form")&&(this.checkOptionSection("form"),this.disableOption("icon")),s.icon.hasOwnProperty("class")&&(o.value=s.icon.class))}}},{key:"eventOpenIconSelector",value:function(t){var e=document.querySelector(".style-grid-container");"style-grid-container active"===e.classList.toString()?e.classList.remove("active"):e.classList.add("active")}},{key:"eventSelectIcon",value:function(t){if(!t.target.classList.contains("selected")&&t.target.classList.contains("style-grid-item")){var e=document.querySelector(".style-grid-item.selected");e&&e.classList.remove("selected"),t.target.classList.add("selected");var o=t.target.classList.toString().replace("selected","").replace("style-grid-item","").trim();document.querySelector("[data-style-options='form.class']").dataset.icon=o.replace("fa","").trim(),document.querySelector("#select-icon").classList=o}}},{key:"changeFamilyFont",value:function(t){""===t.target.value?(document.querySelector("#select-icon").style.display="none",document.querySelector(".style-grid-container").classList.remove("active")):document.querySelector("#select-icon").style.display="inherit",document.querySelectorAll(".style-grid-item").forEach((function(t){t.style.display="none"})),document.querySelectorAll(".style-grid-item[class*='".concat(t.target.value,"']")).forEach((function(t){t.style.display="inherit"}))}},{key:"addLabelPathListener",value:function(){var t=this,e=this.querySelector("[data-style-options='label.path']");e.addEventListener("change",(function(){t.togglePathSection(!e.checked)}))}},{key:"togglePathSection",value:function(t){this.querySelectorAllForEach("[data-textpath]",(function(e){e.disabled=!0===t&&t}))}},{key:"toggleCheckOptionSection",value:function(t){var e=this;this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]')).addEventListener("change",(function(o){e.toggleCheckOptSectionListener(t,o)}))}},{key:"toggleCheckOptSectionListener",value:function(t,e){!0===e.target.checked&&this.activateOption(t)}},{key:"checkOptionSection",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]'));this.activateOption(t),e.checked=!0}},{key:"activateOptionSection",value:function(t){var e=this;this.getParentTemplate().querySelector('[data-buttons-option] [data-label="'.concat(t,'"]')).addEventListener("click",(function(){e.activateOption(t)}))}},{key:"activateOption",value:function(t){var e=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]+label')),o=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]'));null!=o&&!1===o.disabled&&(this.activateLabel(e),this.displaySectionOption(t))}},{key:"activateLabel",value:function(t){this.querySelectorAllForEachParent("[data-selector]",(function(t){t.classList.remove("check-active"),t.classList.add("check-selected")})),t.classList.add("check-active"),t.classList.remove("check-selected")}},{key:"displaySectionOption",value:function(t){this.hideAllOptionsSections(),this.showOptionSection(t)}},{key:"generateOptions",value:function(){var t=this,e={options:{}};this.querySelectorAllForEach("[data-style-options]",(function(o){var i=o.dataset.styleOptions,n=o.value;"form.class"==i&&""!==n&&(n=t.querySelector("[data-style-options='form.class']").dataset.icon),"checkbox"===o.type&&(n=o.checked),"number"===o.type&&(n=parseFloat(n),isNaN(n)&&(n=0));var r=o.dataset.target;if(void 0!==r){var a=parseFloat(t.querySelector('[data-id="'.concat(r,'"]')).value);isNaN(a)&&(a=0),n=[n,a]}I.createObj(e.options,i,n)})),this.querySelectorAllForEach("[data-apply]",(function(t){var o=t.dataset.apply;!1===t.checked&&I.createObj(e.options,o,void 0)}));var o,i=this.querySelector("[data-font-size]").value||12,n=this.querySelector("[data-font-family]").value,r="".concat(i,"px ").concat(n),a=document.querySelector("[data-apply='icon']"),s=null!==a&&!0===a.checked?e.options.src:e.options.form;return null!=e.options.label&&null!=e.options.label.text&&(o=e.options.label),e.options={fill:e.options.fill,stroke:e.options.stroke,label:o,icon:s,radius:e.options.radius},"line"===this.getGeometry()&&(e.options={fill:e.options.fill,stroke:e.options.stroke,label:e.options.label},delete e.options.fill.pattern,0===Object.keys(e.options.fill).length&&delete e.options.fill),"polygon"===this.getGeometry()&&(e.options={fill:e.options.fill,stroke:e.options.stroke,label:e.options.label}),null!=e.options.label&&(e.options.label.font=r),this.processOptions(e)}},{key:"processOptions",value:function(t){var e=M.utils.extends({},t),o=this.isChecked("fill"),i=this.isChecked("stroke"),n=this.isChecked("label"),r=this.isChecked("icon"),a=this.isChecked("form");return e.options.fill=!0===o?e.options.fill:void 0,e.options.stroke=!0===i?e.options.stroke:void 0,e.options.label=!0===n?e.options.label:void 0,e.options.icon=!0===r||!0===a?e.options.icon:void 0,e}},{key:"isChecked",value:function(t){var e=!1,o=this.getParentTemplate().querySelector("[data-buttons-option] input[data-apply='".concat(t,"'"));return null!=o&&(e=o.checked),e}},{key:"generateStyle",value:function(){var t;this.querySelectorAllForEach("[data-apply]",(function(t){t.checked}));var e=this.getGeometry(),o=this.generateOptions().options;switch(e){case"point":t=new M.style.Point(o);break;case"line":t=new M.style.Line(o);break;case"polygon":t=new M.style.Polygon(o);break;default:M.dialog.error("Geometría no soportada","Error")}return t}},{key:"compatibleSectionListener",value:function(t,e){var o=this,i=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]'));null!=i&&i.addEventListener("change",(function(){!0===i.checked?o.disableOption(e):o.enableOption(e)}))}},{key:"disableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]')),o=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]+label'));this.hideOptionSection(t),o.classList.add("check-inactive"),o.classList.add("check-selected"),o.classList.remove("m-option-active"),e.disabled=!0,e.checked=!1}},{key:"enableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]'));this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]+label')).classList.remove("check-inactive"),e.disabled=!1}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;null!=this.style_&&(null!=this.style_.get("fill.pattern")&&(t.patternflag=!0),t=M.utils.extends({},this.style_.getOptions()),t=M.utils.extends(t,e.DEFAULT_OPTIONS_STYLE)),t.fill.color=C(t.fill.color).hex(),t.stroke.color=C(t.stroke.color).hex(),t.label.fill.color=C(t.label.fill.color).hex(),t.label.stroke.color="no-color"===t.label.stroke.color?"no-color":C(t.label.stroke.color).hex(),t.fill.pattern.color=C(t.fill.pattern.color).hex(),t.icon.fill=C(t.icon.fill).hex(),t.icon.color=C(t.icon.color).hex();var o=Object.keys(M.style.pattern).filter((function(t){return"ICON"!=t&&"IMAGE"!=t})),i=Object.values(M.style.align),n=Object.values(M.style.baseline),r=Object.values(M.style.form).filter((function(t){return null!=t}));if(t.patternlist=e.arrayDataToTemplate(t.fill.pattern.name,o,o),t.linecapstroke=e.arrayDataToTemplate(t.stroke.linecap,["butt","square","round"],["Extremo","Cuadrado","Redondeado"]),t.linejoinstroke=e.arrayDataToTemplate(t.stroke.linejoin,["bevel","miter","round"],["Bisel","Inglete","Redondeado"]),t.linecaplabelstroke=e.arrayDataToTemplate(t.label.stroke.linecap,["butt","square","round"],["Extremo","Cuadrado","Redondeado"]),t.linejoinlabelstroke=e.arrayDataToTemplate(t.label.stroke.linejoin,["bevel","miter","round"],["Bisel","Inglete","Redondeado"]),t.alignlist=e.arrayDataToTemplate(t.label.align,i,["Centro","Justificado","Izquierda","Derecha"]),t.baselinelist=e.arrayDataToTemplate(t.label.baseline,n,["Alfabetico","Abajo","Colgando","Ideografico","Arriba","Centro"]),t.formlist=e.arrayDataToTemplate(t.icon.form,r,r),null!=this.layer_){var a=Object.keys(this.getFeaturesAttributes()),s=null!=t.label?t.label.text:"";t.featuresAttr=e.arrayDataToTemplate(s,a.map((function(t){return"{{".concat(t,"}}")})),a)}return t}},{key:"toggleDisplaySubmenu",value:function(t){var e=!0===t?"add":"remove";this.getParentTemplate().querySelector("[data-buttons-option]").classList[e]("m-hidden")}},{key:"refreshLegend",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.imgId_,n=this.generateStyle();if(!0===o&&(n=this.style_),null!=n){(n=n.clone())instanceof M.style.Point&&(n.set("radius",e.RADIUS_OPTION),null!=n.get("icon.radius")&&n.set("icon.radius",e.ICON_RADIUS_OPTION));var r=this.htmlParent_.querySelector("img[id='img-".concat(i,"']"));n.updateCanvas();var a=n.toImage();null!=r&&(r.src=a)}}},{key:"imgId",set:function(t){this.imgId_=t},get:function(){return this.imgId_}}])&&D(o.prototype,i),n&&D(o,n),e}();function j(t){return(j="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function q(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){function e(t,o,i,n,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,V(e).call(this,t,o,i,n,r))}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(e,I),o=e,(i=[{key:"setLayer",value:function(t){return this.layer_=t,this}},{key:"generateStyle",value:function(){var t=this.generateOptions(),e=null;return""!=t.attributeName&&(e=new M.style.Proportional(t.attributeName,t.minRadius,t.maxRadius)),e}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;return null!=this.style_&&(t={attributeName:this.style_.getAttributeName(),minRadius:this.style_.getMinRadius(),maxRadius:this.style_.getMaxRadius()},this.setSelected(!0)),null!=this.layer_&&(t.attributes=this.getAttributes(),t.attributes.forEach((function(e){return e.selected=t.attributeName}))),t}},{key:"getAttributes",value:function(){return this.filterAttributesFeature("number").map((function(t){return{name:t}}))}}])&&q(o.prototype,i),e}();function U(t){return(U="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function H(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Z.DEFAULT_OPTIONS_STYLE={attributeName:"",minRadius:12,maxRadius:25};var X=function(t){function e(t,o,i,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,W(e).call(this,t,o,i,n,r))).compilePromise_.then((function(){a.addEventRangeListener(),a.addPaginationListener()})),a}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(e,I),o=e,(i=[{key:"setLayer",value:function(t){return this.layer_=t,this}},{key:"generateOptions",value:function(){var t={options:{},ranges:{}};return this.querySelectorAllForEach("[data-style-options]",(function(e){var o=e.dataset.styleOptions,i=e.value;"checkbox"===e.type&&(i=e.checked),"number"===e.type&&(i=parseFloat(i)),"label.color"===o?(t.options.label={},t.options.label.color=i):t.options[o]=i})),this.querySelectorAllForEach("[data-ranges-id][data-apply-range]",(function(e){var o=e.dataset.rangesId;null==t.ranges[o]&&(t.ranges[o]={});var i=e.dataset.rangesOptions,n=e.value;"number"===e.type&&(n=parseFloat(n)),I.createObj(t.ranges[o],i,n)})),t.ranges=Object.values(t.ranges).filter((function(t){return!isNaN(t.minRange)&&!isNaN(t.maxRange)})),t}},{key:"generateStyle",value:function(){var t=this.generateOptions(),e=function(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(t.ranges).map((function(t){return{min:t.minRange,max:t.maxRange,style:new M.style.Point(t.style)}}));return t.options.ranges=e,new M.style.Cluster(t.options,{distanceSelectFeatures:t.options.distanceSelectFeatures})}},{key:"setRanges",value:function(){var t=this.querySelector("[data-number-ranges]"),o=parseInt(t.value);if(o>0&&o<e.NUMBER_RANGES){for(var i=1;i<o+1;i++)this.querySelector('[data-page-selector="'.concat(i,'"]')).classList.remove("m-hidden"),this.querySelectorAllForEach('[data-ranges-id="'.concat(i,'"]'),(function(t){t.setAttribute("data-apply-range","")}));for(var n=o+1;n<e.NUMBER_RANGES;n++)this.querySelector('[data-page-selector="'.concat(n,'"]')).classList.add("m-hidden"),this.querySelectorAllForEach('[data-ranges-id="'.concat(n,'"]'),(function(t){t.removeAttribute("data-apply-range")}));var r=this.querySelector('[data-page-selector="'.concat(o,'"]'));this.paginationListener(r)()}}},{key:"paginationListener",value:function(t){var e=this;return function(){var o=e.querySelector("[data-page-active]");if(null!=o){o.removeAttribute("data-page-active"),o.classList.remove("m-page-active");var i=o.dataset.pageSelector,n=e.querySelector("[data-page='".concat(i,"']"));null!=n&&n.classList.add("m-hidden")}if(null!=t){t.classList.add("m-page-active"),t.dataset.pageActive="";var r=t.dataset.pageSelector;e.querySelector("[data-page='".concat(r,"']")).classList.remove("m-hidden")}}}},{key:"addEventRangeListener",value:function(){this.querySelector("[data-number-ranges]").addEventListener("input",this.setRanges.bind(this))}},{key:"addPaginationListener",value:function(){var t=this;this.querySelectorAllForEach("[data-page-selector]",(function(e){e.addEventListener("click",t.paginationListener(e).bind(t))}))}},{key:"getOptionsTemplate",value:function(){var t=Object.assign({},e.DEFAULT_OPTIONS_STYLE);if(null!=this.style_){var o=(t=Object.assign({},this.style_.getOptions())).ranges.filter((function(t){return!isNaN(t.min)})).map((function(t){var e={},o=t.style;return e.min=t.min,e.max=t.max,e.fill=o.get("fill.color"),e.stroke=o.get("stroke.color"),e.width=o.get("stroke.width"),e.opacity=null==o.get("fill.opacity")?1:o.get("fill.opacity"),e.radius=o.get("radius"),e}));t.ranges=o}var i=t.ranges.slice(-1)[0].max;return t.pages=[],function(t,e,o){for(var i=[],n=o,r=t;r<e;r++){var a=n+1,s={id:r,min:a,max:n=a+200,fill:C.random().hex(),stroke:C.random().hex()};i.push(s)}return i}(t.ranges.length+1,e.NUMBER_RANGES,i).forEach((function(e,o){t.pages.push(e)})),t}}])&&H(o.prototype,i),e}();function J(t){return(J="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function K(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $(t,e){return($=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}X.NUMBER_RANGES=13,X.DEFAULT_OPTIONS_STYLE={hoverInteraction:!0,displayAmount:!0,selectInteraction:!0,animated:!0,distance:30,label:{color:"#4dfeef"},maxFeaturesToSelect:20,distanceSelectFeatures:15,ranges:[{min:2,max:30,fill:"#ff00ff",stroke:"#00fef0",width:2,opacity:1}]};var tt=function(t){function e(t,o,i,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,Q(e).call(this,t,o,i,n,r))).style_=null,a.compilePromise_.then((function(){a.removeGradientListener(),a.addGradientListener()})),a.numberAddedColors_=6,a}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$(t,e)}(e,I),o=e,(i=[{key:"setLayer",value:function(t){return this.layer_=t,this.style_=null,this}},{key:"removeGradientListener",value:function(){var t=this;this.querySelectorAllForEach(".m-removable-input-color .m-close",(function(e){e.addEventListener("click",(function(){e.parentElement.parentElement.removeChild(e.parentElement),t.numberAddedColors_--}))}))}},{key:"addGradientListener",value:function(){var t=this,o=this.querySelector("[data-parent='gradient']");this.querySelector("[data-add]").addEventListener("click",(function(){t.compileTemplate("gradientheatmap.html",{}).then((function(i){t.numberAddedColors_<e.MAX_NUMBER_COLORS?(o.appendChild(i),t.setRandomColor(i),i.querySelector(".m-close").addEventListener("click",(function(){i.parentElement.removeChild(i),t.numberAddedColors_--})),t.numberAddedColors_++):M.dialog.info("Ha llegado al número máximo de colores permitidos","Información")}))}))}},{key:"setRandomColor",value:function(t){var e=t.querySelector("input"),o=chroma.random().hex();e.value=o}},{key:"generateStyle",value:function(){var t=this.generateOptions(),e=null;return""!=t.attributeName&&(e=new M.style.Heatmap(t.attributeName,t.options)),e}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;return null!=this.style_&&(t.attribute=this.style_.getAttributeName(),t.radius=this.style_.getRadius(),t.blur=this.style_.getBlurSize(),t.gradient=this.style_.getGradient()),null!=this.layer_&&(t.attributes=this.getAttributes(),t.attributes.forEach((function(e){return e.selected=t.attribute}))),t}},{key:"getAttributes",value:function(){return this.filterAttributesFeature("number").map((function(t){return{name:t}}))}}])&&K(o.prototype,i),e}();function et(t){return(et="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function ot(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nt(t,e){return(nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}tt.DEFAULT_OPTIONS_STYLE={attribute:"",gradient:["#0000ff","#00ffff","#00ff00","#ffff00","#ffb619","#ff0000"],blur:12,radius:22},tt.MAX_NUMBER_COLORS=30;var rt=function(t){function e(t,o,i,n,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==et(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,it(e).call(this,t,o,i,n,r))}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nt(t,e)}(e,I),o=e,(i=[{key:"setLayer",value:function(t){return this.layer_=t,this}},{key:"setRanges",value:function(){for(var t=this.querySelector("[data-number-ranges]"),e=parseInt(t.value),o=[],i=1;i<=e;i++)o.push({number:i});var n=this.querySelector("[data-parent]");this.addTemplate("choroplethstyles.html",n,{ranges:o})}},{key:"addEventRangeListener",value:function(){this.querySelector("[data-number-ranges]").addEventListener("input",this.setRanges.bind(this))}},{key:"generateStyle",value:function(){var t=this.generateOptions(),e=t.ranges,o=t.options.colors,i="JENKS"===t.quantification?M.style.quantification.JENKS:M.style.quantification.QUANTILE,n=null;return""!=t.attributeName&&(n=new M.style.Choropleth(t.attributeName,o,i(e))),n}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;if(null!=this.style_){var o=this.style_.getChoroplethStyles()[0].get("fill.color"),i=this.style_.getChoroplethStyles().slice(-1)[0].get("fill.color");o=o||this.style_.getChoroplethStyles()[0].get("stroke.color"),i=i||this.style_.getChoroplethStyles().slice(-1)[0].get("stroke.color"),t={attribute:this.style_.getAttributeName(),ranges:this.style_.getChoroplethStyles().length,quantification:this.style_.getQuantification().name,startColor:o,endColor:i}}return null!=this.layer_&&(t.attributes=this.getAttributes(),t.attributes.forEach((function(e){return e.selected=t.attribute}))),t}},{key:"getAttributes",value:function(){return this.filterAttributesFeature("number").map((function(t){return{name:t}}))}}])&&ot(o.prototype,i),e}();rt.DEFAULT_OPTIONS_STYLE={attribute:"",quantification:"JENKS",ranges:4,startColor:"#F8FF25",endColor:"#4400FD"};var at=i(12),st=i.n(at),lt=i(13),ct=i.n(lt),ht=i(3),ut=i.n(ht);function pt(t){return(pt="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function dt(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function ft(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var yt=function(t){function e(t,o,i,n,r,a){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=function(t,e){return!e||"object"!==pt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,gt(e).call(this,t,o,i,n,r))).fill_=!1,s.stroke_=!1,s.label_=!1,s.form_=!1,s.icon_=!1,null!=n&&(s.fill_=null!=n.getOptions().fill,s.stroke_=null!=n.getOptions().stroke,s.label_=null!=n.getOptions().label,s.icon_=null!=n.get("icon.src"),s.form_=null!=n.get("icon.form")),s.binding_=a,s}var o,i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mt(t,e)}(e,I),o=e,n=[{key:"arrayDataToTemplate",value:function(t,e,o){return e.map((function(e,i){return{id:e,name:o[i],selected:t}}))}},{key:"RADIUS_OPTION",get:function(){return 10}},{key:"ICON_RADIUS_OPTION",get:function(){return 10}},{key:"OPTIONS_POINT_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"},{id:"icon",name:"Icono"},{id:"form",name:"Familia"}]}},{key:"OPTIONS_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"}]}},{key:"GEOMETRIES",get:function(){return["point","line","polygon"]}},{key:"DEFAULT_OPTIONS_STYLE",get:function(){var t;return{radius:10,fill:{color:"#e5008a",opacity:1,width:2,pattern:{color:"red",name:"HATCH",size:1,spacing:2,scale:3,offset:5,rotation:0}},stroke:{color:"#000000",width:2,linedash:[0,0],linedashoffset:0,linecap:"none",linejoin:"none"},label:{fill:{color:"#ff0000"},stroke:{color:"no-color",width:2,linedash:[0,0],linedashoffset:0,linecap:"none",linejoin:"none"},scale:2,text:"Texto de prueba",font:"14px serif",align:"center",baseline:"top",rotate:!1,rotation:0,offset:[0,0]},icon:(t={src:"",form:"",size:[40,40],anchor:[0,0],scale:1,offset:[0,0],rotation:0,opacity:1},dt(t,"form","CIRCLE"),dt(t,"fill","#ffffff"),dt(t,"gradientcolor","#e07e18"),t)}}}],(i=[{key:"setLayer",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.layer_=t,!0===e&&this.refreshTemplate(),this}},{key:"getOptions",value:function(){return{fill:this.fill_,stroke:this.stroke_,label:this.label_,form:this.form_,icon:this.icon_}}},{key:"setGeometry",value:function(t){return e.GEOMETRIES.includes(t)?this.geometry_=t:this.geometry_="point",this}},{key:"getGeometry",value:function(){return this.geometry_}},{key:"refreshTemplate",value:function(){var t=this,o=this.getGeometry();e.GEOMETRIES.filter((function(t){return t!==o})).forEach((function(e){t.querySelectorAllForEach('[data-geometry="'.concat(e,'"]'),(function(t){return t.classList.add("m-hidden")}))})),this.querySelectorAllForEach('[data-geometry="'.concat(o,'"]'),(function(t){return t.classList.remove("m-hidden")})),this.addLabelPathListener()}},{key:"activateOptionsStyle",value:function(){var t=this.style_;if(null!=t){var e=t.getOptions();null!=e.fill&&Object.values(e.fill).filter((function(t){return null!=t})).length>0&&this.checkOptionSection("fill"),null!=e.stroke&&this.checkOptionSection("stroke"),null!=e.label&&this.checkOptionSection("label"),null!=e.icon&&(e.icon.hasOwnProperty("src")&&(this.checkOptionSection("icon"),this.disableOption("form")),e.icon.hasOwnProperty("form")&&(this.checkOptionSection("form"),this.disableOption("icon")))}}},{key:"showCompatibleSections",value:function(){this.binding_.enableOption("form"),this.binding_.enableOption("icon"),!0===this.icon_&&this.binding_.disableOption("form"),!0===this.form_&&this.binding_.disableOption("icon")}},{key:"addLabelPathListener",value:function(){var t=this,e=this.querySelector("[data-style-options='label.path']");e.addEventListener("change",(function(){t.togglePathSection(!e.checked)}))}},{key:"togglePathSection",value:function(t){this.querySelectorAllForEach("[data-textpath]",(function(e){e.disabled=!0===t&&t}))}},{key:"toggleCheckOptionSection",value:function(t){var e=this;this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]')).addEventListener("change",(function(o){e.toggleCheckOptSectionListener(t,o)}))}},{key:"toggleCheckOptSectionListener",value:function(t,e){!0===e.target.checked&&this.activateOption(t)}},{key:"checkOptionSection",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]'));this.activateOption(t),e.checked=!0}},{key:"activateOptionSection",value:function(t){var e=this;this.getParentTemplate().querySelector('[data-buttons-option] [data-label="'.concat(t,'"]')).addEventListener("click",(function(){e.activateOption(t)}))}},{key:"activateOption",value:function(t){var e=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]+label')),o=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]'));null!=o&&!1===o.disabled&&(this.activateLabel(e),this.displaySectionOption(t))}},{key:"activateLabel",value:function(t){this.querySelectorAllForEachParent("[data-selector]",(function(t){t.classList.remove("check-active"),t.classList.add("check-selected")})),t.classList.add("check-active"),t.classList.remove("check-selected")}},{key:"displaySectionOption",value:function(t){this.hideAllOptionsSections(),this.showOptionSection(t)}},{key:"generateOptions",value:function(){var t=this,e={options:{}};this.querySelectorAllForEach("[data-style-options]",(function(o){var i=o.dataset.styleOptions,n=o.value;"checkbox"===o.type&&(n=o.checked),"number"===o.type&&(n=parseFloat(n),isNaN(n)&&(n=0));var r=o.dataset.target;if(void 0!==r){var a=parseFloat(t.querySelector('[data-id="'.concat(r,'"]')).value);isNaN(a)&&(a=0),n=[n,a]}I.createObj(e.options,i,n)})),this.querySelectorAllForEach("[data-apply]",(function(t){var o=t.dataset.apply;!1===t.checked&&I.createObj(e.options,o,void 0)}));var o,i=this.querySelector("[data-font-size]").value||12,n=this.querySelector("[data-font-family]").value,r="".concat(i,"px ").concat(n),a=!0===this.icon?e.options.src:e.options.form;return null!=e.options.label&&null!=e.options.label.text&&(o=e.options.label),e.options={fill:e.options.fill,stroke:e.options.stroke,label:o,icon:a,radius:e.options.radius},"line"===this.getGeometry()&&(e.options={fill:e.options.fill,stroke:e.options.stroke,label:e.options.label},delete e.options.fill.pattern,0===Object.keys(e.options.fill).length&&delete e.options.fill),"polygon"===this.getGeometry()&&(e.options={fill:e.options.fill,stroke:e.options.stroke,label:e.options.label}),null!=e.options.label&&(e.options.label.font=r),this.processOptions(e)}},{key:"processOptions",value:function(t){var e=M.utils.extends({},t),o=this.isChecked("fill"),i=this.isChecked("stroke"),n=this.isChecked("label"),r=this.isChecked("icon"),a=this.isChecked("form");return e.options.fill=!0===o?e.options.fill:void 0,e.options.stroke=!0===i?e.options.stroke:void 0,e.options.label=!0===n?e.options.label:void 0,e.options.icon=!0===r||!0===a?e.options.icon:void 0,e}},{key:"isChecked",value:function(t){var e=!1,o=this.getParentTemplate().parentElement.querySelector("[data-buttons-option-category] input[data-apply='".concat(t,"'"));return null!=o&&(e=o.checked),e}},{key:"generateStyle",value:function(){var t;this.querySelectorAllForEach("[data-apply]",(function(t){t.checked}));var e=this.getGeometry(),o=this.generateOptions().options;switch(e){case"point":t=new M.style.Point(o);break;case"line":t=new M.style.Line(o);break;case"polygon":t=new M.style.Polygon(o);break;default:M.dialog.error("Geometría no soportada","Error")}return t}},{key:"compatibleSectionListener",value:function(t,e){var o=this,i=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]+label')),n=this.querySelectorParent('[data-buttons-option] input[data-apply="'.concat(t,'"]'));null!=i&&i.addEventListener("click",(function(){!1===n.checked?o.disableOption(e):o.enableOption(e)}))}},{key:"disableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]')),o=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]+label'));this.hideOptionSection(t),o.classList.add("check-inactive"),o.classList.add("check-selected"),o.classList.remove("m-option-active"),e.disabled=!0,e.checked=!1}},{key:"enableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]'));this.getParentTemplate().querySelector('[data-buttons-option] input[data-apply="'.concat(t,'"]+label')).classList.remove("check-inactive"),e.disabled=!1}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;null!=this.style_&&(null!=this.style_.get("fill.pattern")&&(t.patternflag=!0),t=M.utils.extends({},this.style_.getOptions()),t=M.utils.extends(t,e.DEFAULT_OPTIONS_STYLE)),t.fill.color=C(t.fill.color).hex(),t.stroke.color=C(t.stroke.color).hex(),t.label.fill.color=C(t.label.fill.color).hex(),t.label.stroke.color="no-color"===t.label.stroke.color?"no-color":C(t.label.stroke.color).hex(),t.fill.pattern.color=C(t.fill.pattern.color).hex(),t.icon.fill=C(t.icon.fill).hex(),t.icon.gradientcolor=C(t.icon.gradientcolor).hex();var o=Object.keys(M.style.pattern).filter((function(t){return"ICON"!=t&&"IMAGE"!=t})),i=Object.values(M.style.align),n=Object.values(M.style.baseline),r=Object.values(M.style.form).filter((function(t){return null!=t}));if(t.patternlist=e.arrayDataToTemplate(t.fill.pattern.name,o,o),t.linecapstroke=e.arrayDataToTemplate(t.stroke.linecap,["butt","square","round"],["Extremo","Cuadrado","Redondeado"]),t.linejoinstroke=e.arrayDataToTemplate(t.stroke.linejoin,["bevel","miter","round"],["Bisel","Inglete","Redondeado"]),t.linecaplabelstroke=e.arrayDataToTemplate(t.label.stroke.linecap,["butt","square","round"],["Extremo","Cuadrado","Redondeado"]),t.linejoinlabelstroke=e.arrayDataToTemplate(t.label.stroke.linejoin,["bevel","miter","round"],["Bisel","Inglete","Redondeado"]),t.alignlist=e.arrayDataToTemplate(t.label.align,i,i),t.baselinelist=e.arrayDataToTemplate(t.label.baseline,n,n),t.formlist=e.arrayDataToTemplate(t.icon.form,r,r),null!=this.layer_){var a=Object.keys(this.getFeaturesAttributes()),s=null!=t.label?t.label.text:"";t.featuresAttr=e.arrayDataToTemplate(s,a.map((function(t){return"{{".concat(t,"}}")})),a)}return t}},{key:"toggleDisplaySubmenu",value:function(t){var e=!0===t?"add":"remove";this.getParentTemplate().querySelector("[data-buttons-option]").classList[e]("m-hidden")}},{key:"addLegendListener",value:function(){var t=this;this.querySelectorAllForEach("input,select,div.m-boxes",(function(e){e instanceof HTMLDivElement?e.addEventListener("click",(function(){t.refreshLegend(e)})):e instanceof HTMLSelectElement?e.addEventListener("change",(function(){t.refreshLegend(e)})):e.addEventListener("input",(function(){t.refreshLegend(e)}))}))}},{key:"refreshLegend",value:function(t,o){var i=this.imgId_,n=this.generateStyle();if(!0===o&&(n=this.style_),null!=n){this.style_=n,(n=n.clone())instanceof M.style.Point&&(n.set("radius",e.RADIUS_OPTION),null!=n.get("icon.radius")&&n.set("icon.radius",e.ICON_RADIUS_OPTION));var r=this.htmlParent_.querySelector("img[id='img-".concat(i,"']"));n.updateCanvas();var a=n.toImage();null!=r&&(r.src=a)}}},{key:"imgId",set:function(t){this.imgId_=t},get:function(){return this.imgId_}},{key:"fill",set:function(t){this.fill_=t},get:function(){return this.fill_}},{key:"stroke",set:function(t){this.stroke_=t},get:function(){return this.stroke_}},{key:"label",set:function(t){this.label_=t},get:function(){return this.label_}},{key:"form",set:function(t){this.form_=t},get:function(){return this.form_}},{key:"icon",set:function(t){this.icon_=t},get:function(){return this.icon_}},{key:"style",get:function(){return this.style_}}])&&ft(o.prototype,i),n&&ft(o,n),e}();function vt(t){return(vt="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function bt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function St(t,e){return(St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var wt=function(t){function e(t,o,i,n,r,a){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=function(t,e){return!e||"object"!==vt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,_t(e).call(this,t,o,i,n,r))).styleCategories_={},s.compilePromise_.then((function(){s.getTemplate().querySelector("[data-options='attributeName']").addEventListener("input",(function(){s.renderAttributeOptions()}))})),s.selectedCategory_=null,s.clickedOnTable_=!1,s.controller_=a,s}var o,i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&St(t,e)}(e,I),o=e,n=[{key:"OPTIONS_POINT_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"},{id:"icon",name:"Icono"},{id:"form",name:"Fuente"}]}},{key:"OPTIONS_SUBMENU",get:function(){return[{id:"fill",name:"Relleno"},{id:"stroke",name:"Trazo"},{id:"label",name:"Etiqueta"}]}},{key:"MAXNUMBER_CATEGORIES",get:function(){return 30}}],(i=[{key:"setLayer",value:function(t){return this.layer_=t,this.setAttributes(),this.refreshOptionsButtons(),this}},{key:"unhide",value:function(){return this.getTemplate().classList.remove("m-hidden"),this.getParentTemplate().querySelector("[data-buttons-option-category]").classList.remove("m-hidden"),this}},{key:"hide",value:function(){return this.getTemplate().classList.add("m-hidden"),this.getParentTemplate().querySelector("[data-buttons-option-category]").classList.add("m-hidden"),this}},{key:"addEventClickListener",value:function(){var t=this;this.querySelectorAllForEach("td:first-child",(function(e){e.addEventListener("click",(function(){t.toggleCategory(e.id)}))}))}},{key:"refreshOptionsButtons",value:function(){var t=this,e=yt.OPTIONS_POINT_SUBMENU;"point"!==this.getGeometry()&&(e=yt.OPTIONS_SUBMENU),this.addOptionsButtons(e,(function(){t.compatibleSectionListener("icon","form"),t.compatibleSectionListener("form","icon")}))}},{key:"addOptionsButtons",value:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.getParentTemplate().querySelector("[data-buttons-option-category]");this.addTemplate(st.a,i,{buttonsParams:t},(function(i){"function"==typeof o&&o(),t.forEach((function(o){return e.addEventOptionListener(o,t)})),t.forEach((function(o){return e.addEventCheckListener(o,t)})),e.deactivateSubmenu(),e.addEventCheckFromSubmenu()}))}},{key:"addEventCheckFromSubmenu",value:function(){var t=this;this.querySelectorAllForEachParent("[data-buttons-option-category] input",(function(e){e.addEventListener("change",(function(){t.controller_.selectPanel("stylecategory"),t.controller_.setCompatibleStylePanels("stylecategory"),t.controller_.showActivePanel("stylecategory")}))}))}},{key:"compatibleSectionListener",value:function(t,e){var o=this,i=this.querySelectorParent('[data-buttons-option-category] input[data-apply="'.concat(t,'"]'));null!=i&&i.addEventListener("change",(function(){!0===i.checked?o.disableOption(e):o.enableOption(e)}))}},{key:"disableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option-category] input[data-apply="'.concat(t,'"]')),o=this.getParentTemplate().querySelector('[data-buttons-option-category] input[data-apply="'.concat(t,'"]+label'));this.hideOptionSection(t),null!=o&&(o.classList.add("check-inactive"),o.classList.add("check-selected"),o.classList.remove("m-option-active")),null!=e&&(e.disabled=!0,e.checked=!1)}},{key:"enableOption",value:function(t){var e=this.getParentTemplate().querySelector('[data-buttons-option-category] input[data-apply="'.concat(t,'"]')),o=this.getParentTemplate().querySelector('[data-buttons-option-category] input[data-apply="'.concat(t,'"]+label'));null!=o&&o.classList.remove("check-inactive"),null!=e&&(e.disabled=!1)}},{key:"toggleCategory",value:function(t){var e=this;Object.values(this.styleCategories_).forEach((function(t){t.hide()})),!1===this.clickedOnTable_&&(this.activateSubmenu(),this.clickedOnTable_=!0);var o=this.styleCategories_[t];this.selectedCategory_=o;var i=this.selectedCategory_.getOptions();this.checkInput("fill",i.fill),this.checkInput("stroke",i.stroke),this.checkInput("label",i.label),this.checkInput("form",i.form),this.checkInput("icon",i.icon),null!=o&&(o.unhide(),o.showCompatibleSections()),Object.values(this.styleCategories_).forEach((function(t){t.setLayer(e.layer_,!1)}))}},{key:"renderAttributeOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this.querySelector("[data-options='attributeName']").value;null!=this.style_&&!0===t&&(o=this.style_.getAttributeName());var i=!M.utils.isNullOrEmpty(o),n=this.getAllValuesAttribute(o).filter((function(t){return!M.utils.isNullOrEmpty(t)})).map((function(t){return{name:t}})).splice(0,e.MAXNUMBER_CATEGORIES);this.removeCategories(),this.createCategories(n),this.addCategoriesView(n,i)}},{key:"addCategoriesView",value:function(t,e){var o=this,i=this.querySelector("[data-options='values']");this.compileTemplate(ut.a,{values:t,attributeExists:e}).then((function(t){i.innerHTML=t.innerHTML,Object.values(o.styleCategories_).forEach((function(t){t.refreshTemplate(),t.hide()})),o.addEventClickListener(),o.addEventSelectedListener(),o.addLegendListenerAll()}))}},{key:"createCategories",value:function(t){var e=this,o=null==this.style_?null:this.style_.getCategories();t.forEach((function(t){var i=null==o?null:o[t.name];e.styleCategories_[t.name]=new yt(ct.a,e.htmlTemplate_,"stylesimple",i,e.layer_,e),e.styleCategories_[t.name].compilePromise_.then((function(){e.styleCategories_[t.name].refreshLegend(t.name,!0)})),e.setGeometryCategory(e.styleCategories_[t.name])}));var i=null==o?null:o.other;this.styleCategories_.other=new yt(d.a,this.htmlTemplate_,"stylesimple",i,this.layer_,this),this.styleCategories_.other.compilePromise_.then((function(){e.styleCategories_.other.refreshLegend("other",!0)})),this.setGeometryCategory(this.styleCategories_.other)}},{key:"removeCategories",value:function(){Object.values(this.styleCategories_).forEach((function(t){return t.destroy()})),this.styleCategories_={}}},{key:"setAttributes",value:function(){var t=this;if(this.layer_ instanceof M.layer.Vector){var e=null==this.style_?"":this.style_.getAttributeName(),o=this.filterAttributesFeature("string").map((function(t){return{name:t,selected:e}})),i=this.getTemplate().querySelector("[data-options='attributeName']");this.compileTemplate(O.a,{attributes:o}).then((function(e){i.innerHTML=e.innerHTML,t.renderAttributeOptions(!0),0===o.length?t.deactivateBinding():t.activateBinding()}))}}},{key:"setGeometryCategory",value:function(t){switch(this.layer_.getFeatures()[0].getGeometry().type){case"Point":case"MultiPoint":t.geometry_="point";break;case"LineString":case"MultiLineString":t.geometry_="line";break;case"Polygon":case"MultiPolygon":t.geometry_="polygon";break;default:M.dialog.error("Geometria no soportada","Error")}}},{key:"showSection",value:function(t){this.querySelectorAllForEach("[data-id='".concat(t,"']"),(function(t){t.classList.remove("m-hidden")}))}},{key:"hideSection",value:function(t){this.querySelectorAllForEach("[data-id='".concat(t,"']"),(function(t){t.classList.add("m-hidden")}))}},{key:"addEventOptionListener",value:function(t,e){var o=this,i=this.querySelectorParent("[data-buttons-option-category] [data-label='".concat(t.id,"']")),n=this.querySelectorParent("[data-buttons-option-category] input[data-apply='".concat(t.id,"']"));i.addEventListener("click",(function(){!1===n.disabled&&(e.forEach((function(t){return o.hideSection(t.id)})),o.showSection(t.id),o.activeSection(t.id))}))}},{key:"addEventCheckListener",value:function(t,e){var o=this;this.querySelectorParent("[data-buttons-option-category] input[data-apply='".concat(t.id,"']")).addEventListener("click",(function(){o.checkSection(t.id,e)}))}},{key:"activeSection",value:function(t){var e=this.querySelectorParent("[data-buttons-option-category] [data-selector='".concat(t,"']"));this.querySelectorAllForEachParent("[data-buttons-option-category] [data-selector]",(function(t){t.classList.remove("check-active"),t.classList.add("check-selected")})),e.classList.remove("check-selected"),e.classList.add("check-active")}},{key:"setSelectedRow",value:function(t){this.querySelectorAllForEach("td:first-child",(function(t){t.classList.remove("m-table-cell-selected")})),this.querySelector("[id='".concat(t,"']")).classList.add("m-table-cell-selected")}},{key:"addEventSelectedListener",value:function(){var t=this;this.querySelectorAllForEach("td:first-child",(function(e){var o=e.id;e.addEventListener("click",(function(){return t.setSelectedRow(o)}))}))}},{key:"checkSection",value:function(t,e){var o=this;!0===this.querySelectorParent("[data-buttons-option-category] #cat-".concat(t)).checked?(null!=this.selectedCategory_&&(this.selectedCategory_[t]=!0),e.forEach((function(t){return o.hideSection(t.id)})),this.showSection(t),this.activeSection(t)):null!=this.selectedCategory_&&(this.selectedCategory_[t]=!1),this.selectedCategory_.refreshLegend()}},{key:"checkInput",value:function(t,e){var o=this.querySelectorParent("[data-buttons-option-category] #cat-".concat(t));null!=o&&(o.checked=e)}},{key:"activateSubmenu",value:function(){this.querySelectorAllForEachParent("[data-buttons-option-category] input",(function(t){return t.disabled=!1})),this.querySelectorAllForEachParent("[data-buttons-option-category] label[data-selector]",(function(t){t.classList.remove("check-inactive"),t.classList.add("check-selected")}))}},{key:"deactivateSubmenu",value:function(){this.querySelectorAllForEachParent("[data-buttons-option-category] input",(function(t){return t.disabled=!0})),this.querySelectorAllForEachParent("[data-buttons-option-category] label[data-selector]",(function(t){t.classList.add("check-inactive"),t.classList.remove("check-selected")}))}},{key:"getGeometry",value:function(){var t=this.layer_.getFeatures()[0].getGeometry().type;switch(t){case"Point":case"MultiPoint":t="point";break;case"LineString":case"MultiLineString":t="line";break;case"Polygon":case"MultiPolygon":t="polygon";break;default:M.dialog.error("Geometria no soportada","Error")}return t}},{key:"getAllValuesAttribute",value:function(t){return this.layer_.getFeatures().map((function(e){return e.getAttribute(t)})).filter((function(t,e,o){return o.indexOf(t)==e}))}},{key:"generateOptions",value:function(){var t=this,e={},o={};return e.attributeName=this.querySelector("[data-options='attributeName']").value,Object.keys(this.styleCategories_).forEach((function(e){var i=t.styleCategories_[e],n=t.styleCategories_[e].generateOptions().options,r=i.fill,a=i.stroke,s=i.icon||i.form,l=i.label;null!=n.fill&&Object.values(n.fill).filter((function(t){return null!=t})),(r||a||s||l)&&(o[e]=t.styleCategories_[e].style)}),this),e.options=o,e}},{key:"generateStyle",value:function(){var t=this.generateOptions(),e=null;return""!==t.attributeName&&(e=new M.style.Category(t.attributeName,t.options)),e}},{key:"addLegendListenerAll",value:function(){var t=this;Object.keys(this.styleCategories_).forEach((function(e){var o=t.styleCategories_[e];o.imgId=e,o.addLegendListener()}))}}])&&bt(o.prototype,i),n&&bt(o,n),e}(),xt=i(14),Lt=i.n(xt),Mt=i(15),kt=i.n(Mt),Ct=i(16),Et=i.n(Ct);function Tt(t){return(Tt="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function Pt(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ot(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function At(t){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function It(t,e){return(It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Nt=function(t){function e(t,o,i,n,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e){return!e||"object"!==Tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,At(e).call(this,t,o,i,n,r))).variables_=[],null!=n&&(a.variables_=n.getOptions().variables.map((function(t){return t.attribute}))),a.compilePromise_.then((function(){a.addKeyEnterListener(),a.addRenderCompatibleListener(),a.addAttributeListener(),a.refreshVariables()})),a}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&It(t,e)}(e,I),o=e,(i=[{key:"setLayer",value:function(t){return this.layer_=t,this.renderAttributes(),this}},{key:"addAttribute",value:function(t){this.variables_.push(t)}},{key:"removeAttribute",value:function(t){this.variables_=this.variables_.filter((function(e){return e!=t}))}},{key:"addAttributeFromParamenter",value:function(t){this.addAttribute(t),this.addVariableTemplate(t),this.refreshPagination()}},{key:"addAttributeFromInput",value:function(){var t=this.querySelector("[data-attribute]").value;""!==t?this.variables_.includes(t)?M.dialog.info("El atributo ya ha sido agregado.","Nombre de variable repetida"):this.layer_.getFeatures()[0].getAttributes().hasOwnProperty(t)?this.addAttributeFromParamenter(t):M.dialog.info("No existe ninguna variable con ese nombre.","Nombre de variable incorrecto."):M.dialog.info("No está permitido introducir una cadena vacía.","Nombre de variable vacía.")}},{key:"removeAttributeFromInput",value:function(){var t=this.querySelector("[data-attribute]").value;this.removeAttribute(t)}},{key:"addAttributeListener",value:function(){var t=this;this.querySelector("[data-add]").addEventListener("click",(function(){t.addAttributeFromInput()}))}},{key:"addKeyEnterListener",value:function(){this.querySelector("[data-attribute]").addEventListener("keydown",this.keyEnterListener())}},{key:"keyEnterListener",value:function(){var t=this;return function(e){"Enter"===e.key&&t.addAttributeFromInput()}}},{key:"addVariableTemplate",value:function(t){var o,i=this,n=this.querySelector("[data-variables]"),r=[],a=e.DEFAULT_OPTIONS_VARIABLE.legend,s=e.DEFAULT_OPTIONS_VARIABLE.label;null!=this.style_&&(r=this.style_.getOptions().variables),0!==r.length&&null!=(o=r.find((function(e){return e.attribute===t})))&&(a=o.legend,s=o.label),this.compileTemplate(Lt.a,{attribute:t,legend:a,label:s}).then((function(e){n.append.apply(n,Pt(e.children));var o=i.querySelector('[data-remove="'.concat(t,'"]'));null!=o&&(i.addRemoveVarSectionListener(o),i.addLabelOptionListener(t))}))}},{key:"removeVariableTemplate",value:function(t){var e=this.querySelector(".m-chart-variables");this.querySelectorAllForEach('.m-chart-variables [data-delete="'.concat(t,'"]'),(function(t){e.removeChild(t)}))}},{key:"removeVariableSection",value:function(t){this.removeAttribute(t),this.removeVariableTemplate(t),this.refreshPagination()}},{key:"refreshVariables",value:function(){var t=this;Pt(this.variables_).forEach((function(e){t.removeVariableSection(e),t.addAttributeFromParamenter(e)}))}},{key:"addRemoveVarSectionListener",value:function(t){t.addEventListener("click",this.removeVarSectionListener(t).bind(this))}},{key:"removeVarSectionListener",value:function(t){var e=this,o=t.dataset.remove;return function(){e.removeVariableSection(o)}}},{key:"refreshPagination",value:function(){var t=this,e=this.variables_.map((function(t,e){return{attribute:t,number:e+1}})),o=this.querySelector("[data-pagination]");this.compileTemplate(kt.a,{ranges:e}).then((function(e){o.innerHTML=e.innerHTML,t.addClickPagerListener();var i=t.variables_.slice(-1)[0];null!=i&&t.showVariableSection(i)()}))}},{key:"addClickPagerListener",value:function(){var t=this;this.querySelectorAllForEach("[data-page-selector]",(function(e){var o=e.dataset.pageSelector;e.addEventListener("click",t.showVariableSection(o).bind(t))}))}},{key:"clickPagerListener",value:function(t){this.querySelectorAllForEach("[data-target]",(function(t){t.classList.add("m-hidden")})),this.querySelectorAllForEach('[data-target="'.concat(t,'"]'),(function(t){t.classList.remove("m-hidden")}))}},{key:"activePageListener",value:function(t){this.querySelectorAllForEach("[data-page-selector]",(function(t){t.classList.remove("m-page-active")}));var e=this.querySelector('[data-page-selector="'.concat(t,'"]'));null!=e&&e.classList.add("m-page-active")}},{key:"showVariableSection",value:function(t){var e=this;return function(){e.clickPagerListener(t),e.activePageListener(t)}}},{key:"renderCompatibleOpts",value:function(t){this.querySelectorAllForEach("[data-type]",(function(e){e.dataset.type.split(",").includes(t)?e.classList.remove("m-hidden"):e.classList.add("m-hidden")}))}},{key:"renderCompatibleListener",value:function(){var t=this.querySelector("[data-style-options='type']").selectedOptions[0].value;this.renderCompatibleOpts(t)}},{key:"addRenderCompatibleListener",value:function(){this.querySelector("[data-style-options='type']").addEventListener("change",this.renderCompatibleListener.bind(this))}},{key:"renderAttributes",value:function(){var t=this,e=this.layer_.getFeatures()[0].getAttributes(),o=Object.keys(e);o=o.filter((function(t){return!isNaN(parseFloat(e[t]))})),this.compileTemplate(Et.a,{attributes:o}).then((function(e){t.querySelector("[data-attribute]").innerHTML=e.innerHTML}))}},{key:"toggleLabelOptions",value:function(t){var e=this.querySelector('[data-label-target="'.concat(t,'"]')).classList;!0===e.contains("m-hidden")?e.remove("m-hidden"):e.add("m-hidden")}},{key:"addLabelOptionListener",value:function(t){var e=this;this.querySelector('[data-variable-option="'.concat(t,'.labelshow"]')).addEventListener("change",(function(){e.toggleLabelOptions(t)}))}},{key:"generateVariableOptions",value:function(){var t={};this.querySelectorAllForEach("input[data-variable-option]",(function(e){var o=e.dataset.variableOption,i=e.value;"number"===e.type&&(i=parseFloat(i)),"checkbox"===e.type&&(i=e.checked),I.createObj(t,o,i)}));var e=this.variables_.map((function(e){return t[e].attribute=e,t[e]}));return e.map((function(t){return!0===t.labelshow?t.label.text=function(t,e){return Math.round(t/e.reduce((function(t,e){return t+e}))*100)+"%"}:t.label=void 0,t}))}},{key:"generateStyle",value:function(){var t=this.generateOptions().options,e=this.generateVariableOptions(),o=M.style.chart.schemes[t.scheme];return new M.style.Chart({type:t.type,scheme:o,radius:t.radius,donutRadio:t.donutRadius,offsetX:t.offsetX,offsetY:t.offsetY,variables:0===e.length?[new M.style.chart.Variable({attribute:"default"})]:e,fill3DColor:t.fill3DColor})}},{key:"getOptionsTemplate",value:function(){var t=e.DEFAULT_OPTIONS_STYLE;return null!=this.style_&&((t=this.style_.getOptions()).scheme=this.getSchemeName()),t}},{key:"getSchemeName",value:function(){if(null!=this.style_){var t=this.style_.getOptions().scheme,e=M.style.chart.schemes;name=Object.keys(e).find((function(o){return i=t,n=e[o],r=!1,a=!1,i instanceof Array&&n instanceof Array&&(r=i.every((function(t,e){return t===n[e]})),a=n.every((function(t,e){return t===i[e]}))),r&&a;var i,n,r,a}))}return name}}])&&Ot(o.prototype,i),e}();function Ft(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Nt.DEFAULT_OPTIONS_STYLE={donutRatio:4,fill3DColor:"#ff00f0",offsetX:0,offsetY:0,radius:12,rotateWithView:!1,scheme:["#ffa500","blue","red","green","cyan","magenta","yellow","#0f0"],type:"pie"},Nt.DEFAULT_OPTIONS_VARIABLE={legend:"Ejemplo de leyenda",label:{fill:"#ff0000",scale:1,text:function(t,e){return Math.round(t/e.reduce((function(t,e){return t+e}))*100)+"%"},radiusIncrement:2,stroke:{color:"#000000",width:1}}};var Dt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.layer_=null,this.activePanel_=null,this.selectedPanels_=[],this.html_=e,this.renderViews(null)}var e,o,i;return e=t,i=[{key:"parseStyleToName",value:function(t){var e="";return t instanceof M.style.Simple?e="stylesimple":t instanceof M.style.Cluster?e="stylecluster":t instanceof M.style.Heatmap?e="styleheatmap":t instanceof M.style.Choropleth?e="stylechoropleth":t instanceof M.style.Category?e="stylecategory":t instanceof M.style.Chart?e="stylechart":t instanceof M.style.Proportional&&(e="styleproportional"),e}},{key:"STYLE_COMPATIBLE_OPTIONS",get:function(){return{stylesimple:["styleproportional","stylecluster","stylesimple"],styleproportional:["stylesimple","stylecluster","stylechart","styleproportional","stylecategory","stylechoropleth"],stylechoropleth:["styleproportional","stylecluster","stylechoropleth"],stylecategory:["styleproportional","stylecluster","stylecategory"],stylecluster:["stylesimple","stylechart","styleproportional","stylecategory","stylechoropleth","stylecluster"],styleheatmap:["styleheatmap"],stylechart:["stylecluster","styleproportional","stylechart"]}}},{key:"GEOMETRY_COMPATIBLE_OPTIONS",get:function(){return{point:["styleproportional","stylecluster","stylechoropleth","stylecategory","styleheatmap","stylechart","stylesimple"],line:["stylechoropleth","stylecategory","stylesimple"],polygon:["stylechoropleth","stylecategory","stylesimple","styleproportional"]}}}],(o=[{key:"getStyles",value:function(t,e){var o=null;if(null!=t){var i=t.getStyle();i instanceof e?o=i:i instanceof M.style.Composite&&(o=i.getStyles().find((function(t){return t instanceof e})))}return o}},{key:"renderViews",value:function(t){var e=this;this.bindings_={},this.bindings_.stylesimple=new B(d.a,this.html_,"stylesimple",this.getStyles(t,M.style.Simple),t,this),this.bindings_.styleproportional=new Z(g.a,this.html_,"styleproportional",this.getStyles(t,M.style.Proportional),t),this.bindings_.stylecluster=new X(y.a,this.html_,"stylecluster",this.getStyles(t,M.style.Cluster),t),this.bindings_.stylechoropleth=new rt(b.a,this.html_,"stylechoropleth",this.getStyles(t,M.style.Choropleth),t),this.bindings_.stylecategory=new wt(S.a,this.html_,"stylecategory",this.getStyles(t,M.style.Category),t,this),this.bindings_.styleheatmap=new tt(x.a,this.html_,"styleheatmap",this.getStyles(t,M.style.Heatmap),t),this.bindings_.stylechart=new Nt(k.a,this.html_,"stylechart",this.getStyles(t,M.style.Chart),t),this.bindings_.stylesimple.getCompilePromise().then((function(){e.addSelectOnChangeListener()})),this.allCompilePromises_=this.getBindings().map((function(t){return t.getCompilePromise()}))}},{key:"getAllCompilePromises",value:function(){return this.allCompilePromises_}},{key:"renderViewsPromise",value:function(){var t=Object.values(this.bindings_).map((function(t){return t.getCompilePromise()}));return Promise.all(t)}},{key:"destroyViews",value:function(){Object.values(this.bindings_).forEach((function(t){return t.destroy()}))}},{key:"getActivePanel",value:function(){return this.activePanel_}},{key:"setActivePanel",value:function(t){Object.values(this.bindings_).forEach((function(t){return t.setActivated(!1)})),this.activePanel_=this.bindings_[t],this.activePanel_.setActivated(!0),"stylesimple"===t?this.bindings_.stylesimple.toggleDisplaySubmenu(!1):this.bindings_.stylesimple.toggleDisplaySubmenu(!0)}},{key:"getSelectedPanels",value:function(){var t=this;return this.selectedPanels_.map((function(e){return t.bindings_[e]}))}},{key:"addSelectedPanel",value:function(t){this.selectedPanels_.includes(t)||(this.selectedPanels_.push(t),this.bindings_[t].setSelected(!0))}},{key:"selectPanel",value:function(t){this.html_.querySelector("[data-checkbox='".concat(t,"']")).checked=!0,this.addSelectedPanel(t)}},{key:"removeSelectedPanel",value:function(t){this.selectedPanels_=this.selectedPanels_.filter((function(e){return e!==t})),this.bindings_[t].setSelected(!1)}},{key:"disablePanel",value:function(t){var e=this.bindings_[t];null!=e&&e.setDisabled(!0)}},{key:"enablePanel",value:function(t){var e=this.bindings_[t];null!=e&&e.setDisabled(!1)}},{key:"setGeometry",value:function(t){this.geometry_=t}},{key:"getGeometry",value:function(){return this.geometry_}},{key:"change",value:function(t){var e=this;this.destroyViews(),this.renderViews(t),this.renderViewsPromise().then((function(){e.setLayer(t),e.resetOptions(),e.setCompatiblePanels(),e.initBindings(t)}))}},{key:"setLayer",value:function(t){switch(null===this.layer_&&(this.addActiveListener(),this.addSelectListener()),this.layer_=t,t.getFeatures()[0].getGeometry().type){case"Point":case"MultiPoint":this.setGeometry("point");break;case"LineString":case"MultiLineString":this.setGeometry("line");break;case"Polygon":case"MultiPolygon":this.setGeometry("polygon");break;default:M.dialog.error("Geometria no soportada","Error")}}},{key:"getKeysBindings",value:function(){return Object.keys(this.bindings_)}},{key:"getBindings",value:function(){return Object.values(this.bindings_)}},{key:"deactivateAll",value:function(){this.getBindings().forEach((function(t){return t.setActivated(!1)})),this.activePanel_=null}},{key:"unselectAll",value:function(){this.getBindings().forEach((function(t){return t.setSelected(!1)})),this.selectedPanels_=[]}},{key:"enableAll",value:function(){var t=this;this.getKeysBindings().forEach((function(e){return t.enablePanel(e)}))}},{key:"disableAll",value:function(){var t=this;this.getKeysBindings().forEach((function(e){return t.disablePanel(e)}))}},{key:"bindLayer",value:function(t){this.bindings_[t].setLayer(this.layer_),this.bindings_[t].setDisabled(!1)}},{key:"resetOptions",value:function(){this.deactivateAll(),this.unselectAll()}},{key:"initBindings",value:function(e){var o=this;this.bindings_.stylesimple.setGeometry(this.geometry_).setLayer(this.layer_);var i=[e.getStyle()];i[0]instanceof M.style.Composite&&i.push.apply(i,function(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(i[0].getStyles())),i.map((function(e){return t.parseStyleToName(e)})).forEach((function(t){o.showCompatiblePanel(t),o.activeLastSelected(t)}))}},{key:"setCompatiblePanels",value:function(){var e=this,o=t.GEOMETRY_COMPATIBLE_OPTIONS[this.geometry_];this.getKeysBindings().forEach((function(t){o.includes(t)?e.bindLayer(t):e.disablePanel(t)})),this.deactivateAll()}},{key:"setCompatibleStylePanels",value:function(t){var e=this;this.disableAll(),this.getCompatibles().forEach((function(t){e.compatibleGeometry(t)&&e.enablePanel(t)})),this.selectedPanels_.forEach((function(t){e.bindings_[t].setSelected(!0)}))}},{key:"showActivePanel",value:function(t){this.deactivateAll(),this.setActivePanel(t)}},{key:"activeLastSelected",value:function(t){var e=this.selectedPanels_.slice(-1)[0];null==e&&(e=t),this.showActivePanel(e)}},{key:"showCompatiblePanel",value:function(t){this.selectedPanels_.includes(t)?this.removeSelectedPanel(t):this.addSelectedPanel(t),this.setCompatibleStylePanels(t)}},{key:"addActiveListener",value:function(){var t=this;this.getKeysBindings().forEach((function(e){var o=t.bindings_[e],i=o.getSelectButton(),n=o.getActivateButton();t.html_.querySelector("[data-flap='".concat(e,"']+label")).addEventListener("click",(function(){if(!1===i.disabled){var e=n.dataset.flap;t.toggleDisplaySubmenu("stylesimple"!==e),t.showActivePanel(e)}}))}))}},{key:"addSelectListener",value:function(){var t=this;this.getKeysBindings().forEach((function(e){var o=t.bindings_[e].getSelectButton();o.addEventListener("change",(function(){var e=o.dataset.checkbox;t.toggleDisplaySubmenu("stylesimple"!==e),t.showCompatiblePanel(e),t.activeLastSelected(e)}))}))}},{key:"getStyle",value:function(){var t;if(0===this.getSelectedPanels().length)M.dialog.info("Debe elegir al menos un estilo","Elija estilo");else if(1===this.getSelectedPanels().length)t=this.getSelectedPanels()[0].generateStyle();else{var e=this.getMainStyle(),o=this.getIndividualStyles();e.add(o),t=e}return t}},{key:"getMainStyle",value:function(){return this.getSelectedPanels().map((function(t){return t.generateStyle()})).find((function(t){return t instanceof M.style.Composite}))}},{key:"getIndividualStyles",value:function(){var t=this.getMainStyle();return this.getSelectedPanels().filter((function(t){return null!=t})).map((function(t){return t.generateStyle()})).filter((function(e){return!e.equals(t)}))}},{key:"getCompatibles",value:function(){var t=this;return["stylesimple","stylecluster","stylechart","styleproportional","stylecategory","stylechoropleth","styleheatmap"].filter((function(e){return t.isCompatibleAll(t.selectedPanels_,e)}))}},{key:"toggleDisplaySubmenu",value:function(t){this.bindings_.stylesimple.toggleDisplaySubmenu(t)}},{key:"isCompatible",value:function(e,o){return t.STYLE_COMPATIBLE_OPTIONS[e].includes(o)}},{key:"isCompatibleAll",value:function(t,e){var o=this,i=!0;return t.forEach((function(t){o.isCompatible(t,e)||(i=!1)})),i}},{key:"compatibleGeometry",value:function(e){return t.GEOMETRY_COMPATIBLE_OPTIONS[this.geometry_].includes(e)}},{key:"addSelectOnChangeListener",value:function(){var t=this;this.bindings_.stylesimple.querySelectorAllForEach("*",(function(e){e.addEventListener("click",(function(){t.addSelectedPanel("stylesimple")}))}))}}])&&Ft(e.prototype,o),i&&Ft(e,i),t}();function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function Gt(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function Bt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qt(t,e){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Vt=function(t){function e(t){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles PluginControl");var i=new u;return(o=function(t,e){return!e||"object"!==Rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,jt(e).call(this,i,"StyleManager"))).layer_=t,o}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qt(t,e)}(e,M.Control),o=e,(i=[{key:"createView",value:function(t){var e=this;this.facadeMap_=t;var o=t.getWFS().concat(t.getKML().concat(t.getLayers().filter((function(t){return"GeoJSON"===t.type}))));return new Promise((function(t,i){var n=M.template.compileSync(r.a,{jsonp:!0,vars:{layers:o}}),a=n.querySelector("#m-stylemanager-select"),s=n.querySelector(".m-stylemanager-container-select");e.bindinController_=new Dt(s),e.addSelectListener(a,n),e.subscribeAddedLayer(a),e.addApplyBtnListener(n),e.addClearBtnListener(n),e.renderOptionsLayerParam(a,n,o),t(n),e.loadFonts(n)}))}},{key:"renderOptionsLayerParam",value:function(t,e,o){var i=this;this.layer_ instanceof M.layer.Vector&&Promise.all(this.bindinController_.getAllCompilePromises()).then((function(){i.renderOptions(t,e,i.layer_),M.template.compile("selectlayer.html",{vars:{layers:o.map((function(t){return{name:t.name,selected:i.layer_.name}}))}}).then((function(e){t.innerHTML=e.innerHTML}))}))}},{key:"addOpenAttribute",value:function(t){t.querySelector(".m-stylemanager-container-select").setAttribute("open-select","")}},{key:"addApplyBtnListener",value:function(t){t.querySelector("[data-apply-style]").addEventListener("click",this.applyStyle.bind(this))}},{key:"addClearBtnListener",value:function(t){t.querySelector("[data-clear-style]").addEventListener("click",this.clearStyle.bind(this))}},{key:"addSelectListener",value:function(t,e){var o=this;t.addEventListener("change",(function(){o.renderOptions(t,e)}))}},{key:"subscribeAddedLayer",value:function(t){var e=this;this.facadeMap_.on(M.evt.ADDED_LAYER,(function(o){if(Array.isArray(o))o.filter((function(t){return t instanceof M.layer.Vector})).forEach((function(o){return e.addLayerOption(t,o.name)}));else if(o instanceof M.layer.Vector){var i=function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},i=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})))),i.forEach((function(e){Gt(t,e,o[e])}))}return t}({},o);e.addLayerOption(t,i)}}))}},{key:"getActivationButton",value:function(t){return t.querySelector("button.m-panel-btn")}},{key:"addLayerOption",value:function(t,e){if("cluster_cover"!=e&&!0===this.isNotAdded(e,t)){var o=document.createElement("option");o.setAttribute("name",e),o.innerText=e,t.add(o)}}},{key:"isNotAdded",value:function(t,e){return!function(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(e.children).some((function(e){return e.innerHTML===t}))}},{key:"renderOptions",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.value;this.layer_=this.getLayerByName(i),null!=o&&(this.layer_=o),this.layer_ instanceof M.layer.Vector&&(0===this.layer_.getFeatures().length?(M.dialog.error("La capa no tiene features o aún no se han cargado.","Error"),t.selectedIndex=0):(this.bindinController_.change(this.layer_),this.showBoxes(e),this.addOpenAttribute(e)))}},{key:"getLayerByName",value:function(t){return this.facadeMap_.getWFS().concat(this.facadeMap_.getKML().concat(this.facadeMap_.getLayers().filter((function(t){return"GeoJSON"===t.type})))).find((function(e){return e.name===t}))}},{key:"showBoxes",value:function(t){t.querySelector(".m-boxes").classList.remove("m-hidden")}},{key:"applyStyle",value:function(){if(this.layer_ instanceof M.layer.Vector){this.layer_.setStyle(null);var t=this.bindinController_.getStyle();this.layer_.setStyle(t)}else M.dialog.info("Tiene que elegir una capa.","Elija capa")}},{key:"clearStyle",value:function(){this.layer_ instanceof M.layer.Vector?this.layer_.clearStyle():M.dialog.info("Tiene que elegir una capa.","Elija capa")}},{key:"loadFonts",value:function(){M.style.Font.addSymbol({font:"FontAwesome",name:"FontAwesome",copyright:"SIL OFL 1.1",prefix:"fa"},{"fa-glass":"","fa-music":"","fa-search":"","fa-envelope-o":"","fa-heart":"","fa-star":"","fa-star-o":"","fa-user":"","fa-film":"","fa-th-large":"","fa-th":"","fa-th-list":"","fa-check":"","fa-remove":"","fa-close":"","fa-times":"","fa-search-plus":"","fa-search-minus":"","fa-power-off":"","fa-signal":"","fa-gear":"","fa-cog":"","fa-trash-o":"","fa-home":"","fa-file-o":"","fa-clock-o":"","fa-road":"","fa-download":"","fa-arrow-circle-o-down":"","fa-arrow-circle-o-up":"","fa-inbox":"","fa-play-circle-o":"","fa-rotate-right":"","fa-repeat":"","fa-refresh":"","fa-list-alt":"","fa-lock":"","fa-flag":"","fa-headphones":"","fa-volume-off":"","fa-volume-down":"","fa-volume-up":"","fa-qrcode":"","fa-barcode":"","fa-tag":"","fa-tags":"","fa-book":"","fa-bookmark":"","fa-print":"","fa-camera":"","fa-font":"","fa-bold":"","fa-italic":"","fa-text-height":"","fa-text-width":"","fa-align-left":"","fa-align-center":"","fa-align-right":"","fa-align-justify":"","fa-list":"","fa-dedent":"","fa-outdent":"","fa-indent":"","fa-video-camera":"","fa-photo":"","fa-image":"","fa-picture-o":"","fa-pencil":"","fa-map-marker":"","fa-adjust":"","fa-tint":"","fa-edit":"","fa-pencil-square-o":"","fa-share-square-o":"","fa-check-square-o":"","fa-arrows":"","fa-step-backward":"","fa-fast-backward":"","fa-backward":"","fa-play":"","fa-pause":"","fa-stop":"","fa-forward":"","fa-fast-forward":"","fa-step-forward":"","fa-eject":"","fa-chevron-left":"","fa-chevron-right":"","fa-plus-circle":"","fa-minus-circle":"","fa-times-circle":"","fa-check-circle":"","fa-question-circle":"","fa-info-circle":"","fa-crosshairs":"","fa-times-circle-o":"","fa-check-circle-o":"","fa-ban":"","fa-arrow-left":"","fa-arrow-right":"","fa-arrow-up":"","fa-arrow-down":"","fa-mail-forward":"","fa-share":"","fa-expand":"","fa-compress":"","fa-plus":"","fa-minus":"","fa-asterisk":"","fa-exclamation-circle":"","fa-gift":"","fa-leaf":"","fa-fire":"","fa-eye":"","fa-eye-slash":"","fa-warning":"","fa-exclamation-triangle":"","fa-plane":"","fa-calendar":"","fa-random":"","fa-comment":"","fa-magnet":"","fa-chevron-up":"","fa-chevron-down":"","fa-retweet":"","fa-shopping-cart":"","fa-folder":"","fa-folder-open":"","fa-arrows-v":"","fa-arrows-h":"","fa-bar-t-o":"","fa-bar-t":"","fa-twitter-square":"","fa-facebook-square":"","fa-camera-retro":"","fa-key":"","fa-gears":"","fa-cogs":"","fa-comments":""})}},{key:"equals",value:function(t){return t instanceof e}}])&&Bt(o.prototype,i),e}();function zt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Zt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o;return e=t,o=[{key:"apply",value:function(t){var e=t.document,o={started:!1,color:"#000000",inputs:{},hasNativeColorSupport:!1,init:function(t){if(this.start(),!this.hasNativeColorSupport){if("string"!=typeof t)throw"inputId have to be a string id selector";if(this.input=(this.inputs[t]=this.inputs[t])||e.getElementById(t),!this.input)throw'There was no input found with id: "'+t+'"';this.input.value=this.color,this.input.unselectable="on",this.css(this.input,{backgroundColor:this.color,borderWidth:"0.4em 0.3em",width:"3em",cursor:"default"}),this.input.onfocus=function(){o.onFocus(this.id)}}},start:function(){if(!this.started){try{this.hasNativeColorSupport=!!(e.createElement("input").type="color")}catch(t){}if(!this.hasNativeColorSupport){var t=e.createElement("object");t.classid="clsid:3050f819-98b5-11cf-bb82-00aa00bdce0b",t.id="colorHelperObj",this.css(t,{width:"0",height:"0"}),e.body.appendChild(t)}this.started=!0}},destroy:function(t){var o;if("string"==typeof t)this.off(this.inputs[t]);else{for(o in e.body.removeChild(e.getElementById("colorHelperObj")),this.inputs)this.off(this.inputs[o]);this.started=!1}},off:function(t){t.onfocus=null,this.css(t,{backgroundColor:"",borderWidth:"",width:"",cursor:""})},onFocus:function(t){this.input=this.inputs[t],this.color=this.getColor(),this.input.value=this.color,o.css(this.input,{backgroundColor:this.color,color:this.color}),this.input.blur()},getColor:function(){var t=e.getElementById("colorHelperObj").ChooseColorDlg(this.color.replace(/#/,"")).toString(16);return t.length<6&&(t="000000".substring(0,6-t.length).concat(t)),"#"+t},css:function(t,e){for(var o in e)t.style[o]=e[o]}};t.nativeColorPicker=o}}],null&&zt(e.prototype,null),o&&zt(e,o),t}(),Ut=i(17);function Ht(t){return(Ht="function"==typeof Symbol&&"symbol"==o(Symbol.iterator)?function(t){return o(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)})(t)}function Wt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Yt(t,e){return!e||"object"!==Ht(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jt(t,e){return(Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Kt=function(t){function e(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Yt(this,Xt(e).call(this))).map_=null,t.controls_=[],t.metadata_=Ut.metadata,t.panel_=null,t.layer_=o,Zt.apply(window),Handlebars.registerHelper("sum",(function(t,e){return t+e})),Handlebars.registerHelper("neq",(function(t,e,o){return Object.equals(t,e)?o.inverse(this):o.fn(this)})),Handlebars.registerHelper("unless",(function(t,e){return t?e.inverse(this):e.fn(this)})),Handlebars.registerHelper("get",(function(t,e){return e[t]})),Handlebars.registerHelper("uppercase",(function(t){return t.toUpperCase()})),Handlebars.registerHelper("lowercase",(function(t){return t.toLowerCase()})),M.utils.extends=M.utils.extendsObj,t}var o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jt(t,e)}(e,M.Plugin),o=e,(i=[{key:"addTo",value:function(t){this.controls_.push(new Vt(this.layer_)),this.map_=t,this.panel_=new M.ui.Panel(e.NAME,{collapsible:!0,className:"m-stylemanager",collapsedButtonClass:"g-sigc-palette",position:M.ui.position.TL}),this.panel_.addControls(this.controls_),t.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var t=[null,null,null];this.control_=t[0],this.panel_=t[1],this.map_=t[2]}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"name",get:function(){return"stylemanager"}}])&&Wt(o.prototype,i),e}();window.M.plugin||(window.M.plugin={}),window.M.plugin.StyleManager=Kt}])},function(t,e,o){"use strict";o.r(e);o(11);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,o){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=c(t);if(e){var n=c(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return l(this,o)}}function l(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(h,M.impl.Control);var e,o,i,l=s(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=l.call(this)).params_=t||{},e.facadeMap_=null,e}return e=h,(o=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e,r(c(h.prototype),"addTo",this).call(this,t,e)}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}}])&&n(e.prototype,o),i&&n(e,i),h}(),u=o(2),p=o.n(u),d=o(0),f=o.n(d),g=o(3),m=o.n(g);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"setGroupEvents",value:function(t){document.querySelectorAll(".boton-toc-grupo").forEach((function(e){e.addEventListener("click",(function(){var o=e.parentNode.parentNode.nextElementSibling;void 0!==t.get(e.id)?(o.classList.add("noVisible"),e.classList.remove("g-cartografia-flecha-arriba2"),e.classList.add("g-cartografia-flecha-abajo2"),t.delete(e.id)):(o.classList.remove("noVisible"),e.classList.remove("g-cartografia-flecha-abajo2"),e.classList.add("g-cartografia-flecha-arriba2"),t.set(e.id,e))})),void 0===t.get(e.id)?(e.click(),e.click()):void 0!==t.get(e.id)&&e.classList.contains("g-cartografia-flecha-abajo2")&&(e.parentNode.parentNode.nextElementSibling.classList.remove("noVisible"),e.classList.remove("g-cartografia-flecha-abajo2"),e.classList.add("g-cartografia-flecha-arriba2"))}))}},{key:"saveTemplatesAsPartials",value:function(t){var e='\r\n\t\t\t\t\t\t\t\t<div class="m-area-order-hook" title="Orden de capas">\r\n\t\t\t\t\t\t\t\t\t<div class="m-accion-activelayers-order">\r\n\t\t\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">\r\n\t\t\t\t\t\t\t\t\t\t\t<path d="M25 0c-.254 0-.523.086-.719.281l-7 7a1.005 1.005 0 0 0-.218 1.094c.156.371.535.625.937.625h14.031c.551 0 1-.45 1-1a1.01 1.01 0 0 0-.437-.813L25.719.282A1.015 1.015 0 0 0 25 0zM2 13v4h46v-4zm0 10v4h46v-4zm0 10v4h46v-4zm16 8c-.402 0-.781.25-.938.625-.156.375-.066.809.22 1.094l7 7c.195.195.46.281.718.281.258 0 .523-.086.719-.281l7-7c.285-.285.375-.719.218-1.094A1.023 1.023 0 0 0 32 41z" />\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>',o='<div id="tocLayer_{{id}}" data-id="{{id}}" class="toc-item-layer">\r\n\t\t\t\t\t\t\t<div id="titleTocLayer_{{id}}" class="toc-item-layer-header {{#if outOfRange}}out-of-range{{/if}}{{#if visible}} visible{{/if}}">\r\n\t\t\t\t\t\t\t\t<div class="m-area-accion-activelayers-collapse">\r\n\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-collapse {{#if collapsed}}g-cartografia-flecha-abajo2{{else}}g-cartografia-flecha-arriba2{{/if}}"\r\n\t\t\t\t\t\t\t\t\ttitle="Opciones de capa"></button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="m-area-title">\r\n\t\t\t\t\t\t\t\t\t<div id="textTitleLayer_{{id}}" title="{{title}}" class="m-title">{{title}}</div>\r\n\t\t\t\t\t\t\t\t\t{{#if canEditName}}\r\n\t\t\t\t\t\t\t\t\t<div class="m-button">\r\n\t\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-rename g-cartografia-editar" title="Cambiar nombre"></button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{/if}}\r\n\t\t\t\t\t\t\t\t</div><div class="g-cartografia-spinner" title="La capa WFS/Geojson está cargando" style="font-size: x-large; -webkit-animation: mloading 1s linear infinite; -moz-animation: mloading 1s linear infinite; animation: mloading 1s linear infinite;" id="spinner"></div>\r\n\t\t\t\t\t\t\t\t<div class="g-cartografia-tamano" style="font-size: x-large" title="Resaltar capa">\r\n\t\t\t\t\t\t\t\t\t</div>';t&&(o+='\r\n\t\t\t\t\t\t\t\t<div class="g-cartografia-herramienta" style="font-size: x-large" title="Editar estilo">\r\n\t\t\t\t\t\t\t\t\t</div>'),o+='\r\n\t\t\t\t\t\t\t\t<div class="m-area-activate" title="Activar/Desactivar capa">\r\n\t\t\t\t\t\t\t\t\t<input type="checkbox" data-id="{{id}}" class="m-accion-activelayers-activate" {{#if visible}} checked{{/if}}> </input>\r\n\t\t\t\t\t\t\t\t\t</div> <div class="m-area-origin">\r\n\t\t\t\t\t\t\t\t\t<span>{{origen}}</span>\r\n\t\t\t\t\t\t\t\t</div>',o+=e,o+='\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div id="optionsTocLayer_{{id}}" class="toc-item-layer-options{{#if collapsed}} dNone{{/if}}">\r\n\t\t\t\t\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t\t\t\t\t<div class="transparency-control">\r\n\t\t\t\t\t\t\t\t\t\t<input type="range" data-id="{{id}}" title="Nivel de transparencia" class="m-accion-activelayers-transparency"\r\n\t\t\t\t\t\t\t\t\t\tmin="0" max="1" step="0.1" value="{{opacity}}" {{#unless visible}} disabled {{/unless}} {{#if outOfRange}}\r\n\t\t\t\t\t\t\t\t\t\tdisabled{{/if}}/> <span class="transparency-percentage">{{opacityPer}}%</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{#gt styles.length 1}}\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-showstyles g-cartografia-lista" title="Estilos de la capa"></button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{/gt}} {{#if metadata}}\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-metadata g-cartografia-texto" title="Ver metadatos"></button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{/if}} {{#if infoLayer}}\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-info g-cartografia-info" title="Información de la capa"></button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{/if}}\r\n\t\t\t\t\t\t\t\t\t{{#if canRemove}}\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\x3c!-- <span data-id="{{id}}" class="m-accion-activelayers-remove g-cartografia-papelera"></span> --\x3e\r\n\t\t\t\t\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-remove g-cartografia-papelera" title="Eliminar capa"></button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{{/if}}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t\t\t\t\t<div class="legend">\r\n\t\t\t\t\t\t\t\t\t\t<h3>Leyenda</h3>\r\n\t\t\t\t\t\t\t\t\t\t<img data-id="{{id}}" src="{{legend}}"></img>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t\t\t\t\t<div id="stylesTocLayer_{{id}}" class="{{#unless showStyles}}dNone{{/unless}}">\r\n\t\t\t\t\t\t\t\t\t\t<h3>Estilos de capa</h3>\r\n\t\t\t\t\t\t\t\t\t\t{{#each styles}}\r\n\t\t\t\t\t\t\t\t\t\t<div class="m-accion-activelayers-styles">\r\n\t\t\t\t\t\t\t\t\t\t\t<input id="{{@index}}-{{id}}" data-id="{{id}}" type="radio" class="m-accion-activelayers-activestyle"\r\n\t\t\t\t\t\t\t\t\t\t\t{{#if selected}} checked{{/if}} name="{{id}}" value="{{@index}}" />\r\n\t\t\t\t\t\t\t\t\t\t\t<label for="{{@index}}-{{id}}">{{Title}}</label>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t{{/each}}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>',Handlebars.registerPartial("layer",o),Handlebars.registerPartial("group",'<div id="{{id}}" class="toc-item-group toc-item-group-capas-activas n2">\r\n\t\t\t\t\t\t\t<div class="toc-item-group-header gris-negrita-n2">\r\n\t\t\t\t\t\t\t\t<div class="layer-group-name">\r\n\t\t\t\t\t\t\t\t\t<button id="button-{{id}}" class="boton-toc-grupo m-accion-thematiclayers-collapse g-cartografia-flecha-abajo2"></button>\r\n\t\t\t\t\t\t\t\t\t<span>{{name}}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="m-area-order-hook" title="Orden de capas">\r\n\t\t\t\t\t\t\t\t\t<div class="m-accion-activelayers-order">\r\n\t\t\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">\r\n\t\t\t\t\t\t\t\t\t\t\t<path d="M25 0c-.254 0-.523.086-.719.281l-7 7a1.005 1.005 0 0 0-.218 1.094c.156.371.535.625.937.625h14.031c.551 0 1-.45 1-1a1.01 1.01 0 0 0-.437-.813L25.719.282A1.015 1.015 0 0 0 25 0zM2 13v4h46v-4zm0 10v4h46v-4zm0 10v4h46v-4zm16 8c-.402 0-.781.25-.938.625-.156.375-.066.809.22 1.094l7 7c.195.195.46.281.718.281.258 0 .523-.086.719-.281l7-7c.285-.285.375-.719.218-1.094A1.023 1.023 0 0 0 32 41z" />\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div id="id-contenido-{{id}}" class="toc-activelayers toc-item-group-options">\r\n\t\t\t\t\t\t\t\t{{#each ids}}\r\n\t\t\t\t\t\t\t\t\t{{> layer}}\r\n\t\t\t\t\t\t\t\t{{/each}}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>'),Handlebars.registerPartial("groupInside",'<div id="{{id}}" class="toc-item-group toc-item-group-capas-activas n2">\r\n\t\t\t\t\t\t\t<div class="toc-item-group-header gris-negrita-n2">\r\n\t\t\t\t\t\t\t\t<div class="layer-group-name">\r\n\t\t\t\t\t\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;<button id="button-{{id}}" class="boton-toc-grupo m-accion-thematiclayers-collapse g-cartografia-flecha-abajo2"></button>\r\n\t\t\t\t\t\t\t\t\t<span>{{name}}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="m-area-order-hook" title="Orden de capas">\r\n\t\t\t\t\t\t\t\t\t<div class="m-accion-activelayers-order">\r\n\t\t\t\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">\r\n\t\t\t\t\t\t\t\t\t\t\t<path d="M25 0c-.254 0-.523.086-.719.281l-7 7a1.005 1.005 0 0 0-.218 1.094c.156.371.535.625.937.625h14.031c.551 0 1-.45 1-1a1.01 1.01 0 0 0-.437-.813L25.719.282A1.015 1.015 0 0 0 25 0zM2 13v4h46v-4zm0 10v4h46v-4zm0 10v4h46v-4zm16 8c-.402 0-.781.25-.938.625-.156.375-.066.809.22 1.094l7 7c.195.195.46.281.718.281.258 0 .523-.086.719-.281l7-7c.285-.285.375-.719.218-1.094A1.023 1.023 0 0 0 32 41z" />\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div id="id-contenido-{{id}}" class="toc-activelayers toc-item-group-options">\r\n\t\t\t\t\t\t\t\t{{#each ids}}\r\n\t\t\t\t\t\t\t\t\t{{> layer}}\r\n\t\t\t\t\t\t\t\t{{/each}}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>')}},{key:"getLayerByNameOrId",value:function(t,e,o,i){for(var n=0;n<t.getLayers().length;n++){var r=t.getLayers()[n];if(r.name===o&&r.url===i||r.name===o&&null===i||r.id===e)return r}return null}},{key:"getLayerPositionInMap",value:function(t,e){for(var o=0;o<t.getLayers().length;o++){var i=t.getLayers()[o];if(i.name===e.name||i.id===e.id)return o}return-1}},{key:"setModalButtonsEvents",value:function(t){var e=t.querySelector("#m-setstyle-filebutton"),o=t.querySelector("#m-setstyle-file"),i=document.querySelector("div.m-mapea-container"),n=t.querySelector("#remove-button"),r=t.querySelector("#cancel-button");o.addEventListener("change",(function(){var t=o.value;if(t){var e=t.indexOf("\\")>=0?t.lastIndexOf("\\"):t.lastIndexOf("/"),i=t.substring(e);0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),o.nextElementSibling.value=i}})),e.addEventListener("click",(function(){o.click()})),n.addEventListener("click",(function(){o.value="",o.nextElementSibling.value=""})),r.addEventListener("click",(function(){t.remove()})),i.appendChild(t)}},{key:"displayOldTitle",value:function(){document.getElementById("toolbar-title-managelayers").style.display="block",document.getElementsByClassName("color-junta-flex")[0].style.display="none"}},{key:"idEquals",value:function(t,e){return t===e||(t.indexOf("tocLayer_")>-1&&e.indexOf("tocLayer_")>-1&&t.substring(9).substring(t.substring(9).indexOf("_")+1))===e.substring(9).substring(e.substring(9).indexOf("_")+1)}},{key:"getMovedLayers",value:function(e,o,i){var n=[];if(e.newIndex-e.oldIndex>=0)for(var r=0;r<o.children.length;r++){var a=o.children[r];t.idEquals(a.id,i[r])||n.push(i[r])}else for(var s=o.children.length-1;s>=0;s--){var l=o.children[s];t.idEquals(l.id,i[s])||n.push(i[s])}return n}},{key:"getRealIndexes",value:function(t,e,o){var i=0,n=0;if(t.newIndex-t.oldIndex!=0)for(var r=0;r<e.length;r++){var a=e[r];a.id&&(a.id===t.item.id.substring(9)||a.id.substring(a.id.indexOf("_")+1)===t.item.id.substring(9).substring(t.item.id.substring(9).indexOf("_")+1)?i=a.getZIndex():a.id!==o.substring(9)&&a.id.substring(a.id.indexOf("_")+1)!==o.substring(9).substring(o.substring(9).indexOf("_")+1)||(n=a.getZIndex()))}return[i,n]}},{key:"numGroups",value:function(t,e){for(var o=0,i=0;i<t.length;i++)for(var n=t[i],r=!1,a=0;a<e.length&&!r;a++){var s=e[a];n.substring(9)===s.id&&(o++,r=!0)}return t.length-o}},{key:"cloneGroups",value:function(t){if(null==t||"object"!=y(t))return t;var e=t.constructor();for(var o in t)t.hasOwnProperty(o)&&(void 0===t[o].groupsSL||void 0!==t[o].groupsSL&&t[o].groupsSL.length>0)&&(void 0===t[o].ids||void 0!==t[o].ids&&t[o].ids.length>0)&&(e[o]=t[o]);return e.filter((function(t){return null!=t}))}}],(o=null)&&v(e.prototype,o),i&&v(e,i),t}();function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,n=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(o.push(a.value),!e||o.length!==e);i=!0);}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return o}(t,e)||w(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){if(t){if("string"==typeof t)return x(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?x(t,e):void 0}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function L(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var k=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"getSerializedStyle",value:function(t,e){return window.btoa(unescape(encodeURIComponent('{"parameters":['.concat(JSON.stringify(t),'],"type":"M.style.').concat(e,'"}'))))}},{key:"deserialize",value:function(t){var e=decodeURIComponent(escape(window.atob(t))),o=JSON.parse(e),i=o.parameters,n=o.type;return this.deserializeFunction(i,n)}},{key:"deserializeFunction",value:function(t,e){var o=this.defineFunctionFromString(t),i=o.map((function(t,e){return"arg".concat(e)})),n=i.reduce((function(t,e){return t.concat(", ").concat(e)}));return new Function(i,"return new ".concat(e,"(").concat(n,")")).apply(void 0,S(o))}},{key:"defineFunctionFromString",value:function(t){var e=this,o=t;if(/^\{\{f\}\}/.test(t)){var i=t.replace(/^\{\{f\}\}(.+)/,"$1");o=new Function("f","return ".concat(i))()}else Object.keys(o).forEach((function(t){var i=o[t];if(/^\{\{f\}\}/.test(i)){var n=i.replace(/^\{\{f\}\}(.+)/,"$1");o[t]=new Function("f","return ".concat(n))()}else M.utils.isObject(i)&&e.defineFunctionFromString(i)}));return o}},{key:"extendsObj",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e;return M.utils.isNullOrEmpty(o)||Object.keys(o).forEach((function(e){var n=o[e];M.utils.isArray(n)?n=S(n):M.utils.isObject(n)&&(n=t.extendsObj({},n)),M.utils.isNullOrEmpty(i[e])?i[e]=n:M.utils.isObject(i[e])&&t.extendsObj(i[e],n)})),i}},{key:"stringifyFunctions",value:function(t){var e,o=this;return M.utils.isArray(t)?e=(e=S(t)).map((function(t){return o.stringifyFunctions(t)})):M.utils.isObject(t)?(e=this.extendsObj({},t),Object.keys(e).forEach((function(t){var i=e[t];M.utils.isFunction(i)?e[t]="{{f}}".concat(i.toString()):M.utils.isObject(i)&&(e[t]=o.stringifyFunctions(i))}))):e=M.utils.isFunction(t)?"{{f}}".concat(t.toString()):t,e}},{key:"getGeometry",value:function(t){if(!(M.version&&parseInt(M.version.substring(0,1))>=5)){var e=t.constructor.toString();return(e=e.substring(e.indexOf("M.style.")+"M.style.".length)).substring(0,e.indexOf("."))}return t instanceof M.style.Proportional?"Proportional":t instanceof M.style.Choropleth?"Choropleth":t instanceof M.style.Cluster?"Cluster":t instanceof M.style.Category?"Category":t instanceof M.style.Chart?"Chart":t instanceof M.style.Heatmap?"Heatmap":t instanceof M.style.Polygon?"Polygon":t instanceof M.style.Line?"Line":t instanceof M.style.Point?"Point":void 0}},{key:"choroplethToJSON",value:function(t){var e=this,o=t.getAttributeName(),i=t.getChoroplethStyles().map((function(t){if("string"==typeof t)return e.getSerializedStyle({fill:{color:t,opacity:1},stroke:{color:t,width:1}},"Polygon");var o=e.getGeometry(t);return e.getSerializedStyle(t.getOptions(),o)})),n=t.getQuantification();n=M.utils.isNullOrEmpty(n.name)?this.stringifyFunctions(n):n.name;var r=this.extendsObj({},t.getOptions());return{parameters:[o,i,n,r=this.stringifyFunctions(r),t.getStyles().map((function(t){var o=e.getGeometry(t);return e.getSerializedStyle(t.getOptions(),o)}))]}}},{key:"choroplethDeserialize",value:function(t){var e,o=this,i=_(t,5),n=i[0],r=i[1],a=i[2],s=i[3],l=i[4],c=n,h=r.map((function(t){return o.deserialize(t)}));e="jenks"===a?M.style.quantification.JENKS():"quantile"===a?M.style.quantification.QUANTILE():this.defineFunctionFromString(a);var u=this.defineFunctionFromString(s),p=new Function(["attributeName","styles","quantification","options"],"return new M.style.Choropleth(attributeName, styles, quantification, options)")(c,h,e,u),d=l.map((function(t){return o.deserialize(t)}));return p.add(d),p}},{key:"proportionalToJSON",value:function(t){var e=this,o=t.getAttributeName(),i=t.getMinRadius(),n=t.getMaxRadius(),r=t.getStyles().map((function(t){var o=e.getGeometry(t);return e.getSerializedStyle(t.getOptions(),o)})),a=this.stringifyFunctions(t.getProportionalFunction()),s=this.extendsObj({},t.getOptions());return{parameters:[o,i,n,r,a,s=this.stringifyFunctions(s)]}}},{key:"proportionalDeserialize",value:function(t){var e=this,o=_(t,6),i=o[0],n=o[1],r=o[2],a=o[3],s=o[4],l=o[5],c=i,h=n,u=r,p=this.defineFunctionFromString(s),d=this.defineFunctionFromString(l),f=a.map((function(t){return e.deserialize(t)}));return new Function(["attributeName","minRadius","maxRadius","style","proportionalFunction","options"],"return new M.style.Proportional(attributeName,\n        minRadius, maxRadius, style, proportionalFunction, options)")(c,h,u,f[0],p,d)}},{key:"categoryToJSON",value:function(t){var e=this,o=t.getAttributeName(),i=t.getCategories(),n={};Object.keys(i).forEach((function(t){n[t]=e.getSerializedStyle(i[t].options_,e.getGeometry(i[t]))}));var r=this.extendsObj({},t.getOptions());r=this.stringifyFunctions(r);var a=t.getStyles().map((function(t){var o=e.getGeometry(t);return e.getSerializedStyle(t.getOptions(),o)}));return{parameters:[o,n,r,a]}}},{key:"categoryDeserialize",value:function(t){var e=this,o=_(t,4),i=o[0],n=o[1],r=o[2],a=o[3],s=i,l=n;Object.keys(n).forEach((function(t){l[t]=e.deserialize(n[t])}));var c=this.defineFunctionFromString(r),h=new Function(["attributeName","categoryStyles","options"],"return new M.style.Category(attributeName, categoryStyles, options)")(s,l,c),u=a.map((function(t){return e.deserialize(t)}));return h.add(u),h}},{key:"chartToJSON",value:function(t){var e=this,o=t.getOptions();return{parameters:[{type:o.type,radius:o.radius,donutRadio:o.donutRadio,offsetX:o.offsetX,offsetY:o.offsetY,troke:M.utils.isNullOrEmpty(o.stroke)?void 0:this.extendsObj({},o.stroke),fill3DColor:o.fill3DColor,scheme:M.utils.isArray(o.scheme)?S(o.scheme):o.scheme,label:M.utils.isNullOrEmpty(o.label)?void 0:this.extendsObj({},o.label),rotateWithView:o.rotateWithView,variables:o.variables.map((function(t){var o;return M.utils.isNullOrEmpty(t.label)||(o=e.extendsObj({},t.label),o=e.stringifyFunctions(o)),{attribute:t.attribute,legend:t.legend,fill:t.fillColor,label:o}}))}]}}},{key:"chartDeserialize",value:function(t){var e=this,o=_(t,1)[0],i=o;return i.variables=o.variables.map((function(t){return new M.style.chart.Variable(e.defineFunctionFromString(t))})),new Function(["options"],"return new M.style.Chart(options)")(i)}},{key:"heatmapToJSON",value:function(t){var e=t.getAttributeName(),o=t.getOptions();return{parameters:[e,{gradient:S(o.gradient),blur:o.blur,radius:o.radius,weight:o.weight},t.vendorOptions_]}}},{key:"heatmapDeserialize",value:function(t){var e,o=_(t,3),i=o[0],n=o[1],r=o[2],a=i,s=this.defineFunctionFromString(n);return null!=r&&(e=this.defineFunctionFromString(r)),new Function(["attribute","options","vendorOptions"],"return new M.style.Heatmap(attribute, options, vendorOptions)")(a,s,e)}},{key:"clusterToJSON",value:function(t){var e=this,o=M.version&&parseInt(M.version.substring(0,1))>=5?t.optsVendor_:t.gf.optionsVendor_,i=this.extendsObj({},t.getOptions());i.ranges=t.getRanges().map((function(t){var o=e.extendsObj({},t),i=e.getGeometry(t.style);return o.style=e.getSerializedStyle(t.style.getOptions(),i),o})),i=this.stringifyFunctions(i);var n=this.extendsObj({},o);return{parameters:[i,n=this.stringifyFunctions(n),t.getStyles().map((function(t){var o=e.getGeometry(t);return e.getSerializedStyle(t.getOptions(),o)}))]}}},{key:"clusterDeserialize",value:function(t){var e=this,o=_(t,3),i=o[0],n=o[1],r=o[2],a=i;a.ranges.forEach((function(t){t.style=e.deserialize(t.style)})),a=this.defineFunctionFromString(i);var s=this.defineFunctionFromString(n),l=new Function(["options","optsVendor"],"return new M.style.Cluster(options, optsVendor)")(a,s),c=r.map((function(t){return e.deserialize(t)}));return l.add(c),l}}],(o=null)&&L(e.prototype,o),i&&L(e,i),t}();function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var T=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"setLayerStyleEvent",value:function(t,e,o,i,n,r){for(var a=this,s=document.getElementsByClassName("g-cartografia-herramienta"),l=function(l){var c=s[l];c.addEventListener("click",(function(){var s=c.parentNode.parentNode.dataset.id;s=s.split("_"),Number.isNaN(Number.parseInt(s[0]))?s=c.parentNode.parentNode.dataset.id:(s.shift("_"),s=s.join("_"));var l=b.getLayerByNameOrId(t,s,s,null);null!==l&&(l.type!==M.layer.type.WMS&&l.type!==M.layer.type.WFS&&l.type!==M.layer.type.GeoJSON?M.dialog.error("Solamente se pueden aplicar estilos a las capas de tipo WMS, WFS o GeoJSON","No se pueden aplicar estilos a esta capa"):a.activateModal(l,e,o,i,n,r))}))},c=0;c<s.length;c++)l(c)}},{key:"setWFSComplexStyle",value:function(t,e,o,i,n){var r;if("choropleth"===t.geometry.toLowerCase()){var a,s,l=t.valueField;t.colors&&(a=t.colors.map((function(t){return"object"===C(t)?"":t}))).filter((function(t){return""!==t})),t.quantification&&(2===(s=t.quantification.split(",")).length?"JENKS"!==s[0].toUpperCase()&&"QUANTILE"!==s[0].toUpperCase()||(2===a.length?s=M.style.quantification[s[0].toUpperCase()](Number.parseInt(s[1])):a.length>2&&(s=M.style.quantification[s[0].toUpperCase()](a.length))):1===s.length&&void 0!==o.get(s[0])&&(s=o.get(s[0]))),"function"==typeof s&&(r=a?new M.style.Choropleth(l,a,s):new M.style.Choropleth(l,[],s))}else if("proportional"===t.geometry.toLowerCase()){var c,h,u=t.valueField,p=t.sizeMin,d=t.sizeMax;void 0!==t.pointStyle&&(c=new M.style.Point(t.pointStyle)),void 0!==t.proportionalFunction&&""!==t.proportionalFunction&&void 0!==o.get(t.proportionalFunction)&&(h=o.get(t.proportionalFunction)),r=void 0!==h&&"function"==typeof h?new M.style.Proportional(u,p,d,void 0!==c?c:void 0,h):new M.style.Proportional(u,p,d,void 0!==c?c:void 0)}else if("category"===t.geometry.toLowerCase()){var f,g=t.attributeName;void 0!==t.categoryStyles&&(f=t.categoryStyles.map((function(t){return[t.name,new M.style[t.style.geometry](t.style.options)]})),f=Object.fromEntries(f)),r=void 0!==f?new M.style.Category(g,f):new M.style.Category(g)}else if("chart"===t.geometry.toLowerCase()){var m=t.chartStyle,y=Object.assign({},m);if(void 0!==y.variables)for(var v=0;v<y.variables.length;v++){var b=y.variables[v];if(void 0!==b.label&&void 0!==b.label.text&&(b.label.text.toLowerCase().indexOf("function")>-1||b.label.text.toLowerCase().indexOf("funcion")>-1)&&void 0!==o.get(b.label.text)&&(b.label.text=o.get(b.label.text)),!Array.isArray(t.chartStyle.scheme)&&"custom"!==t.chartStyle.scheme.toLowerCase()){var _=v%M.style.chart.schemes[t.chartStyle.scheme].length;b.fill&&(b.fill=M.style.chart.schemes[t.chartStyle.scheme][_])}}r=new M.style.Chart(y)}else if("heatmap"===t.geometry.toLowerCase()){var S=t.attribute;void 0!==S&&((S.toLowerCase().indexOf("function")>-1||S.toLowerCase().indexOf("funcion")>-1)&&void 0!==o.get(S)&&(S=o.get(S)),r=void 0!==t.options?new M.style.Heatmap(S,t.options):new M.style.Heatmap(S))}else if("cluster"===t.geometry.toLowerCase()){var w=t.clusterOptions,x=t.vendorOptions;void 0!==w.ranges&&(w.ranges=w.ranges.map((function(t){var e=t;return void 0!==e.style&&(e.style=new M.style.Point(e.style.options)),e}))),r=void 0===x?new M.style.Cluster(w):new M.style.Cluster(w,x)}void 0!==r&&this.setStyleAndRedrawLayerAndSaveLegendStyle(e,null,i,n,!0,!1,r)}},{key:"isNotComplex",value:function(t){return"choropleth"!==t.toLowerCase()&&"proportional"!==t.toLowerCase()&&"category"!==t.toLowerCase()&&"chart"!==t.toLowerCase()&&"heatmap"!==t.toLowerCase()&&"cluster"!==t.toLowerCase()&&("point"===t.toLowerCase()||"line"===t.toLowerCase()||"polygon"===t.toLowerCase())}},{key:"setStyleFromContent",value:function(t,e,o,i,n,r,a){if(o.type===M.layer.type.WMS)(new DOMParser).parseFromString(t,"text/xml").documentElement.innerHTML.indexOf("parsererror")>-1||-1===t.indexOf("sld:StyledLayerDescriptor")?M.dialog.error("No se puede aplicar el estilo porque no es un fichero SLD o está mal formado","Imposible aplicar estilo"):this.setSLDStyle(e,o,t,i,n,!0);else if(o.type===M.layer.type.WFS||o.type===M.layer.type.GeoJSON)try{var s=JSON.parse(t);if(this.isNotComplex(s.geometry)){this.setStyleWFS(o,s);var l=a.get(o.name);void 0!==l&&(e.setSimpleStyle(o,l),a.set(o.name,l));var c=k.getSerializedStyle(s.options,s.geometry);this.redrawLayerAndSaveLegendStyle(o,c,n,i,!0,!0)}else this.setWFSComplexStyle(s,o,r,n,i)}catch(t){M.dialog.error("No se puede aplicar el estilo porque no es un fichero JSON o está mal formado","Imposible aplicar estilo")}else M.dialog.error("No se puede aplicar el estilo","Imposible aplicar estilo")}},{key:"activateModal",value:function(t,e,o,i,n,r){var a=this,s=M.template.compileSync(f.a,{vars:{message:"Cambiar estilo de la capa"}}),l=s.querySelector("#ok-button"),c=s.querySelector("#remove-button"),h=s.querySelector("#m-setstyle-file"),u=document.createElement("button");u.id="helpButton",u.style.marginRight="1%",u.innerText="Ayuda",s.querySelector("#m-setstyle-button").insertBefore(u,c),u.addEventListener("click",(function(){var t=M.template.compileSync(m.a),e=document.querySelector("div.m-mapea-container");t.querySelector("#close-button").addEventListener("click",(function(){t.remove()})),e.appendChild(t)})),l.addEventListener("click",(function(){var l=h.files[0];if(l){var c=new FileReader;c.readAsText(l,"UTF-8"),c.onload=function(s){a.setStyleFromContent(s.target.result,e,t,o,i,n,r)},c.onerror=function(){M.dialog.error("No se puede aplicar el estilo","Imposible aplicar estilo")}}else if(""===h.nextElementSibling.value)M.dialog.error("No se ha seleccionado ningún estilo","No hay estilo");else{var u=document.createElement("script");u.language="JavaScript",u.type="text/javascript",u.src=h.nextElementSibling.value,u.id="sldOrJsonViaUrl";var p=document.getElementsByTagName("script")[0];p?p.parentNode.insertBefore(u,p):document.body.appendChild(u),setTimeout((function(){try{a.setStyleFromContent(sldViaUrlContent,e,t,o,i,n,r)}catch(s){try{a.setStyleFromContent(jsonViaUrlContent,e,t,o,i,n,r)}catch(t){M.dialog.error("No se puede cargar el fichero localizado en ".concat(u.src,", puede que el recurso no esté accesible en este momento o esté su nombre mal escrito"),"Imposible cargar el fichero")}}finally{document.getElementById(u.id).remove()}}),1e3)}s.remove()})),b.setModalButtonsEvents(s)}},{key:"addSLDInLegendURL",value:function(t,e){return null!==e&&-1===t.toLowerCase().indexOf("sld=")&&-1===t.toLowerCase().indexOf("sld_body=")&&-1===t.toLowerCase().indexOf("SLD=")&&-1===t.toLowerCase().indexOf("SLD_BODY=")&&("http"===e.substring(0,4)?t+="&sld=".concat(encodeURIComponent(e)):"http"!==e.substring(0,4)&&(t+="&sld_body=".concat(-1!==e.indexOf("%253C")?encodeURIComponent(e):e))),t}},{key:"setStyleWFS",value:function(t,e){t.setStyle(new M.style[e.geometry](e.options))}},{key:"setSLDInLegendURL",value:function(t,e){for(var o=e.substring(0,4),i=t.split("?"),n=i[0],r=i[1].split("&"),a=!1,s=n,l=0;l<r.length;l++){var c=r[l];s+=0===l?"?":"&","http"===o.toLowerCase()&&(c.toLowerCase().indexOf("sld_body=")>-1||c.toLowerCase().indexOf("sld=")>-1)?(s+="sld=".concat(encodeURIComponent(e)),a=!0):"http"!==o.toLowerCase()&&(c.toLowerCase().indexOf("sld_body=")>-1||c.toLowerCase().indexOf("sld=")>-1)?(s+="sld_body=".concat(encodeURIComponent(e)),a=!0):s+="".concat(c)}return a||("http"===o.toLowerCase()?s+="&sld=".concat(encodeURIComponent(e)):"http"!==o.toLowerCase()&&(s+="&sld_body=".concat(encodeURIComponent(e)))),s}},{key:"getSLD",value:function(t,e){var o=e.hasSLDInParams(t);return null!==o?o:t.url.indexOf("sld_body=")>-1&&2===t.url.split("sld_body=").length?t.url.split("sld_body=")[1]:t.url.indexOf("SLD_BODY=")>-1&&2===t.url.split("SLD_BODY=").length?t.url.split("SLD_BODY=")[1]:t.url.indexOf("sld=")>-1&&2===t.url.split("sld=").length?t.url.split("sld=")[1]:t.url.indexOf("SLD=")>-1&&2===t.url.split("SLD=").length?t.url.split("SLD=")[1]:null}},{key:"replaceLegendURL",value:function(t,e,o){var i,n=t.split(e);return i=n[1].indexOf("&")>-1?n[1].substring(n[1].indexOf("&")+1):"","".concat(n[0]).concat(e).concat(encodeURIComponent(o)).concat(i)}},{key:"replaceSLDInLegend",value:function(t,e){return t.getLegendURL().indexOf("sld_body=")>-1&&2===t.getLegendURL().split("sld_body=").length?this.replaceLegendURL(t.getLegendURL(),"sld_body=",e):t.url.indexOf("SLD_BODY=")>-1&&2===t.url.split("SLD_BODY=").length?this.replaceLegendURL(t.getLegendURL(),"SLD_BODY=",e):t.url.indexOf("sld=")>-1&&2===t.url.split("sld=").length?this.replaceLegendURL(t.getLegendURL(),"sld=",e):t.url.indexOf("SLD=")>-1&&2===t.url.split("SLD=").length?this.replaceLegendURL(t.getLegendURL(),"SLD=",e):this.setSLDInLegendURL(t.getLegendURL(),e)}},{key:"serializeStyleAndSetStyleMap",value:function(t,e,o,i){var n=k.getSerializedStyle(t,e);i.set(o,{layerName:o,layerSerializedStyle:n})}},{key:"setStyleMap",value:function(t,e){var o=k.getGeometry(t.getStyle());this.isNotComplex(o)&&this.serializeStyleAndSetStyleMap(t.getStyle().getOptions(),o,t.name,e)}},{key:"setStylesLegendsFirstTime",value:function(t,e,o,i,n,r){var a=this;void 0!==t.styles&&(void 0===r&&(r=new Map),t.functions&&t.functions.forEach((function(t){r.set(t.name,t.funcion)})),t.styles.forEach((function(t){for(var s=t.name,l=function(l){var c=i.getLayers()[l];c.name===s&&(c.type===M.layer.type.WFS||c.type===M.layer.type.GeoJSON?void 0!==t.style.styleJSON?a.isNotComplex(t.style.styleJSON.geometry)?(a.setStyleWFS(c,t.style.styleJSON),a.serializeStyleAndSetStyleMap(t.style.styleJSON.options,t.style.styleJSON.geometry,s,n)):"cluster"===t.style.styleJSON.geometry.toLowerCase()?c.on(M.evt.LOAD,(function(){a.setWFSComplexStyle(t.style.styleJSON,c,r,n,e)})):a.setWFSComplexStyle(t.style.styleJSON,c,r,n,e):(c.setStyle(t.style.object),a.setStyleMap(c,n)):c.type===M.layer.type.WMS&&void 0!==t.style.sld&&(o.setSLD(c,t.style.sld),c.url=a.setURL(c.url,"sld_body",encodeURIComponent(t.style.sld),o),c.setLegendURL(a.setSLDInLegendURL(c.getLegendURL(),t.style.sld)),n.set(s,{layerName:s,sldContent:t.style.sld})))},c=0;c<i.getLayers().length;c++)l(c)}))),void 0!==t.legend&&t.legend.forEach((function(t){for(var o=t.name,n=0;n<i.getLayers().length;n++){var r=i.getLayers()[n];r.name===o&&(r.setLegendURL(t.legend),e.set(o,t.legend))}}))}},{key:"setLegend",value:function(t,e,o,i){return void 0!==t.get(e.name)?t.get(e.name):(e.getLegendURL().indexOf(M.Layer.LEGEND_ERROR)>-1&&e.setLegendURL("".concat(e.url,"&SERVICE=WMS&VERSION=").concat(e.version,"&REQUEST=GetLegendGraphic&LAYER=").concat(e.id,"&FORMAT=image%2Fpng&EXCEPTIONS=image%2Fpng")),null===o.hasSLDInParams(e)||-1!==e.getLegendURL().indexOf("sld_body=")&&-1!==e.getLegendURL().indexOf("SLD_BODY=")&&-1!==e.getLegendURL().indexOf("sld=")&&-1!==e.getLegendURL().indexOf("SLD=")?i=this.addSLDInLegendURL(i,this.getSLD(e,o)):(e.setLegendURL(this.replaceSLDInLegend(e,this.getSLD(e,o))),i=e.getLegendURL()),i)}},{key:"setURL",value:function(t,e,o,i){var n=i.removeSLDInURL(t);return n.indexOf("?")>-1?"?"===n.substring(n.length-1)||"&"===n.substring(n.length-1)?n+="".concat(e,"=").concat(o):n+="&".concat(e,"=").concat(o):n+="?".concat(e,"=").concat(o),n}},{key:"setLegendTOC",value:function(t,e){void 0!==t.get(e.name)&&t.delete(e.name),null!==document.getElementById("optionsTocLayer_".concat(e.id))&&(document.getElementById("optionsTocLayer_".concat(e.id)).children[1].children[0].children[1].src=e.getLegendURL())}},{key:"setLegendInLayer",value:function(t,e,o){e.setLegendURL(o),this.setLegendTOC(t,e)}},{key:"setSLDStyle",value:function(t,e,o,i,n,r){if(null!==t.hasSLDInParams(e)||t.hasImplLayer(e)?t.setSLD(e,o):e.url=this.setURL(e.url,"sld_body",encodeURIComponent(o),t),n.set(e.name,{layerName:e.name,sldContent:o}),r){if(e.getLegendURL().indexOf(e.name)>-1&&e.getLegendURL().indexOf("format=")>-1)e.setLegendURL(this.setSLDInLegendURL(e.getLegendURL(),o));else{var a=t.removeSLDInURL(e.url);e.setLegendURL("".concat(a,"&request=GetLegendGraphic&layer=").concat(e.name,"&format=image/png")),e.setLegendURL(this.setSLDInLegendURL(e.getLegendURL(),o))}this.setLegendTOC(i,e)}}},{key:"redrawLayerAndSaveLegendStyle",value:function(t,e,o,i,n,r){var a=this;if(t.redraw(),r&&o.set(t.name,{layerName:t.name,layerSerializedStyle:e}),n){var s=t.getStyle().toImage();s instanceof Promise?s.then((function(e){a.setLegendInLayer(i,t,e)})):this.setLegendInLayer(i,t,s)}}},{key:"setStyleAndRedrawLayerAndSaveLegendStyle",value:function(t,e,o,i,n,r,a){var s=this;t.setStyle(a),t.getFeatures().length>0?this.redrawLayerAndSaveLegendStyle(t,e,o,i,n,r):t.on(M.evt.LOAD,(function(){s.redrawLayerAndSaveLegendStyle(t,e,o,i,n,r)}))}},{key:"setComplexDeserializedStyle",value:function(t,e,o,i){if(void 0!==t){var n=t.parameters;if("choropleth"===t.type||"proportional"===t.type||"category"===t.type||"chart"===t.type||"heatmap"===t.type||"cluster"===t.type){var r=k["".concat(t.type,"Deserialize")](n);this.setStyleAndRedrawLayerAndSaveLegendStyle(e,null,o,i,void 0===i.get(e.name),!1,r)}}}},{key:"setStyleLayer",value:function(t,e,o,i,n,r){var a=n.get(r).index,s=n.get(r).style;if(i.setZIndex(a),n.delete(r),void 0!==e.get(i.name)){var l=e.get(i.name);if(void 0!==l.sldContent)this.setSLDStyle(o,i,l.sldContent,t,e,void 0===t.get(i.name));else if(void 0!==l.layerSerializedStyle){var c=k.deserialize(l.layerSerializedStyle);this.setStyleAndRedrawLayerAndSaveLegendStyle(i,l.layerSerializedStyle,e,t,void 0===t.get(i.name),!0,c)}else if(void 0!==l.layerStyleName){var h=l.layerStyleName;o.hasImplLayer(i)?o.setLayerStyleName(i,h,t,e):i.url=this.setURL(i.url,"STYLES",h,o)}}if(this.setComplexDeserializedStyle(s,i,e,t),void 0!==t.get(i.name)){var u=t.get(i.name);i.setLegendURL(u)}}},{key:"setStyleFromFile",value:function(t,e,o,i,n){var r=this,a=Array.from(n.keys());i.forEach((function(i){if(void 0!==n.get("tocLayer_".concat(i.id)))r.setStyleLayer(t,e,o,i,n,"tocLayer_".concat(i.id));else if(void 0===i.id){var s=a.find((function(t){return t.indexOf(i.name)>-1}));void 0!==s&&r.setStyleLayer(t,e,o,i,n,s)}}))}},{key:"isModifiedByStyleManager",value:function(t,e){return e.get(t.name)&&t.getStyle()&&t.getStyle().options_&&t.getStyle().options_.label&&t.getStyle().options_.label.indexOf("|remove_legends_map")>-1}},{key:"tocLinesFix",value:function(t,e,o,i){var n=this;t.forEach((function(t){if(t.id.indexOf("tocLayer_")>-1&&null===b.getLayerByNameOrId(e,t.id.substring(9),null,null))t.remove();else{var r=b.getLayerByNameOrId(e,t.id.substring(9),null,null);if(null!==r&&("wfs"===r.type.toLowerCase()||"geojson"===r.type.toLowerCase())&&r.getStyle()){if(void 0===o.get(r.name)||n.isModifiedByStyleManager(r,o)){r.getStyle()&&r.getStyle().minRadius_&&void 0===r.getStyle().style_&&r.getStyle().setStyle(new M.style.Point(r.getStyle().getStyles()[0].options_));var a=r.getStyle().toImage();if(a instanceof Promise?a.then((function(e){document.getElementById(t.children[1].id).children[1].children[0].children[1].src=e})):t.children[1].children[1].children[0].children[1].src=a,n.setStyleMap(r,i),n.isModifiedByStyleManager(r,o)&&o.delete(r.name),"string"==typeof r.getStyle().options_.label)for(var s in r.getStyle().options_.label=r.getStyle().options_.label.substring(0,r.getStyle().options_.label.indexOf("|remove_legends_map")),r.getStyle().options_)null!==r.getStyle().options_[s]&&void 0!==r.getStyle().options_[s]&&""!==r.getStyle().options_[s]||delete r.getStyle().options_[s]}if(r.getStyle()&&r.getStyle().options_&&r.getStyle().options_.ranges){var l=r.getStyle().getOptions().ranges.map((function(t){var e=t;return isNaN(e.style.options_.stroke.width)&&(e.style.options_.stroke.width=1),e}));r.getStyle().getOptions().ranges=l}}null!==r?r.type===M.layer.type.WFS||r.type===M.layer.type.GeoJSON?r.getImpl().isLoaded()||!r.isVisible()?t.querySelector(".g-cartografia-spinner").remove():r.on(M.evt.LOAD,(function(){t.querySelector(".g-cartografia-spinner").remove()})):r.type===M.layer.type.WFS&&r.type===M.layer.type.GeoJSON||t.querySelector(".g-cartografia-spinner").remove():t.querySelectorAll("[id^='tocLayer_']").forEach((function(t){t.querySelector(".g-cartografia-spinner").remove()}))}}))}},{key:"setAnimateHeight",value:function(t,e){var o;o=0===t.getZIndex()?50:100*t.getZIndex(),e.animate({height:o})}},{key:"createHighlightLayerButtonEvent",value:function(t,e,o,i,n){var r,a=this;void 0!==i.get(e.name)?r=i.get(e.name):null!=(r=n.create3DStyle(e,0))&&(n.setRender3D(e,r),i.set(e.name,r)),t.children[0].children[2].addEventListener("click",(function(){null===document.getElementById("doneIndicator")?"chart"===k.getGeometry(e.getStyle()).toLowerCase()||e.getStyle()instanceof M.style.Heatmap||void 0!==e.getStyle().attribute||void 0!==e.getStyle().options_.ranges?M.dialog.error("Solamente se pueden resaltar capas con estilo simple, coropletas, símbolos proporcionales y categorías.","Imposible resaltar"):!t.children[0].children[4].children[0].checked||void 0!==o.get(e.name)&&!1!==o.get(e.name)?(r.animate({height:0}),o.set(e.name,!1)):(a.setAnimateHeight(e,r),o.set(e.name,!0)):(n.isDefautRender3D(r)&&(n.setSimpleStyle(e,r),i.set(e.name,r)),document.getElementById("doneIndicator").remove())}))}},{key:"highlightLayer",value:function(t,e,o,i){var n=this;t.getLayers().forEach((function(t){var r=document.querySelectorAll("[id$='_".concat(t.name,"'][id^='tocLayer_']"));0===r.length&&(r=document.querySelectorAll("[id$='_".concat(t.id,"'][id^='tocLayer_']")));for(var a=function(a){var s=r[a];"wfs"===t.type.toLowerCase()||"geojson"===t.type.toLowerCase()?s&&s.children[0]&&s.children[0].children[4]&&s.children[0].children[4].children[0]&&s.children[0].children[4].children[0].checked&&(t.getFeatures().length>0?n.createHighlightLayerButtonEvent(s,t,o,i,e):t.on(M.evt.LOAD,(function(){n.createHighlightLayerButtonEvent(s,t,o,i,e)}))):s&&s.querySelector(".g-cartografia-tamano")&&s.querySelector(".g-cartografia-tamano").remove()},s=0;s<r.length;s++)a(s)}))}},{key:"removeHighlightAndLayers",value:function(t,e,o,i){Array.from(t.entries()).forEach((function(t){t[1]&&document.querySelector("[id$='".concat(t[0],"']")).children[0].children[2].click()})),e.getLayers().forEach((function(t){void 0===o.get("tocLayer_".concat(t.id))&&void 0===i.get("tocLayer_".concat(t.id))&&null!==document.getElementById("tocLayer_".concat(t.id))?(M.version&&parseInt(M.version.substring(0,1))>=5&&"wfs"===t.type.toLowerCase()&&t.getStyle()&&t.getStyle().options_&&t.getStyle().options_.ranges&&t.setStyle(new M.style.Point),e.removeLayers(t),document.getElementById("tocLayer_".concat(t.id)).remove()):void 0!==i.get("tocLayer_".concat(t.id))&&t.setZIndex(i.get("tocLayer_".concat(t.id)))}))}},{key:"higlightHeightMoveFix",value:function(t,e,o){var i=this;Array.from(e.entries()).forEach((function(e){var n=b.getLayerByNameOrId(t,e[0],null,null);o.get(e[0])&&i.setAnimateHeight(n,e[1])}))}}],(o=null)&&E(e.prototype,o),i&&E(e,i),t}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e,o){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function A(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function I(t,e,o){return e&&A(t.prototype,e),o&&A(t,o),t}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=R(t);if(e){var n=R(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return D(this,o)}}function D(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var G=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(o,M.Control);var e=F(o);function o(t,i,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),M.utils.isUndefined(h)&&M.exception("La implementación usada no puede crear controles ManageLayersControl"),(r=e.call(this,t,n.controlName)).params_=i||{},r.options_=r.getControlOptions_(n),r.legendMap_=new Map,r.stylesMap_=new Map,r}return I(o,null,[{key:"NAME",get:function(){return"ManageLayers"}},{key:"CONFIG_BASE",get:function(){return{controlName:o.NAME,template:p.a,iconClass:"g-cartografia-capas2",tooltip:"Gestor capas"}}}]),I(o,[{key:"createView",value:function(t){var e=this;return new Promise((function(o,i){e.panel_.position.indexOf("left")>-1&&document.querySelector(".m-panel.m-managelayers").querySelector(".m-panel-btn.g-cartografia-capas2").addEventListener("click",(function(){var t=document.querySelector(".m-panel.m-managelayers.opened");null!==t&&(t=t.querySelector(".m-panel-btn.g-cartografia-flecha-izquierda")),t&&t.classList.add("opened-left")}));var n=M.template.compileSync(e.options_.template,{vars:e.options_}),r=null;if(M.utils.isNullOrEmpty(e.options_.toolbar))r=n,e.getPanel()._controlsContainer.appendChild(n);else{var a=e.options_.toolbar;!1===!M.utils.isNullOrEmpty(e.getPanel()._element.querySelector(a.selector))&&e.getPanel()._controlsContainer.appendChild(a.target);var s=n.querySelector(e.getSelectorToolbarButton_()),l=n.querySelector(e.getSelectorToolbarContainer_());a.target.querySelector(a.selectorBtn).appendChild(s),a.target.querySelector(a.selectorContainer).appendChild(l),r=a.target}if(e.addEvents(r),o(r),"ActiveLayers"===e.name){T.setStylesLegendsFirstTime(e.params_,e.legendMap_,e.getImpl(),t,e.stylesMap_,e.functionsMap_);var c=e.params_;t.getMapImpl().on("wheel",(function(){void 0!==c&&(c.idle=!1,setTimeout((function(){c.idle=!0}),400))})),b.saveTemplatesAsPartials(c.canEdit)}}))}},{key:"activate",value:function(){this.getToolbarContainer_().classList.toggle("dNone"),this.getControlButton_().classList.toggle("active"),this.getTitleControlManageLayers_().innerText=this.options_.tooltip,O(R(o.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){this.getToolbarContainer_().classList.toggle("dNone"),this.getControlButton_().classList.toggle("active"),O(R(o.prototype),"deactivate",this).call(this)}},{key:"getControlOptions_",value:function(t){t=t||{};var e=M.utils.extend({},o.CONFIG_BASE,!0);return(e=M.utils.extend(e,t,!0)).baseName=M.utils.isNullOrEmpty(e.baseName)?e.controlName:e.baseName,e.baseName=e.baseName.toLowerCase(),e}},{key:"getConfigDefault_",value:function(){return this.CONFIG_BASE}},{key:"addEvents",value:function(t){}},{key:"render",value:function(){}},{key:"getActivationButton",value:function(t){return t.querySelector(this.getSelectorButton_())}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}},{key:"getSelectorToolbarButton_",value:function(){return"#toolbar-button-"+this.options_.baseName}},{key:"getSelectorToolbarContainer_",value:function(){return"#toolbar-container-"+this.options_.baseName}},{key:"getSelectorButton_",value:function(){return"#tool-btn-"+this.options_.baseName}},{key:"getSelectorContainer_",value:function(){return"#tool-"+this.options_.baseName}},{key:"getToolbarContainer_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorToolbarContainer_())}},{key:"getControlContainer_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorContainer_())}},{key:"getControlButton_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorButton_())}},{key:"getTitleControlManageLayers_",value:function(){return this.getPanel()._element.querySelector("#toolbar-title-managelayers")}},{key:"getOptionsControlManageLayers",value:function(t){return this.getOptionsManageLayers(t,this.name.toLowerCase())}},{key:"setOptionsControlManageLayers",value:function(t,e){this.setOptionsManageLayers(t,e,this.name.toLowerCase())}},{key:"getOptionsManageLayers",value:function(t,e){var o=t.options.manageLayers;return M.utils.isNullOrEmpty(e)||M.utils.isNullOrEmpty(o)||(o=o[e]),o}},{key:"setOptionsManageLayers",value:function(t,e,o){M.utils.isNullOrEmpty(t.options.manageLayers)&&(t.options.manageLayers={}),M.utils.isNullOrEmpty(o)?t.options.manageLayers=e:t.options.manageLayers[o]=e}},{key:"resetOptionsManageLayers",value:function(t){t.options.manageLayers={}}},{key:"getQuerySelectorScapeCSS",value:function(t,e,o){return t.querySelector(e+CSS.escape(o))}},{key:"activateLoading",value:function(){this.getPanel()._element.querySelector("#m-waiting-result").classList.remove("dNone"),this.getPanel()._element.querySelector(".m-toolbar-containers-managelayers").style.minHeight="70px"}},{key:"deactivateLoading",value:function(){this.getPanel()._element.querySelector("#m-waiting-result").classList.add("dNone"),this.getPanel()._element.querySelector(".m-toolbar-containers-managelayers").style.minHeight="initial"}},{key:"addLayers",value:function(t){if(Array.isArray(t)||!Array.isArray(t)&&null===b.getLayerByNameOrId(this.map_,null,t.name,t.url))this.map_.addLayers(t);else{var e=b.getLayerByNameOrId(this.map_,null,t.name,t.url),o=document.getElementById("tocLayer_".concat(e.id));if(null!==o){var i=Array.from(o.children[0].children).find((function(t){return t.classList.contains("m-area-activate")}));i.checked||i.children[0].click()}}}},{key:"removeLayers",value:function(t){this.map_.getImpl().removeItemLayers(t)}},{key:"isLoadLayer",value:function(t){var e=!1;return null==this.findLayerById(t.id)&&null===this.findLayerByNameURL(t.name,t.url)||(e=!0),e}},{key:"findLayerByNameURL",value:function(t,e){var o=null,i=this.map_.getLayers();return this.map_.getLayers()&&t&&e&&i.some((function(i){if(i.name===t&&i.url===e)return o=i,!0})),o}},{key:"findLayerById",value:function(t){return this.findItemByProperty(this.map_.getLayers(),"id",t)}},{key:"findItemByProperty",value:function(t,e,o){var i=null;return t&&e&&t.some((function(t){if(t[e]===o)return i=t,!0})),i}}]),o}();function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function V(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=Z(t);if(e){var n=Z(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return z(this,o)}}function z(t,e){return!e||"object"!==B(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Z(t){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(r,M.impl.Control);var e,o,i,n=V(r);function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=n.call(this)).params_=t||{},e.facadeMap_=null,e.totalActiveLayers_=0,e}return e=r,(o=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e;var o=t.getMapImpl();ol.control.Control.call(this,{element:e,target:null}),o.addControl(this)}},{key:"activate",value:function(){this.registerEvents()}},{key:"deactivate",value:function(){this.unregisterEvents()}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}},{key:"registerEvents",value:function(){var t=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var e=this.facadeMap_.getMapImpl();this.registerViewEvents_(e.getView()),this.registerLayersEvents_(e.getLayers()),e.on("change:view",(function(e){return t.onViewChange_(e)}))}}},{key:"unregisterEvents",value:function(){var t=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var e=this.facadeMap_.getMapImpl();this.unregisterViewEvents_(e.getView()),this.unregisterLayersEvents_(e.getLayers()),e.un("change:view",(function(e){return t.onViewChange_(e)}))}}},{key:"registerViewEvents_",value:function(t){var e=this;t.on("change:resolution",(function(){return e.renderPanel()}))}},{key:"registerLayersEvents_",value:function(t){var e=this;t.forEach((function(t){return e.registerLayerEvents_(t)})),t.on("remove",(function(){return e.renderPanel()})),t.on("add",(function(t){return e.onAddLayer_(t)}))}},{key:"registerLayerEvents_",value:function(t){var e=this;t.on("change:extent",(function(){return e.renderPanel()}))}},{key:"unregisterViewEvents_",value:function(t){var e=this;t.un("change:resolution",(function(){return e.renderPanel()}))}},{key:"unregisterLayersEvents_",value:function(t){var e=this;t.forEach((function(t){return e.registerLayerEvents_(t)})),t.un("remove",(function(){return e.renderPanel()})),t.un("add",(function(t){return e.onAddLayer_(t)}))}},{key:"unregisterLayerEvents_",value:function(t){var e=this;t.un("change:extent",(function(){return e.renderPanel()}))}},{key:"onViewChange_",value:function(t){this.unregisterViewEvents_(t.oldValue);var e=this.facadeMap_.getMapImpl();this.registerViewEvents_(e.getView())}},{key:"onAddLayer_",value:function(t){var e=t.element;this.registerLayerEvents_(e),e.setZIndex(this.totalActiveLayers_+1),this.renderPanel()}},{key:"renderPanel",value:function(t){this.facadeCtrol_.renderPanel()}},{key:"moveLayer",value:function(t,e,o,i){var n=this.getFilterLayerList(!1),r=o-e;if(i)if(r>0){for(var a=r;a>0;a--)n[o+1-a].setZIndex(n[o+1-a].getZIndex()+1);n[e].setZIndex(n[e].getZIndex()-r)}else{r*=-1;for(var s=1;s<=r;s++)n[o-1+s].setZIndex(n[o-1+s].getZIndex()-1);n[e].setZIndex(n[e].getZIndex()+r)}else{for(var l,c=!1,h=0;h<n.length&&!c;h++)c=n[h].id===t,l=h;if(r>0){for(var u=1;u<=r;u++)n[l+u].setZIndex(n[l+u].getZIndex()+1);n[l].setZIndex(n[l].getZIndex()-r)}else{for(var p=r*=-1;p>0;p--)n[l-p].setZIndex(n[l-p].getZIndex()-1);n[l].setZIndex(n[l].getZIndex()+r)}}}},{key:"updateOrderLayer",value:function(t,e){t.setZIndex(e)}},{key:"getFilterLayerList",value:function(t){var e=this,o=this.facadeMap_.getLayers().filter((function(t){var o=!0===t.isBaseMap,i="__draw__"===t.name,n=!0===t.transparent,r=!0===t.displayInLayerSwitcher,a=t.type!==M.layer.type.WMC,s=!(t.type===M.layer.type.WMS&&M.utils.isNullOrEmpty(t.name));return o?e.updateOrderLayer(t,0):a&&!i&&(!1===n?e.updateOrderLayer(t,1):!1===r&&e.updateOrderLayer(t,2)),!o&&!i&&n&&a&&s&&r})).sort((function(e,o){var i=e.getZIndex(),n=o.getZIndex();if(isNaN(i)&&isNaN(n))return 0;if(isNaN(i))return-1;if(isNaN(n))return 1;var r=i-n;return t?r:-r})).map((function(e,o,i){return t?e.setZIndex(o+3):e.setZIndex(i.length+2-o),e}));return this.totalActiveLayers_=o.length,o}},{key:"setStyleWMS",value:function(t,e,o){var i=t.getImpl().getOL3Layer().getSource().getUrls()[0];i=this.removeSLDInURL(i),t.url=i,t.getImpl().getOL3Layer().getSource().setUrl(i),t.getImpl().getOL3Layer().getSource().refresh(),void 0!==e.get(t.name)&&e.delete(t.name),o.set(t.name,{layerName:t.name,layerStyleName:t.getImpl().getOL3Layer().getSource().getParams().STYLES}),t.getImpl().getOL3Layer().getSource().updateParams({SLD:"",SLD_BODY:""}),this.removeEmptyParameters(t)}},{key:"setLayerStyle",value:function(t,e,o,i){t.getImpl().setSelectedStyle(e),this.setStyleWMS(t,o,i)}},{key:"setLayerStyleName",value:function(t,e,o,i){t.getImpl().getOL3Layer().getSource().updateParams({STYLES:e}),this.setStyleWMS(t,o,i)}},{key:"getMetadataLink",value:function(t){return t.getImpl().getMetadataURL()}},{key:"getStylesLayer",value:function(t){return t.getImpl().getStylesLayer()}},{key:"getLayerStylePosition",value:function(t){return t.getImpl().selectedStyle_}},{key:"setSLD",value:function(t,e){"http"===e.substring(0,4).toLowerCase()?t.getImpl().getOL3Layer().getSource().updateParams({SLD:e,SLD_BODY:"",STYLES:""}):t.getImpl().getOL3Layer().getSource().updateParams({SLD:"",SLD_BODY:e,STYLES:""}),this.removeEmptyParameters(t)}},{key:"removeEmptyParameters",value:function(t){var e=t.getImpl().getOL3Layer().getSource().ea;for(var o in e||(e=t.getImpl().getOL3Layer().getSource().params_),e)null!==e[o]&&void 0!==e[o]&&""!==e[o]||delete e[o]}},{key:"hasSLDInParams",value:function(t){return null!==t.getImpl().getOL3Layer()&&null!==t.getImpl().getOL3Layer().getSource()&&void 0!==t.getImpl().getOL3Layer().getSource().getParams().SLD?t.getImpl().getOL3Layer().getSource().getParams().SLD:null!==t.getImpl().getOL3Layer()&&null!==t.getImpl().getOL3Layer().getSource()&&void 0!==t.getImpl().getOL3Layer().getSource().getParams().SLD_BODY?t.getImpl().getOL3Layer().getSource().getParams().SLD_BODY:null}},{key:"removeSLD",value:function(t,e){var o,i=t.split(e);return o=i[1].indexOf("&")>-1?i[1].substring(i[1].indexOf("&")+1):"","".concat(i[0]).concat(o)}},{key:"removeSLDInURL",value:function(t){return t.indexOf("sld_body=")>-1&&2===t.split("sld_body=").length?this.removeSLD(t,"sld_body="):t.indexOf("SLD_BODY=")>-1&&2===t.split("SLD_BODY=").length?this.removeSLD(t,"SLD_BODY="):t.indexOf("sld=")>-1&&2===t.split("sld=").length?this.removeSLD(t,"sld="):t.indexOf("SLD=")>-1&&2===t.split("SLD=").length?this.removeSLD(t,"SLD="):t}},{key:"hasImplLayer",value:function(t){return null!==t.getImpl().getOL3Layer()}},{key:"forceZIndex",value:function(t){t.getZIndex()!==t.getImpl().getZIndex()&&t.getImpl().setZIndex(t.getZIndex())}},{key:"create3DStyle",value:function(t,e){return void 0!==t.getStyle()&&void 0!==t.getStyle().options_&&void 0!==t.getStyle().options_.stroke&&void 0!==t.getStyle().options_.fill?new ol.render3D({style:new ol.style.Style({stroke:new ol.style.Stroke({color:t.getStyle().options_.stroke.color}),fill:new ol.style.Fill({color:t.getStyle().options_.fill.color})}),height:e,maxResolution:1e4,defaultHeight:3.5}):new ol.render3D({style:new ol.style.Style({stroke:new ol.style.Stroke({color:"red"}),fill:new ol.style.Fill({color:"blue"})}),height:e,maxResolution:1e4,defaultHeight:3.5})}},{key:"setSimpleStyle",value:function(t,e){if(void 0!==t.getStyle()&&void 0!==t.getStyle().options_){var o=new ol.style.Style({stroke:new ol.style.Stroke({color:t.getStyle().options_.stroke.color}),fill:new ol.style.Fill({color:t.getStyle().options_.fill.color})});e.setStyle(o)}}},{key:"setRender3D",value:function(t,e){t.getImpl().getOL3Layer().setRender3D(e)}},{key:"isDefautRender3D",value:function(t){return"blue"!==t.getStyle().getFill().getColor()&&"red"!==t.getStyle().getStroke().getColor()}}])&&j(e.prototype,o),i&&j(e,i),r}(),H=o(1),W=o.n(H),Y=o(4),X=o.n(Y);function J(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var K=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"createNewTitle",value:function(t){var e=document.createElement("div");e.classList.add("color-junta-flex");var o=document.createElement("div");o.classList.add("title"),o.setAttribute("id","toolbar-title-managelayers"),o.innerText="Capas activas",e.appendChild(o);var i=document.createElement("div");i.classList.add("g-cartografia-descargar"),i.classList.add("boton-capas"),i.classList.add("guardar-capas"),i.setAttribute("id","guardarCapa"),i.setAttribute("title","Guardar configuración de capas y grupos"),e.appendChild(i);var n=document.createElement("div");n.classList.add("g-cartografia-menu"),n.classList.add("boton-capas"),n.classList.add("cargar-capas"),n.setAttribute("id","cargarCapa"),n.setAttribute("title","Cargar configuración de capas y grupos"),e.appendChild(n),t.parentNode.insertBefore(e,t.nextElementSibling)}},{key:"createLayerObject",value:function(t,e){var o={layerId:t,index:e.getZIndex(),type:e.type,url:e.url,name:e.name,legend:e.legend,transparent:e.transparent,visible:e.isVisible()};return"geojson"!==e.type.toLowerCase()&&"wfs"!==e.type.toLowerCase()||("geojson"===e.type.toLowerCase()?(o.features=JSON.stringify(e.getFeatures().map((function(t){return t.getGeoJSON()}))),o.extract=e.extract,o.source=e.source):"wfs"===e.type.toLowerCase()&&(o.namespace=e.namespace,o.geometry=e.geometry,o.version=e.version,o.getFeatureOutputFormat=e.options.getFeatureOutputFormat,o.describeFeatureTypeOutputFormat=e.options.describeFeatureTypeOutputFormat,void 0!==e.getFilter()&&(o.features=JSON.stringify(e.getFeatures().map((function(t){return t.getGeoJSON()}))))),void 0!==e.getStyle().choroplethStyles_?(o.style=k.choroplethToJSON(e.getStyle()),o.style.type="choropleth"):void 0!==e.getStyle().minRadius_?(o.style=k.proportionalToJSON(e.getStyle()),o.style.type="proportional"):void 0!==e.getStyle().categoryStyles_?(o.style=k.categoryToJSON(e.getStyle()),o.style.type="category"):void 0!==e.getStyle().options_&&"chart"===k.getGeometry(e.getStyle()).toLowerCase()?(o.style=k.chartToJSON(e.getStyle()),o.style.type="chart"):void 0!==e.getStyle().attribute?(o.style=k.heatmapToJSON(e.getStyle()),o.style.type="heatmap"):void 0!==e.getStyle().options_.ranges&&(o.style=k.clusterToJSON(e.getStyle()),o.style.type="cluster")),o}},{key:"saveConfiguration",value:function(t,e,o,i,n,r){var a=this,s=new Map;t.forEach((function(t){if(t.indexOf("tocLayer_")>-1&&-1===t.indexOf("thematic")||t.indexOf("tocLayer_")>-1&&t.indexOf("thematic")>-1){var e=b.getLayerByNameOrId(i,t.substring(9),null,null);if(null!==e)s.set(t,a.createLayerObject(t,e));else if(!isNaN(t.substring(9).substring(0,t.substring(9).indexOf("_")))){var o=t.substring(9).substring(t.substring(9).indexOf("_")+1);null!==(e=b.getLayerByNameOrId(i,o,null,null))&&s.set(t,a.createLayerObject(t,e))}}else{var n=b.getLayerByNameOrId(i,t,null,null);null!==n?s.set(t,a.createLayerObject(t,n)):s.set(t,-1)}}));var l=document.createElement("a"),c="data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify({idsIndexes:Array.from(s.entries()),n1:e,n2:o,legends:Array.from(n.entries()),styles:Array.from(r.values())})));l.setAttribute("href",c),l.setAttribute("download","configuracionTOC.json"),l.click()}}],(o=null)&&J(e.prototype,o),i&&J(e,i),t}();function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function tt(t,e,o){return e&&$(t.prototype,e),o&&$(t,o),t}function et(t,e){return(et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=rt(t);if(e){var n=rt(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return it(this,o)}}function it(t,e){return!e||"object"!==Q(e)&&"function"!=typeof e?nt(t):e}function nt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rt(t){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var at=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&et(t,e)}(o,t);var e=ot(o);function o(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),M.utils.isUndefined(U)&&M.exception("La implementación usada no puede crear controles ActiveLayersControl");var r={controlName:o.NAME,iconClass:"g-cartografia-capas2",tooltip:"Capas activas"};i=M.utils.extend(r,i,!0);var a=new U(t);return(n=e.call(this,a,t,i)).params_=t||{},a.facadeCtrol_=nt(n),n.countID_=0,n.boundClickLayer_=function(t){return n.clickLayer(t)},n.params_.invisibleLayers=new Map,n.params_.alternativeNameLayers=new Map,n.functionsMap_=new Map,n.highlight3DMap_=new Map,n.r3DMap_=new Map,n.openGroups_=new Map,n}return tt(o,null,[{key:"NAME",get:function(){return"ActiveLayers"}},{key:"TEMPLATE",get:function(){return X.a}}]),tt(o,[{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("input",(function(t){return e.clickLayerSlider(t)}))}},{key:"clickLayerSlider",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,o=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(o)){var i=this.findLayerById(o);if(e.classList.contains("m-accion-activelayers-transparency")){var n=e.value;M.version&&parseInt(M.version.substring(0,1))>=6&&(n=parseFloat(n)),i.setOpacity(n),e.nextElementSibling.innerHTML=100*n+"%"}}}}},{key:"clickLayer",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,o=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(o)){var i=this.findLayerById(o),n=this.getControlContainer_(),r=this.getQuerySelectorScapeCSS(n,"#optionsTocLayer_",o);if(e.classList.contains("m-accion-activelayers-collapse"))this.getOptionsControlManageLayers(i).collapsed=!r.classList.contains("dNone"),r.classList.toggle("dNone"),e.classList.toggle("g-cartografia-flecha-abajo2"),e.classList.toggle("g-cartografia-flecha-arriba2");else if(e.classList.contains("m-accion-activelayers-rename")){var a=this.getQuerySelectorScapeCSS(n,"#textTitleLayer_",o),s=document.createElement("input");s.type="text",s.value=a.innerText,a.innerText="",a.appendChild(s),s.addEventListener("focus",(function(){this.select()})),s.focus();s.addEventListener("blur",(function(t){return function t(e){a.innerHTML=s.value,i.legend=s.value,s.removeEventListener("blur",(function(e){return t(e)})),s=null}()}))}else if(e.classList.contains("m-accion-activelayers-activate")){if(!0===i.transparent||!i.isVisible()){var l=e.parentElement.parentElement.querySelector("div.tools > input");M.utils.isNullOrEmpty(l)||i.setOpacity(l.value),i.setVisible(!i.isVisible())}if(i.isVisible()){var c=e.parentNode.parentNode.parentNode.id;if(void 0!==this.params_.invisibleLayers.get(c))this.params_.invisibleLayers.delete(c);else{var h=c.substring(9);h=h.substring(h.indexOf("_")+1);var u=Array.from(this.params_.invisibleLayers.keys()).find((function(t){return t.indexOf(h)>-1}));void 0!==u&&this.params_.invisibleLayers.delete(u)}}e.parentNode.parentNode.children[2].classList.contains("g-cartografia-capas")&&!i.isVisible()&&e.parentNode.parentNode.children[2].click()}else if(e.classList.contains("m-accion-activelayers-metadata"))i.type===M.layer.type.WMS?this.getImpl().getMetadataLink(i).then((function(t){window.open(t,"_blank")})):i.type===M.layer.type.WFS&&window.open("".concat(i.url,"request=GetMetadata&layer=").concat(i.name),"_blank");else if(e.classList.contains("m-accion-activelayers-info"))i.getImpl().getAbstractLayer().then((function(t){var e="Información: "+i.legend;M.utils.isNullOrEmpty(t)&&(t="No hay descripción asociada a la capa"),M.dialog.info(t,e)}));else if(e.classList.contains("m-accion-activelayers-showstyles")){var p=this.getQuerySelectorScapeCSS(n,"#stylesTocLayer_",o);this.getOptionsControlManageLayers(i).showStyles=p.classList.contains("dNone"),p.classList.toggle("dNone")}else if(e.classList.contains("m-accion-activelayers-activestyle")){var d=e.value;d!=this.getImpl().getLayerStylePosition(i)&&(this.getImpl().setLayerStyle(i,d,this.legendMap_,this.stylesMap_),this.renderPanel())}else e.classList.contains("m-accion-activelayers-remove")&&(this.resetOptionsManageLayers(i),this.removeLayers(i))}}}},{key:"moveLayer",value:function(t,e,o,i){var n=M.utils.isNullOrEmpty(t)?"":t.getAttribute("data-id");M.utils.isNullOrEmpty(n)||this.getImpl().moveLayer(n,e,o,i)}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=this;(void 0===this.params_.idle||this.params_.idle)&&(this.params_.idle=!1,this.activateLoading(),this.getTemplateVariables_().then((function(e){var i,n=null;if(void 0!==t.params_.groups){var r=t.createGroups(e),a=r[0];n=r[1],i=M.template.compileSync(o.TEMPLATE,{vars:{groups:a}})}else i=M.template.compileSync(o.TEMPLATE,{vars:{overlayLayers:e}});t.sortableList&&(t.sortableList.destroy(),t.sortableList=null);var s=t.getControlContainer_().querySelectorAll("[class^=m-accion-]");Array.from(s).forEach((function(e){e.removeEventListener("click",t.boundClickLayer_)})),t.registerImgErrorEvents_(i),T.tocLinesFix(Array.from(i.children[0].children),t.map_,t.legendMap_,t.stylesMap_);for(var l=t.getControlContainer_();l.firstChild;)l.removeChild(l.lastChild);if(l.appendChild(i.children[0]),!t.sortableList){var c=t.getControlContainer_().querySelector(".sortable-activelayers");if(t.params_&&!1===t.params_.canMove)Array.from(document.querySelectorAll('[class="m-area-order-hook"]')).map((function(t){return t.remove()}));else for(var h=0;h<c.children.length;h++){var u=c.children[h];t.addMoveClassOrRemoveElement(u.children[0],"movible")}t.sortableList=W.a.create(c,{animation:150,handle:".movible",onEnd:function(e){if(t.areGroupsAndCanMove(n)){var o=b.getMovedLayers(e,c,t.listIds);o.shift();var i=o.pop(),r=b.getRealIndexes(e,t.map_.getLayers(),i),a=r[0],s=r[1];if(Math.abs(s-a)-Math.abs(e.newIndex-e.oldIndex)!=0||0===a&&0===s){if(s-a>0&&e.newIndex-e.oldIndex<0||s-a<0&&e.newIndex-e.oldIndex>0){var l=s;s=a,a=l}0===s?s=a-Math.abs(e.newIndex-e.oldIndex)+1+b.numGroups(o,t.map_.getLayers()):0===a&&(a=s+Math.abs(e.newIndex-e.oldIndex)-1-b.numGroups(o,t.map_.getLayers())),t.moveLayer(e.item,a,s,void 0===t.params_.groups||null===n||0===n.length)}else t.moveLayer(e.item,e.oldIndex,e.newIndex,void 0===t.params_.groups||null===n||0===n.length);T.higlightHeightMoveFix(t.map_,t.r3DMap_,t.highlight3DMap_),t.sortableListN2(!0)}else t.moveLayer(e.item,e.oldIndex,e.newIndex,void 0===t.params_.groups||null===n||0===n.length);t.areGroupsAndCanMove(n)&&t.sortableListIds()}}),t.areGroupsAndCanMove(n)&&(void 0===t.listIds?t.sortableListIds():(t.checkListIdsWithModifications(c),t.sortGeneralList(c)),t.sortableListN1(),t.sortableListN2(!1))}s=t.getControlContainer_().querySelectorAll("[class^=m-accion-]"),Array.from(s).forEach((function(e){e.addEventListener("click",t.boundClickLayer_)})),t.deactivateLoading(),b.setGroupEvents(t.openGroups_),T.setLayerStyleEvent(t.map_,t.getImpl(),t.legendMap_,t.stylesMap_,t.functionsMap_,t.r3DMap_),T.highlightLayer(t.map_,t.getImpl(),t.highlight3DMap_,t.r3DMap_),t.showLoadDownloadButtons(),Array.from(t.params_.invisibleLayers.entries()).forEach((function(e){var o=e[0].substring(9),i=b.getLayerByNameOrId(t.map_,o,null,null);if(null===i&&(i=b.getLayerByNameOrId(t.map_,o.substring(o.indexOf("_")+1),null,null)),null!==i){i.setVisible(!1),i.setZIndex(e[1]);var n=e[0].substring(e[0].indexOf("_")+1);n=n.substring(n.indexOf("_")+1),null!==document.querySelector('[id$="'.concat(n,'"]'))&&document.querySelector('[id$="'.concat(n,'"]')).children[0].children[3].children[0].checked&&(document.querySelector('[id$="'.concat(n,'"]')).children[0].children[3].children[0].checked=!1)}else t.params_.invisibleLayers.delete(e[0])})),t.map_.getLayers().forEach((function(e){t.getImpl().forceZIndex(e)})),t.params_.idle=!0})))}},{key:"getTemplateVariables_",value:function(){var t=this;this.setConfigLayers();var e=this.getImpl().getFilterLayerList(!1).map((function(e){return t.parseLayerForTemplate_(e)}));return Promise.all(e).catch((function(t){return console.log("Catch",t)}))}},{key:"parseLayerForTemplate_",value:function(t,e){var o=this,i=this.getOptionsControlManageLayers(t);M.utils.isNullOrEmpty(i)&&(i={index:e,collapsed:!0,showStyles:!1},this.setOptionsControlManageLayers(t,i));var n=t.legend;M.utils.isNullOrEmpty(n)&&(n=t.name),M.utils.isNullOrEmpty(n)&&(n="Servicio - "+t.type);var r=t.options.metadata,a=t.type===M.layer.type.WMS||t.type===M.layer.type.WMTS||t.type===M.layer.type.WFS,s={metadata:!M.utils.isNullOrEmpty(r),infoLayer:a,origen:t.options.origen,collapsed:!0===i.collapsed,showStyles:!0===i.showStyles,base:!1===t.transparent,visible:!0===t.isVisible(),id:t.id,name:t.name,title:n,legend:t.getLegendURL(),outOfRange:!t.inRange(),opacity:t.getOpacity(),opacityPer:100*t.getOpacity(),styles:[],canEditName:"Inicial"!=t.options.origen&&"Tematica"!=t.options.origen,canRemove:"Inicial"!=t.options.origen},l=[];return(t.type===M.layer.type.WMS||t.type===M.layer.type.WFS&&M.utils.isNullOrEmpty(r))&&(t.type===M.layer.type.WFS?s.metadata="".concat(t.url,"request=GetMetadata&layer=").concat(t.name):l.push(this.getImpl().getMetadataLink(t).then((function(t){s.metadata=t})).catch((function(t){return console.log("Catch",t)})))),t.type===M.layer.type.WMS?l.push(this.getImpl().getStylesLayer(t).then((function(e){var i=o.getImpl().getLayerStylePosition(t);s.styles=e.map((function(e,o){return e.id=t.id,e.selected=i==o,e})),s.legend=T.setLegend(o.legendMap_,t,o.getImpl(),s.legend)})).catch((function(t){return console.log("Catch",t)}))):("wfs"===t.type.toLowerCase()||"geojson"===t.type.toLowerCase())&&t.getStyle()&&t.getStyle().toImage()instanceof Promise&&l.push(t.getStyle().toImage().then((function(t){s.legend=t})).catch((function(t){return console.log("Catch",t)}))),Promise.all(l).then((function(){return s})).catch((function(t){return console.log("Catch",t)}))}},{key:"registerImgErrorEvents_",value:function(t){var e=this,o=t.querySelectorAll("img");Array.prototype.forEach.call(o,(function(t){t.addEventListener("error",(function(t){var o=t.target.getAttribute("data-id"),i=e.findLayerById(o),n=M.utils.concatUrlPaths([M.config.THEME_URL,M.Layer.LEGEND_ERROR]);M.utils.isNullOrEmpty(i)||(i.setLegendURL(n),t.target.src=n)}))}))}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}},{key:"setConfigLayers",value:function(){var t=this;this.map_.getLayers().forEach((function(e,o){M.utils.isUndefined(e.options)&&(e.options={}),M.utils.isNullOrEmpty(e.id)&&(e.id=t.countID_+++"_"+e.name),M.utils.isNullOrEmpty(e.options.origen)&&(e.options.origen="Inicial"),M.utils.isNullOrEmpty(e.options.urlLegend)||e.setLegendURL(e.options.urlLegend)}))}},{key:"createGroups",value:function(t){for(var e=Object.assign({},this.params_).groups,o=[],i=function(i){for(var n=t[i],r=[],a=!1,s=0;s<e.length;s++){var l=e[s];if(void 0!==l.groupsSL)for(var c=0;c<l.groupsSL.length;c++){var h=l.groupsSL[c];-1===r.indexOf(n.name)&&(h.ids.indexOf(n.name)>-1?(h.ids[h.ids.indexOf(n.name)]=n,a=!0,r.push(n.name)):h.ids.forEach((function(t){if(JSON.stringify(t)===JSON.stringify(n)||t.id===n.id){for(var e=Object.keys(n),o=0;o<e.length;o++)t[e[o]]=n[e[o]];a=!0,r.push(n.name)}})))}else{var u=l.ids;-1===r.indexOf(n.name)&&(u.indexOf(n.name)>-1?(u[u.indexOf(n.name)]=n,a=!0,r.push(n.name)):u.forEach((function(t){if(JSON.stringify(t)===JSON.stringify(n)||t.id===n.id){for(var e=Object.keys(n),o=0;o<e.length;o++)t[e[o]]=n[e[o]];a=!0,r.push(n.name)}})))}}a||o.push(n)},n=0;n<t.length;n++)i(n);return e.forEach((function(t){if(void 0!==t.groupsSL)for(var e=0;e<t.groupsSL.length;e++)t.groupsSL[e].ids=t.groupsSL[e].ids.filter((function(t){return"object"===Q(t)}));else t.ids=t.ids.filter((function(t){return"object"===Q(t)}))})),e.filter((function(t){void 0!==t.groupsSL?t.groupsSL=t.groupsSL.filter((function(t){return t.ids.length>0})):void 0!==t.ids&&t.ids.length})),e=b.cloneGroups(e),[o=o.concat(e),e]}},{key:"sortableListIds",value:function(){void 0===this.listIds&&(this.listIds=[]);for(var t=[],e=0;e<document.querySelector(".sortable-activelayers").children.length;e++)t.push(document.querySelector(".sortable-activelayers").children[e].id);this.listIds=t}},{key:"sortableListN1",value:function(){var t=this;void 0===this.listN1&&(this.listN1=[]);for(var e=document.getElementsByClassName("n1"),o=0;o<e.length;o++){for(var i=e[o],n=[],r=!1,a=0;a<i.children[i.children.length-1].children.length;a++){var s=i.children[i.children.length-1].children[a];n.push(s.id),this.addMoveClassOrRemoveElement(s.children[0],"movible-".concat(i.id))}for(var l=0;l<this.listN1.length&&!r;l++){var c=this.listN1[l];if(r=i.id===c.id)for(;!this.listNElementIsSorted(c.elements,"id-contenido-".concat(c.id));)for(var h=c.elements,u=document.getElementById("id-contenido-".concat(c.id)),p=0;p<u.children.length;p++){var d=u.children[p],f=h.indexOf(d.id);u.insertBefore(d,u.children[f])}}r||this.listN1.push({id:i.id,elements:n}),W.a.create(i.children[1],{animation:150,handle:".movible-".concat(i.id),onEnd:function(e){for(var o=!1,i=0;i<t.listN1.length&&!o;i++){var n=t.listN1[i],r=[];if(e.item.parentNode.id.substring(13)===n.id){for(var a=document.getElementById("id-contenido-".concat(n.id)).children,s=0;s<a.length;s++){var l=a[s];r.push(l.id)}n.elements=r,o=!0}}}})}}},{key:"sortableListN2",value:function(t){var e=this;(void 0===this.listN2||t)&&(this.listN2=[]);for(var o=document.getElementsByClassName("n2"),i=0;i<o.length;i++){for(var n=o[i],r=[],a=!1,s=0;s<n.children[n.children.length-1].children.length;s++){for(var l=n.children[n.children.length-1].children[s],c=!1,h=0;h<this.map_.getLayers().length&&!c;h++){var u=this.map_.getLayers()[h];(c=u.id===l.id.substring(9))&&r.push({id:l.id,index:u.getZIndex()})}c||r.push({id:l.id,index:0}),this.addMoveClassOrRemoveElement(l.children[0],"movible-".concat(n.id))}r.sort((function(t,e){return e.index-t.index}));for(var p=0;p<this.listN2.length&&!a;p++){var d=this.listN2[p];(a=n.id===d.id)&&this.sortLayersInSubgroup(d)}if(!a){var f={id:n.id,elements:r};this.listN2.push(f),this.sortLayersInSubgroup(f)}W.a.create(n.children[1],{animation:150,handle:".movible-".concat(n.id),onEnd:function(t){for(var o=!1,i=0;i<e.listN2.length&&!o;i++){var n=e.listN2[i],r=[];if(t.item.parentNode.id.substring(13)===n.id){for(var a=document.getElementById("id-contenido-".concat(n.id)).children,s=0;s<a.length;s++)r.push(a[s].id);for(var l=0;l<r.length;l++){var c=!1;n.elements[l].id=r[l];for(var h=0;h<e.map_.getLayers().length&&!c;h++){var u=e.map_.getLayers()[h];u.id===r[l].substring(9)&&(u.setZIndex(n.elements[l].index),c=!0)}}o=!0}}}})}}},{key:"newSortableListIds",value:function(t){for(var e=this.listIds,o=[],i=0;i<e.length;i++)for(var n=e[i],r=!1,a=0;a<t.children.length&&!r;a++){var s=t.children[a];b.idEquals(n,s.id)&&(o.push(s.id),r=!0)}this.listIds=o,this.sortGeneralList(t)}},{key:"sortGeneralList",value:function(t){var e=this;if(!this.itemSortableIsSorted(t)){for(var o=document.createDocumentFragment(),i=0;i<this.listIds.length;i++){var n=document.getElementById(this.listIds[i]);n||function(){var t=e.listIds[i].substring(e.listIds[i].indexOf("_")+1);t=t.substring(t.indexOf("_")+1),n=Array.from(document.getElementById("toc-activelayers").children).find((function(e){return e.id.indexOf(t)>-1}))}(),n&&o.appendChild(n)}document.getElementById("toc-activelayers").appendChild(o)}}},{key:"checkListIdsWithModifications",value:function(t){var e=this;if(t.children.length!==this.listIds.length)if(t.children.length-this.listIds.length>0){var o=Array.from(t.children).map((function(t){return t.id})).filter((function(t){return!e.listIds.includes(t)}));o.length>0&&o.forEach((function(t){e.listIds.unshift(t)}))}else this.newSortableListIds(t)}},{key:"areGroupsAndCanMove",value:function(t){return void 0!==this.params_.groups&&null!==t&&t.length>0&&(void 0===this.params_||void 0===this.params_.canMove||!0===this.params_.canMove)}},{key:"addMoveClassOrRemoveElement",value:function(t,e){void 0===this.params_||void 0===this.params_.canMove||!0===this.params_.canMove?t.children[t.children.length-1].children[0].classList.add(e):t.children[t.children.length-1].remove()}},{key:"itemSortableIsSorted",value:function(t){for(var e=!0,o=0;o<t.children.length&&e;o++){var i=t.children[o],n=b.idEquals(i.id,this.listIds[o]);e=e&&n}return e}},{key:"sortLayersInSubgroup",value:function(t){for(;!this.listNElementIsSorted(t.elements,"id-contenido-".concat(t.id));)for(var e=t.elements,o=document.getElementById("id-contenido-".concat(t.id)),i=function(t){var i=o.children[t],n=e.findIndex((function(t){return b.idEquals(t.id,i.id)}));n>-1&&o.insertBefore(i,o.children[n])},n=0;n<o.children.length;n++)i(n)}},{key:"listNElementIsSorted",value:function(t,e){for(var o=!0,i=0;i<document.getElementById(e).children.length&&o;i++){var n=document.getElementById(e).children[i];o=o&&b.idEquals(n.id,t[i].id||t[i])}return o}},{key:"setLoadDownloadFileEvents",value:function(){var t=this;document.getElementById("cargarCapa").addEventListener("click",(function(){var e=M.template.compileSync(f.a,{vars:{message:"Cargar configuración de capas y grupos"}}),o=e.querySelector("#ok-button"),i=e.querySelector("#m-setstyle-file");o.addEventListener("click",(function(){var o=i.files[0];if(o){var n=new FileReader;n.readAsText(o,"UTF-8"),n.onload=function(e){var o=e.target.result;try{var i=JSON.parse(o);if(void 0===i.idsIndexes)M.dialog.error("El fichero para aplicar la configuración no es correcto","Imposible aplicar configuración");else{t.params_.idle=!1;var n=new Map,r=i.idsIndexes.map((function(t){return n.set(t[0],t[1]),t[0]})),a=new Map;i.styles.map((function(t){a.set(t.layerName,t)}));var s=new Map;i.legends.map((function(t){s.set(t[0],t[1])}));var l=i.n2.map((function(t){return t.elements})).flat(),c=new Map;l.map((function(t){return c.set(t.id,t.index)})),t.params_.invisibleLayers.clear(),T.removeHighlightAndLayers(t.highlight3DMap_,t.map_,n,c),Array.from(n.values()).filter((function(t){if("object"===Q(t))return t})).forEach((function(e){var o=!1;if(null===b.getLayerByNameOrId(t.map_,null,e.name,e.url)){var i,n={url:e.url,name:e.name,legend:e.legend,transparent:e.transparent};if(M.utils.isNullOrEmpty(e.type)||(i=new M.layer[e.type](n)),"geojson"===e.type.toLowerCase()?(i.extract=e.extract,i.source=e.source,i.on(M.evt.LOAD,(function(){i.addFeatures(JSON.parse(e.features).map((function(t){return new M.Feature(t.id,t)})))}))):"wfs"===e.type.toLowerCase()&&(i.namespace=e.namespace,i.geometry=e.geometry,i.version=e.version,i.options.getFeatureOutputFormat=e.getFeatureOutputFormat,i.options.describeFeatureTypeOutputFormat=e.describeFeatureTypeOutputFormat,void 0!==e.features&&i.on(M.evt.LOAD,(function(){var t=JSON.parse(e.features).map((function(t){return new M.Feature(t.id,t)}));i.clear(),i.addFeatures(t),i.redraw()}))),e.layerId.indexOf("tocLayer_thematic_")>-1&&e.style){var a=e.style;T.setComplexDeserializedStyle(a,i,t.stylesMap_,t.legendMap_)}t.map_.addLayers(i),null===(i=b.getLayerByNameOrId(t.map_,null,e.name,e.url))&&(i=b.getLayerByNameOrId(t.map_,null,e.legend,e.url)),null!==i&&(i.setZIndex(e.index),i.setVisible(e.visible),t.params_.alternativeNameLayers.set(e.layerId,"tocLayer_".concat(b.getLayerPositionInMap(t.map_,i),"_").concat(i.name)))}else{var s,l=b.getLayerByNameOrId(t.map_,null,e.name,e.url);if(l.setZIndex(e.index),l.setVisible(e.visible),"wms"===e.type.toLowerCase()&&e.url.toLowerCase().indexOf("sld")>-1)e.url.indexOf("sld_body=")>-1&&2===e.url.split("sld_body=").length?s=decodeURIComponent(e.url.split("sld_body=")[1]):e.url.indexOf("SLD_BODY=")>-1&&2===e.url.split("SLD_BODY=").length?s=decodeURIComponent(e.url.split("SLD_BODY=")[1]):e.url.indexOf("sld=")>-1&&2===e.url.split("sld=").length?s=decodeURIComponent(e.url.split("sld=")[1]):e.url.indexOf("SLD=")>-1&&2===e.url.split("SLD=").length&&(s=decodeURIComponent(e.url.split("SLD=")[1])),void 0!==s&&T.setSLDStyle(t.getImpl(),l,s,t.legendMap_,t.stylesMap_,!1)}for(var c=0;c<r.length&&!o;c++)e.layerId.indexOf(r[c])>-1&&(void 0!==t.params_.alternativeNameLayers.get(e.layerId)&&(r[c]=t.params_.alternativeNameLayers.get(e.layerId)),e.visible||t.params_.invisibleLayers.set(r[c],e.index),o=!0)})),t.legendMap_=s,t.stylesMap_=a,t.highlight3DMap_.clear(),t.r3DMap_.clear(),t.openGroups_.clear(),T.setStyleFromFile(t.legendMap_,t.stylesMap_,t.getImpl(),t.map_.getLayers(),n),t.listIds=r,t.listN1=i.n1,t.listN2=i.n2,t.params_.idle=!0,t.renderPanel()}}catch(t){M.dialog.error("El fichero para aplicar la configuración no es correcto","Imposible aplicar configuración")}},n.onerror=function(){M.dialog.error("No se puede aplicar el estilo","Imposible aplicar estilo")}}e.remove()})),b.setModalButtonsEvents(e)})),document.getElementById("guardarCapa").addEventListener("click",(function(){K.saveConfiguration(t.listIds,t.listN1,t.listN2,t.map_,t.legendMap_,t.stylesMap_)}))}},{key:"showLoadDownloadButtons",value:function(){var t=document.getElementById("toolbar-title-managelayers"),e="Capas activas"===document.getElementById("toolbar-buttons-managelayers").nextElementSibling.innerHTML;t.style.display=e?"none":"block",0===document.getElementsByClassName("color-junta-flex").length?(K.createNewTitle(t),this.setLoadDownloadFileEvents()):e&&(document.getElementsByClassName("color-junta-flex")[0].style.display="flex")}}]),o}(G);function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ct(t,e){return(ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=pt(t);if(e){var n=pt(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return ut(this,o)}}function ut(t,e){return!e||"object"!==st(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ct(t,e)}(r,M.impl.Control);var e,o,i,n=ht(r);function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=n.call(this)).params_=t||{},e.facadeMap_=null,e}return e=r,(o=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e;var o=t.getMapImpl();ol.control.Control.call(this,{element:e,target:null}),o.addControl(this)}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}}])&&lt(e.prototype,o),i&&lt(e,i),r}(),ft=o(5),gt=o.n(ft);function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t){return function(t){if(Array.isArray(t))return bt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||vt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t,e){if(t){if("string"==typeof t)return bt(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?bt(t,e):void 0}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function _t(t,e,o){return(_t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kt(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function St(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function wt(t,e,o){return e&&St(t.prototype,e),o&&St(t,o),t}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=kt(t);if(e){var n=kt(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return Mt(this,o)}}function Mt(t,e){return!e||"object"!==mt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e)}(o,t);var e=Lt(o);function o(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),M.utils.isUndefined(dt)&&M.exception("La implementación usada no puede crear controles BaseLayersControl");var r={controlName:o.NAME,iconClass:"g-cartografia-localizacion",tooltip:"Mapas base"};i=M.utils.extend(r,i,!0);var a=new dt;return(n=e.call(this,a,t,i)).params_=t||{},n.map_=null,n.baseMaps_=[],n.mapaActivo=null,n.activatedBlankMap=null,n}return wt(o,null,[{key:"NAME",get:function(){return"BaseLayers"}},{key:"TEMPLATE",get:function(){return gt.a}},{key:"BASEMAP_BLANCO",get:function(){return"base_blanco"}},{key:"IMG_BASEMAP_DEFAULT",get:function(){return"assets/img/default.png"}},{key:"IMG_BASEMAP_WHITE",get:function(){return"assets/img/osm.png"}}]),wt(o,[{key:"addTo",value:function(t){_t(kt(o.prototype),"addTo",this).call(this,t),this.map_=t,this.baseMaps_=this.loadConfigInicial(),this.activatedBlankMap=!!M.utils.isNullOrEmpty(this.params_.activatedBlankMap)||this.params_.activatedBlankMap,M.utils.isNullOrEmpty(this.mapaActivo)&&this.activatedBlankMap&&(this.mapaActivo=o.BASEMAP_BLANCO),this.renderPanel()}},{key:"render",value:function(){b.displayOldTitle()}},{key:"renderPanel",value:function(){var t=this.getTemplateVariables_(),e=M.template.compileSync(o.TEMPLATE,{vars:t});this.getControlContainer_().innerHTML=e.innerHTML}},{key:"getTemplateVariables_",value:function(){var t={baseLayers:this.baseMaps_.map(this.parseLayerForTemplate_,this)};return this.activatedBlankMap&&(t.baseMapBlanco={id:o.BASEMAP_BLANCO,activo:o.BASEMAP_BLANCO==this.mapaActivo}),t}},{key:"parseLayerForTemplate_",value:function(t){var e=t.layer,o=e.legend;M.utils.isNullOrEmpty(o)&&(o=e.name),M.utils.isNullOrEmpty(o)&&(o="Mapa base");var i=e.options.descripcion;M.utils.isNullOrEmpty(i)&&(i="Imagen mapa base - "+o);var n=t.img,r=this.mapaActivo===t.id;return{id:t.id,title:o,descripcion:i,img:n,activo:r}}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickBaseLayer(t)})),this.map_.on(M.evt.CHANGE_WMC,(function(){e.mapaActivo=null,e.baseMaps_=e.loadConfigInicial(),e.renderPanel()}))}},{key:"clickBaseLayer",value:function(t){var e=(t=t||window.event).target;if(!M.utils.isNullOrEmpty(e)&&e.classList.contains("m-accion-baselayers-load")){t.stopPropagation();var o=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(o)){var i=this.getControlContainer_().querySelector(".baseActivo"),n=i?i.getAttribute("id"):null;if(o!=n){this.getControlContainer_().querySelector("#"+o).classList.toggle("baseActivo");try{var r=this.findItemByProperty(this.baseMaps_,"id",o);r&&r.layer&&r.layer.getImpl().getOL3Layer().setVisible(!0)}catch(t){}try{if(n)i.classList.toggle("baseActivo"),this.findItemByProperty(this.baseMaps_,"id",n).layer.getImpl().getOL3Layer().setVisible(!1)}catch(t){}}}}}},{key:"loadConfigInicial",value:function(){var t=this,e=this.params_.baseMaps,o=!1,i=this.map_.getBaseLayers().map((function(t){return{img:"",layer:t}}));if(i.length){for(var n=0;n<i.length;n++)i[n].layer.isVisible()&&!o?(i[n].activo=!0,o=!0):i[n].activo=!1;var r,a=function(t,e){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=vt(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw r}}}}(e);try{for(a.s();!(r=a.n()).done;){r.value.activo=!1}}catch(t){a.e(t)}finally{a.f()}o||(i[0].layer.setVisible(!0),i[0].activo=!0,o=!0),e=[].concat(yt(e),yt(i))}return M.utils.isNullOrEmpty(e)&&(e=[]),M.utils.isArray(e)||(e=[e]),e.map((function(e,i){var n;if(e.layer.setZIndex(0),e.id="base_"+i,!0===e.activo&&M.utils.isNullOrEmpty(t.mapaActivo)&&(t.mapaActivo=e.id,o||t.addLayers(e.layer)),M.utils.isNullOrEmpty(e.img)&&(e.img=t.getImgLayer(e.layer)),e.layer instanceof M.Layer)n=e.layer;else try{var r=M.parameter.layer(e.layer);M.utils.isNullOrEmpty(r.type)?M.dialog.error("No se ha especificado un tipo válido para la capa"):n=new M.layer[r.type](e.layer)}catch(t){M.dialog.error("El formato de la capa ("+e.layer+") no se reconoce")}return M.utils.isNullOrEmpty(n.id)&&(n.id=e.id),n.isbaseLayer=!0,n.transparent=!1,M.utils.isUndefined(n.options)&&(n.options={}),n.options.queryable=!1,e.layer=n,e}))}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}},{key:"getImgLayer",value:function(t){if(t.type===M.layer.type.WMS){var e=t.getLegendURL();return e||t.url+(t.url.indexOf("?")>-1?"&":"?")+"service=WMS&request=GetMap&layers="+t.name+"&bbox="+this.map_.getMaxExtent()+"&width=200&height=120&version=1.1.1&srs="+this.map_.getProjection().code+"&format=image/png"}return o.IMG_BASEMAP_DEFAULT}}]),o}(G),Et=(o(12),o(6));function Tt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Pt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,i;return e=t,i=[{key:"initMapeaCoreExtension",value:function(t){if(M.utils.isNullOrEmpty(t.fnEquals_)){t.fnEquals_=[],t.fnEquals_[M.layer.type.GeoJSON]=M.layer.GeoJSON.prototype.equals,t.fnEquals_[M.layer.type.KML]=M.layer.KML.prototype.equals,t.fnEquals_[M.layer.type.Mapbox]=M.layer.Mapbox.prototype.equals,t.fnEquals_[M.layer.type.OSM]=M.layer.OSM.prototype.equals,t.fnEquals_[M.layer.type.WFS]=M.layer.WFS.prototype.equals,t.fnEquals_[M.layer.type.WMC]=M.layer.WMC.prototype.equals,t.fnEquals_[M.layer.type.WMS]=M.layer.WMS.prototype.equals,t.fnEquals_[M.layer.type.WMTS]=M.layer.WMTS.prototype.equals;var e=t.fnEquals_,o=function(t){return M.utils.isUndefined(this.id)?e[this.type](t):this.id===t.id};M.layer.GeoJSON.prototype.equals=o,M.layer.KML.prototype.equals=o,M.layer.Mapbox.prototype.equals=o,M.layer.OSM.prototype.equals=o,M.layer.WFS.prototype.equals=o,M.layer.WMC.prototype.equals=o,M.layer.WMS.prototype.equals=o,M.layer.WMTS.prototype.equals=o}}},{key:"overrideMapeaCore",value:function(){M.impl.layer.WFS.prototype.getCapabilities=M.impl.layer.WMS.prototype.getCapabilities,M.impl.layer.WMS.prototype.getAbstractLayer=M.impl.layer.WFS.prototype.getAbstractLayer=M.impl.layer.WMTS.prototype.getAbstractLayer=function(){return new Promise(function(t,e){M.utils.isNullOrEmpty(this.abstract_)?this.getCapabilities().then(function(e){var o=null;M.utils.isUndefined(e.getInfoCapabilities)?!M.utils.isUndefined(e.Contents)&&e.Contents.Layer&&(o=e.Contents.Layer[0]):o=e.getInfoCapabilities(this.name),this.abstract_=o?o.Abstract:"",t(this.abstract_)}.bind(this)).catch((function(t){return e(t)})):t(this.abstract_)}.bind(this))},M.impl.layer.WMS.prototype.getMetadataURL=M.impl.layer.WFS.prototype.getMetadataURL=function(){var t=this;return new Promise((function(e,o){M.utils.isNullOrEmpty(t.metadataLink_)?t.getCapabilities().then((function(i){var n=null;t instanceof M.impl.layer.WMTS||(n=i.getInfoCapabilities(t.name)),t.metadataLink_=!!n&&!!n.MetadataURL&&n.MetadataURL[0].OnlineResource;var r=document.createElement("a");r.href=t.url,!t.metadataLink_&&["www.ideandalucia.es","www.callejerodeandalucia.es","www.juntadeandalucia.es"].indexOf(r.hostname)>-1?M.remote.get("http://www.ideandalucia.es/catalogo/inspire/srv/spa/q",{any:t.name},{jsonp:!0}).then((function(o){var i=(new DOMParser).parseFromString(o.text,"text/xml").getElementsByTagName("uuid");i.length&&(t.metadataLink_="http://www.ideandalucia.es/catalogo/inspire/srv/spa/metadata.formatter.html?xsl=metadato_completo&uuid="+i[0].childNodes[0].nodeValue),e(t.metadataLink_)})).catch((function(t){return o(t)})):e(t.metadataLink_)})).catch((function(t){return o(t)})):e(t.metadataLink_)}))},M.impl.layer.WMS.prototype.getStylesLayer=function(){var t=this;return new Promise((function(e,o){M.utils.isNullOrEmpty(t.listStyles_)?t.getCapabilities().then((function(o){var i=o.getInfoCapabilities(t.name);t.listStyles_=M.utils.isNullOrEmpty(i)||M.utils.isNullOrEmpty(i.Style)?[]:i.Style,t.selectedStyle_=0,M.utils.isNullOrEmpty(t.listStyles_[0])||M.utils.isNullOrEmpty(t.listStyles_[0].LegendURL)||t.setLegendURL(t.listStyles_[0].LegendURL[0].OnlineResource),t.listStyles_.forEach((function(e,o){e.Name==t.getOL3Layer().getSource().getParams().STYLES&&(t.selectedStyle_=o,M.utils.isNullOrEmpty(e.LegendURL)||t.setLegendURL(e.LegendURL[0].OnlineResource))})),e(t.listStyles_)})).catch((function(t){return o(t)})):e(t.listStyles_)}))},M.impl.layer.WMS.prototype.getSelectedStyle=function(){return M.utils.isNullOrEmpty(this.listStyles_)?null:this.listStyles_[this.selectedStyle_]},M.impl.layer.WMS.prototype.setSelectedStyle=function(t){if(!M.utils.isNullOrEmpty(this.listStyles_)){var e=this.listStyles_[t];this.getOL3Layer().getSource().updateParams({STYLES:e.Name}),this.selectedStyle_=t,M.utils.isNullOrEmpty(e.LegendURL)||this.setLegendURL(e.LegendURL[0].OnlineResource)}},M.impl.GetCapabilities.prototype.getInfoCapabilities=function(t){var e=null,o=null;for(e in this)if(!M.utils.isNullOrEmpty(this[e])&&!M.utils.isUndefined(this[e].Capability)){o=this[e].Capability;break}var i=null;return M.utils.isNullOrEmpty(o)||(i=this.getInfoCapabilitiesRecursive_(o.Layer,t)),i},M.impl.GetCapabilities.prototype.getInfoCapabilitiesRecursive_=function(t,e){var o,i,n=null;if(!M.utils.isNullOrEmpty(t))if(M.utils.isArray(t))for(o=0,i=t.length;o<i&&null===n;o++)n=this.getInfoCapabilitiesRecursive_(t[o],e);else M.utils.isObject(t)&&(M.utils.isNullOrEmpty(e)||t.Name===e?n=t:M.utils.isUndefined(t.Layer)||(n=this.getInfoCapabilitiesRecursive_(t.Layer,e)));return n},M.impl.Map.prototype.removeItemLayers=function(t){var e=this;return M.utils.isNullOrEmpty(t)&&(t=[]),M.utils.isArray(t)||(t=[t]),t.forEach((function(t){e.layers_=e.layers_.filter((function(e){return e!=t})),t.type!==M.layer.type.MBtiles&&t.type!==M.layer.type.WMC&&t.getImpl().destroy(),t.type==M.layer.type.KML&&!0===t.extract&&e.featuresHandler_.removeLayer(t.getImpl())})),this},M.impl.layer.OSM.prototype.destroy=function(){var t=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(t.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map.getLayers().forEach((function(t){(t instanceof M.layer.OSM||t instanceof M.layer.Mapbox)&&(this.haveOSMorMapboxLayer=!0)}),this),this.haveOSMorMapboxLayer||this.map.getImpl().getMapImpl().getControls().getArray().forEach((function(t){t instanceof ol.control.Attribution&&this.map.getImpl().getMapImpl().removeControl(t)}),this),this.map=null},M.impl.Layer.prototype.getLegendURL=function(){return M.utils.isNullOrEmpty(this.legendUrl_)&&(this.legendUrl_=M.utils.concatUrlPaths([M.config.THEME_URL,M.Layer.LEGEND_DEFAULT])),this.legendUrl_},M.impl.Layer.prototype.setLegendURL=function(t){this.legendUrl_=t},M.impl.Map.Z_INDEX={},M.impl.Map.Z_INDEX[M.layer.type.WMC]=1,M.impl.Map.Z_INDEX[M.layer.type.WMS]=1,M.impl.Map.Z_INDEX[M.layer.type.WMTS]=1,M.impl.Map.Z_INDEX[M.layer.type.Mapbox]=1,M.impl.Map.Z_INDEX[M.layer.type.OSM]=1,M.impl.Map.Z_INDEX[M.layer.type.KML]=1,M.impl.Map.Z_INDEX[M.layer.type.WFS]=1}}],(o=null)&&Tt(e.prototype,o),i&&Tt(e,i),t}(),Ot=o(7),At=o.n(Ot);function It(t){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ft(t,e,o){return e&&Nt(t.prototype,e),o&&Nt(t,o),t}function Dt(t,e){return(Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=Bt(t);if(e){var n=Bt(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return Gt(this,o)}}function Gt(t,e){return!e||"object"!==It(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Bt(t){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var jt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(o,t);var e=Rt(o);function o(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=new h(t),a={controlName:o.NAME,iconClass:"g-cartografia-medir-area",tooltip:"Capas temáticas"};return i=M.utils.extend(a,i,!0),(n=e.call(this,r,t,i)).params_=t||{},n.thematicLayers_=[],n.loadConfigInicial(),n}return Ft(o,null,[{key:"NAME",get:function(){return"ThematicLayers"}},{key:"TEMPLATE",get:function(){return At.a}}]),Ft(o,[{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=M.template.compileSync(o.TEMPLATE,{vars:this.getTemplateVariables_()});this.getControlContainer_().innerHTML=t.innerHTML,b.displayOldTitle()}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickThematicLayer(t)}))}},{key:"getTemplateVariables_",value:function(){return{groups:this.params_.groups.map(this.parseGroupForTemplate_,this)}}},{key:"parseGroupForTemplate_",value:function(t,e){var o=this.getOptionsControlManageLayers(t);return M.utils.isNullOrEmpty(o)&&(o={index:e,collapsed:!0,activated:!1},this.setOptionsControlManageLayers(t,o)),{id:t.id,title:t.title,collapsed:!0===o.collapsed,overlays:t.overlays.map(this.parseLayerForTemplate_,this),activated:!0===o.activated}}},{key:"parseLayerForTemplate_",value:function(t,e){var o=t.legend;return M.utils.isNullOrEmpty(o)&&(o=t.name),M.utils.isNullOrEmpty(o)&&(o="Servicio WMS"),{id:t.id,name:t.name,title:o,load:!0===this.isLoadLayer(t)}}},{key:"clickThematicLayer",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,o=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(o)){t.stopPropagation();var i=this.getControlContainer_(),n=this.getQuerySelectorScapeCSS(i,"#optionsTocGroup_",o);if(e.classList.contains("m-accion-thematiclayers-collapse")){var r=this.findItemByProperty(this.params_.groups,"id",o);this.getOptionsControlManageLayers(r).collapsed=!n.classList.contains("dNone"),e.classList.toggle("g-cartografia-flecha-abajo2"),e.classList.toggle("g-cartografia-flecha-arriba2"),n.classList.toggle("dNone")}else if(e.classList.contains("m-accion-thematiclayers-load-group")){var a=e.classList.contains("g-cartografia-mas2")?"input[type=checkbox]:not(:checked)":"input[type=checkbox]:checked";n.querySelectorAll(a).forEach((function(t,e){t.click()})),e.classList.toggle("g-cartografia-mas2"),e.classList.toggle("g-cartografia-cancelar2"),e.title=e.classList.contains("g-cartografia-mas2")?"Añadir todas las capas del grupo":"Eliminar todas las capas del grupo";var s=this.findItemByProperty(this.params_.groups,"id",o);this.getOptionsControlManageLayers(s).activated=!e.classList.contains("g-cartografia-mas2")}else if(e.classList.contains("m-accion-thematiclayers-load")){var l=this.findItemByProperty(this.thematicLayers_,"id",o);if(!0===!e.checked){var c=this.findItemByProperty(this.map_.getLayers(),"id",o),h=this.findLayerByNameURL(l.name,l.url);null!==c?(this.removeLayers(c),c.setZIndex(null)):null!==h&&(this.map_.removeLayers(h),h.setZIndex(null))}else this.addLayers(l)}}}}},{key:"loadConfigInicial",value:function(){var t=this,e=this.params_.groups;M.utils.isNullOrEmpty(e)&&(e=[]),M.utils.isArray(e)||(e=[e]),e.forEach((function(e,o){M.utils.isNullOrEmpty(e.id)&&(e.id="grp_thematic_"+o,e.index=o),M.utils.isNullOrEmpty(e.options)&&(e.options={}),M.utils.isNullOrEmpty(e.title)&&(e.title="Grupo - "+o),M.utils.isNullOrEmpty(e.overlays)&&(e.overlays=[]),e.overlays=t.loadConfigOverlays(e,e.overlays),t.thematicLayers_=t.thematicLayers_.concat(e.overlays)}),this),this.params_.groups=e}},{key:"loadConfigOverlays",value:function(t,e){return M.utils.isArray(e)||(e=[e]),e.map((function(e,o){var i;if(e instanceof M.Layer)i=e;else try{var n=M.parameter.layer(e);M.utils.isNullOrEmpty(n.type)?M.dialog.error("No se ha especificado un tipo válido para la capa"):i=new M.layer[n.type](e)}catch(t){M.dialog.error("El formato de la capa ("+e+") no se reconoce")}return M.utils.isNullOrEmpty(i.options)&&(i.options={}),i.options.isTematica=!0,i.options.origen="Tematica",M.utils.isNullOrEmpty(i.id)&&(i.id="thematic_"+t.index+"_"+o),i}))}}]),o}(G),qt=o(8),Vt=o.n(qt);o(13),o(14);function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zt(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ut(t,e){return(Ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=Yt(t);if(e){var n=Yt(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return Wt(this,o)}}function Wt(t,e){return!e||"object"!==zt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Yt(t){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ut(t,e)}(r,M.impl.Control);var e,o,i,n=Ht(r);function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=n.call(this)).params_=t||{},e.facadeMap_=null,e}return e=r,(o=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e}}])&&Zt(e.prototype,o),i&&Zt(e,i),r}(),Jt=o(9),Kt=o.n(Jt);o(15);function Qt(t){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $t(t,e,o){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=re(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function te(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ee(t,e,o){return e&&te(t.prototype,e),o&&te(t,o),t}function oe(t,e){return(oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ie(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=re(t);if(e){var n=re(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return ne(this,o)}}function ne(t,e){return!e||"object"!==Qt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function re(t){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oe(t,e)}(o,t);var e=ie(o);function o(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),M.utils.isUndefined(Xt)&&M.exception("La implementación usada no puede crear controles BaseLayersControl");var r={controlName:o.NAME,iconClass:"g-sigc-palette stylemanager-toc-button",tooltip:"Style manager"};i=M.utils.extend(r,i,!0);var a=new Xt;return(n=e.call(this,a,t,i)).params_=t||{},n}return ee(o,null,[{key:"NAME",get:function(){return"StyleManager"}},{key:"TEMPLATE",get:function(){return Kt.a}}]),ee(o,[{key:"addTo",value:function(t){$t(re(o.prototype),"addTo",this).call(this,t),this.map_=t,this.renderPanel()}},{key:"render",value:function(){b.displayOldTitle(),this.removeStyleManagerPlugin(this.map_),this.addStyleManager(this.map_)}},{key:"renderPanel",value:function(){var t=M.template.compileSync(o.TEMPLATE);this.getControlContainer_().innerHTML=t.innerHTML}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}},{key:"removeStyleManagerPlugin",value:function(t){this.activateLoading();for(var e,o=!1,i=0;i<t.getPlugins().length&&!o;i++){var n=t.getPlugins()[i],r=void 0;(r=M.version&&parseInt(M.version.substring(0,1))>=5?n.name:n.constructor.toString().substring(n.constructor.toString().indexOf(" ")+1,n.constructor.toString().indexOf("(")))&&(r=r.toLowerCase()),"stylemanager"===r&&(e=n,o=!0)}if(void 0!==e){t.removePlugins(e);for(var a=document.getElementById("toc-stylemanager");a.firstChild;)a.removeChild(a.lastChild)}}},{key:"addStyleManager",value:function(t){var e=this,o=new M.plugin.StyleManager;t.addPlugin(o),t.getPanels().forEach((function(o){"m-panel-btn g-sigc-palette"===o._buttonPanel.className&&(M.version&&parseInt(M.version.substring(0,1))>=5?e.styleManagerInTOC(t):o.on(M.evt.ADDED_TO_MAP,(function(){e.styleManagerInTOC(t)})))}))}},{key:"styleManagerInTOC",value:function(t){var e=this;document.getElementsByClassName("m-panel m-stylemanager")[0].style.display="none",document.getElementsByClassName("m-panel-btn g-sigc-palette")[0].addEventListener("click",(function(){setTimeout((function(){document.getElementById("toc-stylemanager").appendChild(document.getElementsByClassName("m-stylemanager-control styles-panel")[0]),document.getElementsByClassName("gi-1x g-sigc-apply")[0].parentNode.addEventListener("click",(function(){var e=document.getElementById("m-stylemanager-select"),o=e.options[e.selectedIndex].value,i=b.getLayerByNameOrId(t,o,o,null);if(null!==i){var n=i.getStyle().toImage();n instanceof Promise?n.then((function(t){i.setLegendURL(t)})):i.setLegendURL(n),void 0===i.getStyle().options_.label?i.getStyle().options_.label="|remove_legends_map":i.getStyle().options_.label+="|remove_legends_map";var r=document.createElement("input");r.setAttribute("id","doneIndicator"),r.setAttribute("type","hidden"),document.getElementsByTagName("body")[0].appendChild(r),document.querySelector("[id$='".concat(i.name,"']")).children[0].children[2].click()}})),e.deactivateLoading()}),1e3)})),document.getElementsByClassName("m-panel-btn g-sigc-palette")[0].click()}}]),o}(G);function se(t){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function le(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ce(t,e,o){return e&&le(t.prototype,e),o&&le(t,o),t}function he(t,e){return(he=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ue(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=fe(t);if(e){var n=fe(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return pe(this,o)}}function pe(t,e){return!e||"object"!==se(e)&&"function"!=typeof e?de(t):e}function de(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fe(t){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&he(t,e)}(o,M.Plugin);var e=ue(o);function o(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=e.call(this)).name=o.NAME,i.map_=null,i.controls_=[],t=t||{},i.config_=t.config||{},i.params_=t.params||{},i.metadata_=Et.metadata,i.options_=t.options||{},Pt.overrideMapeaCore(),Pt.initMapeaCoreExtension(de(i)),i}return ce(o,null,[{key:"NAME",get:function(){return"ManageLayers"}},{key:"TEMPLATE",get:function(){return Vt.a}}]),ce(o,[{key:"addTo",value:function(t){var e=this;this.map_=t;var i=this.createView(t);this.toolbar_={target:i,selector:"#toolbar-"+o.NAME.toLowerCase(),selectorBtn:".m-toolbar-buttons",selectorContainer:".m-toolbar-containers"},this.map_.on(M.evt.COMPLETED,(function(){M.utils.isNullOrEmpty(e.params_.metadata)?e.initControls():M.remote.get(e.params_.metadata,null,{jsonp:!1}).then((function(t){!1===t.error||M.dialog.error("Se ha producido un error al cargar la configuración de metadatos","Configuración metadatos"),e.initControls()}))}))}},{key:"getConfigControl",value:function(t){var e=this.config_[t]||{};return e.params=e.params||{},e.options=e.options||{},e.options.toolbar=this.toolbar_,e}},{key:"initControls",value:function(){var t=this,e=null,o=null;o=this.getConfigControl("activeLayers"),e=new at(o.params,o.options),this.addControlToPlugin_(e);var i=o.params.canEdit;o=this.getConfigControl("baseLayers"),e=new Ct(o.params,o.options),this.addControlToPlugin_(e),this.config_&&this.config_.thematicLayers&&!1!==this.config_.thematicLayers.show&&(o=this.getConfigControl("thematicLayers"),e=new jt(o.params,o.options),this.addControlToPlugin_(e)),i&&(o=this.getConfigControl("styleManager"),e=new ae(o.params,o.options),this.addControlToPlugin_(e)),this.panel_=this.getPanel_(),this.panel_.addControls(this.controls_),this.panel_.on(M.evt.ADDED_TO_MAP,(function(){return t.fire(M.evt.ADDED_TO_MAP)})),this.map_.addPanels(this.panel_)}},{key:"createView",value:function(t){return M.template.compileSync||(M.template.compileSync=function(t,e){var o,i={};M.utils.isUndefined(e)||(i=M.utils.extends(i,e.vars),o=e.parseToHtml);var n=Handlebars.compile(t)(i);return!1!==o?M.utils.stringToHtml(n):n}),M.template.compileSync(o.TEMPLATE,{})}},{key:"addControlToPlugin_",value:function(t){t.on(M.evt.ACTIVATED,(function(){t.render()})),this.controls_.push(t)}},{key:"getPanel_",value:function(){var t=this,e=M.utils.isNullOrEmpty(this.options_.panel)||M.utils.isNullOrEmpty(this.options_.panel.name)?"managelayers":this.options_.panel.name,o=this.map_.getPanels(e)[0];return M.utils.isNullOrEmpty(o)&&((o=new M.ui.Panel(e,this.getPanelOptions_())).on(M.evt.ADDED_TO_MAP,(function(t){M.utils.enableTouchScroll(t)})),o.on(M.evt.SHOW,(function(e){for(var o=!1,i=t.getControls(),n=0;n<i.length;n++)if(i[n].activated){o=!0;break}o||t.map_.getControls(at.NAME)[0].activate()}))),o}},{key:"getPanelOptions_",value:function(){var t={};return M.utils.isNullOrEmpty(this.options_.panel)||(t=this.options_.panel),{collapsible:!0,className:"m-managelayers"+(M.utils.isNullOrEmpty(t.className)?"":" "+t.className),collapsedButtonClass:M.utils.isNullOrEmpty(t.collapsedClass)?"g-cartografia-capas2":t.collapsedClass,position:M.utils.isNullOrEmpty(t.position)?M.ui.position.TR:t.position,tooltip:M.utils.isNullOrEmpty(t.tooltip)?"Gestor de capas":t.tooltip}}},{key:"getControls",value:function(){return this.controls_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.controls_=null,this.panel_=null,this.params_=null,this.options_=null,this.name=null}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=!0),e}},{key:"getMetadata",value:function(){return this.metadata_}}]),o}(),me=o(10),ye=o.n(me);function ve(t){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function be(t,e,o){return(be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Me(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(o):n.value}})(t,e,o||t)}function _e(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Se(t,e,o){return e&&_e(t.prototype,e),o&&_e(t,o),t}function we(t,e){return(we=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=Me(t);if(e){var n=Me(this).constructor;o=Reflect.construct(i,arguments,n)}else o=i.apply(this,arguments);return Le(this,o)}}function Le(t,e){return!e||"object"!==ve(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Me(t){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&we(t,e)}(o,t);var e=xe(o);function o(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=new h(t),a={controlName:o.NAME,iconClass:"g-cartografia-capas",tooltip:"Capas WMC"};return i=M.utils.extend(a,i,!0),(n=e.call(this,r,t,i)).params_=t||{},n}return Se(o,null,[{key:"NAME",get:function(){return"WMCLayers"}},{key:"TEMPLATE",get:function(){return ye.a}}]),Se(o,[{key:"addTo",value:function(t){var e=this;be(Me(o.prototype),"addTo",this).call(this,t),this.wmc_=this.getWMCSelected(),this.render(),this.map_.on(M.evt.CHANGE_WMC,(function(t){e.wmc_=e.getWMCSelected(),e.render()}),this)}},{key:"getWMCSelected",value:function(){var t=this.map_.getWMC().filter((function(t){return 1==t.selected})),e=t?t[0]:null;return e&&e.layers.forEach((function(t,e){M.utils.isNullOrEmpty(t.id)&&(t.id="WMC_"+e)})),e}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=M.template.compileSync(o.TEMPLATE,{vars:this.getTemplateVariables_()});this.getControlContainer_().innerHTML=t.innerHTML}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickWmcLayer(t)}))}},{key:"getTemplateVariables_",value:function(){if(M.utils.isNullOrEmpty(this.wmc_))return{name:"",wmcLayers:[]};var t=this.wmc_.layers.filter((function(t){var e=t.type!==M.layer.type.WMC,o=!(t.type===M.layer.type.WMS&&M.utils.isNullOrEmpty(t.name));return e&&o&&!0}));return{name:this.wmc_.name,wmcLayers:t.map(this.parseLayerForTemplate_,this)}}},{key:"parseLayerForTemplate_",value:function(t){var e=t.legend;return M.utils.isNullOrEmpty(e)&&(e=t.name),M.utils.isNullOrEmpty(e)&&(e="Servicio WMS"),M.utils.isNullOrEmpty(t.options)&&(t.options={}),M.utils.isNullOrEmpty(t.options.origen)&&(t.options.isWMC=!0,t.options.origen="WMC"),{id:t.id,name:t.name,title:e,load:!0===this.isLoadLayer(t)}}},{key:"clickWmcLayer",value:function(t){var e=(t=t||window.event).target;if(!M.utils.isNullOrEmpty(e))if(e.classList.contains("m-accion-wmclayers-load-group")){t.stopPropagation();var o=e.classList.contains("g-cartografia-mas2")?"input[type=checkbox]:not(:checked)":"input[type=checkbox]:checked";this.getControlContainer_().querySelectorAll(o).forEach((function(t,e){t.click()})),e.classList.toggle("g-cartografia-mas2"),e.classList.toggle("g-cartografia-cancelar2"),e.title=e.classList.contains("g-cartografia-mas2")?"Añadir todas las capas":"Eliminar todas las capas"}else{var i=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(i)){t.stopPropagation();var n=this.findItemByProperty(this.wmc_.layers,"id",i);if(e.classList.contains("m-accion-wmclayers-load"))!0===this.isLoadLayer(n)?(this.removeLayers(n),this.resetOptionsManageLayers(n)):this.addLayers(n)}}}},{key:"equals",value:function(t){var e=!1;return t instanceof o&&(e=this.name===t.name),e}}]),o}(G);window.M.control||(window.M.control={}),window.M.plugin||(window.M.plugin={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.control.ActiveLayersControl=at,window.M.plugin.BaseLayersControl=Ct,window.M.plugin.ManageLayers=ge,window.M.control.ManageLayersControl=G,window.M.plugin.StyleManagerControl=ae,window.M.control.ThematicLayersControl=jt,window.M.control.WMCLayersControl=ke,window.M.impl.control.ActiveLayersControl=U,window.M.impl.control.BaseLayersControl=dt,window.M.impl.control.ManageLayersControl=h,window.M.impl.control.StyleManagerControl=Xt}]);
//# sourceMappingURL=managelayers.ol.min.js.map